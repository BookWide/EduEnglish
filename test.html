<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <title>測試重設密碼連結</title>
</head>
<body>
  <input id="resetEmail" type="email" placeholder="請輸入註冊 email">
  <button id="btnSend">產生重設連結</button>
  <pre id="msg"></pre>

  <script type="module">
    const btn = document.getElementById('btnSend');
    const msg = document.getElementById('msg');

    btn.addEventListener('click', async () => {
      msg.textContent = '';
      const email = document.getElementById('resetEmail').value.trim();
      if (!email) {
        msg.textContent = '請輸入 email';
        return;
      }

      btn.disabled = true;

      try {
        const res = await fetch(
          'https://jeajrwpmrgczimmrflxo.supabase.co/functions/v1/generate-reset-link',
          {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ email })
          }
        );

        const text = await res.text();
        let data;
        try {
          data = JSON.parse(text);
        } catch {
          data = { raw: text };
        }

        if (!res.ok) {
          msg.textContent = '錯誤：' + (data.error || JSON.stringify(data));
          return;
        }

        // ✅ 成功：印出 link
        msg.textContent = '產生的重設連結：\n' + data.link;

        // 實際使用時可以直接：
        // window.location.href = data.link;
      } catch (err) {
        msg.textContent = '系統錯誤：' + err.message;
      } finally {
        btn.disabled = false;
      }
    });
  </script>
</body>
</html>

