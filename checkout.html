<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>BookWide | 結帳</title>
  <style>
    body {
      background:#fff;
      color:#000;
      font-family:'Microsoft JhengHei','Noto Sans TC','PingFang TC','Heiti TC',sans-serif;
      margin:0;
      padding:20px;
    }
    h1 {font-size:26px;margin:10px 0;}
    .card {border:1px solid #ccc;border-radius:10px;padding:20px;max-width:800px;margin:auto;background:#fafafa;}
    .row {display:flex;justify-content:space-between;border-bottom:1px solid #ddd;padding:10px 0;}
    .row:last-child {border-bottom:none;}
    .pill {background:#000;color:#fff;padding:4px 12px;border-radius:999px;margin-left:4px;}
    .price {text-align:right;min-width:100px;}
    .total {font-weight:700;font-size:20px;}
    button {width:100%;background:#22c55e;color:#fff;padding:16px;border:none;border-radius:8px;font-size:18px;font-weight:bold;cursor:pointer;margin-top:20px;}
  </style>
</head>
<body>
  <h1>訂單摘要</h1>
  <div class="card">
    <div class="row"><div>週期：</div><div id="periodLabel">月</div></div>
    <div class="row"><div>方案：</div><div id="itemsPills"></div></div>
    <div class="row"><div>推薦碼：</div><div id="refLabel">無</div></div>
    <div id="lineItems"></div>
    <div class="row"><div>小計</div><div id="subtotal" class="price">$0</div></div>
    <div class="row" id="rowDiscount" style="display:none"><div>折扣</div><div id="discount" class="price">-$0</div></div>
    <div class="row"><div>稅額(0%)</div><div id="tax" class="price">$0</div></div>
    <div class="row"><div class="total">應付金額</div><div id="grand" class="price total">$0</div></div>
    <button id="btnPay">確認付款</button>
  </div>

<script>
(function(){
  const UNIT_PRICES={month:200,half:960,year:1680};
  const PERIOD_TEXT={month:"月",half:"半年",year:"年"};
  const DISCOUNT=0.9;

  const usp=new URLSearchParams(location.search);
  const items=(usp.get("items")||"").split(",").map(s=>s.trim()).filter(Boolean);
  const period=usp.get("period")||"month";
  const refFromUrl=usp.get("ref");
  if(refFromUrl)localStorage.setItem("referral_code",refFromUrl);
  const referral=localStorage.getItem("referral_code")||"";

  const elPeriod=document.getElementById("periodLabel");
  const elItems=document.getElementById("itemsPills");
  const elRef=document.getElementById("refLabel");
  const elLine=document.getElementById("lineItems");
  const elSub=document.getElementById("subtotal");
  const elDisc=document.getElementById("discount");
  const elTax=document.getElementById("tax");
  const elGrand=document.getElementById("grand");
  const elRowDisc=document.getElementById("rowDiscount");
  const btn=document.getElementById("btnPay");

  elPeriod.textContent=PERIOD_TEXT[period]||"月";

  if(items.length===0){location.href="./pricing.html";return;}
  elItems.innerHTML=items.map(i=>"<span class='pill'>"+i+"</span>").join(" ");

  if(referral){
    elRef.innerHTML="<span class='pill'>"+referral+"</span>";
  }else{
    elRef.textContent="無";
  }

  const unit=UNIT_PRICES[period]||200;
  elLine.innerHTML=items.map(i=>"<div class='row'><div>"+i+"</div><div class='price'>$"+unit+"</div></div>").join("");
  const subtotal=unit*items.length;
  let discount=0;
  if(referral){discount=Math.round(subtotal*(1-DISCOUNT));elRowDisc.style.display="flex";elDisc.textContent="-$"+discount;}
  else elRowDisc.style.display="none";

  const grand=subtotal-discount;
  elSub.textContent="$"+subtotal;
  elTax.textContent="$0";
  elGrand.textContent="$"+grand;

  btn.onclick=()=>alert("付款測試頁 - 金額 "+grand+" 元");
})();
</script>
</body>
</html>













