<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BookWide｜結帳（訂閱方案）</title>
  <style>
    :root{
      --fg:#111;
      --bg:#f7f8fa;
      --card:#fff;
      --muted:#6b7280;
      --line:#e5e7eb;
      --brand:#111;
      --ok:#0a7f2e;
      --bad:#b91c1c;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      background:var(--bg);
      color:var(--fg);
      font:15px/1.7 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;
    }
    header{
      border-bottom:1px solid var(--line);
      background:#fff;
    }
    .wrap{
      max-width:980px;
      margin:0 auto;
      padding:18px 16px 32px;
    }
    .nav{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
    }
    .nav-title{
      font-size:22px;
      font-weight:800;
      letter-spacing:.04em;
    }
    .nav-back{
      font-size:14px;
      color:#2563eb;
      text-decoration:none;
    }
    .nav-back:hover{text-decoration:underline;}

    main{margin-top:18px;}
    .section{
      background:var(--card);
      border-radius:16px;
      border:1px solid var(--line);
      padding:18px 18px 20px;
      margin-bottom:18px;
    }
    .section h2{
      margin:0 0 10px;
      font-size:18px;
    }
    .section-sub{
      margin-top:-2px;
      margin-bottom:10px;
      color:var(--muted);
      font-size:13px;
    }

    .pills{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin:2px 0 10px;
    }
    .pill{
      padding:4px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#f9fafb;
      font-size:13px;
    }

    .plan-row{
      margin-top:4px;
      font-size:14px;
    }
    .plan-price{
      margin-top:6px;
      font-size:26px;
      font-weight:800;
    }
    .plan-price small{
      font-size:13px;
      font-weight:400;
      color:var(--muted);
      margin-left:4px;
    }
    .plan-note{
      margin-top:8px;
      font-size:13px;
      color:var(--muted);
    }

    textarea{
      width:100%;
      min-height:110px;
      padding:10px;
      border-radius:10px;
      border:1px solid var(--line);
      resize:vertical;
      font:14px/1.6 inherit;
    }
    textarea:focus{
      outline:2px solid #d1e0ff;
      outline-offset:1px;
      border-color:#2563eb;
    }

    .field-label{
      font-size:14px;
      margin-bottom:4px;
    }
    .hint{
      font-size:12px;
      color:var(--muted);
      margin-top:4px;
    }

    .pay-options{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      margin-top:4px;
    }
    .pay-pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#f9fafb;
      font-size:14px;
      cursor:pointer;
    }
    .pay-pill input{
      accent-color:#111;
    }

    .actions{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:14px;
    }
    button{
      font:14px/1.4 inherit;
      cursor:pointer;
      border-radius:10px;
      border:1px solid transparent;
      padding:9px 16px;
    }
    .btn-primary{
      background:#111;
      color:#fff;
      border-color:#111;
    }
    .btn-primary:disabled{
      opacity:.5;
      cursor:not-allowed;
    }
    .btn-ghost{
      background:#fff;
      color:#111;
      border-color:var(--line);
    }

    .msg{
      margin-top:10px;
      font-size:13px;
    }
    .msg-ok{color:var(--ok);}
    .msg-bad{color:var(--bad);}

    #refTag{
      display:none;
      margin-top:8px;
      font-size:13px;
      padding:3px 8px;
      border-radius:999px;
      background:#ecfdf3;
      color:#166534;
      border:1px solid #bbf7d0;
      width:max-content;
    }

    footer{
      text-align:center;
      padding:20px 0 30px;
      color:var(--muted);
      font-size:13px;
    }

    @media (max-width:640px){
      .wrap{padding:14px 12px 28px;}
      .section{padding:14px 12px 16px;}
      .plan-price{font-size:22px;}
    }
  </style>
</head>
<body>
<header>
  <div class="wrap nav">
    <div>
      <div class="nav-title">BookWide</div>
      <div style="font-size:12px;color:var(--muted);margin-top:2px;">
        ENGLISH LEARNING
      </div>
    </div>
    <a href="pricing.html" class="nav-back">← 回方案與定價</a>
  </div>
</header>

<main class="wrap">

  <!-- 訂閱方案 -->
  <section class="section">
    <h2>訂閱方案</h2>
    <div class="section-sub">以下內容由 pricing.html 帶入：</div>

    <div id="itemsPills" class="pills"></div>

    <div class="plan-row" id="periodText">方案期間：—</div>

    <div class="plan-price" id="priceText">
      0 元 <small>（由 pricing.html 傳入）</small>
    </div>

    <div class="plan-note">
      若金額或項目不正確，請先回 pricing.html 重新選擇方案再進入本頁。
    </div>

    <div id="refTag"></div>
  </section>

  <!-- 備註 / 發票 -->
  <section class="section">
    <h2>備註／發票資訊（選填）</h2>
    <p class="section-sub">
      如需填寫統編、抬頭，或其他備註，請在此留下（選填）。
    </p>

    <div class="field">
      <div class="field-label">備註內容</div>
      <textarea id="note" placeholder="此欄位內容會一起寫入訂單，並附在通知 email 中。"></textarea>
      <div class="hint">例：XX 公司，統編 12345678，抬頭：OOO。</div>
    </div>
  </section>

  <!-- 付款方式 -->
  <section class="section">
    <h2>付款方式</h2>
    <p class="section-sub">目前為測試環境，可先使用「模擬付款成功」流程。</p>

    <div class="field-label">選擇付款方式</div>
    <div class="pay-options">
      <label class="pay-pill">
        <input type="radio" name="pay" value="sim" checked>
        模擬付款（測試用）
      </label>
      <label class="pay-pill">
        <input type="radio" name="pay" value="bank">
        匯款 / 轉帳
      </label>
      <label class="pay-pill">
        <input type="radio" name="pay" value="other">
        其他方式（之後再聯繫）
      </label>
    </div>

    <div class="actions">
      <button id="btnSubmit" class="btn-primary">模擬付款成功，建立訂單</button>
      <button id="btnPrint" class="btn-ghost" type="button">列印這一頁</button>
    </div>

    <div id="msgArea" class="msg"></div>
  </section>

</main>

<footer>BookWide © 2025</footer>

<script>
  // ========= 1. 解析 URL 參數 =========
  const params = new URLSearchParams(location.search);

  // 主題列表
  const rawItemsParam = (params.get('topics') || params.get('items') || '').trim();
  const items = rawItemsParam
    ? rawItemsParam.split(',').map(s => s.trim()).filter(Boolean)
    : ['story']; // 沒帶就預設故事

  // plan / period → period（month / half / year）
  let period = (params.get('period') || params.get('plan') || 'month').trim();
  if (period === 'monthly') period = 'month';
  if (period === 'semi') period = 'half';              // ★ semi → half
  if (['halfyear', 'half-year', '6m'].includes(period)) period = 'half';
  if (['yearly', '12m'].includes(period)) period = 'year';

  // 每個方案的價格（你要改價只改這裡就好，單位：元）
  function pricePerTopic(p) {
    switch (p) {
      case 'month': return 1000;  // 月繳 1000
      case 'half':  return 5400;  // 半年 5400
      case 'year':  return 9600;  // 年繳 9600
      default:      return 0;
    }
  }

  // amount：如果 URL 有帶就用 URL，沒有就用預設方案金額計算
  let amount = Number(params.get('amount') || '0');
  if (!amount || isNaN(amount)) {
    // ★ 不再乘以主題數量，直接用方案金額
    amount = pricePerTopic(period);
  }

  // 推薦碼（可有可無）
  const refCode = (params.get('ref') || params.get('referral') || '').trim();

  // ========= 2. 顯示在畫面上 =========
  const itemsPillsEl = document.getElementById('itemsPills');
  const periodTextEl = document.getElementById('periodText');
  const priceTextEl = document.getElementById('priceText');
  const refTagEl = document.getElementById('refTag');

  function zhItemName(key) {
    switch (key) {
      case 'story': return '故事 Story';
      case 'music': return '音樂 Music';
      case 'movie': return '電影 Movie';
      case 'news':  return '新聞 News';
      case 'pro':   return '職場 Pro';
      default:      return key;
    }
  }

  function zhPeriod(p) {
    switch (p) {
      case 'month': return '月方案';
      case 'half':  return '半年方案';
      case 'year':  return '一年方案';
      default:      return p;
    }
  }

  items.forEach(k => {
    const pill = document.createElement('span');
    pill.className = 'pill';
    pill.textContent = zhItemName(k);
    itemsPillsEl.appendChild(pill);
  });

  periodTextEl.textContent = '方案期間：' + zhPeriod(period);
  priceTextEl.textContent = isNaN(amount) ? '—' : amount.toLocaleString() + ' 元';

  if (refCode) {
    refTagEl.style.display = 'inline-block';
    refTagEl.textContent = '推薦碼：' + refCode;
  }

  // ========= 3. 送出訂單（目前模擬） =========
  function getSelectedPayMethod(){
    const r = document.querySelector('input[name="pay"]:checked');
    return r ? r.value : 'sim';
  }

  function showMessage(text, ok=true){
    const box = document.getElementById('msgArea');
    box.textContent = text;
    box.className = 'msg ' + (ok ? 'msg-ok' : 'msg-bad');
  }

  document.getElementById('btnSubmit').addEventListener('click', async ()=>{
    const note = document.getElementById('note').value.trim();
    const pay  = getSelectedPayMethod();

    const payload = {
      items,
      period,
      amount,
      pay_method: pay,
      note,
      referral_code: refCode || null
    };

    console.log('模擬送出訂單 payload =', payload);
    showMessage('模擬付款成功！訂單已在前端建立（詳見 console）。實際上線時可在此接 Supabase Edge Function。', true);
  });

  document.getElementById('btnPrint').addEventListener('click', ()=>{
    window.print();
  });
</script>
</body>
</html>







































































































