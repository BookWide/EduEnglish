<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8">
  <title>訂單摘要</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <script type="module">
    import { supabase } from './supa.js';
    window.supabase = supabase;
  </script>
</head>
<body>
  <div style="max-width:480px;margin:40px auto;padding:20px;border:1px solid #ddd;border-radius:12px;font-family:'Microsoft JhengHei';">
    <h2>訂單摘要</h2>
    <p>方案：<span id="plan">story</span></p>
    <p>金額：<span id="price">$200</span></p>
    <button id="payBtn" style="width:100%;padding:12px;background:#000;color:#fff;border:none;border-radius:8px;font-size:16px;">確認付款</button>
  </div>

  <script>
    const BASE_URL = "https://jeajrwpmrgczimmrflxo.supabase.co"; // ✅ 你的 Supabase 專案

    const supabase = window.supabase;

    document.getElementById("payBtn").onclick = async () => {
      const { data: { session } } = await supabase.auth.getSession();

      if (!session) {
        alert("請先登入帳號再付款");
        return;
      }

      const orderId = "ORDER-" + Date.now();
      console.log("→ 建立訂單:", orderId);

      // ✅ 使用 multipart/form-data 送給 Edge Function
      const form = document.createElement("form");
      form.method = "POST";
      form.action = `${BASE_URL}/functions/v1/create-ecpay-order`;
      form.enctype = "multipart/form-data";
      form.innerHTML = `
        <input type="hidden" name="order_id" value="${orderId}">
        <input type="hidden" name="token" value="${session.access_token}">
      `;
      document.body.appendChild(form);
      form.submit();
    };
  </script>
</body>
</html>











