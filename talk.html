<!DOCTYPE html>

<html lang="zh-Hant">
<head>
<!-- ===== BookWide Guard (Talk: subscription required) ===== -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  // BookWide Supabase public config (global)
  const SUPABASE_URL = 'https://jeajrwpmrgczimmrflxo.supabase.co';
  const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImplYWpyd3BtcmdjemltbXJmbHhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3MTg5MzksImV4cCI6MjA3NjI5NDkzOX0.3iFXdHH0JEuk177_R4TGFJmOxYK9V8XctON6rDe7-Do';
  window.SUPABASE_URL = SUPABASE_URL;
  window.SUPABASE_ANON_KEY = SUPABASE_ANON_KEY;
</script>
<script>(async function(){
  try{
    const SUPABASE_URL = window.SUPABASE_URL || 'https://jeajrwpmrgczimmrflxo.supabase.co';
    const SUPABASE_ANON_KEY = window.SUPABASE_ANON_KEY || '';
    const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
      auth: { persistSession:true, autoRefreshToken:true, detectSessionInUrl:true }
    });

    // 1) ÂøÖÈ†àÁôªÂÖ•
    const { data: sess } = await supabase.auth.getSession();
    const session = sess && sess.session;
    if(!session || !session.user){
      const red = encodeURIComponent(location.pathname + location.search + location.hash);
      location.replace('/account/login.html?redirect=' + red);
      return;
    }

    const user = session.user;
    const uid = user.id;
    const email = (user.email || '').toLowerCase();
    const today = new Date().toLocaleDateString('en-CA', { timeZone: 'Asia/Taipei' }); // YYYY-MM-DD

    // 2) profiles ÂÑ™ÂÖàÔºàËã• RLS ÊìãÂà∞‰πü‰∏çË¶ÅÁõ¥Êé•Âà§Ê≠ªÔºâ
    let paused = false;
    let pexp = '';
    let profileReadable = true;
    try{
      const { data: prof, error: perr } = await supabase
        .from('profiles')
        .select('expires_at,is_paused')
        .eq('id', uid)
        .maybeSingle();
      if(perr) profileReadable = false;
      if(prof){
        paused = !!prof.is_paused;
        if(prof.expires_at) pexp = String(prof.expires_at).slice(0,10);
      }
    }catch(e){
      profileReadable = false;
    }

    // 3) orders fallbackÔºàÁî® user_idÔºõÂ§±ÊïóÂÜçÁî® emailÔºâ
    let oexp = '';
    let hasPaid = false;
    let opaid = '';
    let ocreated = '';
    async function readOrderBy(field, value){
      try{
        const r = await supabase
          .from('orders')
          .select('status,expires_at,paid_at,created_at')
          .eq(field, value)
          .order('created_at', { ascending:false })
          .limit(1);
        if(!r.error && r.data && r.data.length){
          const row = r.data[0];
          const st = String(row.status || '').toLowerCase();
          hasPaid = (st === 'paid');
          if(row.expires_at) oexp = String(row.expires_at).slice(0,10);
          if(row.paid_at) opaid = String(row.paid_at);
          if(row.created_at) ocreated = String(row.created_at);
          return true;
        }
      }catch(e){}
      return false;
    }
    await readOrderBy('user_id', uid) || (email && await readOrderBy('email', email));

    // 4) Âà§Êñ∑ÊòØÂê¶ÊîæË°å
    let ok = (!paused) && (
      (pexp && pexp >= today) ||
      (oexp && oexp >= today)
    );

    // paid ‰ΩÜÁº∫ expires_atÔºöÁî® paid_at / created_at ÂÅö‰øùÂÆàÊîæË°åÔºàÈÅøÂÖçÂ∑≤‰ªòË≤ªË¢´Ë∏¢Ôºâ
    if(!ok && hasPaid){
      const base = (opaid || ocreated || '').slice(0,10);
      if(base){
        const t0 = new Date(base + 'T00:00:00Z').getTime();
        const days = (Date.now() - t0) / 86400000;
        if(days >= 0 && days <= 400) ok = true;
      }else{
        ok = true;
      }
    }

    window.BW_SUB_OK = ok;
    window.BW_SUB_EXPIRES_AT = ok ? ((pexp && pexp >= today) ? pexp : (oexp || null)) : null;
    window.BW_PROFILE_OK = profileReadable;

    if(!ok){
      location.replace('/account/subscription.html');
      return;
    }
  }catch(e){
    location.replace('/account/subscription.html?err=guard');
  }
})();
</script>
<!-- ===== /BookWide Guard ===== -->
<meta charset="utf-8"/>
<meta content="width=device-width,initial-scale=1,viewport-fit=cover" name="viewport"/>
<title>TalkÔºàÊØèÈÄ±Âè£Ë™™ÔºâÔΩúBookWide</title>
<style>
:root{
  --bg:#f4f6fb; --card:#fff; --ink:#0b1220; --muted:#5b667a; --line:#e6eaf0;
  --shadow:0 10px 28px rgba(10,20,40,.10); --r:18px; --r2:24px;
  --brand:#0b66ff; --brand2:#084fc6; --soft:#f6f8fb;
}
*{box-sizing:border-box}
html,body{height:100%}
body{
  margin:0; font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;
  background:var(--bg); color:var(--ink);
  overscroll-behavior: none;
  padding-bottom:18px;
}
a{color:inherit}
.wrap{max-width:980px; margin:0 auto; padding:14px 14px 24px}
.card{background:var(--card); border:1px solid var(--line); border-radius:var(--r2); box-shadow:var(--shadow)}
.topbar{padding:14px; display:flex; gap:10px; align-items:center; justify-content:space-between}
.leftTop{display:flex; align-items:center; gap:12px}
.btnIcon{
  width:44px; height:44px; border-radius:999px; border:1px solid var(--line);
  background:#fff; display:grid; place-items:center; box-shadow:0 6px 18px rgba(10,20,40,.08);
}
.brandTitle{font-weight:800; font-size:22px; line-height:1}
.sub{font-size:12px; color:var(--muted); margin-top:4px}
.rightTop{display:flex; gap:10px; align-items:center}
.smallBtn{
  border:1px solid var(--line); background:#fff; border-radius:999px; padding:10px 12px;
  font-weight:700; color:var(--brand2); box-shadow:0 6px 18px rgba(10,20,40,.08);
}
.smallBtn:active{transform:translateY(1px)}
.pill{
  border:1px solid var(--line); background:#fff; border-radius:999px; padding:10px 12px;
  display:flex; align-items:center; gap:8px; font-weight:800;
}
.pill select{border:none;background:transparent;font:inherit;color:inherit;outline:none;padding:0 2px;}
.pill .meta{margin-right:6px;opacity:.75;font-size:12px;}
.pill .meta{font-size:12px; color:var(--muted); font-weight:700}
.grid{display:grid; grid-template-columns:1fr; gap:14px; padding:14px}
.hero{padding:14px}
.heroRow{display:flex; gap:14px; align-items:center}
.avatar{
  width:92px; height:92px; border-radius:999px;
  border:1px solid var(--line);
  background: radial-gradient(circle at 30% 30%, #ffffff 0%, #eef3ff 40%, #e8eefb 100%);
  box-shadow:inset 0 0 0 10px rgba(255,255,255,.6);
  position:relative; flex:0 0 auto;
}
  .avatar{ position:relative; overflow:hidden; }
  .teacherMedia{ width:100%; height:100%; object-fit:cover; border-radius:999px; display:block; }

.dot{position:absolute; left:12px; top:14px; width:12px; height:12px; border-radius:999px; background:#22c55e; box-shadow:0 0 0 4px rgba(34,197,94,.15)}
.heroText{min-width:0}
.sceneTitle{font-weight:900; font-size:16px}
.sceneSub{color:var(--muted); font-size:12px; margin-top:4px}
.big{
  padding:16px; border-radius:var(--r2); border:1px solid var(--line);
  background:var(--soft);
}
.big .en{font-size:34px; font-weight:900; letter-spacing:.2px}
.big .zh{margin-top:10px; font-size:15px; color:var(--muted)}
.controls{
  display:grid; grid-template-columns:86px 1fr 1fr; gap:12px; align-items:center;
}
.mic{
  width:86px; height:86px; border-radius:999px; border:none;
  background:linear-gradient(180deg,var(--brand) 0%, var(--brand2) 100%);
  color:#fff; font-size:28px; font-weight:900;
  box-shadow:0 16px 40px rgba(11,102,255,.35);
}
.ctrlBtn{
  height:52px; border-radius:999px; border:1px solid var(--line);
  background:#fff; font-weight:900; font-size:18px; color:var(--brand2);
  display:flex; align-items:center; justify-content:center; gap:10px;
  box-shadow:0 10px 24px rgba(10,20,40,.08);
}
.ctrlBtn small{font-size:14px; color:var(--muted); font-weight:800}
.row2{display:flex; gap:10px; flex-wrap:wrap}
.chip{
  border:1px solid var(--line); border-radius:999px; background:#fff;
  padding:10px 12px; font-weight:900; color:var(--ink);
}
.chip.on{background:#0b1220; color:#fff; border-color:#0b1220}
.fillCard{padding:14px}
.fillHead{display:flex; align-items:center; justify-content:space-between; gap:10px; margin-bottom:10px}
.fillHead .h{font-weight:900; font-size:18px}
.badges{display:flex; gap:10px; align-items:center}
.badge{
  border:1px solid var(--line); border-radius:999px; padding:8px 12px; background:#fff;
  font-weight:900; color:var(--muted);
}
.badge.lev{color:#0b1220}
.fillEn{font-size:34px; font-weight:950; line-height:1.05}
.fillHint{margin-top:10px; color:var(--muted); font-weight:700}
.fillRow{display:flex; gap:10px; margin-top:14px; align-items:center}
.primary{
  height:54px; border-radius:999px; border:none;
  background:linear-gradient(180deg,var(--brand) 0%, var(--brand2) 100%);
  color:#fff; font-weight:950; padding:0 18px; font-size:18px;
  box-shadow:0 16px 40px rgba(11,102,255,.28);
}
.ghost{
  height:54px; border-radius:999px; border:1px solid var(--line); background:#fff;
  font-weight:950; padding:0 18px; font-size:18px; color:var(--brand2);
}
.inp{
  width:100%; height:54px; border-radius:16px; border:1px solid var(--line);
  padding:0 14px; font-size:18px; font-weight:800; outline:none;
  background:#fff;
}
.toast{
  position:fixed; left:50%; transform:translateX(-50%);
  bottom:18px; background:#0b1220; color:#fff; padding:10px 12px;
  border-radius:999px; font-weight:800; font-size:13px;
  box-shadow:0 18px 45px rgba(0,0,0,.25);
  max-width:min(92vw,520px); display:none;
}
.modalMask{position:fixed; inset:0; background:rgba(0,0,0,.34); display:none; align-items:flex-start; justify-content:center; padding:18px}
.modal{
  width:min(720px, 94vw);
  background:#fff; border:1px solid var(--line);
  border-radius:24px; box-shadow:0 24px 80px rgba(0,0,0,.25);
  overflow:hidden;
}
.modalTop{padding:14px 14px 10px; display:flex; align-items:center; justify-content:space-between; border-bottom:1px solid var(--line)}
.modalTop .t{font-weight:950}
.modalBody{padding:12px; max-height:70vh; overflow:auto}
.group{border:1px solid var(--line); border-radius:18px; overflow:hidden; margin-bottom:12px}
.group .gHead{padding:10px 12px; background:#f7f9ff; font-weight:950; display:flex; justify-content:space-between; align-items:center}
.group .gHead .lock{font-size:12px; color:var(--muted); font-weight:900}
.item{padding:12px; border-top:1px solid var(--line); display:flex; gap:10px; align-items:center; justify-content:space-between}
.item .name{font-weight:900}
.item .sub{margin:0; font-size:12px}
.item button{white-space:nowrap}
@media (max-width:520px){
  .wrap{padding:10px 10px 18px}
  .topbar{padding:12px}
  .brandTitle{font-size:20px}
  .big .en{font-size:30px}
  .fillEn{font-size:30px}
  .controls{grid-template-columns:78px 1fr 1fr}
  .mic{width:78px; height:78px; font-size:26px}
  .ctrlBtn{height:50px; font-size:17px}
}

/* ===== Mobile compact (v3) ===== */
@media (max-width: 520px){
  .brandTitle{font-size:14px}
  .sub{font-size:10px}
  .pill .meta{font-size:10px}
  .sceneTitle{font-size:13px}
  .sceneSub{font-size:10px}
  .big .en{font-size:20px}
  .big .zh{font-size:12px}
  .micBtn{min-height:64px}
  .micBtn .label{font-size:14px}
  .ctrlBtn{min-height:44px}
  .ctrlBtn span{font-size:14px}
  .ctrlBtn small{font-size:11px}
  .fillCard{padding:12px}
  .fillHead .h{font-size:14px}
  .fillEn{font-size:20px}
  .fillHint{font-size:11px}
  .fillSend,.fillReroll{min-height:44px; font-size:14px; padding:0 14px}
  .fillInput{min-height:44px; font-size:14px}
  .chip{font-size:11px; padding:8px 10px}
}
.fileTag{display:inline-block; margin-left:10px; font-size:12px; color:var(--muted); max-width:240px; overflow:hidden; text-overflow:ellipsis; white-space:nowrap;}
.bottomPanel{
  position:sticky; bottom:10px; left:auto; transform:none;
  width:100%;
  margin-top:12px;
  border:1px solid var(--line);
  border-radius:var(--r2);
  background:var(--card);
  box-shadow:0 10px 28px rgba(10,20,40,.10);
  padding:12px 14px;
  z-index:5;
}
.bpRow{display:flex; gap:10px; align-items:flex-start;}
.bpTitle{flex:0 0 auto; font-weight:800; font-size:13px; padding:4px 10px; border-radius:999px; background:var(--soft); color:var(--brand2);}
.bpBody{flex:1 1 auto; font-size:13px; color:var(--ink); line-height:1.35; min-height:22px;}
.bpLinks{margin-top:8px; display:flex; gap:10px; flex-wrap:wrap;}
.bpLink{font-size:12px; color:var(--brand2); text-decoration:none; padding:6px 10px; border:1px solid var(--line); border-radius:999px; background:#fff;}
.bpLink:hover{background:var(--soft);}
@media (max-width:520px){
  .fileTag{max-width:120px}
  .bottomPanel{bottom:8px; padding:10px 12px; border-radius:16px;}
}

/* ===== V8.5 Mobile Topbar Tighten (2026-01-10) ===== */
@media (max-width:520px){
  .wrap{padding:6px 10px 14px !important;}
  .topbar{padding:8px 10px !important; gap:8px !important;}
  .backBtn,.back{width:40px !important; height:40px !important; border-radius:14px !important;}
  .brandTitle{font-size:13px !important;}
  .sub{font-size:9px !important; margin-top:2px !important;}
  .pill{padding:6px 8px !important; gap:6px !important;}
  .pill .meta{font-size:9px !important;}
  .pill .w{font-size:12px !important;}
  .replayBtn,.btnReplay{width:44px !important; height:44px !important; font-size:12px !important;}
  .hero{padding:10px !important;}
  .avatar{width:72px !important; height:72px !important;}
  .sceneTitle{font-size:14px !important;}
  .sceneSub{font-size:10px !important;}
  .big{padding:12px !important;}
  .big .zh{margin-top:4px !important; font-size:10px !important;}
}


/* ====== v7-ultra-compact-2 (2026-01-10) ======
   - Êõ¥ÊøÄÈÄ≤Á∏ÆÂ∞èË°åË∑ù/ÈñìË∑ùÔºàÊâãÊ©ü‰∏ÄÈ†ÅÂÆπÁ¥çÊõ¥Â§öÔºâ
   - Á∏ÆÂ∞èÂ§ßÂè•Â≠ê„ÄÅÂ°´Á©∫„ÄÅÈÄÅÂá∫/Èáç‰æÜÊåâÈàï„ÄÅÂç°Áâá padding/margin
*/
:root{
  --card-pad:10px;
}

/* overall */
.wrap{padding:8px 10px 12px !important;}
.card{padding:var(--card-pad) !important; margin:8px 0 !important;}
.hr{margin:8px 0 !important;}

/* topbar */
.topbar{padding:6px 10px !important; gap:8px !important;}
.iconBtn{width:36px !important; height:36px !important;}
.brand .t{font-size:18px !important; line-height:1.05 !important;}
.brand .s{font-size:12px !important; margin-top:1px !important; line-height:1.05 !important;}
.smallBtn{padding:6px 10px !important; border-radius:999px !important; font-size:12px !important;}

/* status/hero cards */
.hero{padding:10px !important;}
.heroGrid{gap:10px !important;}
.avatarWrap{width:74px !important; height:74px !important;}
.heroTitle{font-size:18px !important; margin-bottom:2px !important; line-height:1.1 !important;}
.heroSub{font-size:12px !important; line-height:1.15 !important;}
.progress{font-size:12px !important; line-height:1.15 !important;}

/* big sentence (AI line) */
.big .en{font-size:24px !important; line-height:1.05 !important;}
.big .zh{margin-top:4px !important; font-size:12px !important; line-height:1.15 !important;}

/* controls block */
.controls{margin-top:8px !important;}
.ctrlRow{gap:10px !important;}
.micBtn{width:64px !important; height:64px !important;}
.ctrlBtn{height:40px !important; padding:0 14px !important; font-size:14px !important;}
.ctrlBtn .ico{font-size:16px !important; margin-right:8px !important;}
.ctrlRow2{gap:10px !important; margin-top:8px !important;}
.pillBtn{padding:8px 14px !important; font-size:14px !important;}

/* reply / fill card */
.replyCard{padding:10px !important;}
.replyHead{margin-bottom:6px !important;}
.replyTitle{font-size:16px !important; line-height:1.05 !important;}
.replyDesc{font-size:11px !important; line-height:1.15 !important; margin-top:4px !important;}
.fillEn{font-size:24px !important; line-height:1.05 !important;}
.fillHint{margin-top:4px !important; font-size:11px !important; line-height:1.15 !important;}
.input{margin-top:8px !important; padding:10px 12px !important; font-size:14px !important; border-radius:16px !important;}

/* action buttons (ÈÄÅÂá∫/Èáç‰æÜ) */
.fillActions{gap:10px !important; margin-top:10px !important;}
.fillSend{
  min-height:36px !important;
  padding:0 14px !important;
  font-size:14px !important;
  border-radius:18px !important;
  box-shadow:0 10px 22px rgba(37,99,235,.22) !important;
}
.fillReroll{
  min-height:36px !important;
  padding:0 14px !important;
  font-size:14px !important;
  border-radius:18px !important;
}
.fillSend .check{width:22px !important; height:22px !important; margin-right:8px !important; font-size:13px !important;}

/* bottom sheet/panel */
.bottomPanel{margin-top:10px !important;}
.sheetTabs{gap:10px !important;}
.sheetTab{padding:8px 12px !important; font-size:14px !important;}
.sheet{margin-top:8px !important;}
.sheetBody{padding:10px !important;}
.taskItem{padding:10px !important; margin-bottom:8px !important;}
.taskItem .k{font-size:14px !important; margin-bottom:4px !important;}
.taskItem .v{font-size:12px !important; line-height:1.2 !important;}

</style>
<style id="v8-redo-patch">
/* === V8 REDO PATCH === */
/* Reduce dialogue text ~50% */
.big .en { font-size: 17px !important; }
.big .zh { font-size: 12px !important; }
.fillEn { font-size: 17px !important; }
.fillHint, .bpBody, .sceneSub { font-size: 11px !important; }
.sceneTitle { font-size: 13px !important; }

/* Integrate bottom task panel into page flow (no floating) */
.bottomPanel{
  position: static !important;
  margin-top: 12px !important;
  box-shadow: none !important;
}
@media (max-width:520px){
  .big .en { font-size: 16px !important; }
  .fillEn { font-size: 16px !important; }
}

/* ===== V8.5 Mobile Topbar Tighten (2026-01-10) ===== */
@media (max-width:520px){
  .wrap{padding:6px 10px 14px !important;}
  .topbar{padding:8px 10px !important; gap:8px !important;}
  .backBtn,.back{width:40px !important; height:40px !important; border-radius:14px !important;}
  .brandTitle{font-size:13px !important;}
  .sub{font-size:9px !important; margin-top:2px !important;}
  .pill{padding:6px 8px !important; gap:6px !important;}
  .pill .meta{font-size:9px !important;}
  .pill .w{font-size:12px !important;}
  .replayBtn,.btnReplay{width:44px !important; height:44px !important; font-size:12px !important;}
  .hero{padding:10px !important;}
  .avatar{width:72px !important; height:72px !important;}
  .sceneTitle{font-size:14px !important;}
  .sceneSub{font-size:10px !important;}
  .big{padding:12px !important;}
  .big .zh{margin-top:4px !important; font-size:10px !important;}
}


/* ====== v7-ultra-compact-2 (2026-01-10) ======
   - Êõ¥ÊøÄÈÄ≤Á∏ÆÂ∞èË°åË∑ù/ÈñìË∑ùÔºàÊâãÊ©ü‰∏ÄÈ†ÅÂÆπÁ¥çÊõ¥Â§öÔºâ
   - Á∏ÆÂ∞èÂ§ßÂè•Â≠ê„ÄÅÂ°´Á©∫„ÄÅÈÄÅÂá∫/Èáç‰æÜÊåâÈàï„ÄÅÂç°Áâá padding/margin
*/
:root{
  --card-pad:10px;
}

/* overall */
.wrap{padding:8px 10px 12px !important;}
.card{padding:var(--card-pad) !important; margin:8px 0 !important;}
.hr{margin:8px 0 !important;}

/* topbar */
.topbar{padding:6px 10px !important; gap:8px !important;}
.iconBtn{width:36px !important; height:36px !important;}
.brand .t{font-size:18px !important; line-height:1.05 !important;}
.brand .s{font-size:12px !important; margin-top:1px !important; line-height:1.05 !important;}
.smallBtn{padding:6px 10px !important; border-radius:999px !important; font-size:12px !important;}

/* status/hero cards */
.hero{padding:10px !important;}
.heroGrid{gap:10px !important;}
.avatarWrap{width:74px !important; height:74px !important;}
.heroTitle{font-size:18px !important; margin-bottom:2px !important; line-height:1.1 !important;}
.heroSub{font-size:12px !important; line-height:1.15 !important;}
.progress{font-size:12px !important; line-height:1.15 !important;}

/* big sentence (AI line) */
.big .en{font-size:24px !important; line-height:1.05 !important;}
.big .zh{margin-top:4px !important; font-size:12px !important; line-height:1.15 !important;}

/* controls block */
.controls{margin-top:8px !important;}
.ctrlRow{gap:10px !important;}
.micBtn{width:64px !important; height:64px !important;}
.ctrlBtn{height:40px !important; padding:0 14px !important; font-size:14px !important;}
.ctrlBtn .ico{font-size:16px !important; margin-right:8px !important;}
.ctrlRow2{gap:10px !important; margin-top:8px !important;}
.pillBtn{padding:8px 14px !important; font-size:14px !important;}

/* reply / fill card */
.replyCard{padding:10px !important;}
.replyHead{margin-bottom:6px !important;}
.replyTitle{font-size:16px !important; line-height:1.05 !important;}
.replyDesc{font-size:11px !important; line-height:1.15 !important; margin-top:4px !important;}
.fillEn{font-size:24px !important; line-height:1.05 !important;}
.fillHint{margin-top:4px !important; font-size:11px !important; line-height:1.15 !important;}
.input{margin-top:8px !important; padding:10px 12px !important; font-size:14px !important; border-radius:16px !important;}

/* action buttons (ÈÄÅÂá∫/Èáç‰æÜ) */
.fillActions{gap:10px !important; margin-top:10px !important;}
.fillSend{
  min-height:36px !important;
  padding:0 14px !important;
  font-size:14px !important;
  border-radius:18px !important;
  box-shadow:0 10px 22px rgba(37,99,235,.22) !important;
}
.fillReroll{
  min-height:36px !important;
  padding:0 14px !important;
  font-size:14px !important;
  border-radius:18px !important;
}
.fillSend .check{width:22px !important; height:22px !important; margin-right:8px !important; font-size:13px !important;}

/* bottom sheet/panel */
.bottomPanel{margin-top:10px !important;}
.sheetTabs{gap:10px !important;}
.sheetTab{padding:8px 12px !important; font-size:14px !important;}
.sheet{margin-top:8px !important;}
.sheetBody{padding:10px !important;}
.taskItem{padding:10px !important; margin-bottom:8px !important;}
.taskItem .k{font-size:14px !important; margin-bottom:4px !important;}
.taskItem .v{font-size:12px !important; line-height:1.2 !important;}

</style>
<style id="v8-controls-compact-v2">
/* === V8 Controls Compact V2 (real merge + clear active) === */
.controlsWrap{
  display:flex;
  align-items:center;
  gap:10px;
  flex-wrap:wrap;          /* small screens wrap gracefully */
  margin-top: 6px;
  margin-bottom: 6px;
}

/* make the two inner rows behave like one bar */
.controls, .row2{
  display:flex !important;
  align-items:center;
  gap:10px !important;
  margin:0 !important;
  padding:0 !important;
  box-shadow:none !important;
  background:transparent !important;
}

/* shrink mic + buttons by sizing, NOT transform (keeps layout + tap target sane) */
.mic{
  width:52px !important;
  height:52px !important;
  border-radius:50% !important;
  font-size:20px !important;
  box-shadow: 0 10px 24px rgba(15,23,42,.14) !important;
}
.ctrlBtn{
  height:40px !important;
  padding:0 14px !important;
  font-size:12px !important;
  border-radius:999px !important;
}
.ctrlBtn span{ font-size:12px !important; }

/* chips */
.chip{
  height:34px !important;
  padding:0 12px !important;
  font-size:12px !important;
  border-radius:999px !important;
}

/* clearer pressed/active feedback */
.ctrlBtn:active, .chip:active, .mic:active{
  transform: translateY(1px) scale(0.98);
  filter: saturate(1.15) contrast(1.05);
  box-shadow: inset 0 0 0 3px rgba(37,99,235,.18), 0 8px 18px rgba(15,23,42,.12) !important;
}
.ctrlBtn:focus-visible, .chip:focus-visible, .mic:focus-visible{
  outline: none;
  box-shadow: 0 0 0 3px rgba(37,99,235,.22), 0 10px 24px rgba(15,23,42,.14) !important;
}

/* tighten vertical space around this bar */
.big{ margin-bottom: 10px !important; }

/* ===== V8.5 Mobile Topbar Tighten (2026-01-10) ===== */
@media (max-width:520px){
  .wrap{padding:6px 10px 14px !important;}
  .topbar{padding:8px 10px !important; gap:8px !important;}
  .backBtn,.back{width:40px !important; height:40px !important; border-radius:14px !important;}
  .brandTitle{font-size:13px !important;}
  .sub{font-size:9px !important; margin-top:2px !important;}
  .pill{padding:6px 8px !important; gap:6px !important;}
  .pill .meta{font-size:9px !important;}
  .pill .w{font-size:12px !important;}
  .replayBtn,.btnReplay{width:44px !important; height:44px !important; font-size:12px !important;}
  .hero{padding:10px !important;}
  .avatar{width:72px !important; height:72px !important;}
  .sceneTitle{font-size:14px !important;}
  .sceneSub{font-size:10px !important;}
  .big{padding:12px !important;}
  .big .zh{margin-top:4px !important; font-size:10px !important;}
}


/* ====== v7-ultra-compact-2 (2026-01-10) ======
   - Êõ¥ÊøÄÈÄ≤Á∏ÆÂ∞èË°åË∑ù/ÈñìË∑ùÔºàÊâãÊ©ü‰∏ÄÈ†ÅÂÆπÁ¥çÊõ¥Â§öÔºâ
   - Á∏ÆÂ∞èÂ§ßÂè•Â≠ê„ÄÅÂ°´Á©∫„ÄÅÈÄÅÂá∫/Èáç‰æÜÊåâÈàï„ÄÅÂç°Áâá padding/margin
*/
:root{
  --card-pad:10px;
}

/* overall */
.wrap{padding:8px 10px 12px !important;}
.card{padding:var(--card-pad) !important; margin:8px 0 !important;}
.hr{margin:8px 0 !important;}

/* topbar */
.topbar{padding:6px 10px !important; gap:8px !important;}
.iconBtn{width:36px !important; height:36px !important;}
.brand .t{font-size:18px !important; line-height:1.05 !important;}
.brand .s{font-size:12px !important; margin-top:1px !important; line-height:1.05 !important;}
.smallBtn{padding:6px 10px !important; border-radius:999px !important; font-size:12px !important;}

/* status/hero cards */
.hero{padding:10px !important;}
.heroGrid{gap:10px !important;}
.avatarWrap{width:74px !important; height:74px !important;}
.heroTitle{font-size:18px !important; margin-bottom:2px !important; line-height:1.1 !important;}
.heroSub{font-size:12px !important; line-height:1.15 !important;}
.progress{font-size:12px !important; line-height:1.15 !important;}

/* big sentence (AI line) */
.big .en{font-size:24px !important; line-height:1.05 !important;}
.big .zh{margin-top:4px !important; font-size:12px !important; line-height:1.15 !important;}

/* controls block */
.controls{margin-top:8px !important;}
.ctrlRow{gap:10px !important;}
.micBtn{width:64px !important; height:64px !important;}
.ctrlBtn{height:40px !important; padding:0 14px !important; font-size:14px !important;}
.ctrlBtn .ico{font-size:16px !important; margin-right:8px !important;}
.ctrlRow2{gap:10px !important; margin-top:8px !important;}
.pillBtn{padding:8px 14px !important; font-size:14px !important;}

/* reply / fill card */
.replyCard{padding:10px !important;}
.replyHead{margin-bottom:6px !important;}
.replyTitle{font-size:16px !important; line-height:1.05 !important;}
.replyDesc{font-size:11px !important; line-height:1.15 !important; margin-top:4px !important;}
.fillEn{font-size:24px !important; line-height:1.05 !important;}
.fillHint{margin-top:4px !important; font-size:11px !important; line-height:1.15 !important;}
.input{margin-top:8px !important; padding:10px 12px !important; font-size:14px !important; border-radius:16px !important;}

/* action buttons (ÈÄÅÂá∫/Èáç‰æÜ) */
.fillActions{gap:10px !important; margin-top:10px !important;}
.fillSend{
  min-height:36px !important;
  padding:0 14px !important;
  font-size:14px !important;
  border-radius:18px !important;
  box-shadow:0 10px 22px rgba(37,99,235,.22) !important;
}
.fillReroll{
  min-height:36px !important;
  padding:0 14px !important;
  font-size:14px !important;
  border-radius:18px !important;
}
.fillSend .check{width:22px !important; height:22px !important; margin-right:8px !important; font-size:13px !important;}

/* bottom sheet/panel */
.bottomPanel{margin-top:10px !important;}
.sheetTabs{gap:10px !important;}
.sheetTab{padding:8px 12px !important; font-size:14px !important;}
.sheet{margin-top:8px !important;}
.sheetBody{padding:10px !important;}
.taskItem{padding:10px !important; margin-bottom:8px !important;}
.taskItem .k{font-size:14px !important; margin-bottom:4px !important;}
.taskItem .v{font-size:12px !important; line-height:1.2 !important;}

</style>
<style id="v8-topbar-small">
/* === V8 Top Bar Small (mobile-first) === */
@media (max-width: 520px){
  /* header container */
  .topbar, .header, .navBar{
    padding: 8px 10px !important;
    border-radius: 16px !important;
  }
  /* shrink the whole top row height */
  .topbar * { line-height: 1.1 !important; }
  .title, .brandTitle, .pageTitle{
    font-size: 16px !important;
    font-weight: 800 !important;
  }
  .subtitle, .brandSub, .pageSub{
    font-size: 11px !important;
    margin-top: 2px !important;
  }

  /* back button + right buttons */
  .backBtn, .btnBack{
    width: 38px !important;
    height: 38px !important;
    border-radius: 14px !important;
  }
  .topRight button, .topbar .ctrlBtn, .topbar .chip, .topbar .btn{
    height: 34px !important;
    padding: 0 10px !important;
    font-size: 12px !important;
    border-radius: 14px !important;
  }

  /* week selector / dropdown */
  select, .weekSel, .sceneSel{
    height: 34px !important;
    padding: 0 10px !important;
    font-size: 12px !important;
    border-radius: 14px !important;
  }

  /* reduce spacing under header */
  .wrap, .container{
    padding-top: 8px !important;
  }
}

/* ===== V8.5 Mobile Topbar Tighten (2026-01-10) ===== */
@media (max-width:520px){
  .wrap{padding:6px 10px 14px !important;}
  .topbar{padding:8px 10px !important; gap:8px !important;}
  .backBtn,.back{width:40px !important; height:40px !important; border-radius:14px !important;}
  .brandTitle{font-size:13px !important;}
  .sub{font-size:9px !important; margin-top:2px !important;}
  .pill{padding:6px 8px !important; gap:6px !important;}
  .pill .meta{font-size:9px !important;}
  .pill .w{font-size:12px !important;}
  .replayBtn,.btnReplay{width:44px !important; height:44px !important; font-size:12px !important;}
  .hero{padding:10px !important;}
  .avatar{width:72px !important; height:72px !important;}
  .sceneTitle{font-size:14px !important;}
  .sceneSub{font-size:10px !important;}
  .big{padding:12px !important;}
  .big .zh{margin-top:4px !important; font-size:10px !important;}
}


/* ====== v7-ultra-compact-2 (2026-01-10) ======
   - Êõ¥ÊøÄÈÄ≤Á∏ÆÂ∞èË°åË∑ù/ÈñìË∑ùÔºàÊâãÊ©ü‰∏ÄÈ†ÅÂÆπÁ¥çÊõ¥Â§öÔºâ
   - Á∏ÆÂ∞èÂ§ßÂè•Â≠ê„ÄÅÂ°´Á©∫„ÄÅÈÄÅÂá∫/Èáç‰æÜÊåâÈàï„ÄÅÂç°Áâá padding/margin
*/
:root{
  --card-pad:10px;
}

/* overall */
.wrap{padding:8px 10px 12px !important;}
.card{padding:var(--card-pad) !important; margin:8px 0 !important;}
.hr{margin:8px 0 !important;}

/* topbar */
.topbar{padding:6px 10px !important; gap:8px !important;}
.iconBtn{width:36px !important; height:36px !important;}
.brand .t{font-size:18px !important; line-height:1.05 !important;}
.brand .s{font-size:12px !important; margin-top:1px !important; line-height:1.05 !important;}
.smallBtn{padding:6px 10px !important; border-radius:999px !important; font-size:12px !important;}

/* status/hero cards */
.hero{padding:10px !important;}
.heroGrid{gap:10px !important;}
.avatarWrap{width:74px !important; height:74px !important;}
.heroTitle{font-size:18px !important; margin-bottom:2px !important; line-height:1.1 !important;}
.heroSub{font-size:12px !important; line-height:1.15 !important;}
.progress{font-size:12px !important; line-height:1.15 !important;}

/* big sentence (AI line) */
.big .en{font-size:24px !important; line-height:1.05 !important;}
.big .zh{margin-top:4px !important; font-size:12px !important; line-height:1.15 !important;}

/* controls block */
.controls{margin-top:8px !important;}
.ctrlRow{gap:10px !important;}
.micBtn{width:64px !important; height:64px !important;}
.ctrlBtn{height:40px !important; padding:0 14px !important; font-size:14px !important;}
.ctrlBtn .ico{font-size:16px !important; margin-right:8px !important;}
.ctrlRow2{gap:10px !important; margin-top:8px !important;}
.pillBtn{padding:8px 14px !important; font-size:14px !important;}

/* reply / fill card */
.replyCard{padding:10px !important;}
.replyHead{margin-bottom:6px !important;}
.replyTitle{font-size:16px !important; line-height:1.05 !important;}
.replyDesc{font-size:11px !important; line-height:1.15 !important; margin-top:4px !important;}
.fillEn{font-size:24px !important; line-height:1.05 !important;}
.fillHint{margin-top:4px !important; font-size:11px !important; line-height:1.15 !important;}
.input{margin-top:8px !important; padding:10px 12px !important; font-size:14px !important; border-radius:16px !important;}

/* action buttons (ÈÄÅÂá∫/Èáç‰æÜ) */
.fillActions{gap:10px !important; margin-top:10px !important;}
.fillSend{
  min-height:36px !important;
  padding:0 14px !important;
  font-size:14px !important;
  border-radius:18px !important;
  box-shadow:0 10px 22px rgba(37,99,235,.22) !important;
}
.fillReroll{
  min-height:36px !important;
  padding:0 14px !important;
  font-size:14px !important;
  border-radius:18px !important;
}
.fillSend .check{width:22px !important; height:22px !important; margin-right:8px !important; font-size:13px !important;}

/* bottom sheet/panel */
.bottomPanel{margin-top:10px !important;}
.sheetTabs{gap:10px !important;}
.sheetTab{padding:8px 12px !important; font-size:14px !important;}
.sheet{margin-top:8px !important;}
.sheetBody{padding:10px !important;}
.taskItem{padding:10px !important; margin-bottom:8px !important;}
.taskItem .k{font-size:14px !important; margin-bottom:4px !important;}
.taskItem .v{font-size:12px !important; line-height:1.2 !important;}

</style>
<style id="v8-tight-space-v4">
/* === V8 Tight Space V4 === */

/* shrink dialogue + response text by ~50% while keeping overall layout */
.dialogue, .aiLine, .bigLine, .utterance, .promptLine{
  font-size: 50% !important;
}

/* also shrink secondary helper text */
.small, .muted, .help, .desc, .subline{
  font-size: 50% !important;
}

/* tighten big empty padding/margins inside the response panel */
.panel, .card, .section{
  padding: 12px !important;
}
.responseBox, .replyBox, .answerBox{
  margin-top: 6px !important;
  padding-top: 6px !important;
}

/* reduce input area height */
textarea, input[type="text"], .replyInput{
  min-height: 40px !important;
  padding: 10px 12px !important;
  font-size: 14px !important;  /* keep input readable */
}

/* compact bottom buttons row ("ÈÄÅÂá∫Â°´Â•ΩÂè•" / "Èáç‰æÜ") */
.bottomActions, .submitRow, .btnRow{
  gap: 10px !important;
  margin-top: 10px !important;
}
.bottomActions button, .submitRow button, .btnRow button{
  height: 38px !important;
  padding: 0 14px !important;
  font-size: 13px !important;
}

/* reduce whitespace around the whole block */
.block, .taskBlock, .replyBlock{
  margin-top: 10px !important;
}

/* mobile tighter */
@media (max-width: 520px){
  .panel, .card, .section{ padding: 10px !important; }
  .bottomActions button, .submitRow button, .btnRow button{
    height: 36px !important;
    padding: 0 12px !important;
    font-size: 12px !important;
  }
}

/* ===== V8.5 Mobile Topbar Tighten (2026-01-10) ===== */
@media (max-width:520px){
  .wrap{padding:6px 10px 14px !important;}
  .topbar{padding:8px 10px !important; gap:8px !important;}
  .backBtn,.back{width:40px !important; height:40px !important; border-radius:14px !important;}
  .brandTitle{font-size:13px !important;}
  .sub{font-size:9px !important; margin-top:2px !important;}
  .pill{padding:6px 8px !important; gap:6px !important;}
  .pill .meta{font-size:9px !important;}
  .pill .w{font-size:12px !important;}
  .replayBtn,.btnReplay{width:44px !important; height:44px !important; font-size:12px !important;}
  .hero{padding:10px !important;}
  .avatar{width:72px !important; height:72px !important;}
  .sceneTitle{font-size:14px !important;}
  .sceneSub{font-size:10px !important;}
  .big{padding:12px !important;}
  .big .zh{margin-top:4px !important; font-size:10px !important;}
}


/* ====== v7-ultra-compact-2 (2026-01-10) ======
   - Êõ¥ÊøÄÈÄ≤Á∏ÆÂ∞èË°åË∑ù/ÈñìË∑ùÔºàÊâãÊ©ü‰∏ÄÈ†ÅÂÆπÁ¥çÊõ¥Â§öÔºâ
   - Á∏ÆÂ∞èÂ§ßÂè•Â≠ê„ÄÅÂ°´Á©∫„ÄÅÈÄÅÂá∫/Èáç‰æÜÊåâÈàï„ÄÅÂç°Áâá padding/margin
*/
:root{
  --card-pad:10px;
}

/* overall */
.wrap{padding:8px 10px 12px !important;}
.card{padding:var(--card-pad) !important; margin:8px 0 !important;}
.hr{margin:8px 0 !important;}

/* topbar */
.topbar{padding:6px 10px !important; gap:8px !important;}
.iconBtn{width:36px !important; height:36px !important;}
.brand .t{font-size:18px !important; line-height:1.05 !important;}
.brand .s{font-size:12px !important; margin-top:1px !important; line-height:1.05 !important;}
.smallBtn{padding:6px 10px !important; border-radius:999px !important; font-size:12px !important;}

/* status/hero cards */
.hero{padding:10px !important;}
.heroGrid{gap:10px !important;}
.avatarWrap{width:74px !important; height:74px !important;}
.heroTitle{font-size:18px !important; margin-bottom:2px !important; line-height:1.1 !important;}
.heroSub{font-size:12px !important; line-height:1.15 !important;}
.progress{font-size:12px !important; line-height:1.15 !important;}

/* big sentence (AI line) */
.big .en{font-size:24px !important; line-height:1.05 !important;}
.big .zh{margin-top:4px !important; font-size:12px !important; line-height:1.15 !important;}

/* controls block */
.controls{margin-top:8px !important;}
.ctrlRow{gap:10px !important;}
.micBtn{width:64px !important; height:64px !important;}
.ctrlBtn{height:40px !important; padding:0 14px !important; font-size:14px !important;}
.ctrlBtn .ico{font-size:16px !important; margin-right:8px !important;}
.ctrlRow2{gap:10px !important; margin-top:8px !important;}
.pillBtn{padding:8px 14px !important; font-size:14px !important;}

/* reply / fill card */
.replyCard{padding:10px !important;}
.replyHead{margin-bottom:6px !important;}
.replyTitle{font-size:16px !important; line-height:1.05 !important;}
.replyDesc{font-size:11px !important; line-height:1.15 !important; margin-top:4px !important;}
.fillEn{font-size:24px !important; line-height:1.05 !important;}
.fillHint{margin-top:4px !important; font-size:11px !important; line-height:1.15 !important;}
.input{margin-top:8px !important; padding:10px 12px !important; font-size:14px !important; border-radius:16px !important;}

/* action buttons (ÈÄÅÂá∫/Èáç‰æÜ) */
.fillActions{gap:10px !important; margin-top:10px !important;}
.fillSend{
  min-height:36px !important;
  padding:0 14px !important;
  font-size:14px !important;
  border-radius:18px !important;
  box-shadow:0 10px 22px rgba(37,99,235,.22) !important;
}
.fillReroll{
  min-height:36px !important;
  padding:0 14px !important;
  font-size:14px !important;
  border-radius:18px !important;
}
.fillSend .check{width:22px !important; height:22px !important; margin-right:8px !important; font-size:13px !important;}

/* bottom sheet/panel */
.bottomPanel{margin-top:10px !important;}
.sheetTabs{gap:10px !important;}
.sheetTab{padding:8px 12px !important; font-size:14px !important;}
.sheet{margin-top:8px !important;}
.sheetBody{padding:10px !important;}
.taskItem{padding:10px !important; margin-bottom:8px !important;}
.taskItem .k{font-size:14px !important; margin-bottom:4px !important;}
.taskItem .v{font-size:12px !important; line-height:1.2 !important;}

</style>
<style id="ultra-tight-override">
/* === ULTRA TIGHT OVERRIDE === */
body, .card, .panel, .section, .content,
h1, h2, h3, h4, p, div, span, label {
  line-height: 1.1 !important;
}

p, h1, h2, h3, h4 {
  margin-top: 4px !important;
  margin-bottom: 4px !important;
}

.section, .card, .panel {
  padding-top: 6px !important;
  padding-bottom: 6px !important;
  margin-top: 6px !important;
  margin-bottom: 6px !important;
}

.big-sentence, .main-sentence {
  font-size: 0.85em !important;
  line-height: 1.05 !important;
}
</style>
<style id="rebuild-inline-compact">
/* === REBUILD: inline AI with avatar + compact === */
.heroRow{align-items:flex-start}
.heroText{display:flex; flex-direction:column; gap:4px}
/* Inline bubble */
.aiInline{
  background:#f6f8fb;
  border:1px solid var(--line);
  border-radius:14px;
  padding:8px 10px;
}
.aiInline .en{font-size:18px !important; line-height:1.1 !important; font-weight:900}
.aiInline .zh{font-size:12px !important; line-height:1.15 !important; margin-top:4px !important; color:var(--muted)}
/* Hide duplicated title near AI line */
.sceneTitle{display:none !important}
/* Compact overall text */
body{line-height:1.1}
.big{display:none !important} /* old AI block hidden */
/* Buttons compact */
.ctrlBtn{height:40px !important; font-size:14px !important}
.mic{width:56px !important; height:56px !important; font-size:22px !important}
/* Fill card compact */
.fillEn{font-size:18px !important; line-height:1.1 !important}
.fillHint{font-size:11px !important}
</style>
<style id="hide-right-label">
/* Hide right-top file label only */
.fileTag { display: none !important; }
</style>
</head>
<body>
<div class="wrap">
<div class="card topbar" role="banner">
<div class="leftTop">
<button aria-label="ËøîÂõû" class="btnIcon" id="btnBack">‚Üê</button>
<div>
<div class="brandTitle">Talk</div>
<div class="sub" id="subTitle">ÊØèÈÄ±Âè£Ë™™ ¬∑ Browser Speech</div>
</div>
</div>
<div class="rightTop">
<button class="pill" id="btnPick" title="ÈÅ∏ÊìáÊú¨ÈÄ±ÊÉÖÂ¢É">
<span id="weekLabel">W1</span>
<span class="meta" id="scenePickLabel">ÈÅ∏ÊìáÊÉÖÂ¢É</span>
<span aria-hidden="true">‚ñæ</span>
</button>
<label class="pill" title="ÈÅ∏ÊìáËÄÅÂ∏´">
<span class="meta">Teacher</span>
<select aria-label="Teacher" id="selTeacher">
<option value="Diana.mp4">Diana</option>
<option value="Emma.mp4">Emma</option>
<option value="Sophia.mp4">Sophia</option>
</select>
</label>
<button class="smallBtn" id="btnReplay">ÈáçÊí≠</button>
<span class="fileTag" id="fileTag"></span>
</div>
</div>
<div class="card grid">
<div class="hero card">
<div class="heroRow">
<div aria-label="AI ËÄÅÂ∏´È†≠ÂÉè" class="avatar">
<video autoplay="" class="teacherMedia" id="teacherVideo" muted="" playsinline="" webkit-playsinline=""></video>
<span class="dot" id="dotLive"></span>
</div>
<div class="heroText">
<div class="aiInline">
<div class="en" id="lineEnInline">Loading‚Ä¶</div>
<div class="zh" id="lineZhInline">ÔºàËºâÂÖ•‰∏≠‚Ä¶Ôºâ</div>
</div>
<div class="sceneTitle" id="sceneTitle">ËºâÂÖ•‰∏≠‚Ä¶</div>
<div class="sceneSub" id="sceneSub">Êú¨ÈÄ±Ôºö3 ÂÄãÁ∑¥ÁøíÔºàCore / Variation / ChallengeÔºâ</div>
</div>
</div>
</div>
<div class="big">
<div class="en" id="lineEn">Loading‚Ä¶</div>
<div class="zh" id="lineZh">ÔºàËºâÂÖ•‰∏≠‚Ä¶Ôºâ</div>
</div>
<div class="controlsWrap"><div class="controls">
<button aria-label="ÈñãÂßãË™ûÈü≥Ëæ®Ë≠ò" class="mic" id="btnMic">üé§</button>
<button class="ctrlBtn" id="btnType"><span aria-hidden="true">‚å®Ô∏è</span><span>Ëº∏ÂÖ•</span></button>
<button class="ctrlBtn" id="btnSkip"><span>Ë∑≥ÈÅé</span></button>
</div><div class="row2">
<button class="chip" id="btnHint">ÊèêÁ§∫</button>
<button class="chip" id="btnSave">Êî∂Ëóè</button>
<button class="chip" id="btnFill">Â°´Á©∫ÂºïÂ∞é</button>
</div></div>
<div class="card fillCard" id="fillCard">
<div class="fillHead">
<div class="h" id="fillTitle">‰Ω†ÁöÑÂõûË¶Ü</div>
<div class="badges">
<span class="badge lev" id="levBadge">A1</span>
<button class="badge" id="btnHideFill" type="button">Èö±Ëóè</button>
</div>
</div>
<div class="fillEn" id="fillEn">Can I get a ____ , please?</div>
<div class="fillHint" id="fillHint">ÂÖàÁî®„ÄåÂ°´Á©∫„ÄçÂÆåÊàê‰∏ÄÂè•ÔºåÂÜçÊîπÊàê‰Ω†Ëá™Â∑±ÁöÑË™™Ê≥ï„ÄÇ</div>
<div class="fillRow">
<input class="inp" id="fillInput" placeholder="Â°´ÂÖ•Á©∫Ê†º‚Ä¶"/>
</div>
<div class="fillRow" style="margin-top:10px">
<button class="primary" id="btnSendFill">‚úÖ ÈÄÅÂá∫Â°´Â•ΩÂè•</button>
<button class="ghost" id="btnFillReset">Èáç‰æÜ</button>
</div>
</div>
</div>
<div aria-label="‰ªªÂãôËàáÂèÉËÄÉ" class="bottomPanel" id="bottomPanel">
<div class="bpRow">
<div class="bpTitle">‰ªªÂãô</div>
</div>
<div class="toast" id="toast"></div>
<!-- picker modal -->
<div aria-hidden="true" class="modalMask" id="mask">
<div aria-label="ÈÅ∏ÊìáÊÉÖÂ¢É" aria-modal="true" class="modal" role="dialog">
<div class="modalTop">
<div class="t">ÈÅ∏ÊìáÊÉÖÂ¢ÉÔºà‰æùÈÄ±Êé®Âá∫Ôºâ</div>
<button aria-label="ÈóúÈñâ" class="btnIcon" id="btnClose">‚úï</button>
</div>
<div class="modalBody" id="modalBody"></div>
</div>
</div>
<script>const TEACHER_AZURE_VOICE = {
  "diana.mp4":  "en-US-AvaNeural",
  "emma.mp4":   "en-US-AriaNeural",
  "sophia.mp4": "en-GB-SoniaNeural"
};

const TEACHER_TTS_STYLE = {
  "diana.mp4":  { rate: "-2%", pitch: "+10%" },
  "emma.mp4":   { rate: "+6%", pitch: "+2%" },
  "sophia.mp4": { rate: "0%",  pitch: "-6%" }
};

function getTeacherStyle(sel){
  const key = (sel && sel.value ? sel.value : "").toLowerCase();
  return TEACHER_TTS_STYLE[key] || { rate: "0%", pitch: "0%" };
}

function getTeacherVoice(sel){
  const key = (sel && sel.value ? sel.value : "").toLowerCase();
  return TEACHER_AZURE_VOICE[key] || "en-US-JennyNeural";
}
</script>

<!-- ===== Learning Report Modal (LOCKED) ===== -->
<div id="bwReportMask" style="display:none;position:fixed;inset:0;background:rgba(0,0,0,.35);z-index:9999">
<div style="position:absolute;left:50%;top:50%;transform:translate(-50%,-50%);
              width:min(92vw,420px);background:#fff;border-radius:22px;padding:18px 18px 16px;">
<div style="text-align:center;font-size:20px;font-weight:700;margin-top:4px">
<span style="font-size:28px">‚≠ê ‚≠ê ‚≠ê</span><br/>ÂæàÊ£í!
    </div>
<div style="text-align:center;color:#666;margin:6px 0 10px">Ë≤∑‰∏ÄÊùØÂíñÂï°</div>
<div style="display:flex;gap:10px;justify-content:space-between;margin:10px 0">
<div style="flex:1;text-align:center"><b id="rActive">50%</b><div style="color:#777;font-size:12px">‰∏ªÂãïÁ∑¥Áøí</div></div>
<div style="flex:1;text-align:center"><b id="rPron">53%</b><div style="color:#777;font-size:12px">ÁôºÈü≥</div></div>
<div style="flex:1;text-align:center"><b id="rWords">116</b><div style="color:#777;font-size:12px">ÂñÆÂ≠óÊï∏</div></div>
</div>
<div style="text-align:center;margin:6px 0 14px">
<div style="font-size:12px;color:#777">ÂÆåÊï¥Â∫¶</div>
<div id="rComplete" style="font-size:28px;font-weight:700">65</div>
</div>
<div style="display:flex;gap:10px">
<button onclick="closeReport()" style="flex:1;border-radius:14px;border:1px solid #e5e7eb;padding:10px;background:#fff">ÈóúÈñâ</button>
<button onclick="closeReport()" style="flex:1;border-radius:14px;border:none;padding:10px;background:#2563eb;color:#fff">ÁπºÁ∫å</button>
</div>
</div>
</div>
<script>
function showReport(){ document.getElementById('bwReportMask').style.display='block';
  try{bwSaveTalkDailyScore();
  try{ if(typeof totalScore!=='undefined'){ BW_commitTalkScore(totalScore);} }catch(e){}
}catch(e){} }
function closeReport(){ document.getElementById('bwReportMask').style.display='none'; }
</script>
<!-- ===== End Learning Report ===== -->
<script>
function bwSaveTalkDailyScore(){
  try{
    const d = new Date();
    const key = d.toISOString().slice(0,10); // UTC key
    const twKey = d.toLocaleDateString('en-CA', { timeZone: 'Asia/Taipei' }); // Taiwan key
    const score = (function(){
      const el = document.getElementById('rComplete');
      const v = el ? Number(String(el.textContent||'').trim()) : NaN;
      return Number.isFinite(v) ? Math.max(0, Math.min(100, Math.round(v))) : 65;
    })();
    const active = (function(){
      const el = document.getElementById('rActive');
      if(!el) return null;
      const t = String(el.textContent||'').replace('%','').trim();
      const v = Number(t);
      return Number.isFinite(v) ? Math.max(0, Math.min(100, Math.round(v))) : null;
    })();
    const pron = (function(){
      const el = document.getElementById('rPron');
      if(!el) return null;
      const t = String(el.textContent||'').replace('%','').trim();
      const v = Number(t);
      return Number.isFinite(v) ? Math.max(0, Math.min(100, Math.round(v))) : null;
    })();
    const words = (function(){
      const el = document.getElementById('rWords');
      if(!el) return null;
      const v = Number(String(el.textContent||'').trim());
      return Number.isFinite(v) ? Math.max(0, Math.min(9999, Math.round(v))) : null;
    })();

    let obj = {};
    const raw = localStorage.getItem('bwTalkScores');
    if(raw){ try{ obj = JSON.parse(raw)||{}; }catch(e){ obj = {}; } }
    obj[key] = { score, active, pron, words, updated_at: new Date().toISOString() };
    if (twKey && twKey !== key) obj[twKey] = obj[key];
    localStorage.setItem('bwTalkScores', JSON.stringify(obj));
  }catch(e){}
}
</script>
<!-- ===== BW TALK SCORE ‚Üí DASHBOARD BRIDGE (LOCKED) ===== -->
<script>
(function(){
  const KEY = "BW_DAILY_SCORE_MAP";
  const TZ = "Asia/Taipei";
  function todayKey(){
    return new Date().toLocaleDateString("en-CA",{ timeZone: TZ });
  }
  window.BW_commitTalkScore = function(score){
    try{
      const day = todayKey();
      const map = JSON.parse(localStorage.getItem(KEY) || "{}");
      map[day] = (Number(map[day]) || 0) + Number(score || 0);
      localStorage.setItem(KEY, JSON.stringify(map));
      console.log("[BW SCORE SAVED]", day, map[day]);
    }catch(e){ console.error(e); }
  };
})();
</script>
<!-- ===== /BW TALK SCORE ‚Üí DASHBOARD BRIDGE ===== -->
</div></div></body>
</html>
