<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>學習控制台｜BookWide</title>
  <style>
    :root{
      --bg:#f4f6fb;
      --card-bg:#fff;
      --muted:#6b7280;
      --border:#e5e7eb;
      --brand:#2563eb;
      --brand-soft:#e0edff;
      --danger:#b91c1c;
      --radius-lg:18px;
      --shadow-card:0 10px 30px rgba(15,23,42,.08);
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;
      background:var(--bg);
      color:#111827;
    }
    a{text-decoration:none;color:inherit;}
    img{max-width:100%;display:block;}

    .wrap{
      max-width:1080px;
      margin:32px auto 80px;
      padding:0 16px;
    }

    .nav{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:16px;
      gap:12px;
    }
    .back{
      display:inline-flex;
      align-items:center;
      gap:.5rem;
      padding:6px 12px;
      border-radius:999px;
      border:1px solid #c7d2fe;
      background:#eef2ff;
      color:#1e40af;
      font-size:14px;
      cursor:pointer;
    }
    .back span:first-child{font-size:18px;margin-top:-2px;}
    .user-pill{
      padding:6px 12px;
      border-radius:999px;
      background:#111827;
      color:#f9fafb;
      font-size:13px;
      display:flex;
      align-items:center;
      gap:6px;
      white-space:nowrap;
    }
    .user-pill small{opacity:.8;}
    .logout-btn{
      margin-left:8px;
      padding:4px 10px;
      font-size:12px;
      border-radius:999px;
      border:1px solid #4b5563;
      background:#fff;
      color:#111827;
      cursor:pointer;
    }

    h1{
      margin:0 0 18px;
      font-size:26px;
      letter-spacing:.05em;
    }

    .layout{
      display:grid;
      grid-template-columns:minmax(0,2fr) minmax(0,1.55fr);
      gap:18px;
      align-items:flex-start;
    }
    @media(max-width:880px){
      .layout{
        grid-template-columns:minmax(0,1fr);
      }
    }

    .card{
      background:var(--card-bg);
      border-radius:var(--radius-lg);
      padding:16px 18px;
      box-shadow:var(--shadow-card);
      border:1px solid rgba(148,163,184,.28);
    }
    .card-title{
      display:flex;
      align-items:center;
      justify-content:space-between;
      margin-bottom:10px;
    }
    .card-title h2{
      margin:0;
      font-size:16px;
    }
    .tag{
      font-size:11px;
      padding:2px 8px;
      border-radius:999px;
      background:#e5e7eb;
      color:#374151;
    }
    .tag.blue{
      background:var(--brand-soft);
      color:#1e40af;
    }

    /* 繼續播放 */
    .continue-box{
      display:flex;
      align-items:center;
      gap:14px;
      padding:10px 0 6px;
      min-height:72px;
    }
    .thumb{
      width:70px;
      height:70px;
      border-radius:12px;
      overflow:hidden;
      background:#e5e7eb;
      flex-shrink:0;
    }
    .thumb img{width:100%;height:100%;object-fit:cover;}
    .cont-meta{
      flex:1;
      min-width:0;
    }
    .cont-meta .title{
      font-weight:600;
      margin-bottom:4px;
      font-size:15px;
    }
    .cont-meta .sub{
      font-size:12px;
      color:var(--muted);
    }
    .progress-wrap{
      margin-top:8px;
      display:flex;
      align-items:center;
      gap:8px;
      font-size:12px;
      color:var(--muted);
    }
    .bar{
      position:relative;
      flex:1;
      height:6px;
      background:#e5e7eb;
      border-radius:999px;
      overflow:hidden;
    }
    .bar span{
      position:absolute;
      inset:0;
      width:0%;
      border-radius:999px;
      background:linear-gradient(90deg,#3b82f6,#10b981);
    }

    .btn-primary{
      margin-top:10px;
      padding:6px 14px;
      font-size:13px;
      border-radius:999px;
      border:none;
      background:var(--brand);
      color:#fff;
      cursor:pointer;
    }

    /* 最近看過 */
    .recent-list{
      margin:4px 0 0;
      padding:0;
      list-style:none;
      font-size:13px;
    }
    .recent-item{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:4px 0;
      gap:10px;
    }
    .recent-left{
      display:flex;
      align-items:center;
      gap:6px;
      min-width:0;
    }
    .dot{
      width:18px;
      height:18px;
      border-radius:4px;
      background:#111827;
      display:flex;
      align-items:center;
      justify-content:center;
      font-size:10px;
      color:#f9fafb;
      flex-shrink:0;
    }
    .recent-title{
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
    }
    .recent-meta{
      font-size:12px;
      color:var(--muted);
      white-space:nowrap;
    }

    /* 今日複習 & 清單 */
    .grid-small{
      display:grid;
      grid-template-columns:minmax(0,1fr);
      gap:14px;
    }
    .review-item{
      display:flex;
      gap:10px;
      padding:6px 0;
      font-size:13px;
    }
    .review-thumb{
      width:56px;
      height:56px;
      border-radius:10px;
      overflow:hidden;
      flex-shrink:0;
      background:#e5e7eb;
    }
    .review-info small{
      display:block;
      font-size:11px;
      color:var(--muted);
    }

    .empty-tip{
      font-size:13px;
      color:var(--muted);
      padding-top:4px;
    }

    /* 學習曲線 */
    .chart-wrap{
      margin-top:6px;
    }
    .chart-row{
      display:flex;
      align-items:center;
      gap:10px;
      font-size:12px;
      margin:4px 0;
    }
    .chart-label{
      width:54px;
      color:var(--muted);
      flex-shrink:0;
    }
    .chart-bar{
      flex:1;
      height:8px;
      border-radius:999px;
      background:#e5e7eb;
      overflow:hidden;
      position:relative;
    }
    .chart-bar span{
      position:absolute;
      inset:0;
      width:0%;
      background:linear-gradient(90deg,#3b82f6,#10b981);
      border-radius:999px;
    }
    .chart-val{
      width:40px;
      text-align:right;
      color:var(--muted);
      flex-shrink:0;
    }

    .badge-status{
      font-size:11px;
      padding:2px 8px;
      border-radius:999px;
      border:1px solid #c7d2fe;
      background:#e0edff;
      color:#1e3a8a;
    }
  </style>
</head>
<body>
<div class="wrap">
  <header class="nav">
    <button class="back" onclick="window.location.href='../index.html'">
      <span>←</span><span>回首頁</span>
    </button>
    <div style="display:flex;align-items:center;gap:6px;">
      <div id="userPill" class="user-pill" style="display:none;">
        <small>已登入</small><span id="userEmail"></span>
      </div>
      <button id="logoutBtn" class="logout-btn" style="display:none;">登出</button>
    </div>
  </header>

  <main>
    <h1>學習控制台</h1>

    <div class="layout">
      <!-- 左側：主要區塊 -->
      <div style="display:flex;flex-direction:column;gap:18px;">
        <!-- 繼續播放 -->
        <section class="card">
          <div class="card-title">
            <h2>繼續播放</h2>
            <span id="continueStatus" class="badge-status">未完成</span>
          </div>
          <div id="continueBox" class="continue-box">
            <!-- JS 會填入 -->
          </div>
          <button class="btn-primary" id="btnResume">從上次進度繼續</button>
        </section>

        <!-- 最近看過 -->
        <section class="card">
          <div class="card-title">
            <h2>最近看過</h2>
            <span class="tag">最近 10 筆紀錄</span>
          </div>
          <ul id="recentList" class="recent-list"></ul>
        </section>

        <!-- 學習曲線 -->
        <section class="card">
          <div class="card-title">
            <h2>學習曲線（最近 7 天）</h2>
            <span class="tag blue">以完成度統計</span>
          </div>
          <div id="chartArea" class="chart-wrap"></div>
        </section>
      </div>

      <!-- 右側：今日複習 / 我的清單 -->
      <div class="grid-small">
        <section class="card">
          <div class="card-title">
            <h2>今日複習</h2>
            <span class="tag">系統推薦</span>
          </div>
          <div id="reviewList"></div>
        </section>

        <section class="card">
          <div class="card-title">
            <h2>我的清單</h2>
            <span class="tag">收藏影片</span>
          </div>
          <div id="favoriteList" class="empty-tip">載入中…</div>
        </section>
      </div>
    </div>
  </main>
</div>

<!-- Part 2：請把下面整段 JS 貼在這裡（接在這一行後面） -->
/* 3) favorites — 用 email 查，而不是 user_id */
/* 你目前 favorites 表中 user_id = NULL，所以不能用 uuid，也不能 eq(null) */

const { data: favRows, error: favErr } = await supabase
  .from("favorites")
  .select("*")
  .eq("email", userEmail);   // ←← 你現在要用 email 查

console.log("favorites:", favRows);

// 把 favorites video_slug → 轉成 videos 資料（封面、分類、標題）
const favoriteList = (favRows || [])
  .map((f) => mapVideos[f.video_slug])
  .filter(Boolean);

// 顯示 Favorite 區塊
renderFavorites(favoriteList);















































