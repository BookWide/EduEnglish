
<!DOCTYPE html>
<html lang="zh-TW">
<head>
<meta charset="utf-8">
<title>Level Survey (FINAL)</title>
</head>
<body>

<h2>Level Survey（最終鎖定版）</h2>
<p>此檔案只負責：算 Level → 寫起點 → 30 天冷卻</p>

<button id="startTest">開始測驗</button>

<script>
/* ===============================
   Level Survey FINAL LOGIC
   =============================== */

const LEVEL_TO_START_WEEK = {
  A1: 4,
  A2: 8,
  B1: 16,
  B2: 24,
  C1: 32
};

const COOLDOWN_DAYS = 30;
const COOLDOWN_MS = COOLDOWN_DAYS * 24 * 60 * 60 * 1000;

function now() {
  return Date.now();
}

function cooldownLeftDays() {
  const last = Number(localStorage.getItem('BW_LEVEL_LAST_TEST_AT') || 0);
  if (!last) return 0;
  const diff = now() - last;
  if (diff >= COOLDOWN_MS) return 0;
  return Math.ceil((COOLDOWN_MS - diff) / 86400000);
}

function applyCooldownLock() {
  const left = cooldownLeftDays();
  const btn = document.getElementById('startTest');
  if (left > 0 && btn) {
    btn.disabled = true;
    btn.textContent = `30 天冷卻中（剩 ${left} 天）`;
  }
}

// 模擬：測驗完成（實務上你會用你原本的計分）
function finishLevelTest(level) {
  const startWeek = LEVEL_TO_START_WEEK[level] || 4;

  localStorage.setItem('BW_LEVEL_RESULT', level);
  localStorage.setItem('BW_LEVEL_START_WEEK', String(startWeek));
  localStorage.setItem('BW_LEVEL_LAST_TEST_AT', String(now()));

  location.href = 'talk_FINAL_LOCKED.html';
}

document.getElementById('startTest').onclick = function () {
  // ⚠️ 這裡只是示範，實務請改成你真正算出的 level
  finishLevelTest('A1');
};

applyCooldownLock();
</script>

</body>
</html>
