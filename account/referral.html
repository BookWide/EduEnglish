<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>æ¨è–¦åˆ†æ½¤</title>
  <style>
    :root{
      --bg:#ffffff; --text:#111; --muted:#6b7280; --border:#e5e7eb;
      --primary:#111; --chip:#111; --chipText:#fff;
    }
    html,body{background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue","Noto Sans","Microsoft JhengHei",sans-serif;margin:0}
    .wrap{max-width:980px;margin:28px auto;padding:0 16px}
    .back{display:inline-flex;align-items:center;gap:6px;font-size:14px;text-decoration:none;color:var(--muted);margin-bottom:16px}
    .title{font-size:38px;font-weight:800;margin:6px 0 20px}
    .desc{color:var(--muted);margin-bottom:18px}
    .card{border:1px solid var(--border);border-radius:14px;padding:18px}
    .row{display:flex;gap:12px;align-items:center}
    .row+.row{margin-top:12px}
    .input{
      flex:1;min-height:48px;border:1px solid var(--border);border-radius:10px;
      padding:10px 12px;font-size:16px;outline:none
    }
    .btn{height:48px;padding:0 16px;border:1px solid var(--text);background:var(--text);color:#fff;border-radius:10px;cursor:pointer}
    .btn:active{transform:translateY(1px)}
    .chip{display:inline-flex;align-items:center;gap:8px;background:var(--chip);color:var(--chipText);
      border-radius:999px;padding:8px 14px;font-weight:700;letter-spacing:1px}
    .muted{color:var(--muted)}
    .metrics{display:flex;gap:28px;flex-wrap:wrap;margin-top:16px}
    .metric{display:flex;align-items:center;gap:8px;color:var(--muted)}
    .footer-note{margin-top:14px;color:var(--muted);font-size:14px}
  </style>
</head>
<body>
  <div class="wrap">
    <a class="back" href="../index.html">â† å›é¦–é </a>

    <h1 class="title">æ¨è–¦åˆ†æ½¤</h1>
    <p class="desc">å°‡å°ˆå±¬é€£çµåˆ†äº«çµ¦æœ‹å‹ï¼Œç•¶ä»–å€‘è¨»å†Šä¸¦è¨‚é–±èª²ç¨‹ï¼Œä½ éƒ½èƒ½ç²å¾—åˆ†æ½¤çå‹µã€‚</p>

    <div class="card">
      <div class="row">
        <input id="link" class="input" readonly />
        <button id="btnCopy" class="btn" type="button">è¤‡è£½</button>
      </div>

      <div class="row">
        <span class="muted">æ¨è–¦ç¢¼ï¼š</span>
        <span id="codeChip" class="chip">00000</span>
      </div>

      <div class="metrics">
        <div class="metric">âœ… æˆåŠŸæ¨è–¦ï¼š<span id="mCount">0</span> ä½</div>
        <div class="metric">ğŸ… ç´¯ç©é‡‘é¡ï¼š<span id="mAmount">0</span> å…ƒ</div>
        <div class="metric">â³ æœ‰æ•ˆæœŸé™ï¼š<span id="mExpire">â€”</span></div>
      </div>

      <p class="footer-note">ä½ çš„æœ‹å‹é€éæ­¤é€£çµé€²åˆ°å®šåƒ¹é ï¼ˆpricingï¼‰å¾Œï¼Œæ¨è–¦ç¢¼æœƒè‡ªå‹•å¸¶å…¥çµå¸³ã€‚</p>
    </div>
  </div>

  <script>
    // ---------------- åŸºæœ¬åƒæ•¸ ----------------
    // ç›®æ¨™é ï¼šå¾ /account/referral.html æŒ‡åˆ°ä¸Šä¸€å±¤çš„ pricing.html
    const pricingURL = new URL('../pricing.html', location.href).href;

    // ---------------- å–å¾—ä½¿ç”¨è€…è­˜åˆ¥ ----------------
    // è‹¥ä½ æ—¥å¾Œæœ‰ç™»å…¥æµç¨‹ï¼Œåªè¦æŠŠ email æˆ– uid æ”¾åˆ°ä¸‹é¢ä»»ä¸€å€‹ keyï¼Œå°±æœƒå¾—åˆ°åŒä¸€çµ„ 5 ç¢¼
    // localStorage.auth_email = 'user@example.com'  æˆ–  localStorage.auth_uid = 'uid_xxx'
    function getIdentitySeed(){
      const email = localStorage.getItem('auth_email');
      const uid   = localStorage.getItem('auth_uid');
      if (email) return email.toLowerCase();
      if (uid)   return uid;

      // ç›®å‰ç„¡ç™»å…¥ï¼šç”¨å›ºå®šçš„è¨ªå®¢ idï¼Œç¢ºä¿åŒä¸€ç€è¦½å™¨ç”¢ç”Ÿçš„ç¢¼ä¸æœƒè®Š
      let guest = localStorage.getItem('ref_guest_id');
      if (!guest){
        guest = (Date.now().toString(36) + Math.random().toString(36).slice(2,8));
        localStorage.setItem('ref_guest_id', guest);
      }
      return 'guest:' + guest;
    }

    // ---------------- 5 ç¢¼æ¨è–¦ç¢¼ï¼ˆç©©å®šå¯é‡ç¾ï¼‰ ----------------
    function fiveDigitCode(seed){
      // ç°¡å–® 32-bit hashï¼Œå†è½‰ç‚º 5 ç¢¼æ•¸å­—ï¼ˆ10000â€“99999ï¼‰
      let h = 2166136261 >>> 0;
      for (let i=0;i<seed.length;i++){
        h ^= seed.charCodeAt(i);
        h = Math.imul(h, 16777619) >>> 0;
      }
      const n = (h % 90000) + 10000;  // 10000..99999
      return String(n);
    }

    // ---------------- åˆå§‹åŒ–é é¢ ----------------
    (function init(){
      // 1) ç”¢å‡ºç©©å®šæ¨è–¦ç¢¼
      const seed = getIdentitySeed();
      const code = fiveDigitCode(seed);
      localStorage.setItem('referral_code', code); // è®“ checkout ä¹Ÿè®€å¾—åˆ°

      // 2) ç”¢å‡ºåˆ†äº«é€£çµ
      const link = `${pricingURL}?ref=${encodeURIComponent(code)}`;

      // 3) æ³¨å…¥ç•«é¢
      document.getElementById('codeChip').textContent = code;
      const linkEl = document.getElementById('link');
      linkEl.value = link;

      // 4) è¤‡è£½
      document.getElementById('btnCopy').addEventListener('click', async ()=>{
        try{
          await navigator.clipboard.writeText(linkEl.value);
          const old = document.getElementById('btnCopy').textContent;
          document.getElementById('btnCopy').textContent = 'å·²è¤‡è£½';
          setTimeout(()=>document.getElementById('btnCopy').textContent = old, 1200);
        }catch(e){
          linkEl.select(); document.execCommand('copy');
        }
      });
    })();
  </script>
</body>
</html>




















