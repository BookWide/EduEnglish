<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>推薦分潤</title>
  <style>
    :root{
      --bg:#ffffff; --text:#111; --muted:#6b7280; --border:#e5e7eb;
      --primary:#111; --chip:#111; --chipText:#fff;
    }
    html,body{background:var(--bg);color:var(--text);font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue","Noto Sans","Microsoft JhengHei",sans-serif;margin:0}
    .wrap{max-width:980px;margin:28px auto;padding:0 16px}
    .back{display:inline-flex;align-items:center;gap:6px;font-size:14px;text-decoration:none;color:var(--muted);margin-bottom:16px}
    .title{font-size:38px;font-weight:800;margin:6px 0 20px}
    .desc{color:var(--muted);margin-bottom:18px}
    .card{border:1px solid var(--border);border-radius:14px;padding:18px}
    .row{display:flex;gap:12px;align-items:center}
    .row+.row{margin-top:12px}
    .input{
      flex:1;min-height:48px;border:1px solid var(--border);border-radius:10px;
      padding:10px 12px;font-size:16px;outline:none
    }
    .btn{height:48px;padding:0 16px;border:1px solid var(--text);background:var(--text);color:#fff;border-radius:10px;cursor:pointer}
    .btn:active{transform:translateY(1px)}
    .chip{display:inline-flex;align-items:center;gap:8px;background:var(--chip);color:var(--chipText);
      border-radius:999px;padding:8px 14px;font-weight:700;letter-spacing:1px}
    .muted{color:var(--muted)}
    .metrics{display:flex;gap:28px;flex-wrap:wrap;margin-top:16px}
    .metric{display:flex;align-items:center;gap:8px;color:var(--muted)}
    .footer-note{margin-top:14px;color:var(--muted);font-size:14px}
  </style>
</head>
<body>
  <div class="wrap">
    <a class="back" href="../index.html">← 回首頁</a>

    <h1 class="title">推薦分潤</h1>
    <p class="desc">將專屬連結分享給朋友，當他們註冊並訂閱課程，你都能獲得分潤獎勵。</p>

    <div class="card">
      <div class="row">
        <input id="link" class="input" readonly />
        <button id="btnCopy" class="btn" type="button">複製</button>
      </div>

      <div class="row">
        <span class="muted">推薦碼：</span>
        <span id="codeChip" class="chip">00000</span>
      </div>

      <div class="metrics">
        <div class="metric">✅ 成功推薦：<span id="mCount">0</span> 位</div>
        <div class="metric">🏅 累積金額：<span id="mAmount">0</span> 元</div>
        <div class="metric">⏳ 有效期限：<span id="mExpire">—</span></div>
      </div>

      <p class="footer-note">你的朋友透過此連結進到定價頁（pricing）後，推薦碼會自動帶入結帳。</p>
    </div>
  </div>

  <script>
    // ---------------- 基本參數 ----------------
    // 目標頁：從 /account/referral.html 指到上一層的 pricing.html
    const pricingURL = new URL('../pricing.html', location.href).href;

    // ---------------- 取得使用者識別 ----------------
    // 若你日後有登入流程，只要把 email 或 uid 放到下面任一個 key，就會得到同一組 5 碼
    // localStorage.auth_email = 'user@example.com'  或  localStorage.auth_uid = 'uid_xxx'
    function getIdentitySeed(){
      const email = localStorage.getItem('auth_email');
      const uid   = localStorage.getItem('auth_uid');
      if (email) return email.toLowerCase();
      if (uid)   return uid;

      // 目前無登入：用固定的訪客 id，確保同一瀏覽器產生的碼不會變
      let guest = localStorage.getItem('ref_guest_id');
      if (!guest){
        guest = (Date.now().toString(36) + Math.random().toString(36).slice(2,8));
        localStorage.setItem('ref_guest_id', guest);
      }
      return 'guest:' + guest;
    }

    // ---------------- 5 碼推薦碼（穩定可重現） ----------------
    function fiveDigitCode(seed){
      // 簡單 32-bit hash，再轉為 5 碼數字（10000–99999）
      let h = 2166136261 >>> 0;
      for (let i=0;i<seed.length;i++){
        h ^= seed.charCodeAt(i);
        h = Math.imul(h, 16777619) >>> 0;
      }
      const n = (h % 90000) + 10000;  // 10000..99999
      return String(n);
    }

    // ---------------- 初始化頁面 ----------------
    (function init(){
      // 1) 產出穩定推薦碼
      const seed = getIdentitySeed();
      const code = fiveDigitCode(seed);
      localStorage.setItem('referral_code', code); // 讓 checkout 也讀得到

      // 2) 產出分享連結
      const link = `${pricingURL}?ref=${encodeURIComponent(code)}`;

      // 3) 注入畫面
      document.getElementById('codeChip').textContent = code;
      const linkEl = document.getElementById('link');
      linkEl.value = link;

      // 4) 複製
      document.getElementById('btnCopy').addEventListener('click', async ()=>{
        try{
          await navigator.clipboard.writeText(linkEl.value);
          const old = document.getElementById('btnCopy').textContent;
          document.getElementById('btnCopy').textContent = '已複製';
          setTimeout(()=>document.getElementById('btnCopy').textContent = old, 1200);
        }catch(e){
          linkEl.select(); document.execCommand('copy');
        }
      });
    })();
  </script>
</body>
</html>




















