<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>推薦分潤</title>
  <style>
    :root{
      --bg:#fff; --text:#111; --muted:#666; --border:#e5e7eb;
      --pill:#111; --pillText:#fff; --btn:#111; --btnText:#fff;
      --radius:14px;
    }
    html,body{background:var(--bg); color:var(--text); font-family: system-ui,-apple-system,"Segoe UI",Roboto,
      "Noto Sans","Helvetica Neue","Microsoft JhengHei",Arial,sans-serif; margin:0}
    .wrap{max-width:900px; margin:40px auto; padding:0 20px;}
    .topbar{margin-bottom:18px}
    .back{color:#333; text-decoration:none}
    h1{font-size:36px; margin:6px 0 22px 0; text-align:center}
    p.lead{color:var(--muted); text-align:center; margin-top:-6px}

    .card{margin:26px auto 18px; background:#fff; border:1px solid var(--border);
      border-radius:var(--radius); padding:22px 22px}
    .row{display:flex; gap:10px; align-items:center; justify-content:center}
    .row input.link{flex:1 1 680px; min-width:240px; font-size:16px; padding:12px 14px;
      border:1px solid var(--border); border-radius:12px; outline:none}
    .row button.copy{flex:0 0 auto; padding:12px 16px; border:0; border-radius:12px;
      background:var(--btn); color:var(--btnText); cursor:pointer}
    .row button.copy:active{transform:translateY(1px)}

    .meta{max-width:700px; margin:14px auto 0; color:var(--muted); font-size:15px}
    .stat{display:flex; gap:22px; justify-content:center; margin-top:10px; flex-wrap:wrap}
    .badge{padding:6px 12px; border:1px solid var(--border); border-radius:999px; font-size:14px}

    .code-line{display:flex; gap:10px; justify-content:center; align-items:center; margin-top:16px}
    .pill{background:var(--pill); color:var(--pillText); padding:6px 12px; border-radius:999px}

    @media (max-width:640px){
      h1{font-size:28px}
      .row{flex-direction:column; align-items:stretch}
      .row button.copy{width:100%}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar"><a class="back" href="/EduEnglish/">← 回首頁</a></div>

    <h1>推薦分潤</h1>
    <p class="lead">將專屬連結分享給朋友，當他們註冊並訂閱課程，你都能獲得分潤獎勵。</p>

    <div class="card">
      <div class="row">
        <input id="shareLink" class="link" type="text" readonly value="">
        <button id="btnCopy" class="copy" type="button">複製</button>
      </div>

      <div class="code-line">
        <span>推薦碼：</span>
        <span id="refCode" class="pill">—</span>
      </div>

      <div class="stat">
        <span class="badge">✅ 成功推薦：0 位</span>
        <span class="badge">🏅 累積金額：0 元</span>
        <span class="badge">⏳ 有效期限：—</span>
      </div>

      <p class="meta" style="text-align:center">你的朋友透過此連結進到定價頁（pricing）後，推薦碼會自動帶入結帳。</p>
    </div>
  </div>

  <script>
    // 1) 取得推薦碼：URL ?ref=… 優先；否則從 localStorage 讀
    const usp = new URLSearchParams(location.search);
    const urlRef = usp.get('ref');
    if (urlRef) localStorage.setItem('referral_code', urlRef);
    const ref = urlRef || localStorage.getItem('referral_code') || 'TEST888';

    // 2) 組分享連結（導向 pricing.html）
    const share = `https://bookwide.github.io/EduEnglish/pricing.html?ref=${encodeURIComponent(ref)}`;
    document.getElementById('shareLink').value = share;
    document.getElementById('refCode').textContent = ref;

    // 3) 複製按鈕
    document.getElementById('btnCopy').addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(share);
        const btn = document.getElementById('btnCopy');
        const old = btn.textContent;
        btn.textContent = '已複製！';
        setTimeout(()=>btn.textContent = old, 1200);
      } catch {
        // 備援
        const input = document.getElementById('shareLink');
        input.select(); document.execCommand('copy');
      }
    });
  </script>

  <!-- ===== referral code auto-generate patch ===== -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  // 模擬從 Supabase Auth 取使用者帳號（這裡假設有 email 或 id）
  // TODO: 如果你已有登入機制，請改成實際取用 user.email 或 user.id
  let userEmail = localStorage.getItem("user_email") || "guest@example.com";

  // 將 email 轉成簡短五位碼（簡單 hash）
  function genReferralCode(email) {
    let hash = 0;
    for (let i = 0; i < email.length; i++) {
      hash = email.charCodeAt(i) + ((hash << 5) - hash);
    }
    return ("00000" + Math.abs(hash % 100000)).slice(-5);
  }

  const code = genReferralCode(userEmail);
  const link = `https://bookwide.github.io/EduEnglish/pricing.html?ref=${code}`;

  // 顯示到畫面上
  const codeEl = document.querySelector("#refCode");
  const linkEl = document.querySelector("#refLink");

  if (codeEl) codeEl.textContent = code;
  if (linkEl) linkEl.value = link;
});
</script>
<!-- ===== /referral code auto-generate patch ===== -->

</body>
</html>



















