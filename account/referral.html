<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>æ¨è–¦åˆ†æ½¤</title>
  <style>
    :root{
      --bg:#fff; --text:#111; --muted:#666; --border:#e5e7eb;
      --pill:#111; --pillText:#fff; --btn:#111; --btnText:#fff;
      --radius:14px;
    }
    html,body{background:var(--bg); color:var(--text); font-family: system-ui,-apple-system,"Segoe UI",Roboto,
      "Noto Sans","Helvetica Neue","Microsoft JhengHei",Arial,sans-serif; margin:0}
    .wrap{max-width:900px; margin:40px auto; padding:0 20px;}
    .topbar{margin-bottom:18px}
    .back{color:#333; text-decoration:none}
    h1{font-size:36px; margin:6px 0 22px 0; text-align:center}
    p.lead{color:var(--muted); text-align:center; margin-top:-6px}

    .card{margin:26px auto 18px; background:#fff; border:1px solid var(--border);
      border-radius:var(--radius); padding:22px 22px}
    .row{display:flex; gap:10px; align-items:center; justify-content:center}
    .row input.link{flex:1 1 680px; min-width:240px; font-size:16px; padding:12px 14px;
      border:1px solid var(--border); border-radius:12px; outline:none}
    .row button.copy{flex:0 0 auto; padding:12px 16px; border:0; border-radius:12px;
      background:var(--btn); color:var(--btnText); cursor:pointer}
    .row button.copy:active{transform:translateY(1px)}

    .meta{max-width:700px; margin:14px auto 0; color:var(--muted); font-size:15px}
    .stat{display:flex; gap:22px; justify-content:center; margin-top:10px; flex-wrap:wrap}
    .badge{padding:6px 12px; border:1px solid var(--border); border-radius:999px; font-size:14px}

    .code-line{display:flex; gap:10px; justify-content:center; align-items:center; margin-top:16px}
    .pill{background:var(--pill); color:var(--pillText); padding:6px 12px; border-radius:999px}

    @media (max-width:640px){
      h1{font-size:28px}
      .row{flex-direction:column; align-items:stretch}
      .row button.copy{width:100%}
    }
  </style>
</head>
<body>
  <div class="wrap">
    <div class="topbar"><a class="back" href="/EduEnglish/">â† å›é¦–é </a></div>

    <h1>æ¨è–¦åˆ†æ½¤</h1>
    <p class="lead">å°‡å°ˆå±¬é€£çµåˆ†äº«çµ¦æœ‹å‹ï¼Œç•¶ä»–å€‘è¨»å†Šä¸¦è¨‚é–±èª²ç¨‹ï¼Œä½ éƒ½èƒ½ç²å¾—åˆ†æ½¤çå‹µã€‚</p>

    <div class="card">
      <div class="row">
        <input id="shareLink" class="link" type="text" readonly value="">
        <button id="btnCopy" class="copy" type="button">è¤‡è£½</button>
      </div>

      <div class="code-line">
        <span>æ¨è–¦ç¢¼ï¼š</span>
        <span id="refCode" class="pill">â€”</span>
      </div>

      <div class="stat">
        <span class="badge">âœ… æˆåŠŸæ¨è–¦ï¼š0 ä½</span>
        <span class="badge">ğŸ… ç´¯ç©é‡‘é¡ï¼š0 å…ƒ</span>
        <span class="badge">â³ æœ‰æ•ˆæœŸé™ï¼šâ€”</span>
      </div>

      <p class="meta" style="text-align:center">ä½ çš„æœ‹å‹é€éæ­¤é€£çµé€²åˆ°å®šåƒ¹é ï¼ˆpricingï¼‰å¾Œï¼Œæ¨è–¦ç¢¼æœƒè‡ªå‹•å¸¶å…¥çµå¸³ã€‚</p>
    </div>
  </div>

  <script>
    // 1) å–å¾—æ¨è–¦ç¢¼ï¼šURL ?ref=â€¦ å„ªå…ˆï¼›å¦å‰‡å¾ localStorage è®€
    const usp = new URLSearchParams(location.search);
    const urlRef = usp.get('ref');
    if (urlRef) localStorage.setItem('referral_code', urlRef);
    const ref = urlRef || localStorage.getItem('referral_code') || 'TEST888';

    // 2) çµ„åˆ†äº«é€£çµï¼ˆå°å‘ pricing.htmlï¼‰
    const share = `https://bookwide.github.io/EduEnglish/pricing.html?ref=${encodeURIComponent(ref)}`;
    document.getElementById('shareLink').value = share;
    document.getElementById('refCode').textContent = ref;

    // 3) è¤‡è£½æŒ‰éˆ•
    document.getElementById('btnCopy').addEventListener('click', async () => {
      try {
        await navigator.clipboard.writeText(share);
        const btn = document.getElementById('btnCopy');
        const old = btn.textContent;
        btn.textContent = 'å·²è¤‡è£½ï¼';
        setTimeout(()=>btn.textContent = old, 1200);
      } catch {
        // å‚™æ´
        const input = document.getElementById('shareLink');
        input.select(); document.execCommand('copy');
      }
    });
  </script>

  <!-- ===== referral code auto-generate patch ===== -->
<script>
document.addEventListener("DOMContentLoaded", () => {
  // æ¨¡æ“¬å¾ Supabase Auth å–ä½¿ç”¨è€…å¸³è™Ÿï¼ˆé€™è£¡å‡è¨­æœ‰ email æˆ– idï¼‰
  // TODO: å¦‚æœä½ å·²æœ‰ç™»å…¥æ©Ÿåˆ¶ï¼Œè«‹æ”¹æˆå¯¦éš›å–ç”¨ user.email æˆ– user.id
  let userEmail = localStorage.getItem("user_email") || "guest@example.com";

  // å°‡ email è½‰æˆç°¡çŸ­äº”ä½ç¢¼ï¼ˆç°¡å–® hashï¼‰
  function genReferralCode(email) {
    let hash = 0;
    for (let i = 0; i < email.length; i++) {
      hash = email.charCodeAt(i) + ((hash << 5) - hash);
    }
    return ("00000" + Math.abs(hash % 100000)).slice(-5);
  }

  const code = genReferralCode(userEmail);
  const link = `https://bookwide.github.io/EduEnglish/pricing.html?ref=${code}`;

  // é¡¯ç¤ºåˆ°ç•«é¢ä¸Š
  const codeEl = document.querySelector("#refCode");
  const linkEl = document.querySelector("#refLink");

  if (codeEl) codeEl.textContent = code;
  if (linkEl) linkEl.value = link;
});
</script>
<!-- ===== /referral code auto-generate patch ===== -->

</body>
</html>



















