<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>BookWide Admin｜JSON 產生器</title>

  <!-- 如果路徑不同，這裡改成你現在專案的 supa.js 實際位置 -->
  <script type="module" src="../supa.js?v=20251109g"></script>

  <style>
    :root{
      --bg:#f4f6fb;
      --card-bg:#fff;
      --muted:#6b7280;
      --border:#e5e7eb;
      --brand:#2563eb;
      --brand-soft:#e0edff;
      --danger:#b91c1c;
      --radius-lg:18px;
      --shadow-card:0 10px 30px rgba(15,23,42,.08);
      --mono:"JetBrains Mono","SF Mono",ui-monospace,Menlo,Consolas,monospace;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      background:var(--bg);
      color:#111827;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans TC",
        "PingFang TC","Microsoft JhengHei",sans-serif;
    }
    .wrap{
      max-width:1080px;
      margin:32px auto 96px;
      padding:0 16px;
    }
    .nav{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
      margin-bottom:16px;
    }
    .nav-left{display:flex;align-items:center;gap:8px;}
    .back{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:4px;
      border-radius:999px;
      padding:6px 14px;
      border:1px solid var(--border);
      background:#fff;
      font-size:14px;
      color:#111827;
      text-decoration:none;
    }
    h1{
      font-size:20px;
      font-weight:700;
      margin:0;
    }
    .nav-tabs{
      display:flex;
      border-radius:999px;
      background:#e5edff;
      padding:3px;
      gap:4px;
    }
    .nav-tab{
      border-radius:999px;
      padding:6px 16px;
      font-size:14px;
      border:none;
      background:transparent;
      cursor:pointer;
      color:#1d4ed8;
    }
    .nav-tab.active{
      background:#fff;
      box-shadow:0 0 0 1px rgba(37,99,235,.2);
    }

    .card{
      background:var(--card-bg);
      border-radius:var(--radius-lg);
      box-shadow:var(--shadow-card);
      padding:20px 20px 24px;
      margin-bottom:20px;
    }
    .card h2{
      margin:0 0 4px;
      font-size:18px;
    }
    .card > p.desc{
      margin:0 0 16px;
      color:var(--muted);
      font-size:14px;
    }
    .grid-2{
      display:grid;
      grid-template-columns:1fr 1fr;
      gap:12px 16px;
    }
    .field{
      display:flex;
      flex-direction:column;
      gap:4px;
      margin-bottom:10px;
    }
    .field label{
      font-size:14px;
      color:#374151;
    }
    .field small{
      font-size:12px;
      color:var(--muted);
    }
    .ipt,.select{
      border-radius:999px;
      border:1px solid var(--border);
      padding:8px 14px;
      font-size:14px;
      width:100%;
      background:#fff;
    }
    .ipt::placeholder{color:#9ca3af;}
    .field-row{
      display:flex;
      align-items:center;
      gap:8px;
      flex-wrap:wrap;
    }
    .btn{
      border-radius:999px;
      border:none;
      padding:8px 16px;
      font-size:14px;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
      background:var(--brand);
      color:#fff;
    }
    .btn.outline{
      background:#fff;
      color:#1d4ed8;
      border:1px solid #bfdbfe;
    }
    .btn.sm{
      padding:4px 10px;
      font-size:12px;
    }
    .btn.danger{
      background:var(--danger);
    }
    .hint{
      font-size:13px;
      color:var(--muted);
      margin-top:4px;
    }
    .tag{
      display:inline-flex;
      align-items:center;
      border-radius:999px;
      padding:2px 8px;
      font-size:11px;
      background:#eef2ff;
      color:#1e3a8a;
    }
    textarea.json-view{
      width:100%;
      min-height:220px;
      font-family:var(--mono);
      font-size:13px;
      padding:10px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background:#0b1120;
      color:#e5e7eb;
      white-space:pre;
      overflow:auto;
    }
    .section-title{
      font-size:15px;
      font-weight:600;
      margin:0 0 4px;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .badge{
      font-size:11px;
      padding:2px 6px;
      border-radius:999px;
      background:#fee2e2;
      color:#991b1b;
    }
    @media (max-width:768px){
      .grid-2{
        grid-template-columns:1fr;
      }
      .nav{
        flex-direction:column;
        align-items:flex-start;
      }
      .nav-tabs{
        align-self:stretch;
      }
    }
  </style>
</head>
<body>
  <div class="wrap">
    <header class="nav">
      <div class="nav-left">
        <a href="./admin.html" class="back">← 回主控台</a>
        <div>
          <h1>JSON 產生器</h1>
          <div style="font-size:13px;color:var(--muted);">
            由 SRT 產生 cues / quiz / vocab / ai / index JSON。（一次產生一個檔）
          </div>
        </div>
      </div>
      <div>
        <div class="nav-tabs">
          <button class="nav-tab" onclick="location.href='change.html#mp4'">MP4 整理</button>
          <button class="nav-tab active">JSON 產生器</button>
        </div>
      </div>
    </header>

    <!-- 基本資料 -->
    <section class="card">
      <h2>基本資料</h2>
      <p class="desc">這裡的分類 / 片名 slug，會用來決定輸出的檔名與路徑。</p>
      <div class="grid-2">
        <div class="field">
          <label>分類（category）</label>
          <select id="category" class="select">
            <option value="story">story</option>
            <option value="music" selected>music</option>
            <option value="movie">movie</option>
            <option value="news">news</option>
            <option value="pro">pro</option>
          </select>
          <small>之後檔案會像：<code>data/music/cues-片名.json</code></small>
        </div>
        <div class="field">
          <label>片名 slug（例如：mid-autumn / houyi / hello）</label>
          <input id="slug" class="ipt" placeholder="hello" />
          <small>所有 JSON 會使用同一個 slug：cues-<b>hello</b>.json / quiz-<b>hello</b>.json …</small>
        </div>
        <div class="field">
          <label>顯示標題（title）</label>
          <input id="title" class="ipt" placeholder="A Little Love" />
        </div>
        <div class="field">
          <label>影片長度（秒，之後可再微調）</label>
          <input id="duration" class="ipt" type="number" min="0" step="1" placeholder="180" />
          <small>目前只用在 index-*.json 裡的 <code>duration_sec</code>。</small>
        </div>
        <div class="field">
          <label>OpenAI API Key <span style="color:#b91c1c;font-size:12px;">（只存在你瀏覽器，不會存伺服器）</span></label>
          <input id="apiKey" class="ipt" type="password" placeholder="sk-..." />
          <small>用於在本頁直接呼叫 GPT 產生 JSON，不會跳轉到 openai.com。</small>
        </div>
        <div class="field">
          <label>使用模型</label>
          <select id="model" class="select">
            <option value="gpt-4.1-mini">gpt-4.1-mini（建議）</option>
            <option value="gpt-4.1">gpt-4.1</option>
          </select>
          <small>如果字數很多，可以先用 gpt-4.1-mini 測試。</small>
        </div>
      </div>
    </section>

    <!-- 上傳 SRT -->
    <section class="card">
      <h2>1. 上傳英文 SRT 字幕</h2>
      <p class="desc">目前只讀英文字幕。GPT 會負責翻譯成中 / 日並組成 JSON。</p>
      <div class="field">
        <label>英文 SRT 檔</label>
        <input id="srtFile" type="file" accept=".srt" />
        <small class="hint">例如：<code>hello.srt</code>。整個檔案會當成 GPT 的輸入。</small>
      </div>
      <div class="field">
        <label>已解析的段落預覽</label>
        <textarea id="previewSegments" class="json-view" style="min-height:120px;"></textarea>
        <div class="field-row">
          <button class="btn outline sm" id="btnParseSrt">重新解析 SRT</button>
          <span class="hint">如果你更新了 SRT，再按一次解析即可。</span>
        </div>
      </div>
    </section>

    <!-- 2. 各種 JSON 產生 -->
    <section class="card">
      <h2>2. 使用 GPT 產生 JSON（一次一個檔）</h2>
      <p class="desc">按下面任一按鈕，會把段落 &amp; 指示送給 GPT，要它回傳完整 JSON。</p>

      <!-- cues -->
      <div class="field">
        <div class="section-title">
          cues-<span id="slugCuesLabel">slug</span>.json
          <span class="tag">字幕三語版</span>
        </div>
        <p class="hint">
          依照 applesong 範例格式：每一段 <code>{ "time", "en", "zh", "ja" }</code>。
          GPT 會翻譯成中文 &amp; 日文，不留空白。
        </p>
        <div class="field-row">
          <button class="btn" id="btnGenCues">① 用 GPT 產生 cues JSON</button>
          <button class="btn outline" id="btnDownloadCues" disabled>下載 cues-*.json</button>
        </div>
      </div>

      <!-- quiz -->
      <hr style="border:none;border-top:1px dashed var(--border);margin:14px 0;">
      <div class="field">
        <div class="section-title">
          quiz-<span id="slugQuizLabel">slug</span>.json
          <span class="tag">測驗題目</span>
        </div>
        <p class="hint">
          依照 applesong 的 quiz 範例：四選一、包含 explain_en / explain_zh / explain_ja / tag。
          GPT 會自己設計題目與解析。
        </p>
        <div class="field-row">
          <button class="btn" id="btnGenQuiz">② 用 GPT 產生 quiz JSON</button>
          <button class="btn outline" id="btnDownloadQuiz" disabled>下載 quiz-*.json</button>
        </div>
      </div>

      <!-- vocab -->
      <hr style="border:none;border-top:1px dashed var(--border);margin:14px 0;">
      <div class="field">
        <div class="section-title">
          vocab-<span id="slugVocabLabel">slug</span>.json
          <span class="tag">單字表</span>
        </div>
        <p class="hint">
          依照 applesong vocab 範例：含詞性、例句（英 / 中 / 日）、圖片檔名欄位 <code>img</code>。
        </p>
        <div class="field-row">
          <button class="btn" id="btnGenVocab">③ 用 GPT 產生 vocab JSON</button>
          <button class="btn outline" id="btnDownloadVocab" disabled>下載 vocab-*.json</button>
        </div>
      </div>

      <!-- ai -->
      <hr style="border:none;border-top:1px dashed var(--border);margin:14px 0;">
      <div class="field">
        <div class="section-title">
          ai-<span id="slugAiLabel">slug</span>.json
          <span class="tag">AI 對話素材</span>
        </div>
        <p class="hint">
          依照 applesong 的 ai JSON 結構（intro / topics / dialogs ...）。GPT 會生成適合 AI 互動用的資料。
        </p>
        <div class="field-row">
          <button class="btn" id="btnGenAi">④ 用 GPT 產生 ai JSON</button>
          <button class="btn outline" id="btnDownloadAi" disabled>下載 ai-*.json</button>
        </div>
      </div>

      <!-- index -->
      <hr style="border:none;border-top:1px dashed var(--border);margin:14px 0;">
      <div class="field">
        <div class="section-title">
          index-<span id="slugIndexLabel">slug</span>.json
          <span class="tag">索引檔</span>
        </div>
        <p class="hint">
          這一個不會叫 GPT，只是用上面填好的資料組一個 index JSON，路徑會跟 applesong 一樣。
        </p>
        <div class="field-row">
          <button class="btn outline" id="btnGenIndex">⑤ 產生 index JSON</button>
          <button class="btn outline" id="btnDownloadIndex" disabled>下載 index-*.json</button>
        </div>
      </div>

      <div class="field" style="margin-top:18px;">
        <label>目前產生的 JSON 內容</label>
        <textarea id="jsonOutput" class="json-view"></textarea>
        <p class="hint">每次叫 GPT 只處理一種檔案。你可以先看這裡，再決定要不要下載。</p>
      </div>
    </section>
  </div>

  <script type="module">
    // === 等 supa.js 就緒 + 驗證 admin 角色 ===
    const waitBWReady = () => new Promise(resolve=>{
      if (window.BW && window.BW.supa) return resolve();
      const t=setInterval(()=>{
        if (window.BW && window.BW.supa){ clearInterval(t); resolve(); }
      },50);
    });

    (async () => {
      try{
        await waitBWReady();
        await BW.requireAdmin();        // 只允許 admin 進入
        BW.startHeartbeat(2);           // 2 分鐘更新 last_seen_at
      }catch(e){
        console.error('admin guard failed', e);
      }
    })();

    // === DOM helper ===
    const $ = (q,root=document)=>root.querySelector(q);

    const slugInput = $('#slug');
    const srtFileInput = $('#srtFile');
    const previewBox = $('#previewSegments');
    const jsonOutput = $('#jsonOutput');

    const slugLabels = [
      '#slugCuesLabel','#slugQuizLabel','#slugVocabLabel',
      '#slugAiLabel','#slugIndexLabel'
    ].map(q=>$(q));

    slugInput.addEventListener('input',()=>{
      const s = slugInput.value.trim() || 'slug';
      slugLabels.forEach(el=>el.textContent = s);
    });

    // === 解析 SRT 為簡單段落 ===
    let parsedSegments = []; // { index, start, end, text }

    function parseTimeToSeconds(t){
      // "00:00:05,000"
      const [h,m,sMs] = t.split(':');
      const [s,ms] = sMs.split(',');
      return (+h)*3600 + (+m)*60 + (+s) + (+ms||0)/1000;
    }
    function formatTimeMMSS(sec){
      const m = Math.floor(sec/60);
      const s = Math.round(sec%60);
      return String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
    }

    async function parseSrtFile(){
      const file = srtFileInput.files?.[0];
      if(!file){
        alert('請先選擇一個 SRT 檔。');
        return;
      }
      const text = await file.text();
      const blocks = text.replace(/\r\n/g,'\n').split(/\n{2,}/);
      parsedSegments = [];
      let maxEnd = 0;

      for(const block of blocks){
        const lines = block.trim().split('\n');
        if(lines.length < 2) continue;
        let ptr = 0;
        if(/^\d+$/.test(lines[0].trim())) ptr = 1; // 略過序號
        const timeLine = lines[ptr++] || '';
        const m = timeLine.match(/(\d+:\d+:\d+,\d+)\s*-->\s*(\d+:\d+:\d+,\d+)/);
        if(!m) continue;
        const start = parseTimeToSeconds(m[1]);
        const end = parseTimeToSeconds(m[2]);
        maxEnd = Math.max(maxEnd, end);
        const textLines = lines.slice(ptr).join(' ').replace(/\s+/g,' ').trim();
        if(!textLines) continue;
        parsedSegments.push({
          index: parsedSegments.length+1,
          start,
          end,
          text: textLines
        });
      }

      // 如果 duration 沒填，順便估一個
      const durIpt = $('#duration');
      if(!durIpt.value && maxEnd>0){
        durIpt.value = Math.round(maxEnd);
      }

      // 預覽
      previewBox.value = parsedSegments.map(seg=>{
        return `${String(seg.index).padStart(2,'0')}. [${formatTimeMMSS(seg.start)}] ${seg.text}`;
      }).join('\n');

      if(!parsedSegments.length){
        alert('SRT 沒有成功解析，請檢查格式。');
      }
    }

    $('#btnParseSrt').addEventListener('click', parseSrtFile);
    // 初次選擇檔案時自動解析
    srtFileInput.addEventListener('change', parseSrtFile);

    // === 呼叫 GPT 共用函式 ===
    async function callGPTForJSON(kind, extraInstructions){
      const apiKey = $('#apiKey').value.trim();
      const model = $('#model').value;
      const category = $('#category').value.trim();
      const slug = slugInput.value.trim();
      const title = $('#title').value.trim() || slug || 'untitled';

      if(!apiKey){
        alert('請先輸入 OpenAI API Key。');
        return null;
      }
      if(!parsedSegments.length){
        alert('請先上傳並解析 SRT 檔。');
        return null;
      }
      if(!slug){
        alert('請先填寫 slug。');
        return null;
      }

      const segmentText = parsedSegments.map(seg=>{
        return `${seg.index}. [${formatTimeMMSS(seg.start)}] ${seg.text}`;
      }).join('\n');

      const systemPrompt = `
你是 BookWide English 的 JSON 產生器，專門為英語學習影片產生教材。
請只輸出「有效的 JSON」，不要加註解、不要用 \`\`\` 包起來。
目前處理的影片：
- category: ${category}
- slug: ${slug}
- title: ${title}
`;

      const userPrompt = `
以下是這支影片的英文字幕段落，每一行格式：
序號. [mm:ss] 內文

${segmentText}

請依照「${kind}」的需求，產生 JSON：
${extraInstructions}

務必遵守：
1. 只輸出 JSON 本身，不要有任何其他文字。
2. 所有字串一律使用雙引號。
3. JSON 結構要可以直接被 JSON.parse() 解析通過。
`;

      jsonOutput.value = `【${kind}】請求送出中，請稍候…`;

      const res = await fetch('https://api.openai.com/v1/chat/completions',{
        method:'POST',
        headers:{
          'Content-Type':'application/json',
          'Authorization':`Bearer ${apiKey}`
        },
        body:JSON.stringify({
          model,
          messages:[
            {role:'system',content:systemPrompt},
            {role:'user',content:userPrompt}
          ],
          temperature:0.7
        })
      });

      if(!res.ok){
        const txt = await res.text();
        alert('GPT 呼叫失敗：'+res.status);
        jsonOutput.value = '錯誤：\n'+txt;
        return null;
      }
      const data = await res.json();
      const content = data.choices?.[0]?.message?.content?.trim() || '';
      jsonOutput.value = content;
      try{
        return JSON.parse(content);
      }catch(e){
        alert('GPT 回傳的不是合法 JSON，請手動修正後再下載。\n（錯誤：'+e.message+'）');
        return null;
      }
    }

    // === 各種 JSON 產生 + 下載 ===
    let lastCues = null;
    let lastQuiz = null;
    let lastVocab = null;
    let lastAi = null;
    let lastIndex = null;

    function downloadJSON(obj, filename){
      const blob = new Blob([JSON.stringify(obj,null,2)],{type:'application/json'});
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = filename;
      a.click();
      URL.revokeObjectURL(url);
    }

    // cues
    $('#btnGenCues').addEventListener('click', async ()=>{
      const extra = `
輸出格式為 JSON 陣列，每個元素是一個物件：
{
  "time": "mm:ss",
  "en": "英文原句",
  "zh": "自然的繁體中文翻譯",
  "ja": "自然的日文翻譯"
}

規則：
- "time" 使用該行字幕的開始時間（mm:ss）。
- "en" 使用原始英文，如有需要可做輕微修正（修正文法 / 大小寫）。
- "zh" 為適合台灣學生的自然繁體中文。
- "ja" 為自然、口語的日文。
- 不要留空字串，三個語言都要有內容。
`;
      const json = await callGPTForJSON('cues', extra);
      if(json){
        lastCues = json;
        $('#btnDownloadCues').disabled = false;
      }
    });

    $('#btnDownloadCues').addEventListener('click', ()=>{
      if(!lastCues){ alert('尚未產生 cues JSON。'); return; }
      const slug = slugInput.value.trim() || 'slug';
      downloadJSON(lastCues, `cues-${slug}.json`);
    });

    // quiz
    $('#btnGenQuiz').addEventListener('click', async ()=>{
      const extra = `
輸出格式為 JSON 陣列，每個元素為一題四選一選擇題，結構參考：

{
  "id": 1,
  "time": "00:15",
  "en": "英文題目敘述",
  "zh": "繁中題目敘述",
  "ja": "日文題目敘述",
  "choices": ["選項 A", "選項 B", "選項 C", "選項 D"],
  "answer": 2,
  "explain_en": "英語解析，解釋為何此答案正確",
  "explain_zh": "繁中解析",
  "explain_ja": "日文解析",
  "tag": "vocabulary / listening / grammar 等標籤"
}

規則：
- 題目與選項內容要真實反映影片內容。
- 每題只允許一個正確答案（answer 為 1~4）。
- 題目難度以國高中程度為主。
- 至少產生 8~12 題。
`;
      const json = await callGPTForJSON('quiz', extra);
      if(json){
        lastQuiz = json;
        $('#btnDownloadQuiz').disabled = false;
      }
    });

    $('#btnDownloadQuiz').addEventListener('click', ()=>{
      if(!lastQuiz){ alert('尚未產生 quiz JSON。'); return; }
      const slug = slugInput.value.trim() || 'slug';
      downloadJSON(lastQuiz, `quiz-${slug}.json`);
    });

    // vocab
    $('#btnGenVocab').addEventListener('click', async ()=>{
      const extra = `
輸出格式為 JSON 陣列，每個元素代表一個重點單字，結構如下：

{
  "time": "mm:ss",                      // 詞彙首次出現的時間
  "word": "單字（含片語）",
  "pos": "詞性（n., v., adj., phr. v. ...）",
  "zh": "繁體中文解釋",
  "en": "英文解釋（簡單英語）",
  "en_example": "英文例句，情境自然、接近影片內容",
  "zh_example": "例句的繁體中文翻譯",
  "ja": "日文單字或片語",
  "ja_example": "日文例句",
  "img": "建議圖片檔名，例如 assets/category/slug/word-key.jpg"
}

規則：
- 以影片內容為主，挑出 15~25 個重點字彙或片語。
- "img" 只填建議檔名，不要 http 連結。
`;
      const json = await callGPTForJSON('vocab', extra);
      if(json){
        lastVocab = json;
        $('#btnDownloadVocab').disabled = false;
      }
    });

    $('#btnDownloadVocab').addEventListener('click', ()=>{
      if(!lastVocab){ alert('尚未產生 vocab JSON。'); return; }
      const slug = slugInput.value.trim() || 'slug';
      downloadJSON(lastVocab, `vocab-${slug}.json`);
    });

    // ai
    $('#btnGenAi').addEventListener('click', async ()=>{
      const extra = `
請模仿以下範例結構（但不要照抄內容），產生一個適合 AI 互動教學使用的 JSON：

{
  "intro": {
    "zh": "本篇的中文簡介",
    "en": "Short English introduction",
    "ja": "Japanese introduction"
  },
  "topics": [
    {
      "id": 1,
      "key": "main-idea",
      "title_zh": "主旨理解",
      "title_en": "Main Idea",
      "title_ja": "主な内容",
      "questions": [
        {
          "q_zh": "中文提問",
          "q_en": "English question",
          "q_ja": "Japanese question",
          "hint_zh": "中文提示（可省略）",
          "answer_zh": "範例回答（中文）",
          "answer_en": "範例回答（英文）",
          "answer_ja": "範例回答（日文）"
        }
      ]
    }
  ],
  "dialogs": [
    {
      "role": "teacher",
      "zh": "老師中文台詞",
      "en": "Teacher line in English",
      "ja": "Japanese line"
    }
  ]
}

規則：
- topics 至少 3~4 個主題，涵蓋主旨、字彙、句型、延伸討論。
- dialogs 至少 6~10 句，模擬老師帶學生互動的腳本。
`;
      const json = await callGPTForJSON('ai', extra);
      if(json){
        lastAi = json;
        $('#btnDownloadAi').disabled = false;
      }
    });

    $('#btnDownloadAi').addEventListener('click', ()=>{
      if(!lastAi){ alert('尚未產生 ai JSON。'); return; }
      const slug = slugInput.value.trim() || 'slug';
      downloadJSON(lastAi, `ai-${slug}.json`);
    });

    // index
    $('#btnGenIndex').addEventListener('click', ()=>{
      const category = $('#category').value.trim();
      const slug = slugInput.value.trim() || 'slug';
      const title = $('#title').value.trim() || slug;
      const duration = parseInt($('#duration').value,10) || 0;

      const idx = {
        title,
        category,
        slug,
        video: "",
        cover: "",
        cues: { zh: `./cues-${slug}.json` },
        vocab: `./vocab-${slug}.json`,
        quiz: `./quiz-${slug}.json`,
        ai: `./ai-${slug}.json`,
        is_public: true,
        duration_sec: duration
      };
      lastIndex = idx;
      jsonOutput.value = JSON.stringify(idx,null,2);
      $('#btnDownloadIndex').disabled = false;
    });

    $('#btnDownloadIndex').addEventListener('click', ()=>{
      if(!lastIndex){ alert('尚未產生 index JSON。'); return; }
      const slug = slugInput.value.trim() || 'slug';
      downloadJSON(lastIndex, `index-${slug}.json`);
    });
  </script>
</body>
</html>

