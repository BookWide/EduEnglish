<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <title>Talk AI 老師影片批量產生（D-ID）｜BookWide Admin</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />

  <style>
    :root{
      --bg:#f4f6fb;
      --card:#ffffff;
      --ink:#0f172a;
      --muted:#64748b;
      --line:#e5e7eb;
      --brand:#2563eb;
      --ok:#16a34a;
      --warn:#d97706;
      --err:#dc2626;
      --radius:14px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,
        "Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;
      background:var(--bg);
      color:var(--ink);
    }
    header{
      padding:18px 22px;
      font-size:18px;
      font-weight:700;
      background:#fff;
      border-bottom:1px solid var(--line);
    }
    main{
      max-width:1100px;
      margin:24px auto;
      padding:0 16px;
    }
    .card{
      background:var(--card);
      border-radius:var(--radius);
      padding:18px;
      margin-bottom:18px;
      border:1px solid var(--line);
    }
    h2{
      margin:0 0 12px;
      font-size:16px;
    }
    .row{
      display:grid;
      grid-template-columns:180px 1fr;
      gap:12px;
      margin-bottom:10px;
      align-items:center;
    }
    input, textarea, select{
      width:100%;
      padding:8px 10px;
      border-radius:10px;
      border:1px solid var(--line);
      font-size:14px;
    }
    textarea{min-height:70px}
    .btn{
      padding:10px 14px;
      border-radius:12px;
      border:0;
      cursor:pointer;
      font-size:14px;
      background:var(--brand);
      color:#fff;
    }
    .btn.secondary{
      background:#e5e7eb;
      color:#111827;
    }
    .btn.warn{
      background:var(--warn);
    }
    .list{
      width:100%;
      border-collapse:collapse;
      font-size:14px;
    }
    .list th,.list td{
      border-bottom:1px solid var(--line);
      padding:8px;
      text-align:left;
    }
    .tag{
      display:inline-block;
      padding:2px 8px;
      border-radius:999px;
      font-size:12px;
      background:#eef2ff;
      color:#3730a3;
    }
    .ok{color:var(--ok)}
    .muted{color:var(--muted)}
    footer{
      text-align:center;
      font-size:12px;
      color:var(--muted);
      margin:28px 0;
    }
  </style>
</head>

<body>
<header>
  Talk AI 老師影片批量產生（D-ID）
</header>

<main>

  <!-- 基本設定 -->
  <div class="card">
    <h2>① 基本設定</h2>

    <div class="row">
      <label>老師圖片 URL</label>
      <input id="img" value="https://jeajrwpmrgczimmrflxo.supabase.co/storage/v1/object/public/talk/teacher.png">
    </div>

    <div class="row">
      <label>聲音（Voice ID）</label>
      <input id="voice" placeholder="例如：en-US-Jenny">
    </div>

    <div class="row">
      <label>D-ID API Key</label>
      <input id="apikey" type="password" placeholder="sk_***（只在本頁使用）">
    </div>

    <p class="muted">
      ⚠️ 建議：正式版請改由 <b>Supabase Edge Function</b> 呼叫 D-ID，避免 Key 外露。
    </p>
  </div>

  <!-- 情境腳本 -->
  <div class="card">
    <h2>② 情境開場句（每行一個影片）</h2>

    <textarea id="scripts">
Restaurant Order (A1)|Welcome! Are you ready to order?
Coffee Shop (A1)|Welcome to our cafe! What would you like today?
Hotel Check-in (A1)|Hello, welcome to our hotel. May I have your passport?
Business Meeting (A2)|Good morning everyone. Thank you for joining today.
Airport (A2)|Excuse me, may I see your boarding pass?
    </textarea>

    <p class="muted">
      格式：<br>
      <code>情境名稱|老師要說的英文句</code><br>
      → 每一行會產生一支 MP4
    </p>
  </div>

  <!-- 執行 -->
  <div class="card">
    <h2>③ 批量產生</h2>

    <button class="btn warn" onclick="start()">開始呼叫 D-ID 批量產生</button>
    <button class="btn secondary" onclick="clearLog()">清空紀錄</button>

    <pre id="log" style="margin-top:12px;font-size:12px;white-space:pre-wrap"></pre>
  </div>

</main>

<footer>
  BookWide Admin · Talk AI Video Generator · v202601
</footer>

<script>
async function start(){
  const key = apikey.value.trim();
  if(!key){ alert("請輸入 D-ID API Key"); return; }

  const img = document.getElementById('img').value.trim();
  const voice = document.getElementById('voice').value.trim();
  const lines = document.getElementById('scripts').value.trim().split('\n');

  for(const line of lines){
    if(!line.includes('|')) continue;
    const [title,text] = line.split('|');

    logLine(`▶ 產生：${title}`);

    try{
      const res = await fetch("https://api.d-id.com/talks",{
        method:"POST",
        headers:{
          "Authorization":"Basic "+btoa(key+":"),
          "Content-Type":"application/json"
        },
        body:JSON.stringify({
          source_url: img,
          script:{
            type:"text",
            input:text,
            provider:{
              type:"microsoft",
              voice_id: voice || "en-US-JennyNeural"
            }
          },
          config:{ fluent:true }
        })
      });

      const j = await res.json();
      logLine(`✔ 已送出：${j.id}`);
    }catch(e){
      logLine(`✖ 失敗：${e.message}`);
    }
  }
}

function logLine(t){
  log.textContent += t + "\n";
}

function clearLog(){
  log.textContent="";
}
</script>

</body>
</html>
