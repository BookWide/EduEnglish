<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BookWideï½œå­¸ç¿’å½±ç‰‡æ¸…å–®</title>
  <style>
    :root{
      --bg:#0f172a;--panel:#0b1220;--muted:#94a3b8;--text:#e2e8f0;--brand:#60a5fa;
      --chip:#1e293b;--chip-active:#1d4ed8;--card:#0b1220;--border:#1f2937
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto}
    a{color:inherit;text-decoration:none}
    .container{max-width:1200px;margin:0 auto;padding:24px}
    header.topbar{position:sticky;top:0;z-index:50;background:rgba(15,23,42,.9);backdrop-filter:saturate(180%) blur(8px);border-bottom:1px solid var(--border)}
    header .row{display:flex;align-items:center;gap:12px;justify-content:space-between}
    .logo{font-size:28px;font-weight:800;letter-spacing:.5px}
    .logo b{color:var(--brand)}
    .actions{display:flex;align-items:center;gap:10px}
    .chip{background:var(--chip);border:1px solid var(--border);color:var(--text);padding:8px 14px;border-radius:9999px;cursor:pointer}
    .chip.active{background:var(--chip-active)}
    .muted{color:var(--muted)}
    .grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:18px}
    @media (max-width:960px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media (max-width:640px){.grid{grid-template-columns:1fr}}
    .card{display:block;background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden}
    .thumb-wrap{position:relative;aspect-ratio:16/9;background:#0a0f1a}
    .thumb{width:100%;height:100%;object-fit:cover;display:block}
    .card-body{padding:12px 14px 14px}
    .title{font-weight:700;margin:2px 0 8px}
    .meta{display:flex;gap:10px;color:var(--muted);font-size:13px}
    .pill{display:inline-block;background:var(--chip);color:var(--text);padding:4px 10px;border-radius:9999px;border:1px solid var(--border);font-size:12px}
    .feature-row{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:14px;margin:18px 0 6px}
    @media (max-width:960px){.feature-row{grid-template-columns:1fr}}
    .feature{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:14px}
    .tagbar{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 14px}
    .searchbar{display:flex;gap:8px;margin:10px 0 20px}
    .searchbar input{flex:1;background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:12px 14px;color:var(--text)}
    .btn{background:var(--chip);border:1px solid var(--border);color:var(--text);padding:10px 14px;border-radius:10px;cursor:pointer}
    .btn:hover{filter:brightness(1.1)}
    /* user menu */
    #userMenu{position:relative}
    #userDropdown{position:absolute;right:0;top:120%;background:var(--panel);border:1px solid var(--border);
      border-radius:12px;min-width:240px;box-shadow:0 10px 30px rgba(0,0,0,.35);display:none}
    #userDropdown.open{display:block}
    #userDropdown a{display:block;padding:10px 14px;border-bottom:1px solid var(--border)}
    #userDropdown a:last-child{border-bottom:0}
    .right{display:flex;align-items:center;gap:10px}
    /* å›ºå®š LINE é€£çµ */
    #btnLINE{position:fixed;right:14px;bottom:18px;z-index:40}
    #btnLINE a{display:inline-block;background:#22c55e;color:#052e16;border-radius:9999px;padding:9px 14px;font-weight:700}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="container row">
      <div class="logo">Book<b>Wide</b></div>
      <div class="right">
        <!-- æœå‹™å°è¦½ï¼ˆä½ çš„åŸä¾†æŒ‰éˆ•å¯ä¿ç•™ä½ç½®ï¼Œé€™è£¡ç°¡åŒ–ï¼‰ -->
        <button class="chip" id="svcBtn" aria-expanded="false">æœå‹™å°è¦½ â–¾</button>
        <!-- BookWide ç™»å…¥åŠŸèƒ½æ¨¡çµ„ï¼ˆå›ºå®šå€åŸŸï¼Œä¸å¯åˆªé™¤ï¼‰ -->
        <div id="userMenu">
          <button class="chip" id="signInBtn" aria-label="Sign in">ç™»å…¥</button>
          <div id="userDropdown" role="menu" aria-labelledby="userMenu">
            <a href="pricing.html">æ–¹æ¡ˆåƒ¹æ ¼</a>
            <a href="profile.html">å€‹äººè³‡æ–™</a>
            <a href="billing.html">æˆ‘çš„è¨‚é–±</a>
            <a href="dashboard.html">å­¸ç¿’æ§åˆ¶å°</a>
            <a href="referral.html">æ¨å»£åˆ†æ½¤</a>
            <a href="#" id="signOutBtn">ç™»å‡º</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <h1 style="margin:18px 0 8px">çœ‹å½±ç‰‡ã€åšæ¸¬é©—ã€èƒŒå–®å­— â€”â€” ä¸€é å®Œæˆ</h1>
    <p class="muted" style="margin:0 0 16px">
      BookWide ç”¨ <b>æ•…äº‹</b>ã€<b>éŸ³æ¨‚</b>ã€<b>é›»å½±</b>ã€<b>æ–°è</b>ã€<b>å°ˆæ¥­ä¸»é¡Œ</b> å¸¶ä½ å­¸è‹±æ–‡ã€‚é€å¥æ’­æ”¾ã€é›™èªå­—å¹•ã€å–®å­—å¡èˆ‡åˆ†å€æ¸¬é©—ï¼Œå®Œæ•´ç·´åˆ°è½è®€å¯«ã€‚
    </p>

    <!-- å››å€‹å›ºå®šåŠŸèƒ½èªªæ˜å¡ï¼ˆä½ åŸæœ¬çš„æ–‡æ¡ˆä¿ç•™ï¼‰ -->
    <div class="feature-row">
      <div class="feature">
        <div style="font-weight:700;margin-bottom:6px">ğŸ§  é€å¥æ’­æ”¾</div>
        <div class="muted">ä¸€éµå›æ”¾ / ä¸‹ä¸€å¥ï¼Œè·Ÿè‘—æ–‡æœ¬èµ°ï¼Œä¸è¿·è·¯ã€‚</div>
      </div>
      <div class="feature">
        <div style="font-weight:700;margin-bottom:6px">ğŸ’¬ é›™èªå­—å¹•</div>
        <div class="muted">è‹±æ–‡åœ¨ä¸Šï¼Œä¸­æ–‡åœ¨ä¸‹ï¼›æ‰‹æ©Ÿä¹Ÿèƒ½é•·å¥ä¸æ–·è¡Œã€‚</div>
      </div>
      <div class="feature">
        <div style="font-weight:700;margin-bottom:6px">ğŸ§© åˆ†å€æ¸¬é©—</div>
        <div class="muted">Vocabulary / Grammar / Reading / Mixed å››åˆ†å€è©•é‡ã€‚</div>
      </div>
      <div class="feature">
        <div style="font-weight:700;margin-bottom:6px">ğŸ“š å–®å­—å¡</div>
        <div class="muted">é®å­—å¡«ç©ºã€æœ—è®€ã€å¿«é€Ÿè·³æ®µï¼ŒçœŸæ­£ç”¨åˆ°çš„å­—æ‰è¨˜å¾—ä½ã€‚</div>
      </div>
    </div>

    <!-- ç¯©é¸åˆ— -->
    <div class="tagbar" id="tabBar" role="tablist" aria-label="é¡åˆ¥ç¯©é¸">
      <button class="chip active" data-cat="all" role="tab" aria-selected="true">å…¨éƒ¨</button>
      <button class="chip" data-cat="story" role="tab">æ•…äº‹</button>
      <button class="chip" data-cat="music" role="tab">éŸ³æ¨‚</button>
      <button class="chip" data-cat="movie" role="tab">é›»å½±</button>
      <button class="chip" data-cat="news" role="tab">æ–°è</button>
      <button class="chip" data-cat="pro" role="tab">å°ˆæ¥­è¡Œæ¥­</button>
    </div>

    <!-- æœå°‹ -->
    <div class="searchbar">
      <input id="kw" placeholder="æœå°‹æ¨™é¡Œã€é—œéµå­—â€¦" />
      <button id="btnSearch" class="btn">æœå°‹</button>
    </div>

    <!-- æ¸…å–® -->
    <div id="grid" class="grid" aria-live="polite"></div>
  </main>

  <!-- å›ºå®šå³ä¸‹ï¼šLINE è¯çµ¡ -->
  <div id="btnLINE"><a href="https://line.me/R/ti/p/@bookwide" target="_blank" aria-label="è¯çµ¡æˆ‘å€‘ï¼ˆLINEï¼‰">LINE è¯çµ¡</a></div>

  <script>
    /***********************
     *  BookWide Index V002
     *  - è¼‰å…¥ ./data/<cat>/index.json
     *  - è‹¥ä¸å­˜åœ¨ï¼Œå›é€€ ./data/<cat>/<cat>-index.json
     *  - ä¿ç•™ç™»å…¥æ¨¡çµ„ï¼ˆæœªä¸²æ™‚å‡ºæç¤ºï¼‰
     ************************/

    const $ = (s, e = document) => e.querySelector(s);
    const $$ = (s, e = document) => [...e.querySelectorAll(s)];
    const grid = $("#grid");
    const tabBar = $("#tabBar");
    const kwInput = $("#kw");

    const CATS = ["story","music","movie","news","pro"];

    function safe(src){ return src.replace(/\s+/g,"%20"); }

    function getThumb(item){
      if(item.thumb){ return item.thumb; }
      const cat = item.cat, slug = item.slug;
      const jpg = `./videos/${cat}/${slug}.jpg`;
      const png = `./videos/${cat}/${slug}.png`;
      return jpg; // ç€è¦½å™¨è‡ªå‹•è«‹æ±‚ï¼Œä¸å­˜åœ¨ä¹Ÿä¸å½±éŸ¿
    }

    function toCardHTML(it){
      const url = `./player.html?cat=${encodeURIComponent(it.cat)}&slug=${encodeURIComponent(it.slug)}`;
      const thumb = safe(getThumb(it));
      const title = it.title || it.slug;
      const level = it.level || it.levels || "";
      const duration = it.duration || it.dur || "";
      const tag = it.catName || ({story:"æ•…äº‹",music:"éŸ³æ¨‚",movie:"é›»å½±",news:"æ–°è",pro:"å°ˆæ¥­"}[it.cat]||it.cat);
      return `
        <a class="card" href="${url}">
          <div class="thumb-wrap"><img class="thumb" src="${thumb}" alt="${title}" loading="lazy"/></div>
          <div class="card-body">
            <div class="title">${title}</div>
            <div class="meta">
              <span class="pill">${tag}</span>
              ${duration?`<span>${duration}</span>`:""}
              ${level?`<span>${level}</span>`:""}
            </div>
          </div>
        </a>
      `;
    }

    function render(list){
      if(!list.length){
        grid.innerHTML = `<div class="muted" style="grid-column:1/-1;padding:18px 6px">ï¼ˆæš«ç„¡è³‡æ–™æˆ–é—œéµå­—ç„¡çµæœï¼‰</div>`;
        return;
      }
      grid.innerHTML = list.map(toCardHTML).join("");
    }

    let ALL = [];               // å…¨é‡
    let state = { cat:"all", kw:"" };

    function apply(){
      const kw = state.kw.trim().toLowerCase();
      let list = ALL.filter(x => state.cat === "all" ? true : x.cat === state.cat);
      if(kw){
        list = list.filter(x => {
          const hay = `${x.title||""} ${x.desc||""} ${(x.tags||[]).join(" ")}`.toLowerCase();
          return hay.includes(kw);
        });
      }
      render(list);
    }

    // è®€å–ä¸€å€‹é¡åˆ¥çš„ index
    async function loadOne(cat){
      const tryPaths = [
        `./data/${cat}/index.json`,
        `./data/${cat}/${cat}-index.json`
      ];
      for(const p of tryPaths){
        try{
          const res = await fetch(p);
          if(res.ok){
            const arr = await res.json();
            return arr.map(x => ({...x, cat}));
          }
        }catch(_e){}
      }
      console.log(`[WARN] é¡åˆ¥ ${cat} æ²’æœ‰ index.jsonï¼ˆæˆ– <cat>-index.jsonï¼‰`);
      return [];
    }

    // è¼‰å…¥å…¨éƒ¨é¡åˆ¥
    async function loadAll(){
      let total = [];
      for(const c of CATS){
        const arr = await loadOne(c);
        total = total.concat(arr);
      }
      return total;
    }

    // äº‹ä»¶ç¶å®šï¼šç¯©é¸ï¼æœå°‹
    tabBar.addEventListener("click", (e)=>{
      const b = e.target.closest("[data-cat]");
      if(!b) return;
      $$(".chip", tabBar).forEach(x => x.classList.remove("active"));
      b.classList.add("active");
      state.cat = b.dataset.cat;
      apply();
    });

    $("#btnSearch").addEventListener("click", ()=>{
      state.kw = kwInput.value;
      apply();
    });
    kwInput.addEventListener("keydown", (e)=>{
      if(e.key === "Enter"){
        state.kw = kwInput.value;
        apply();
      }
    });

    // å³ä¸Šç™»å…¥æ¨¡çµ„ï¼ˆæœªä¸² Supabase å‹å–„æç¤ºï¼‰
    function setupAuth(){
      const signBtn = $("#signInBtn");
      const signOut = $("#signOutBtn");
      const dropdown = $("#userDropdown");
      const userMenu = $("#userMenu");

      // å¦‚æœå·²ç¶“ç™»å…¥ï¼ˆä¹‹å¾Œä¸² supabase å¾Œç”±ç‹€æ…‹åˆ‡æ›ï¼‰ï¼Œé€™è£¡å…ˆå›ºå®šã€Œæœªç™»å…¥ã€è¡Œç‚º
      signBtn.addEventListener("click", ()=>{
        // åµæ¸¬å…¨åŸŸ supabase ç‰©ä»¶
        if(window.supabase && window.supabase.auth){
          // ä¾‹ï¼šwindow.supabase.auth.signInWithOAuth({ provider:'google' })
          try{
            alert("æ­¤ç¯„ä¾‹å°šæœªä¸²æ¥ç™»å…¥æœå‹™ï¼Œè«‹åœ¨å°ˆæ¡ˆåŠ å…¥ Supabase å¾Œå‘¼å« signInWithOAuthã€‚");
          }catch(_e){}
        }else{
          alert("æ­¤ç¯„ä¾‹å°šæœªä¸²æ¥ç™»å…¥æœå‹™ï¼Œè«‹åœ¨å°ˆæ¡ˆåŠ å…¥ Supabase å¾Œå‘¼å« signInWithOAuthã€‚");
        }
      });

      // å±•é–‹/æ”¶åˆï¼ˆä¹‹å¾Œç™»å…¥ç‹€æ…‹æ™‚æ‰æœƒé¡¯ç¤º dropdownï¼‰
      userMenu.addEventListener("click",(e)=>{
        const isMenuBtn = e.target.id === "signInBtn";
        if(isMenuBtn) return; // æœªç™»å…¥ç‹€æ…‹æŒ‰éˆ•ä¸Šé¢å·²è™•ç†
        dropdown.classList.toggle("open");
        e.stopPropagation();
      });
      document.addEventListener("click",()=> dropdown.classList.remove("open"));
      document.addEventListener("keydown",(e)=>{ if(e.key==="Escape") dropdown.classList.remove("open"); });

      signOut.addEventListener("click",(e)=>{
        e.preventDefault();
        if(window.supabase && window.supabase.auth){
          try{ window.supabase.auth.signOut(); }catch(_e){}
        }
        dropdown.classList.remove("open");
        alert("å·²ç™»å‡ºï¼ˆç¤ºæ„ï¼‰ã€‚");
      });
    }

    // åˆå§‹åŒ–
    (async function init(){
      setupAuth();
      ALL = await loadAll();
      apply();
    })();
  </script>
</body>
</html>





