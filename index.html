<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BookWide｜學習影片清單</title>
  <style>
    :root{
      --bg:#0f172a;--panel:#0b1220;--muted:#94a3b8;--text:#e2e8f0;--brand:#60a5fa;
      --chip:#1e293b;--chip-active:#1d4ed8;--card:#0b1220;--border:#1f2937
    }
    *{box-sizing:border-box}
    html,body{margin:0;background:var(--bg);color:var(--text);font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto}
    a{color:inherit;text-decoration:none}
    .container{max-width:1200px;margin:0 auto;padding:24px}
    header.topbar{position:sticky;top:0;z-index:50;background:rgba(15,23,42,.9);backdrop-filter:saturate(180%) blur(8px);border-bottom:1px solid var(--border)}
    header .row{display:flex;align-items:center;gap:12px;justify-content:space-between}
    .logo{font-size:28px;font-weight:800;letter-spacing:.5px}
    .logo b{color:var(--brand)}
    .actions{display:flex;align-items:center;gap:10px}
    .chip{background:var(--chip);border:1px solid var(--border);color:var(--text);padding:8px 14px;border-radius:9999px;cursor:pointer}
    .chip.active{background:var(--chip-active)}
    .muted{color:var(--muted)}
    .grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:18px}
    @media (max-width:960px){.grid{grid-template-columns:repeat(2,minmax(0,1fr))}}
    @media (max-width:640px){.grid{grid-template-columns:1fr}}
    .card{display:block;background:var(--card);border:1px solid var(--border);border-radius:14px;overflow:hidden}
    .thumb-wrap{position:relative;aspect-ratio:16/9;background:#0a0f1a}
    .thumb{width:100%;height:100%;object-fit:cover;display:block}
    .card-body{padding:12px 14px 14px}
    .title{font-weight:700;margin:2px 0 8px}
    .meta{display:flex;gap:10px;color:var(--muted);font-size:13px}
    .pill{display:inline-block;background:var(--chip);color:var(--text);padding:4px 10px;border-radius:9999px;border:1px solid var(--border);font-size:12px}
    .feature-row{display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:14px;margin:18px 0 6px}
    @media (max-width:960px){.feature-row{grid-template-columns:1fr}}
    .feature{background:var(--panel);border:1px solid var(--border);border-radius:14px;padding:14px}
    .tagbar{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 14px}
    .searchbar{display:flex;gap:8px;margin:10px 0 20px}
    .searchbar input{flex:1;background:var(--panel);border:1px solid var(--border);border-radius:10px;padding:12px 14px;color:var(--text)}
    .btn{background:var(--chip);border:1px solid var(--border);color:var(--text);padding:10px 14px;border-radius:10px;cursor:pointer}
    .btn:hover{filter:brightness(1.1)}
    /* user menu */
    #userMenu{position:relative}
    #userDropdown{position:absolute;right:0;top:120%;background:var(--panel);border:1px solid var(--border);
      border-radius:12px;min-width:240px;box-shadow:0 10px 30px rgba(0,0,0,.35);display:none}
    #userDropdown.open{display:block}
    #userDropdown a{display:block;padding:10px 14px;border-bottom:1px solid var(--border)}
    #userDropdown a:last-child{border-bottom:0}
    .right{display:flex;align-items:center;gap:10px}
    /* 固定 LINE 連結 */
    #btnLINE{position:fixed;right:14px;bottom:18px;z-index:40}
    #btnLINE a{display:inline-block;background:#22c55e;color:#052e16;border-radius:9999px;padding:9px 14px;font-weight:700}
  </style>
</head>
<body>
  <header class="topbar">
    <div class="container row">
      <div class="logo">Book<b>Wide</b></div>
      <div class="right">
        <!-- 服務導覽（你的原來按鈕可保留位置，這裡簡化） -->
        <button class="chip" id="svcBtn" aria-expanded="false">服務導覽 ▾</button>
        <!-- BookWide 登入功能模組（固定區域，不可刪除） -->
        <div id="userMenu">
          <button class="chip" id="signInBtn" aria-label="Sign in">登入</button>
          <div id="userDropdown" role="menu" aria-labelledby="userMenu">
            <a href="pricing.html">方案價格</a>
            <a href="profile.html">個人資料</a>
            <a href="billing.html">我的訂閱</a>
            <a href="dashboard.html">學習控制台</a>
            <a href="referral.html">推廣分潤</a>
            <a href="#" id="signOutBtn">登出</a>
          </div>
        </div>
      </div>
    </div>
  </header>

  <main class="container">
    <h1 style="margin:18px 0 8px">看影片、做測驗、背單字 —— 一頁完成</h1>
    <p class="muted" style="margin:0 0 16px">
      BookWide 用 <b>故事</b>、<b>音樂</b>、<b>電影</b>、<b>新聞</b>、<b>專業主題</b> 帶你學英文。逐句播放、雙語字幕、單字卡與分區測驗，完整練到聽讀寫。
    </p>

    <!-- 四個固定功能說明卡（你原本的文案保留） -->
    <div class="feature-row">
      <div class="feature">
        <div style="font-weight:700;margin-bottom:6px">🧠 逐句播放</div>
        <div class="muted">一鍵回放 / 下一句，跟著文本走，不迷路。</div>
      </div>
      <div class="feature">
        <div style="font-weight:700;margin-bottom:6px">💬 雙語字幕</div>
        <div class="muted">英文在上，中文在下；手機也能長句不斷行。</div>
      </div>
      <div class="feature">
        <div style="font-weight:700;margin-bottom:6px">🧩 分區測驗</div>
        <div class="muted">Vocabulary / Grammar / Reading / Mixed 四分區評量。</div>
      </div>
      <div class="feature">
        <div style="font-weight:700;margin-bottom:6px">📚 單字卡</div>
        <div class="muted">遮字填空、朗讀、快速跳段，真正用到的字才記得住。</div>
      </div>
    </div>

    <!-- 篩選列 -->
    <div class="tagbar" id="tabBar" role="tablist" aria-label="類別篩選">
      <button class="chip active" data-cat="all" role="tab" aria-selected="true">全部</button>
      <button class="chip" data-cat="story" role="tab">故事</button>
      <button class="chip" data-cat="music" role="tab">音樂</button>
      <button class="chip" data-cat="movie" role="tab">電影</button>
      <button class="chip" data-cat="news" role="tab">新聞</button>
      <button class="chip" data-cat="pro" role="tab">專業行業</button>
    </div>

    <!-- 搜尋 -->
    <div class="searchbar">
      <input id="kw" placeholder="搜尋標題、關鍵字…" />
      <button id="btnSearch" class="btn">搜尋</button>
    </div>

    <!-- 清單 -->
    <div id="grid" class="grid" aria-live="polite"></div>
  </main>

  <!-- 固定右下：LINE 聯絡 -->
  <div id="btnLINE"><a href="https://line.me/R/ti/p/@bookwide" target="_blank" aria-label="聯絡我們（LINE）">LINE 聯絡</a></div>

  <script>
    /***********************
     *  BookWide Index V002
     *  - 載入 ./data/<cat>/index.json
     *  - 若不存在，回退 ./data/<cat>/<cat>-index.json
     *  - 保留登入模組（未串時出提示）
     ************************/

    const $ = (s, e = document) => e.querySelector(s);
    const $$ = (s, e = document) => [...e.querySelectorAll(s)];
    const grid = $("#grid");
    const tabBar = $("#tabBar");
    const kwInput = $("#kw");

    const CATS = ["story","music","movie","news","pro"];

    function safe(src){ return src.replace(/\s+/g,"%20"); }

    function getThumb(item){
      if(item.thumb){ return item.thumb; }
      const cat = item.cat, slug = item.slug;
      const jpg = `./videos/${cat}/${slug}.jpg`;
      const png = `./videos/${cat}/${slug}.png`;
      return jpg; // 瀏覽器自動請求，不存在也不影響
    }

    function toCardHTML(it){
      const url = `./player.html?cat=${encodeURIComponent(it.cat)}&slug=${encodeURIComponent(it.slug)}`;
      const thumb = safe(getThumb(it));
      const title = it.title || it.slug;
      const level = it.level || it.levels || "";
      const duration = it.duration || it.dur || "";
      const tag = it.catName || ({story:"故事",music:"音樂",movie:"電影",news:"新聞",pro:"專業"}[it.cat]||it.cat);
      return `
        <a class="card" href="${url}">
          <div class="thumb-wrap"><img class="thumb" src="${thumb}" alt="${title}" loading="lazy"/></div>
          <div class="card-body">
            <div class="title">${title}</div>
            <div class="meta">
              <span class="pill">${tag}</span>
              ${duration?`<span>${duration}</span>`:""}
              ${level?`<span>${level}</span>`:""}
            </div>
          </div>
        </a>
      `;
    }

    function render(list){
      if(!list.length){
        grid.innerHTML = `<div class="muted" style="grid-column:1/-1;padding:18px 6px">（暫無資料或關鍵字無結果）</div>`;
        return;
      }
      grid.innerHTML = list.map(toCardHTML).join("");
    }

    let ALL = [];               // 全量
    let state = { cat:"all", kw:"" };

    function apply(){
      const kw = state.kw.trim().toLowerCase();
      let list = ALL.filter(x => state.cat === "all" ? true : x.cat === state.cat);
      if(kw){
        list = list.filter(x => {
          const hay = `${x.title||""} ${x.desc||""} ${(x.tags||[]).join(" ")}`.toLowerCase();
          return hay.includes(kw);
        });
      }
      render(list);
    }

    // 讀取一個類別的 index
    async function loadOne(cat){
      const tryPaths = [
        `./data/${cat}/index.json`,
        `./data/${cat}/${cat}-index.json`
      ];
      for(const p of tryPaths){
        try{
          const res = await fetch(p);
          if(res.ok){
            const arr = await res.json();
            return arr.map(x => ({...x, cat}));
          }
        }catch(_e){}
      }
      console.log(`[WARN] 類別 ${cat} 沒有 index.json（或 <cat>-index.json）`);
      return [];
    }

    // 載入全部類別
    async function loadAll(){
      let total = [];
      for(const c of CATS){
        const arr = await loadOne(c);
        total = total.concat(arr);
      }
      return total;
    }

    // 事件綁定：篩選／搜尋
    tabBar.addEventListener("click", (e)=>{
      const b = e.target.closest("[data-cat]");
      if(!b) return;
      $$(".chip", tabBar).forEach(x => x.classList.remove("active"));
      b.classList.add("active");
      state.cat = b.dataset.cat;
      apply();
    });

    $("#btnSearch").addEventListener("click", ()=>{
      state.kw = kwInput.value;
      apply();
    });
    kwInput.addEventListener("keydown", (e)=>{
      if(e.key === "Enter"){
        state.kw = kwInput.value;
        apply();
      }
    });

    // 右上登入模組（未串 Supabase 友善提示）
    function setupAuth(){
      const signBtn = $("#signInBtn");
      const signOut = $("#signOutBtn");
      const dropdown = $("#userDropdown");
      const userMenu = $("#userMenu");

      // 如果已經登入（之後串 supabase 後由狀態切換），這裡先固定「未登入」行為
      signBtn.addEventListener("click", ()=>{
        // 偵測全域 supabase 物件
        if(window.supabase && window.supabase.auth){
          // 例：window.supabase.auth.signInWithOAuth({ provider:'google' })
          try{
            alert("此範例尚未串接登入服務，請在專案加入 Supabase 後呼叫 signInWithOAuth。");
          }catch(_e){}
        }else{
          alert("此範例尚未串接登入服務，請在專案加入 Supabase 後呼叫 signInWithOAuth。");
        }
      });

      // 展開/收合（之後登入狀態時才會顯示 dropdown）
      userMenu.addEventListener("click",(e)=>{
        const isMenuBtn = e.target.id === "signInBtn";
        if(isMenuBtn) return; // 未登入狀態按鈕上面已處理
        dropdown.classList.toggle("open");
        e.stopPropagation();
      });
      document.addEventListener("click",()=> dropdown.classList.remove("open"));
      document.addEventListener("keydown",(e)=>{ if(e.key==="Escape") dropdown.classList.remove("open"); });

      signOut.addEventListener("click",(e)=>{
        e.preventDefault();
        if(window.supabase && window.supabase.auth){
          try{ window.supabase.auth.signOut(); }catch(_e){}
        }
        dropdown.classList.remove("open");
        alert("已登出（示意）。");
      });
    }

    // 初始化
    (async function init(){
      setupAuth();
      ALL = await loadAll();
      apply();
    })();
  </script>
</body>
</html>





