<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <title>BookWideÔΩúÁúãÂΩ±Áâá„ÄÅÂÅöÊ∏¨È©ó„ÄÅËÉåÂñÆÂ≠ó ‚Äî‚Äî ‰∏ÄÈ†ÅÂÆåÊàê</title>
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <meta name="description" content="BookWide Áî® ÊïÖ‰∫ã¬∑Èü≥Ê®Ç¬∑ÈõªÂΩ±¬∑Êñ∞ËÅû¬∑Â∞àÊ•≠‰∏ªÈ°å Â∏∂‰Ω†Â≠∏Ëã±Êñá„ÄÇÈÄêÂè•Êí≠Êîæ„ÄÅÈõôË™ûÂ≠óÂπï„ÄÅÂñÆÂ≠óÂç°ËàáÂàÜÂçÄÊ∏¨È©óÔºåÂÆåÊï¥Á∑¥Âà∞ËÅΩËÆÄÂØ´„ÄÇ">
  <link rel="icon" href="./assets/favicon.png">
  <style>
    :root{
      --bg:#f3f4f6;
      --card:#ffffff;
      --primary:#0b53ff;
      --primary-soft:#e0ebff;
      --border:#e5e7eb;
      --text:#111827;
      --muted:#6b7280;
      --chip:#f3f4ff;
    }
    *{box-sizing:border-box;margin:0;padding:0}
    body{
      font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",system-ui,"PingFang TC","Noto Sans CJK TC",sans-serif;
      background:var(--bg);
      color:var(--text);
      -webkit-font-smoothing:antialiased;
    }
    a{color:inherit;text-decoration:none}
    .shell{max-width:1200px;margin:0 auto;padding:16px 16px 40px}
    header{
      display:flex;
      align-items:center;
      justify-content:space-between;
      padding:10px 0 12px;
    }
    .logo{display:flex;align-items:center;gap:10px;font-weight:700;font-size:20px}
    .logo img{width:32px;height:32px;border-radius:8px}
    .beta{font-size:12px;padding:2px 6px;border-radius:999px;border:1px solid var(--border);color:var(--muted)}
    .nav-right{display:flex;align-items:center;gap:12px}
    .user-menu-btn{
      position:relative;
      padding:6px 12px;
      border-radius:999px;
      border:1px solid var(--border);
      background:#fff;
      min-width:120px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:6px;
      cursor:pointer;
      font-size:14px;
    }
    .user-menu-btn span.email{
      max-width:150px;
      overflow:hidden;
      text-overflow:ellipsis;
      white-space:nowrap;
    }
    .user-menu{
      position:absolute;
      right:0;
      top:110%;
      background:#fff;
      border-radius:10px;
      box-shadow:0 18px 45px rgba(15,23,42,.18);
      padding:8px 0;
      min-width:220px;
      z-index:40;
      display:none;
    }
    .user-menu.open{display:block}
    .user-menu hr{border:none;border-top:1px solid #f3f4f6;margin:6px 0}
    .user-menu .item{
      padding:8px 14px;
      font-size:14px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      cursor:pointer;
    }
    .user-menu .item:hover{background:#f9fafb}
    .user-menu .item .label{display:flex;align-items:center;gap:6px}
    .user-menu .badge{
      font-size:11px;
      padding:1px 6px;
      border-radius:999px;
      background:#eef2ff;
      color:#3730a3;
    }
    .btn-primary{
      border-radius:999px;
      padding:6px 14px;
      border:none;
      background:#111827;
      color:#fff;
      font-size:14px;
      cursor:pointer;
    }
    .btn-secondary{
      border-radius:999px;
      padding:6px 14px;
      border:1px solid var(--border);
      background:#fff;
      font-size:14px;
      cursor:pointer;
    }

    .hero{
      background:#fff;
      border-radius:18px;
      padding:18px 20px 18px;
      margin-top:4px;
      box-shadow:0 18px 45px rgba(15,23,42,.06);
    }
    .hero-title{
      font-size:26px;
      font-weight:700;
      margin-bottom:6px;
    }
    .hero-sub{
      font-size:14px;
      color:var(--muted);
      margin-bottom:16px;
      line-height:1.6;
    }
    .hero-actions{display:flex;flex-wrap:wrap;gap:8px}
    .hero-actions .btn-big{
      border-radius:999px;
      padding:8px 16px;
      font-size:14px;
      border:none;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      gap:6px;
    }
    .btn-primary-big{
      background:var(--primary);
      color:#fff;
      box-shadow:0 12px 30px rgba(37,99,235,.35);
    }
    .btn-outline-big{
      background:#fff;
      border:1px solid var(--border);
    }
    .pill-row{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:14px;
    }
    .pill{
      font-size:13px;
      padding:6px 10px;
      border-radius:999px;
      background:#f3f4ff;
      color:#4b5563;
      display:flex;
      align-items:center;
      gap:6px;
    }
    .pill span.icon{
      width:18px;height:18px;border-radius:999px;
      background:#e0f2fe;
      display:flex;align-items:center;justify-content:center;
      font-size:11px;
    }

    .tabs{display:flex;gap:10px;flex-wrap:wrap;margin:10px 0 18px}
    .tab{background:var(--chip);border:1px solid var(--border);color:#111;padding:8px 12px;border-radius:999px;cursor:pointer}
    .tab.on{background:#0b53ff;color:#fff;border-color:#0b53ff}
    .level-bar{display:flex;flex-wrap:wrap;gap:6px;margin:4px 0 10px}
    .level-bar .lv{padding:4px 10px;border-radius:999px;border:1px solid var(--border);background:#f9fafb;font-size:13px;cursor:pointer}
    .level-bar .lv.on{background:#111827;color:#fff;border-color:#111827}

    .searchbar{
      display:flex;
      gap:8px;
      align-items:center;
      margin:4px 0 18px;
    }
    .searchbar input{
      flex:1;
      padding:8px 10px;
      border-radius:999px;
      border:1px solid var(--border);
      font-size:14px;
    }
    .searchbar button{
      border-radius:999px;
      border:none;
      background:#111827;
      color:#fff;
      padding:8px 14px;
      font-size:14px;
      cursor:pointer;
      white-space:nowrap;
    }

    .grid{
      display:grid;
      grid-template-columns:repeat(5,minmax(0,1fr));
      gap:14px;
    }
    @media (max-width:1024px){
      .grid{grid-template-columns:repeat(3,minmax(0,1fr))}
    }
    @media (max-width:768px){
      .shell{padding:12px 10px 30px}
      .hero{padding:16px 14px;margin-top:6px}
      .hero-title{font-size:22px}
      .hero-actions{flex-direction:column;align-items:flex-start}
      .grid{grid-template-columns:repeat(2,minmax(0,1fr))}
      .user-menu-btn span.email{max-width:110px}
    }
    @media (max-width:480px){
      .grid{grid-template-columns:repeat(2,minmax(0,1fr))}
    }

    .card{
      background:#fff;
      border-radius:14px;
      overflow:hidden;
      box-shadow:0 8px 18px rgba(15,23,42,.06);
      display:flex;
      flex-direction:column;
      height:100%;
      transition:transform .08s ease, box-shadow .08s ease;
    }
    .card:hover{
      transform:translateY(-2px);
      box-shadow:0 16px 35px rgba(15,23,42,.14);
    }
    .thumb{
      position:relative;
      width:100%;
      padding-top:56.25%;
      background:#111827;
      overflow:hidden;
    }
    .thumb img{
      position:absolute;left:0;top:0;width:100%;height:100%;object-fit:cover;
    }
    .thumb .cat-tag{
      position:absolute;
      left:8px;top:8px;
      font-size:11px;
      padding:3px 7px;
      border-radius:999px;
      background:rgba(17,24,39,.78);
      color:#fff;
    }
    .thumb .badge-new{
      position:absolute;
      right:8px;top:8px;
      font-size:11px;
      padding:3px 7px;
      border-radius:999px;
      background:#f97316;
      color:#fff;
    }
    .pad{
      padding:8px 10px 10px;
      display:flex;
      flex-direction:column;
      gap:4px;
      flex:1;
    }
    .title{
      font-size:14px;
      font-weight:600;
      line-height:1.4;
      display:-webkit-box;
      -webkit-line-clamp:2;
      -webkit-box-orient:vertical;
      overflow:hidden;
    }
    .meta{
      font-size:12px;
      color:var(--muted);
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:4px;
    }
    .meta span{white-space:nowrap}

    footer{
      margin-top:20px;
      font-size:12px;
      color:#9ca3af;
      text-align:center;
    }
    footer a{color:#6b7280;text-decoration:underline}

    .toast{
      position:fixed;
      left:50%;
      bottom:20px;
      transform:translateX(-50%);
      background:#111827;
      color:#fff;
      padding:10px 14px;
      border-radius:999px;
      font-size:13px;
      box-shadow:0 12px 28px rgba(0,0,0,.35);
      display:none;
      z-index:60;
    }
  </style>
</head>
<body>
  <div class="shell">
    <header>
      <div class="logo">
        <img src="./assets/logo-64.png" alt="BookWide">
        <div>BookWide</div>
        <span class="beta">Beta</span>
      </div>
      <div class="nav-right">
        <button class="btn-secondary" id="btnGuide">ÊúçÂãôÂ∞éË¶Ω ‚ñæ</button>
        <button class="btn-primary" id="btnSignin">ÁôªÂÖ•</button>
        <div class="user-menu-container" id="userMenuWrap" style="display:none">
          <button class="user-menu-btn" id="userMenuBtn" aria-haspopup="true" aria-expanded="false">
            <span class="email" id="userEmail">Â∏≥Ëôü</span>
            <span>‚ñæ</span>
          </button>
          <div class="user-menu" id="userMenu" role="menu">
            <div class="item" data-link="./pricing.html">
              <div class="label"><span>ÊñπÊ°àËàáÂÉπÊ†º</span></div>
            </div>
            <div class="item" data-link="./profile.html">
              <div class="label"><span>ÂÄã‰∫∫Ë≥áÊñô</span></div>
            </div>
            <div class="item" data-link="./account/subscription.html">
              <div class="label"><span>ÊàëÁöÑË®ÇÈñ±</span></div>
            </div>
            <div class="item" data-link="./dashboard.html">
              <div class="label"><span>Â≠∏ÁøíÊéßÂà∂Âè∞</span></div>
              <span class="badge">New</span>
            </div>
            <div class="item" data-link="./referral.html">
              <div class="label"><span>Êé®Âª£ÂàÜÊΩ§</span></div>
            </div>
            <hr>
            <div class="item" id="linkAdmin" style="display:none">
              <div class="label"><span>Admin ‰∏ªÊéßÂè∞</span></div>
              <span class="badge">ÁÆ°ÁêÜÂì°</span>
            </div>
            <div class="item" id="btnSignout">
              <div class="label"><span>ÁôªÂá∫</span></div>
            </div>
          </div>
        </div>
      </div>
    </header>

    <section class="hero">
      <div class="hero-title">ÁúãÂΩ±Áâá„ÄÅÂÅöÊ∏¨È©ó„ÄÅËÉåÂñÆÂ≠ó ‚Äî‚Äî ‰∏ÄÈ†ÅÂÆåÊàê</div>
      <div class="hero-sub">
        BookWide Áî® ÊïÖ‰∫ã„ÉªÈü≥Ê®Ç„ÉªÈõªÂΩ±„ÉªÊñ∞ËÅû„ÉªÂ∞àÊ•≠‰∏ªÈ°å Â∏∂‰Ω†Â≠∏Ëã±Êñá„ÄÇÈÄêÂè•Êí≠Êîæ„ÄÅÈõôË™ûÂ≠óÂπï„ÄÅÂñÆÂ≠óÂç°ËàáÂàÜÂçÄÊ∏¨È©óÔºåÂÆåÊï¥Á∑¥Âà∞ËÅΩËÆÄÂØ´„ÄÇ
      </div>
      <div class="hero-actions">
        <button class="btn-big btn-primary-big" id="btnTryMid">
          Ë©¶ÁúãÔºöÊïÖ‰∫ã„ÄäMid-Autumn„Äã
        </button>
        <button class="btn-big btn-outline-big" id="btnBrowseAll">
          ÁÄèË¶ΩÊïôÊùê
        </button>
      </div>
      <div class="pill-row">
        <div class="pill">
          <span class="icon">üß†</span>
          <span>ÈÄêÂè•Êí≠ÊîæÔºå‰∏ÄÈçµÂõûÊîæ / ‰∏ã‰∏ÄÂè•ÔºåË∑üËëóÊñáÊú¨Ëµ∞Ôºå‰∏çËø∑Ë∑Ø„ÄÇ</span>
        </div>
        <div class="pill">
          <span class="icon">Â≠óÂπï</span>
          <span>ÈõôË™ûÂ≠óÂπïÔºöËã±ÊñáÂú®‰∏ä„ÄÅ‰∏≠ÊñáÂú®‰∏ãÔºåÊâãÊ©ü‰πüËÉΩÈï∑Âè•‰∏çÊñ∑Ë°å„ÄÇ</span>
        </div>
        <div class="pill">
          <span class="icon">üìù</span>
          <span>ÂàÜÂçÄÊ∏¨È©óÔºöVocabulary / Grammar / Reading / Mixed ÂõõÂàÜÂçÄË©ïÈáè„ÄÇ</span>
        </div>
        <div class="pill">
          <span class="icon">üìö</span>
          <span>ÂñÆÂ≠óÂç°ÔºöÈÅÆÂ≠óÂ°´Á©∫„ÄÅÊúóËÆÄ„ÄÅÂø´ÈÄüË∑≥ÊÆµÔºåÁúüÊ≠£Áî®Âà∞ÁöÑÂ≠óÊâçË®òÂæó‰Ωè„ÄÇ</span>
        </div>
      </div>
    </section>

    <div class="tabs" id="tabBar">
      <div class="tab on" data-cat="all">ÂÖ®ÈÉ®</div>
      <div class="tab" data-cat="story">ÊïÖ‰∫ã</div>
      <div class="tab" data-cat="music">Èü≥Ê®Ç</div>
      <div class="tab" data-cat="movie">ÈõªÂΩ±</div>
      <div class="tab" data-cat="news">Êñ∞ËÅû</div>
      <div class="tab" data-cat="pro">Â∞àÊ•≠Ë°åÊ•≠</div>
    </div>
    <div class="level-bar" id="levelBar">
      <button class="lv on" data-level="all">ÂÖ®ÈÉ®Á®ãÂ∫¶</button>
      <button class="lv" data-level="1">ÂàùÁ¥ö</button>
      <button class="lv" data-level="2">‰∏≠Á¥ö</button>
      <button class="lv" data-level="3">ÈÄ≤Èöé</button>
    </div>
    <div class="searchbar">
      <input id="kw" type="search" placeholder="ÊêúÂ∞ãÊ®ôÈ°å„ÄÅÈóúÈçµÂ≠ó‚Ä¶">
      <button id="btnSearch">ÊêúÂ∞ã</button>
    </div>

    <div class="grid" id="catalog"></div>

    <footer>
      ¬© 2025 BookWideÔºéÂª∫Ë≠∞‰ΩøÁî®ÊúÄÊñ∞ Chrome / Edge / Safari<br>
      Ëã•ÊúâÂïèÈ°åÊ≠°Ëøé‰æÜ‰ø°Ôºö<a href="mailto:service@bookwide.com">service@bookwide.com</a>
    </footer>
  </div>

  <div class="toast" id="toast"></div>

  <script>
    const $ = sel => document.querySelector(sel);

    const grid    = $('#catalog');
    const tabsEl  = $('#tabBar');
    const kwInput = $('#kw');
    const btnSearch = $('#btnSearch');
    const levelBar  = $('#levelBar');

    const BASE = '/EduEnglish';
    const PATHS = {
      story: `${BASE}/data/story/story-index.json`,
      music: `${BASE}/data/music/music-index.json`,
      movie: `${BASE}/data/movie/movie-index.json`,
      news:  `${BASE}/data/news/news-index.json`,
      pro:   `${BASE}/data/pro/pro-index.json`
    };

    const tagName = cat => ({
      story:'ÊïÖ‰∫ã', music:'Èü≥Ê®Ç', movie:'ÈõªÂΩ±', news:'Êñ∞ËÅû', pro:'Â∞àÊ•≠'
    }[cat] || 'ÊïôÊùê');

    function cardHTML(it){
      const href = `${BASE}/player.html?cat=${encodeURIComponent(it.cat)}&slug=${encodeURIComponent(it.slug)}`;
      return `<a class="card" href="${href}">
        <div class="thumb">
          ${it.cover ? `<img src="${it.cover}" alt="">` : ''}
          <div class="cat-tag">${tagName(it.cat)}</div>
        </div>
        <div class="pad">
          <div class="title">${it.title || it.slug}</div>
          <div class="meta"><span>ÊôÇÈï∑ ${it.mins||'‚Äì'} ÂàÜ</span><span>Á®ãÂ∫¶ ${it.level||'‚Äì'}</span></div>
        </div>
      </a>`;
    }

    function render(list){ grid.innerHTML = list.map(cardHTML).join(''); }

    let ACTIVE_LEVEL = "all";
    let CATALOG = [];

    // Á¢∫‰øùÈ†êË®≠ tab = ÂÖ®ÈÉ®ÔºàÁ¨¨‰∏ÄÊ¨°ÈÄ≤È†ÅÊôÇÂèØËÉΩÂ∞öÊú™Êúâ .onÔºâ
    function ensureDefaultTab(){
      const on = tabsEl?.querySelector('.tab.on');
      if (!on) tabsEl?.querySelector('[data-cat="all"]')?.classList.add('on');
    }

    function filterAndRender(){
      ensureDefaultTab();
      const active = tabsEl?.querySelector('.tab.on')?.dataset.cat || 'all';
      const q = (kwInput?.value || '').trim().toLowerCase();

      let pool = (active === 'all') ? CATALOG : CATALOG.filter(x => x.cat === active);
      if (q) {
        pool = pool.filter(x =>
          (x.title + ' ' + (x.topic||'') + ' ' + (x.slug||'') + ' ' + (x.tags||[]).join(' '))
            .toLowerCase()
            .includes(q)
        );
      }

      if (ACTIVE_LEVEL !== 'all') {
        pool = pool.filter(x => {
          const key = String(x.levelKey || 0);
          return key === ACTIVE_LEVEL;
        });
      }

      render(pool);
    }

    tabsEl?.addEventListener('click', (e)=>{
      const tab = e.target.closest('.tab'); if(!tab) return;
      tabsEl.querySelectorAll('.tab').forEach(t => t.classList.remove('on'));
      tab.classList.add('on');
      filterAndRender();
    });

    levelBar?.addEventListener('click', (e)=>{
      const btn = e.target.closest('.lv[data-level]');
      if (!btn) return;
      levelBar.querySelectorAll('.lv.on').forEach(b => b.classList.remove('on'));
      btn.classList.add('on');
      ACTIVE_LEVEL = btn.dataset.level || 'all';
      filterAndRender();
    });

    btnSearch?.addEventListener('click', filterAndRender);
    kwInput?.addEventListener('keydown', e => { if (e.key === 'Enter') filterAndRender(); });

    function showToast(msg){
      const el = $('#toast');
      el.textContent = msg;
      el.style.display='block';
      clearTimeout(showToast._t);
      showToast._t = setTimeout(()=>{ el.style.display='none'; }, 2200);
    }

    function getQuery(){
      const s = location.search.slice(1).split('&').filter(Boolean);
      const obj = {};
      for(const kv of s){
        const [k,v] = kv.split('=');
        obj[decodeURIComponent(k)] = decodeURIComponent(v||'');
      }
      return obj;
    }

    async function publicUrlFromPath(path){
      if (!path) return null;
      const base = 'https://supabase.bookwide.app/storage/v1/object/public';
      return `${base}/${path.replace(/^\\/+/, '')}`;
    }

    async function loadFromSupabase(){
      try{
        if(!window.supa) return [];
        const { data, error } = await window.supa
          .from('videos')
          .select('category, slug, title, cover_path, duration_sec, is_public, difficulty_level')
          .eq('is_public', true);
        if(error || !Array.isArray(data)) return [];
        const list = [];
        for(const r of data){
          const cover = await publicUrlFromPath(r.cover_path);

          const lvNum = Number(r.difficulty_level || 0);
          const lvLabel =
            lvNum === 1 ? 'ÂàùÁ¥ö' :
            lvNum === 3 ? 'ÈÄ≤Èöé' :
            lvNum === 2 ? '‰∏≠Á¥ö' : 'Ôºç';

          list.push({
            cat: r.category,
            slug: r.slug,
            title: r.title || r.slug,
            cover: cover || null,
            mins: (r.duration_sec ? Math.max(1, Math.round(r.duration_sec/60)) : '‚Äì'),
            level: lvLabel,
            levelKey: lvNum || 0
          });
        }
        return list;
      }catch{ return []; }
    }

    async function loadIndex(url, cat){
      try{
        const res = await fetch(url);
        if (!res.ok) return [];
        const raw = await res.json();
        const arr = Array.isArray(raw) ? raw : (Array.isArray(raw.items) ? raw.items : []);
        if (!Array.isArray(arr)) return [];
        return arr.map(x => ({ ...x, cat }));
      }catch{
        return [];
      }
    }

    (async () => {
      let supaList = await loadFromSupabase();

      if (supaList && supaList.length) {
        CATALOG = supaList;
      } else {
        const lists = await Promise.all(Object.entries(PATHS).map(([cat, url]) => loadIndex(url, cat)));
        CATALOG = lists.flat();
      }

      filterAndRender();
    })();

    document.addEventListener('click', (e)=>{
      const wrap = $('#userMenuWrap');
      const menu = $('#userMenu');
      const btn  = $('#userMenuBtn');
      if (!wrap || wrap.style.display==='none') return;
      if(btn.contains(e.target)) return;
      if(!menu.contains(e.target)){
        menu.classList.remove('open');
        btn.setAttribute('aria-expanded','false');
      }
    });

    const BUTTON_GUIDE = $('#btnGuide');
    const BUTTON_SIGNIN = $('#btnSignin');
    const USER_MENU_WRAP = $('#userMenuWrap');
    const USER_MENU_BTN  = $('#userMenuBtn');
    const USER_MENU      = $('#userMenu');
    const USER_EMAIL_EL  = $('#userEmail');
    const LINK_ADMIN     = $('#linkAdmin');
    const BTN_SIGNOUT    = $('#btnSignout');

    BUTTON_GUIDE?.addEventListener('click', ()=>{ location.href = './pricing.html'; });
    BUTTON_SIGNIN?.addEventListener('click', ()=>{ location.href = './signin.html'; });

    USER_MENU_BTN?.addEventListener('click', ()=>{
      const open = USER_MENU.classList.toggle('open');
      USER_MENU_BTN.setAttribute('aria-expanded', open ? 'true' : 'false');
    });

    USER_MENU?.addEventListener('click', (e)=>{
      const item = e.target.closest('.item[data-link]');
      if(!item) return;
      const href = item.dataset.link;
      if(href) location.href = href;
    });

    BTN_SIGNOUT?.addEventListener('click', async ()=>{
      try{
        if(window.supa){
          await window.supa.auth.signOut();
        }
      }catch{}
      location.href = './signin.html';
    });

    function applyUserUI(profile){
      if(profile && profile.email){
        BUTTON_SIGNIN.style.display = 'none';
        USER_MENU_WRAP.style.display = 'block';
        USER_EMAIL_EL.textContent = profile.email;
        if(profile.is_admin){
          LINK_ADMIN.style.display = 'flex';
          LINK_ADMIN.querySelector('.label span').textContent = 'Admin ‰∏ªÊéßÂè∞';
          LINK_ADMIN.onclick = ()=>{ location.href = './admin.html'; };
        }else{
          LINK_ADMIN.style.display = 'none';
        }
      }else{
        BUTTON_SIGNIN.style.display = 'inline-flex';
        USER_MENU_WRAP.style.display = 'none';
      }
    }

    (async ()=>{
      try{
        if(!window.supa) return;
        const { data: { session } } = await window.supa.auth.getSession();
        if(!session){ applyUserUI(null); return; }
        const email = session.user.email;
        const { data: profile, error } = await window.supa
          .from('public_profiles')
          .select('email, is_admin')
          .eq('email', email)
          .maybeSingle();
        if(error){ applyUserUI({ email }); return; }
        applyUserUI(profile || { email });
      }catch{
        applyUserUI(null);
      }
    })();

    document.getElementById('btnTryMid')?.addEventListener('click', ()=>{
      location.href = `${BASE}/player.html?cat=story&slug=mid-autumn`;
    });
    document.getElementById('btnBrowseAll')?.addEventListener('click', ()=>{
      const el = document.getElementById('catalog');
      if(!el) return;
      const r = el.getBoundingClientRect();
      window.scrollTo({ top: window.scrollY + r.top - 80, behavior:'smooth' });
    });

    const q = getQuery();
    if(q.denied === 'signin'){
      showToast('Ë´ãÂÖàÁôªÂÖ•ÔºåÂÜçÈÄ≤ÂÖ•ÊïôÊùê„ÄÇ');
    }else if(q.denied === 'expired'){
      showToast('ÊÇ®ÁöÑÊñπÊ°àÂ∑≤Âà∞ÊúüÔºåË´ãÁ∫åÁ¥ÑÂæåÂÜçËßÄÁúãÊïôÊùê„ÄÇ');
    }
  </script>

  <script src="https://unpkg.com/@supabase/supabase-js@2.48.0/dist/umd/supabase.js"></script>
  <script>
    const supaUrl = 'https://bookwide.supabase.co';
    const supaAnon = 'public-anon-key-placeholder';
    window.supa = window.supabase.createClient(supaUrl, supaAnon, {
      auth:{
        persistSession:true,
        detectSessionInUrl:true
      }
    });
  </script>
</body>
</html>






































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































