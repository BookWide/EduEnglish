<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>交易說明｜BookWide</title>

<style>
body{font-family:system-ui,-apple-system,"Noto Sans TC",sans-serif;background:#f6f7fb;margin:0}
.wrap{max-width:900px;margin:40px auto;padding:0 16px}
.card{background:#fff;border-radius:16px;padding:24px;box-shadow:0 10px 30px rgba(0,0,0,.06)}
h1{margin:0 0 16px}
button{background:#2563eb;color:#fff;border:none;border-radius:10px;padding:12px 18px;font-size:16px;cursor:pointer}
button:disabled{opacity:.6}
.modal{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center}
.modal.on{display:flex}
.panel{background:#fff;border-radius:16px;width:min(760px,100%);padding:20px}
.row{margin-bottom:12px}
label{display:block;font-weight:700;margin-bottom:4px}
input,select,textarea{width:100%;padding:10px;border-radius:10px;border:1px solid #d1d5db}
.actions{display:flex;gap:10px;justify-content:flex-end}
.hint{margin-top:10px;font-weight:700}
.ok{color:#16a34a}
.bad{color:#dc2626}
</style>
</head>

<body>
<div class="wrap">
  <div class="card">
    <h1>交易說明</h1>
    <p>如需申請退費，請點擊下方按鈕。</p>
    <button id="open">提出退費申請</button>
  </div>
</div>

<!-- Modal -->
<div class="modal" id="modal">
  <div class="panel">
    <h2>退費申請表</h2>

    <form id="form">
      <div class="row">
        <label>Email *</label>
        <input name="email" required>
      </div>

      <div class="row">
        <label>訂單號（若有）</label>
        <input name="order_no">
      </div>

      <div class="row">
        <label>付款方式 *</label>
        <select name="pay_method" required>
          <option value="">請選擇</option>
          <option>信用卡</option>
          <option>ATM</option>
          <option>第三方金流</option>
        </select>
      </div>

      <div class="row">
        <label>付款日期（大概即可）</label>
        <input type="date" name="pay_date">
      </div>

      <div class="row">
        <label>退費原因 *</label>
        <textarea name="reason" required></textarea>
      </div>

      <div class="row">
        <label>聯絡方式</label>
        <input name="contact">
      </div>

      <div class="row">
        <label>補充說明</label>
        <textarea name="extra"></textarea>
      </div>

      <div class="actions">
        <button type="button" id="close">取消</button>
        <button type="submit" id="submit">送出</button>
      </div>

      <div id="hint" class="hint"></div>
    </form>
  </div>
</div>

<script>
/* === Supabase 設定 === */
const SUPABASE_URL = "https://jeajrwpmrgczimmrflxo.supabase.co";
const SUPABASE_ANON_KEY =
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImplYWpyd3BtcmdjemltbXJmbHhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3MTg5MzksImV4cCI6MjA3NjI5NDkzOX0.3iFXdHH0JEuk177_R4TGFJmOxYK9V8XctON6rDe7-Do";

const modal = document.getElementById("modal");
const form = document.getElementById("form");
const hint = document.getElementById("hint");

document.getElementById("open").onclick = ()=> modal.classList.add("on");
document.getElementById("close").onclick = ()=> modal.classList.remove("on");

/* === 送出 === */
form.addEventListener("submit", async (e)=>{
  e.preventDefault();
  hint.textContent = "送出中…";
  hint.className = "hint";

  const fd = new FormData(form);

  const payload = {
    email: String(fd.get("email")||"").trim(),
    order_no: String(fd.get("order_no")||"").trim() || null,
    pay_method: String(fd.get("pay_method")||"").trim(),
    pay_date: fd.get("pay_date") || null,
    reason: String(fd.get("reason")||"").trim(),
    contact: String(fd.get("contact")||"").trim() || null,
    extra: String(fd.get("extra")||"").trim() || null,

    page_url: location.href,
    user_agent: navigator.userAgent,
    client_time: new Date().toISOString(),
    status: "new"
  };

  try{
    const res = await fetch(`${SUPABASE_URL}/rest/v1/refund_requests`,{
      method:"POST",
      headers:{
        apikey: SUPABASE_ANON_KEY,
        Authorization:`Bearer ${SUPABASE_ANON_KEY}`,
        "Content-Type":"application/json",
        Prefer:"return=minimal"
      },
      body:JSON.stringify(payload)
    });

    if(!res.ok) throw new Error(await res.text());

    hint.textContent = "✅ 已送出，客服將與你聯絡";
    hint.className = "hint ok";
    form.reset();
    setTimeout(()=>modal.classList.remove("on"),800);

  }catch(err){
    console.error(err);
    hint.textContent = "❌ 送出失敗，請稍後再試";
    hint.className = "hint bad";
  }
});
</script>
</body>
</html>

















