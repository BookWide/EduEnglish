<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>交易說明｜BookWide</title>
<meta name="description" content="BookWide 交易說明：訂閱方案、付款方式、續訂扣款、取消退費、客服聯絡與退款申請入口。" />

<style>
  :root{
    --bg:#f6f7fb; --card:#ffffff; --ink:#111827; --muted:#6b7280; --line:#e5e7eb; --soft:#f8fafc;
    --brand:#2563eb; --shadow:0 12px 30px rgba(15,23,42,.08); --radius:16px;
    --ok:#16a34a; --bad:#b91c1c;
  }
  *{box-sizing:border-box}
  body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Noto Sans TC",Helvetica,Arial;background:var(--bg);color:var(--ink)}
  a{color:var(--brand);text-decoration:none} a:hover{text-decoration:underline}
  .wrap{max-width:980px;margin:0 auto;padding:28px 18px 90px}
  header{margin:10px 0 14px}
  h1{margin:0 0 8px;font-size:28px;font-weight:900;letter-spacing:.2px}
  .lead{margin:0;color:var(--muted);line-height:1.8}

  .topbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:16px 0 18px}
  .badge{display:inline-flex;gap:8px;align-items:center;padding:8px 12px;border:1px solid var(--line);background:#fff;border-radius:999px;color:var(--muted);font-size:13px}
  .badge b{color:var(--ink)}
  .toc{display:flex;flex-wrap:wrap;gap:10px;margin:12px 0 18px}
  .toc a{font-size:14px;background:#fff;border:1px solid var(--line);border-radius:999px;padding:8px 12px}

  .grid{display:grid;grid-template-columns: 1.2fr .8fr;gap:14px}
  @media(max-width:900px){.grid{grid-template-columns:1fr}}
  .card{background:var(--card);border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow);padding:16px}
  .card h2{margin:0 0 10px;font-size:16px;font-weight:900}
  .sub{margin:0 0 12px;color:var(--muted);line-height:1.8}
  ul{margin:0;padding-left:18px;line-height:1.9}
  li{margin:6px 0}

  .notice{border:1px dashed #c7d2fe;background:#f8fbff;border-radius:14px;padding:14px;line-height:1.85}
  .notice b{display:block;margin-bottom:6px}
  .kv{display:grid;grid-template-columns:140px 1fr;gap:10px;margin-top:10px}
  @media(max-width:560px){.kv{grid-template-columns:1fr}}
  .k{color:var(--muted);font-size:13px}
  .v{font-weight:800}

  .ctaRow{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
  .cta{height:42px;padding:0 16px;border-radius:12px;border:1px solid var(--brand);background:var(--brand);color:#fff;font-weight:900;cursor:pointer;box-shadow:0 10px 20px rgba(37,99,235,.18)}
  .cta:hover{filter:brightness(.96)}
  .ghost{background:#fff;color:var(--brand);border-color:var(--line);box-shadow:none}
  .ghost:hover{background:#f9fafb}
  .fine{font-size:12px;color:var(--muted);line-height:1.7;margin-top:10px}

  /* FAQ */
  details{border-top:1px solid var(--line);padding:10px 0}
  summary{cursor:pointer;font-weight:900}
  details p{margin:8px 0 0;color:var(--muted);line-height:1.8}

  /* Modal */
  .modal{position:fixed;inset:0;display:none;z-index:9999}
  .modal.on{display:block}
  .backdrop{position:absolute;inset:0;background:rgba(15,23,42,.45)}
  .panel{position:relative;width:min(820px,calc(100% - 28px));margin:6vh auto;background:#fff;border-radius:18px;border:1px solid var(--line);box-shadow:0 30px 80px rgba(15,23,42,.25);overflow:hidden}
  .head{padding:16px 16px 14px;border-bottom:1px solid var(--line);background:#fbfbfb;display:flex;justify-content:space-between;align-items:flex-start;gap:12px}
  .head h3{margin:0;font-size:18px;font-weight:900}
  .head .muted{margin-top:6px;font-size:13px;color:var(--muted);line-height:1.6}
  .close{width:36px;height:36px;border-radius:12px;border:1px solid var(--line);background:#fff;font-size:20px;cursor:pointer;flex:0 0 auto}
  form{padding:16px}
  .row{margin-bottom:12px}
  label{display:block;font-size:13px;font-weight:900;margin-bottom:6px}
  input,select,textarea{width:100%;padding:10px 12px;border-radius:12px;border:1px solid var(--line);font-size:14px;outline:none}
  input:focus,select:focus,textarea:focus{border-color:#c7d2fe;box-shadow:0 0 0 4px rgba(99,102,241,.12)}
  textarea{resize:vertical}
  .grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
  @media(max-width:720px){.grid2{grid-template-columns:1fr}}
  .actions{display:flex;justify-content:flex-end;gap:10px;flex-wrap:wrap;margin-top:6px}
  .hint{margin-top:10px;font-size:13px;line-height:1.7;white-space:pre-wrap;word-break:break-word}
  .hint.ok{color:var(--ok);font-weight:900}
  .hint.bad{color:var(--bad);font-weight:900}
</style>
</head>

<body>
<div class="wrap">
  <header>
    <h1>交易說明</h1>
    <p class="lead">本頁提供 BookWide 的訂閱方案、付款方式、續訂扣款、取消與退費、客服聯絡與退費申請入口。為保障雙方權益，請先閱讀後再提交申請。</p>

    <div class="topbar">
      <span class="badge">服務：<b>BookWide 線上訂閱</b></span>
      <span class="badge">適用：<b>網站 / 行動裝置瀏覽器</b></span>
      <span class="badge">更新：<b id="lastUpdated"></b></span>
    </div>

    <div class="toc">
      <a href="#plans">訂閱方案</a>
      <a href="#payment">付款方式</a>
      <a href="#renew">續訂與扣款</a>
      <a href="#cancel">取消與退費</a>
      <a href="#apply">退費申請入口</a>
      <a href="#support">客服聯絡</a>
      <a href="#faq">常見問題</a>
    </div>
  </header>

  <div class="grid">
    <div class="card" id="plans">
      <h2>1) 訂閱方案</h2>
      <p class="sub">BookWide 採「訂閱制」提供學習內容與功能。實際方案、價格、可用內容以 <a href="/pricing.html">方案頁</a> 與結帳頁顯示為準。</p>
      <ul>
        <li>訂閱期間可使用已開放的學習內容、播放器、測驗與個人化功能。</li>
        <li>部分功能可能依方案、地區、裝置或瀏覽器相容性而異。</li>
        <li>我們可能不定期更新內容與功能（含新增/調整/下架），以維持品質與合規。</li>
      </ul>

      <div class="notice" style="margin-top:12px">
        <b>重要提醒</b>
        BookWide 為數位服務/數位內容。若你提交退費申請，我們會依購買方案、付款方式、使用情況與合理性進行審核，並以 Email 通知結果。
      </div>
    </div>

    <div class="card" id="payment">
      <h2>2) 付款方式</h2>
      <p class="sub">實際可用付款方式以結帳頁顯示為準（可能因地區與金流策略不同而異）。</p>
      <ul>
        <li>信用卡／簽帳卡</li>
        <li>ATM / 轉帳（若結帳頁提供）</li>
        <li>第三方金流（依地區提供）</li>
      </ul>

      <div class="kv">
        <div class="k">付款安全</div><div class="v">採用金流服務商處理支付資訊</div>
        <div class="k">收據/憑證</div><div class="v">依結帳流程或 Email 通知為準</div>
        <div class="k">幣別</div><div class="v">依結帳頁顯示幣別為準</div>
      </div>
    </div>

    <div class="card" id="renew">
      <h2>3) 續訂與扣款</h2>
      <p class="sub">為避免學習中斷，部分方案採自動續訂。你可在個人訂閱頁或帳務頁（若提供）管理。</p>
      <ul>
        <li>自動續訂：於到期日或到期前後進行扣款（依金流規則）。</li>
        <li>扣款失敗：訂閱可能暫停或降級，重新付款即可恢復（依系統顯示）。</li>
        <li>更換付款方式：請依結帳/訂閱管理頁指引操作（若提供）。</li>
      </ul>

      <div class="fine">※ 若你發現未預期的扣款或重複訂閱，請先提交退費申請並提供訂單號與付款方式，以便快速查核。</div>
    </div>

    <div class="card" id="cancel">
      <h2>4) 取消與退費</h2>
      <p class="sub">我們提供清楚的申請流程與審核原則，讓你可以商業運營且可規模化處理客服。</p>

      <ul>
        <li><b>取消：</b>你可停止續訂（若方案支援自動續訂）。取消後通常仍可使用至到期日。</li>
        <li><b>退費：</b>退費審核會綜合考量「購買方案/付款方式/使用情況/申請原因」。</li>
        <li><b>處理時間：</b>通常 3–7 個工作天回覆（尖峰可能延長）。</li>
        <li><b>退款入帳：</b>由金流/銀行處理，實際入帳時間依付款方式而異。</li>
      </ul>

      <div class="notice" style="margin-top:12px">
        <b>建議你提供的資訊（越完整越快）</b>
        Email、訂單號、付款方式、付款日期（大概即可）、退費原因、可重現問題的描述（或截圖連結）。
      </div>
    </div>

    <div class="card" id="apply">
      <h2>5) 退費申請入口</h2>
      <p class="sub">按下按鈕填表送出。送出後會建立申請紀錄到 <code>public.refund_requests</code>，方便後台管理與稽核。</p>

      <div class="notice">
        <b>退費申請表</b>
        送出後會建立一筆「新申請」；客服將以 Email 聯絡你。<br/>
        <div class="ctaRow">
          <button class="cta" id="openRefund" type="button">提出退費申請</button>
          <button class="cta ghost" id="quickGuide" type="button">我要準備哪些資料？</button>
        </div>
        <div class="fine">※ 若你是測試/內部資料，建議在原因欄加註「TEST」。</div>
      </div>
    </div>

    <div class="card" id="support">
      <h2>6) 客服聯絡</h2>
      <p class="sub">若送出申請後未收到回覆，請用同一 Email 聯絡客服並附上訂單號。</p>
      <ul>
        <li>客服 Email：<b>support@bookwide.net</b>（你可替換成實際客服信箱）</li>
        <li>建議主旨：<b>BookWide 退費申請／訂單查詢</b></li>
        <li>服務時間：工作日 10:00–18:00（可自行調整）</li>
      </ul>

      <div class="fine">※ 為保障隱私，請勿在公開留言區張貼付款卡號或敏感個資。</div>
    </div>

    <div class="card" id="faq">
      <h2>7) 常見問題</h2>

      <details>
        <summary>Q1：我送出申請後會發生什麼事？</summary>
        <p>系統會建立申請紀錄（status=new），客服會依你提供資訊查核訂單與使用狀況，再以 Email 通知結果與後續處理。</p>
      </details>

      <details>
        <summary>Q2：我沒有訂單號也可以申請嗎？</summary>
        <p>可以，但建議至少提供付款方式與付款日期（大概即可），以便更快查核。</p>
      </details>

      <details>
        <summary>Q3：為什麼要填聯絡方式？</summary>
        <p>若 Email 無法聯繫或需要補件，客服可用手機/LINE 更快確認。</p>
      </details>

      <details>
        <summary>Q4：我可以查詢退費進度嗎？</summary>
        <p>目前以客服 Email 回覆為準。若你要做「使用者自助查詢頁」，我可以下一步幫你加上（讀 status / handled_at）。</p>
      </details>

      <details>
        <summary>Q5：你們怎麼處理我的資料？</summary>
        <p>申請資料僅用於客服處理與稽核。建議你在隱私政策頁（/privacy.html）補齊資料用途與保存期間。</p>
      </details>
    </div>
  </div>
</div>

<!-- Modal -->
<div class="modal" id="refundModal" aria-hidden="true">
  <div class="backdrop" id="backdropRefund"></div>
  <div class="panel" role="dialog" aria-modal="true" aria-labelledby="refundTitle">
    <div class="head">
      <div>
        <h3 id="refundTitle">退費申請表</h3>
        <div class="muted">送出後會建立申請紀錄（寫入 Supabase：<code>public.refund_requests</code>）。</div>
      </div>
      <button class="close" id="closeRefund" aria-label="關閉">×</button>
    </div>

    <form id="refundForm" autocomplete="on">
      <div class="row">
        <label>Email *</label>
        <input required type="email" name="email" placeholder="例如：yourname@gmail.com">
      </div>

      <div class="row">
        <label>訂單號（若有）</label>
        <input name="order_no" placeholder="例如：BW-2025xxxx">
      </div>

      <div class="row grid2">
        <div>
          <label>付款方式 *</label>
          <select required name="pay_method">
            <option value="">請選擇</option>
            <option>信用卡</option>
            <option>ATM</option>
            <option>第三方金流</option>
          </select>
        </div>
        <div>
          <label>付款日期（大概即可）</label>
          <input type="date" name="pay_date">
        </div>
      </div>

      <div class="row">
        <label>退費原因 *</label>
        <textarea required name="reason" rows="4" placeholder="例如：重複訂閱／無法使用／內容不符合期待..."></textarea>
      </div>

      <div class="row">
        <label>聯絡方式（手機或 LINE ID）</label>
        <input name="contact" placeholder="例如：09xx-xxx-xxx / LINE：xxxx">
      </div>

      <div class="row">
        <label>補充說明（可貼錯誤訊息/截圖連結）</label>
        <textarea name="extra" rows="3" placeholder="可貼上你看到的錯誤文字或圖片連結"></textarea>
      </div>

      <div class="actions">
        <button type="button" class="cta ghost" id="cancelRefund">取消</button>
        <button type="submit" class="cta" id="submitRefund">送出申請</button>
      </div>

      <div class="hint" id="refundHint"></div>
    </form>
  </div>
</div>

<script>
  // === 版本/更新日期（顯示用）===
  (function(){
    const el = document.getElementById('lastUpdated');
    if(el){
      const d = new Date();
      const y = d.getFullYear();
      const m = String(d.getMonth()+1).padStart(2,'0');
      const day = String(d.getDate()).padStart(2,'0');
      el.textContent = `${y}-${m}-${day}`;
    }
  })();

  // ===== Supabase (REST) =====
  const SUPABASE_URL = "https://jeajrwpmrgczimmrflxo.supabase.co";
  const SUPABASE_ANON_KEY =
"eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImplYWpyd3BtcmdjemltbXJmbHhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3MTg5MzksImV4cCI6MjA3NjI5NDkzOX0.3iFXdHH0JEuk177_R4TGFJmOxYK9V8XctON6rDe7-Do";
  const TABLE = "refund_requests";

  const modal = document.getElementById('refundModal');
  const btnOpen = document.getElementById('openRefund');
  const btnClose = document.getElementById('closeRefund');
  const btnCancel = document.getElementById('cancelRefund');
  const backdrop = document.getElementById('backdropRefund');

  const form = document.getElementById('refundForm');
  const hint = document.getElementById('refundHint');
  const btnSubmit = document.getElementById('submitRefund');

  function openModal(){
    modal.classList.add('on');
    modal.setAttribute('aria-hidden','false');
    hint.textContent = '';
    hint.className = 'hint';
    setTimeout(()=> {
      const first = form.querySelector('input[name="email"]');
      if(first) first.focus();
    }, 80);
  }
  function closeModal(){
    modal.classList.remove('on');
    modal.setAttribute('aria-hidden','true');
  }

  btnOpen?.addEventListener('click', openModal);
  btnClose?.addEventListener('click', closeModal);
  btnCancel?.addEventListener('click', closeModal);
  backdrop?.addEventListener('click', closeModal);
  document.addEventListener('keydown', (e)=> {
    if(e.key === 'Escape' && modal.classList.contains('on')) closeModal();
  });

  // 小提示：準備資料
  document.getElementById('quickGuide')?.addEventListener('click', ()=>{
    alert("建議準備：\n1) Email\n2) 訂單號（若有）\n3) 付款方式/日期（大概即可）\n4) 退費原因（越具體越快）\n5) 若有錯誤：請附截圖連結");
  });

  function showHint(msg, ok=false){
    hint.textContent = msg;
    hint.className = ok ? 'hint ok' : 'hint bad';
    try{ hint.scrollIntoView({block:'nearest'}); }catch(_e){}
  }

  function fetchWithTimeout(url, options, ms=12000){
    return new Promise((resolve, reject)=>{
      const t = setTimeout(()=>reject(new Error("Request timeout (12s)")), ms);
      fetch(url, options).then((r)=>{clearTimeout(t); resolve(r);}).catch((e)=>{clearTimeout(t); reject(e);});
    });
  }

  async function supabaseInsert(payload){
    const url = `${SUPABASE_URL}/rest/v1/${TABLE}`;
    const res = await fetchWithTimeout(url, {
      method: "POST",
      headers: {
        apikey: SUPABASE_ANON_KEY,
        Authorization: `Bearer ${SUPABASE_ANON_KEY}`,
        "Content-Type": "application/json",
        Prefer: "return=minimal"
      },
      body: JSON.stringify(payload)
    });
    const txt = await res.text();
    if(!res.ok) throw new Error(`HTTP ${res.status}\n${txt}`);
    return true;
  }

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();

    btnSubmit.disabled = true;
    hint.textContent = "送出中…";
    hint.className = "hint";

    try{
      const fd = new FormData(form);

      // ✅ 欄位完全對齊你的 public.refund_requests
      const payload = {
        email: String(fd.get("email") || "").trim(),
        order_no: String(fd.get("order_no") || "").trim() || null,
        pay_method: String(fd.get("pay_method") || "").trim(),
        pay_date: fd.get("pay_date") || null,
        reason: String(fd.get("reason") || "").trim(),
        contact: String(fd.get("contact") || "").trim() || null,
        extra: String(fd.get("extra") || "").trim() || null,

        page_url: location.href,
        user_agent: navigator.userAgent,
        client_time: new Date().toISOString(),
        status: "new"
      };

      await supabaseInsert(payload);

      showHint("✅ 已送出申請（已建立紀錄）。客服將以 Email 聯絡你。", true);
      form.reset();
      setTimeout(closeModal, 700);

    }catch(err){
      showHint("❌ 送出失敗：\n" + (err?.message || String(err)));
      alert("送出失敗：請打開 DevTools → Network 看錯誤回應，貼給我我一次修到好。");
    }finally{
      btnSubmit.disabled = false;
    }
  });
</script>

<!-- BookWide 共用 Footer（你若已統一頁尾就留著） -->
<script src="/shared/footer.js"></script>
</body>
</html>
















