<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1"/>
  <title>我的訂閱｜BookWide</title>
  <style>
    body{margin:0;font-family:system-ui,-apple-system,"Noto Sans TC",sans-serif;background:#f4f6fb;color:#111}
    .wrap{max-width:980px;margin:32px auto;padding:0 16px}
    h1{margin:0 0 16px}
    .card{background:#fff;border-radius:14px;padding:18px 20px;margin-bottom:16px;box-shadow:0 10px 30px rgba(0,0,0,.06)}
    table{width:100%;border-collapse:collapse}
    th,td{padding:10px 8px;border-bottom:1px solid #e5e7eb;text-align:left}
    th{color:#6b7280;font-weight:600}
    .btn{display:inline-block;background:#2563eb;color:#fff;border-radius:10px;padding:10px 14px;text-decoration:none}
    .muted{color:#6b7280}
  </style>
</head>
<body>
<div class="wrap">
  <h1>我的訂閱</h1>

  <div class="card">
    <h3>目前訂閱</h3>
    <div id="current" class="muted">載入中…</div>
  </div>

  <div class="card">
    <h3>歷史訂單</h3>
    <table>
      <thead>
        <tr><th>付款日期</th><th>方案</th><th>金額</th><th>狀態</th></tr>
      </thead>
      <tbody id="rows"></tbody>
    </table>
  </div>

  <a class="btn" href="/pricing.html">前往訂閱</a>
</div>

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
const SUPABASE_URL = "https://YOUR_PROJECT.supabase.co";
const SUPABASE_ANON = "YOUR_PUBLIC_ANON_KEY";
const supabase = supabase.createClient(SUPABASE_URL, SUPABASE_ANON);

(async () => {
  const { data: { user } } = await supabase.auth.getUser();
  if (!user) {
    document.getElementById('current').innerText = '請先登入';
    return;
  }

  const uid = user.id;

  const { data: orders } = await supabase
    .from('orders')
    .select('*')
    .or(`user_id.eq.${uid},buyer_id.eq.${uid}`)
    .order('created_at', { ascending:false });

  const paid = (orders||[]).find(o => o.status === 'paid');
  document.getElementById('current').innerText =
    paid ? `有效至：${paid.expire_at}` : '尚無訂閱紀錄';

  const rows = document.getElementById('rows');
  rows.innerHTML = (orders||[]).map(o => `
    <tr>
      <td>${o.paid_at || '-'}</td>
      <td>${o.period}</td>
      <td>${o.total || o.subtotal || '-'}</td>
      <td>${o.status}</td>
    </tr>
  `).join('');
})();
</script>
</body>
</html>




