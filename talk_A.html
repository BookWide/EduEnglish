<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Talk Aï¼ˆæ‰‹æ©Ÿå£èªªï¼‰ï½œBookWide</title>
<style>
:root{
  --bg:#f4f6fb; --card:#fff; --ink:#0f172a; --muted:#64748b; --line:#e5e7eb;
  --brand:#2563eb; --brand2:#1d4ed8; --soft:#eef2ff; --radius:18px;
  --shadow:0 14px 40px rgba(15,23,42,.08);
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--ink);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;}
a{color:inherit;text-decoration:none}
.wrap{max-width:980px;margin:0 auto;padding:14px 12px 40px;}
.topbar{display:flex;align-items:center;gap:10px;background:var(--card);border:1px solid var(--line);
  border-radius:999px;padding:10px 12px;box-shadow:var(--shadow);}
.back{width:36px;height:36px;border-radius:999px;border:1px solid var(--line);display:grid;place-items:center;background:#fff;cursor:pointer;}
.title{min-width:0}
.title h1{margin:0;font-size:16px;line-height:1.1}
.title .sub{margin-top:2px;font-size:12px;color:var(--muted)}
.spacer{flex:1}
.sel{display:flex;gap:10px;align-items:center;flex-wrap:wrap}
select{appearance:none;border:1px solid var(--line);background:#fff;border-radius:999px;padding:10px 12px;
  font-size:13px;box-shadow:0 6px 18px rgba(15,23,42,.06);}
.btn{border:1px solid var(--line);background:#fff;border-radius:999px;padding:10px 12px;font-size:13px;cursor:pointer}
.card{margin-top:12px;background:var(--card);border:1px solid var(--line);border-radius:24px;box-shadow:var(--shadow);padding:16px;}
.badge{display:inline-flex;align-items:center;gap:8px;background:#0b1220;color:#fff;border-radius:999px;padding:8px 12px;font-size:12px;}
.dot{width:10px;height:10px;border-radius:999px;background:#34d399;box-shadow:0 0 0 3px rgba(52,211,153,.15);}
.badge b{font-weight:700}
.hrow{display:flex;align-items:center;gap:10px;flex-wrap:wrap}
.hrow .sceneLabel{color:var(--muted);font-size:13px}
.avatarWrap{display:grid;place-items:center;margin:16px 0 10px;}
.orb{width:min(380px,72vw);aspect-ratio:1/1;border-radius:999px;
  background:radial-gradient(circle at 35% 30%, #fff 0%, #f0f2f7 44%, #e6e9f2 70%, #dde2ee 100%);
  display:grid;place-items:center;position:relative;}
.innerRing{width:60%;aspect-ratio:1/1;border-radius:999px;background:rgba(255,255,255,.65);
  border:10px solid rgba(255,255,255,.9);box-shadow:0 18px 60px rgba(15,23,42,.12);display:grid;place-items:center;overflow:hidden}
video#avatarVideo{width:100%;height:100%;object-fit:cover;display:block}
img#avatarFallback{width:100%;height:100%;object-fit:cover;display:none}
.bubble{margin-top:8px;background:#f8fafc;border:1px solid var(--line);border-radius:18px;padding:16px;}
.bubble .en{font-size:34px;font-weight:800;letter-spacing:.2px}
.bubble .zh{margin-top:8px;color:var(--muted);font-size:14px}
.actions{display:flex;gap:10px;margin-top:12px;align-items:center;flex-wrap:wrap}
.big{flex:1;min-width:240px;display:flex;align-items:center;justify-content:center;gap:10px;
  padding:16px 18px;border-radius:999px;border:0;background:linear-gradient(180deg,var(--brand),var(--brand2));
  color:#fff;font-size:16px;font-weight:700;cursor:pointer;box-shadow:0 18px 46px rgba(37,99,235,.28)}
.small{padding:14px 16px;border-radius:999px;border:1px solid var(--line);background:#fff;cursor:pointer;font-weight:600}
.inputLine{margin-top:10px;border-top:1px dashed var(--line);padding-top:12px;color:var(--muted);font-size:13px}
.kpi{margin-top:14px;display:grid;grid-template-columns:repeat(4,minmax(0,1fr));gap:10px}
.kpi .k{background:#fff;border:1px solid var(--line);border-radius:18px;padding:14px}
.k .t{color:var(--muted);font-size:12px}
.k .v{margin-top:6px;font-size:13px;font-weight:700}
@media (max-width:720px){ .kpi{grid-template-columns:repeat(2,minmax(0,1fr))} .bubble .en{font-size:30px} }
.toast{position:fixed;left:50%;transform:translateX(-50%);bottom:18px;z-index:9999;
  background:#0b1220;color:#fff;padding:10px 12px;border-radius:999px;font-size:13px;display:none;
  box-shadow:0 14px 40px rgba(0,0,0,.25)}
</style>
</head>
<body>
<div class="wrap">
  <div class="topbar">
    <button class="back" id="btnBack" title="è¿”å›">â†</button>
    <div class="title">
      <h1>Talk Aï¼ˆæ‰‹æ©Ÿå£èªªï¼‰</h1>
      <div class="sub">TTSï¼šBrowser SpeechSynthesis</div>
    </div>
    <div class="spacer"></div>
    <div class="sel">
      <select id="sceneSel" title="é¸æƒ…å¢ƒ"></select>
      <select id="teacherSel" title="é¸è€å¸«"></select>
      <button class="btn" id="btnReplay">é‡æ’­æœ¬å¥</button>
    </div>
  </div>

  <div class="card">
    <div class="hrow">
      <span class="badge"><span class="dot"></span><b id="badgeRole">AI</b></span>
      <span class="sceneLabel" id="sceneTitle">â€”</span>
    </div>

    <div class="avatarWrap">
      <div class="orb">
        <div class="innerRing">
          <video id="avatarVideo" playsinline muted preload="auto"></video>
          <img id="avatarFallback" alt="AI Avatar" />
        </div>
      </div>
    </div>

    <div class="bubble">
      <div class="en" id="lineEn">Loadingâ€¦</div>
      <div class="zh" id="lineZh">ï¼ˆè¼‰å…¥ä¸­â€¦ï¼‰</div>
      <div class="inputLine" id="youSaid"></div>
    </div>

    <div class="actions">
      <button class="big" id="btnSpeak">ğŸ¤ é»æˆ‘èªªï¼ˆé–‹å§‹è¾¨è­˜ï¼‰</button>
      <button class="small" id="btnType">âŒ¨ï¸ è¼¸å…¥</button>
      <button class="small" id="btnSkip">è·³é</button>
    </div>

    <div class="kpi">
      <div class="k"><div class="t">ä»»å‹™</div><div class="v" id="kTask">è¦åšä»€éº¼</div></div>
      <div class="k"><div class="t">ç¯„ä¾‹</div><div class="v" id="kExample">ä¸æœƒå¥</div></div>
      <div class="k"><div class="t">ç¿»è­¯</div><div class="v" id="kTrans">ä¸­/æ—¥</div></div>
      <div class="k"><div class="t">å·²å„²å­˜</div><div class="v" id="kSaved">å–®å­—å¥</div></div>
    </div>
  </div>
</div>

<div class="toast" id="toast"></div>

<script>
/** BookWide Talk A â€” stable scenes + teacher dropdown
 * build: 2026-01-06 03:15
 * - 5 scenes embedded (no 404)
 * - teacher dropdown (å›ºå®š 3-5 ä½ï¼Œä¸èµ° admin)
 * - avatar: speak uses talk.mp4; idle/listen pause at first frame
 */
const DATA = {"index": {"version": "2026-01-04", "title": "Talk Scenarios", "items": [{"id": "coffee_shop", "title_zh": "è²·ä¸€æ¯å’–å•¡", "title_en": "Coffee Shop", "level": "A1", "role": "Barista", "avatar": "assets/avatars/teacher-blonde.jpg"}, {"id": "hotel_checkin", "title_zh": "é£¯åº—å…¥ä½", "title_en": "Hotel Check-in", "level": "A1", "role": "Front Desk", "avatar": "assets/avatars/teacher-blonde.jpg"}, {"id": "restaurant_order", "title_zh": "é¤å»³é»é¤", "title_en": "Restaurant Order", "level": "A1", "role": "Server", "avatar": "assets/avatars/teacher-blonde.jpg"}, {"id": "airport_checkin", "title_zh": "æ©Ÿå ´å ±åˆ°", "title_en": "Airport Check-in", "level": "A2", "role": "Airline Staff", "avatar": "assets/avatars/teacher-blonde.jpg"}, {"id": "business_meeting", "title_zh": "å•†å‹™æœƒè­°é–‹å ´", "title_en": "Business Meeting Opening", "level": "A2", "role": "Colleague", "avatar": "assets/avatars/teacher-blonde.jpg"}]}, "scenes": {"coffee_shop": {"id": "coffee_shop", "level": "A1", "title_zh": "è²·ä¸€æ¯å’–å•¡", "title_en": "Coffee Shop", "role": {"ai_name": "Mia", "ai_title": "Barista"}, "meta": {"missions": [{"id": 1, "text": "å‘Šè¨´åº—å“¡ä½ æƒ³é»ä¸€æ¯å’–å•¡ã€‚", "complete_on_step": "u2"}, {"id": 2, "text": "èªªæ˜æ¯å‹ / æ˜¯å¦åŠ å¥¶æˆ–ç³–ã€‚", "complete_on_step": "u6"}, {"id": 3, "text": "å®Œæˆä»˜æ¬¾èˆ‡æ”¶å°¾ã€‚", "complete_on_step": "u11"}], "examples": [{"en": "Can I get a black coffee, please?", "zh": "æˆ‘å¯ä»¥è¦ä¸€æ¯é»‘å’–å•¡å—ï¼Ÿ"}, {"en": "Iâ€™d like a latte, please.", "zh": "æˆ‘æƒ³è¦ä¸€æ¯æ‹¿éµã€‚"}, {"en": "Medium, please. No sugar.", "zh": "ä¸­æ¯ï¼Œè¬è¬ã€‚ä¸åŠ ç³–ã€‚"}], "key_vocab": [{"w": "coffee", "zh": "å’–å•¡", "note": "KAW-fee"}, {"w": "latte", "zh": "æ‹¿éµ", "note": "LAH-tay"}, {"w": "black", "zh": "é»‘å’–å•¡", "note": "ä¸åŠ å¥¶"}, {"w": "milk", "zh": "ç‰›å¥¶", "note": ""}, {"w": "sugar", "zh": "ç³–", "note": ""}, {"w": "small/medium/large", "zh": "å°/ä¸­/å¤§", "note": ""}]}, "dialogue": [{"id": "a1", "speaker": "AI", "en": "Welcome to our cafe! What would you like today?", "zh": "æ­¡è¿å…‰è‡¨ï¼ä»Šå¤©æƒ³å–ä»€éº¼ï¼Ÿ"}, {"id": "u2", "speaker": "USER", "hint_en": "Can I get a coffee, please?", "hint_zh": "æˆ‘å¯ä»¥è¦ä¸€æ¯å’–å•¡å—ï¼Ÿ"}, {"id": "a3", "speaker": "AI", "en": "Sure. Would you like it black or with milk?", "zh": "å¥½çš„ã€‚è¦é»‘å’–å•¡é‚„æ˜¯åŠ å¥¶ï¼Ÿ"}, {"id": "u4", "speaker": "USER", "hint_en": "Black, please.", "hint_zh": "é»‘å’–å•¡ï¼Œè¬è¬ã€‚"}, {"id": "a5", "speaker": "AI", "en": "What size would you like: small, medium, or large?", "zh": "è¦å°æ¯ã€ä¸­æ¯é‚„æ˜¯å¤§æ¯ï¼Ÿ"}, {"id": "u6", "speaker": "USER", "hint_en": "Medium, please. No sugar.", "hint_zh": "ä¸­æ¯ï¼Œè¬è¬ã€‚ä¸åŠ ç³–ã€‚"}, {"id": "a7", "speaker": "AI", "en": "Great. Anything else?", "zh": "å¥½çš„ã€‚é‚„éœ€è¦åˆ¥çš„å—ï¼Ÿ"}, {"id": "u8", "speaker": "USER", "hint_en": "Thatâ€™s all, thanks.", "hint_zh": "å°±é€™æ¨£ï¼Œè¬è¬ã€‚"}, {"id": "a9", "speaker": "AI", "en": "Your total is five dollars.", "zh": "ä¸€å…±äº”å…ƒã€‚"}, {"id": "u10", "speaker": "USER", "hint_en": "Here you go.", "hint_zh": "çµ¦ä½ ã€‚"}, {"id": "a11", "speaker": "AI", "en": "Thanks! Your coffee will be ready soon.", "zh": "è¬è¬ï¼å’–å•¡å¾ˆå¿«å°±å¥½ã€‚"}, {"id": "u12", "speaker": "USER", "hint_en": "Thank you!", "hint_zh": "è¬è¬ï¼"}], "feedback_tiers": [{"min": 0, "max": 39, "title": "å†è©¦ä¸€æ¬¡ä¹Ÿæ²’é—œä¿‚ ğŸ‘", "summary": "ä½ é‚„åœ¨ç†Ÿæ‚‰é»é¤æµç¨‹ï¼Œéƒ¨åˆ†å›ç­”æ²’æœ‰å®Œæˆä»»å‹™ã€‚", "metric_notes": {"relevance": "å›ç­”æœ‰å‡ºç¾ï¼Œä½†èˆ‡é»é¤æƒ…å¢ƒä¸å¤ è²¼åˆã€‚", "pronunciation": "é—œéµå–®å­—ä¸å¤ æ¸…æ¥šï¼ˆcoffee/latte/pleaseï¼‰ã€‚", "vocab": "å…ˆç”¨ç°¡å–®å¥å°±å¥½ï¼Œä¸ç”¨è¿½æ±‚å¤šå–®å­—ã€‚"}, "one_fix": {"original": "I want coffee.", "better": "Can I get a coffee, please?"}, "ai_message": "æ²’é—œä¿‚ï¼Œå¾ä¸€å¥é–‹å§‹ç·´å°±å¥½ï¼Œæˆ‘æœƒé™ªä½ ä¸€èµ·ä¾†ã€‚", "cta": "retry"}, {"min": 40, "max": 59, "title": "ä¸éŒ¯çš„é–‹å§‹ï¼", "summary": "ä½ å®Œæˆäº†éƒ¨åˆ†ä»»å‹™ï¼Œä½†è¡¨é”é‚„ä¸å¤ ç©©å®šã€‚", "metric_notes": {"relevance": "å¤§è‡´ç¬¦åˆé»é¤ï¼Œä½†æœ‰äº›å¥å­åèŠå¤©ã€‚", "pronunciation": "coffee / black / medium å†æ¸…æ¥šä¸€é»æœƒæ›´å¥½ã€‚", "vocab": "å¥å­å¯ä»¥æ›´çŸ­ã€æ›´ç›´æ¥ã€‚"}, "one_fix": {"original": "I want a coffee.", "better": "Can I get a black coffee, please?"}, "ai_message": "æ–¹å‘æ˜¯å°çš„ï¼æŠŠå¥å­èªªçŸ­ä¸€é»ï¼Œæœƒé€²æ­¥å¾ˆå¿«ã€‚", "cta": "practice_once_more"}, {"min": 60, "max": 74, "title": "åšå¾—ä¸éŒ¯ï¼", "summary": "ä½ å·²å®Œæˆä¸»è¦ä»»å‹™ï¼Œè¡¨é”å¤§è‡´è‡ªç„¶ã€‚", "metric_notes": {"relevance": "é»é¤æµç¨‹å®Œæ•´ã€‚", "pronunciation": "å¶æœ‰ä¸æ¸…æ¥šä½†ä¸å½±éŸ¿ç†è§£ã€‚", "vocab": "ç”¨å­—æ°ç•¶ã€‚"}, "one_fix": {"original": "I want a coffee.", "better": "Iâ€™d like a coffee, please."}, "ai_message": "ä½ å·²ç¶“èƒ½æ‡‰ä»˜é»é¤äº†ï¼Œä¸‹æ¬¡å°ˆæ³¨èªæ°£å°±æ›´è‡ªç„¶ã€‚", "cta": "next_or_advanced"}, {"min": 75, "max": 89, "title": "å¾ˆå¥½ï¼ğŸ‘", "summary": "ä½ çš„å°è©±è‡ªç„¶æµæš¢ï¼Œæ¥è¿‘æ¯èªä½¿ç”¨è€…ã€‚", "metric_notes": {"relevance": "å®Œå…¨è²¼åˆæƒ…å¢ƒã€‚", "pronunciation": "ç™¼éŸ³æ¸…æ¥šã€‚", "vocab": "ç”¨å­—å¾—é«”ã€‚"}, "one_fix": {"original": "Medium latte, no sugar.", "better": "Can I get a medium latte with no sugar, please?"}, "ai_message": "è¡¨ç¾å¾ˆå¥½ï¼ä½ å·²ç¶“å¯ä»¥åœ¨çœŸå¯¦æƒ…å¢ƒä¸­ä½¿ç”¨äº†ã€‚", "cta": "unlock_real"}, {"min": 90, "max": 100, "title": "å¤ªæ£’äº†ï¼ğŸŒŸ", "summary": "éå¸¸è‡ªç„¶ï¼Œå¹¾ä¹åƒæ¯èªè€…ã€‚", "metric_notes": {"relevance": "ä¸»é¡Œå®Œå…¨æŒæ¡ã€‚", "pronunciation": "ç™¼éŸ³è‡ªç„¶ã€‚", "vocab": "å¥å‹éˆæ´»ã€‚"}, "one_fix": {"original": "Give me a coffee.", "better": "Could I get a coffee when you have a moment?"}, "ai_message": "é€™æ¨£çš„è¡¨é”åœ¨åœ‹å¤–å®Œå…¨æ²’å•é¡Œï¼Œåšå¾—éå¸¸å¥½ï¼", "cta": "next"}]}, "hotel_checkin": {"id": "hotel_checkin", "level": "A1", "title_zh": "é£¯åº—å…¥ä½", "title_en": "Hotel Check-in", "role": {"ai_name": "Liam", "ai_title": "Front Desk"}, "meta": {"missions": [{"id": 1, "text": "å‘Šè¨´æ«ƒå°ä½ æœ‰è¨‚æˆ¿ã€‚", "complete_on_step": "u2"}, {"id": 2, "text": "å‡ºç¤ºè­‰ä»¶ä¸¦ç¢ºèªæˆ¿å‹ã€‚", "complete_on_step": "u6"}, {"id": 3, "text": "æ‹¿åˆ°æˆ¿å¡ä¸¦æ”¶å°¾ã€‚", "complete_on_step": "u12"}], "examples": [{"en": "I have a reservation under Chen.", "zh": "æˆ‘ç”¨é™³é€™å€‹å§“è¨‚æˆ¿ã€‚"}, {"en": "Here is my passport.", "zh": "é€™æ˜¯æˆ‘çš„è­·ç…§ã€‚"}, {"en": "Could I have a room key, please?", "zh": "æˆ‘å¯ä»¥æ‹¿æˆ¿å¡å—ï¼Ÿ"}], "key_vocab": [{"w": "reservation", "zh": "è¨‚æˆ¿", "note": "rez-er-VAY-shun"}, {"w": "passport", "zh": "è­·ç…§", "note": "PASS-port"}, {"w": "single/double", "zh": "å–®äºº/é›™äººæˆ¿", "note": ""}, {"w": "room key", "zh": "æˆ¿å¡", "note": ""}, {"w": "third floor", "zh": "ä¸‰æ¨“", "note": ""}]}, "dialogue": [{"id": "a1", "speaker": "AI", "en": "Good evening. Welcome! How can I help you?", "zh": "æ™šå®‰ï¼Œæ­¡è¿å…‰è‡¨ï¼æˆ‘èƒ½å¹«æ‚¨ä»€éº¼ï¼Ÿ"}, {"id": "u2", "speaker": "USER", "hint_en": "Hi, I have a reservation.", "hint_zh": "ä½ å¥½ï¼Œæˆ‘æœ‰è¨‚æˆ¿ã€‚"}, {"id": "a3", "speaker": "AI", "en": "Great. What name is the reservation under?", "zh": "å¥½çš„ã€‚è¨‚æˆ¿å§“åæ˜¯ï¼Ÿ"}, {"id": "u4", "speaker": "USER", "hint_en": "Itâ€™s under Chen.", "hint_zh": "å§“é™³ã€‚"}, {"id": "a5", "speaker": "AI", "en": "May I see your passport, please?", "zh": "å¯ä»¥çœ‹ä¸€ä¸‹è­·ç…§å—ï¼Ÿ"}, {"id": "u6", "speaker": "USER", "hint_en": "Sure. Here you are.", "hint_zh": "ç•¶ç„¶ï¼Œçµ¦ä½ ã€‚"}, {"id": "a7", "speaker": "AI", "en": "Thank you. You booked a single room for two nights, correct?", "zh": "è¬è¬ã€‚æ‚¨è¨‚çš„æ˜¯å–®äººæˆ¿å…©æ™šï¼Œå°å—ï¼Ÿ"}, {"id": "u8", "speaker": "USER", "hint_en": "Yes, thatâ€™s right.", "hint_zh": "å°ï¼Œæ²’éŒ¯ã€‚"}, {"id": "a9", "speaker": "AI", "en": "Perfect. Here is your room key.", "zh": "å¥½çš„ï¼Œé€™æ˜¯æ‚¨çš„æˆ¿å¡ã€‚"}, {"id": "a10", "speaker": "AI", "en": "Your room is on the third floor.", "zh": "æ‚¨çš„æˆ¿é–“åœ¨ä¸‰æ¨“ã€‚"}, {"id": "u11", "speaker": "USER", "hint_en": "Thank you. What time is breakfast?", "hint_zh": "è¬è¬ã€‚æ—©é¤å¹¾é»ï¼Ÿ"}, {"id": "a12", "speaker": "AI", "en": "Breakfast is from 7 to 10 a.m. Enjoy your stay!", "zh": "æ—©é¤ 7 åˆ° 10 é»ã€‚ç¥æ‚¨å…¥ä½æ„‰å¿«ï¼"}], "feedback_tiers": [{"min": 0, "max": 39, "title": "å†è©¦ä¸€æ¬¡ä¹Ÿæ²’é—œä¿‚ ğŸ‘", "summary": "å…¥ä½æµç¨‹é‚„ä¸å®Œæ•´ï¼Œé—œéµå¥å¯ä»¥å…ˆç·´ç†Ÿã€‚", "metric_notes": {"relevance": "å›ç­”æœªèšç„¦åœ¨å…¥ä½æµç¨‹ã€‚", "pronunciation": "reservation / passport éœ€è¦æ›´æ¸…æ¥šã€‚", "vocab": "å…ˆç”¨ç°¡çŸ­å¥å®Œæˆä»»å‹™ã€‚"}, "one_fix": {"original": "I have booking.", "better": "I have a reservation."}, "ai_message": "å…ˆæŠŠã€I have a reservationã€ç·´é †å°±æœƒå¥½å¾ˆå¤šã€‚", "cta": "retry"}, {"min": 40, "max": 59, "title": "ä¸éŒ¯çš„é–‹å§‹ï¼", "summary": "ä½ å®Œæˆéƒ¨åˆ†å…¥ä½æ­¥é©Ÿï¼Œä½†è¡¨é”é‚„ä¸ç©©ã€‚", "metric_notes": {"relevance": "å¤§å¤šç¬¦åˆå…¥ä½æƒ…å¢ƒã€‚", "pronunciation": "passport / single room å¯å†æ¸…æ¥šã€‚", "vocab": "æ³¨æ„å† è© a çš„ä½¿ç”¨ã€‚"}, "one_fix": {"original": "I have reservation.", "better": "I have a reservation."}, "ai_message": "æ–¹å‘å°äº†ï¼æŠŠ a åŠ å›å»æœƒæ›´åƒæ¯èªè€…ã€‚", "cta": "practice_once_more"}, {"min": 60, "max": 74, "title": "åšå¾—ä¸éŒ¯ï¼", "summary": "ä½ å·²å®Œæˆä¸»è¦å…¥ä½ä»»å‹™ï¼Œè¡¨é”æ¸…æ¥šã€‚", "metric_notes": {"relevance": "æµç¨‹å®Œæ•´ã€‚", "pronunciation": "å¶æœ‰ä¸æ¸…æ¥šä½†å¯ç†è§£ã€‚", "vocab": "ç”¨å­—æ°ç•¶ã€‚"}, "one_fix": {"original": "Give me room key.", "better": "Could I have a room key, please?"}, "ai_message": "ä½ å·²ç¶“å¾ˆä¸éŒ¯äº†ï¼Œä¸‹æ¬¡æŠŠèªæ°£æ›´ç¦®è²Œæœƒæ›´å°ˆæ¥­ã€‚", "cta": "next_or_advanced"}, {"min": 75, "max": 89, "title": "å¾ˆå¥½ï¼ğŸ‘", "summary": "å…¥ä½å°è©±è‡ªç„¶æµæš¢ï¼Œæ¥è¿‘çœŸå¯¦ä½¿ç”¨ã€‚", "metric_notes": {"relevance": "éå¸¸è²¼åˆã€‚", "pronunciation": "ç™¼éŸ³æ¸…æ¥šã€‚", "vocab": "å¥å‹è‡ªç„¶ã€‚"}, "one_fix": {"original": "Breakfast time?", "better": "What time is breakfast?"}, "ai_message": "ä½ å·²ç¶“èƒ½åœ¨é£¯åº—é †åˆ©æºé€šäº†ï¼", "cta": "unlock_real"}, {"min": 90, "max": 100, "title": "å¤ªæ£’äº†ï¼ğŸŒŸ", "summary": "éå¸¸è‡ªç„¶ï¼ŒåƒçœŸçš„åœ¨æ«ƒå°å°è©±ã€‚", "metric_notes": {"relevance": "å®Œå…¨æŒæ¡ã€‚", "pronunciation": "è‡ªç„¶æ¸…æ™°ã€‚", "vocab": "å½ˆæ€§é«˜ã€‚"}, "one_fix": {"original": "I want late checkout.", "better": "Could I request a late checkout, please?"}, "ai_message": "é€™æ¨£è¬›éå¸¸åˆ°ä½ï¼ŒçœŸå¯¦æƒ…å¢ƒå®Œå…¨æ²’å•é¡Œï¼", "cta": "next"}]}, "restaurant_order": {"id": "restaurant_order", "level": "A1", "title_zh": "é¤å»³é»é¤", "title_en": "Restaurant Order", "role": {"ai_name": "Sara", "ai_title": "Server"}, "meta": {"missions": [{"id": 1, "text": "å‘æœå‹™ç”Ÿè©¢å•èœå–®æˆ–æ¨è–¦ã€‚", "complete_on_step": "u2"}, {"id": 2, "text": "é»ä¸»é¤èˆ‡é£²æ–™ã€‚", "complete_on_step": "u6"}, {"id": 3, "text": "çµå¸³æˆ–æ”¶å°¾ã€‚", "complete_on_step": "u11"}], "examples": [{"en": "Could I see the menu, please?", "zh": "å¯ä»¥çœ‹ä¸€ä¸‹èœå–®å—ï¼Ÿ"}, {"en": "Iâ€™d like to order the steak.", "zh": "æˆ‘æƒ³é»ç‰›æ’ã€‚"}, {"en": "Could we have the bill, please?", "zh": "å¯ä»¥çµå¸³å—ï¼Ÿ"}], "key_vocab": [{"w": "menu", "zh": "èœå–®", "note": ""}, {"w": "recommend", "zh": "æ¨è–¦", "note": ""}, {"w": "steak", "zh": "ç‰›æ’", "note": ""}, {"w": "bill", "zh": "å¸³å–®", "note": ""}]}, "dialogue": [{"id": "a1", "speaker": "AI", "en": "Hi! Welcome. Are you ready to order?", "zh": "ä½ å¥½ï¼æ­¡è¿å…‰è‡¨ã€‚æº–å‚™å¥½é»é¤äº†å—ï¼Ÿ"}, {"id": "u2", "speaker": "USER", "hint_en": "Could I see the menu, please?", "hint_zh": "å¯ä»¥çœ‹ä¸€ä¸‹èœå–®å—ï¼Ÿ"}, {"id": "a3", "speaker": "AI", "en": "Of course. Our pasta is very popular.", "zh": "ç•¶ç„¶ã€‚æˆ‘å€‘çš„ç¾©å¤§åˆ©éºµå¾ˆå—æ­¡è¿ã€‚"}, {"id": "u4", "speaker": "USER", "hint_en": "What do you recommend?", "hint_zh": "ä½ æ¨è–¦ä»€éº¼ï¼Ÿ"}, {"id": "a5", "speaker": "AI", "en": "I recommend the steak. Would you like it medium or well-done?", "zh": "æˆ‘æ¨è–¦ç‰›æ’ã€‚è¦ä¸‰åˆ†ç†Ÿé‚„æ˜¯å…¨ç†Ÿï¼Ÿ"}, {"id": "u6", "speaker": "USER", "hint_en": "Medium, please. And a glass of water.", "hint_zh": "ä¸‰åˆ†ç†Ÿï¼Œè¬è¬ã€‚å†ä¸€æ¯æ°´ã€‚"}, {"id": "a7", "speaker": "AI", "en": "Great. Anything else?", "zh": "å¥½çš„ã€‚é‚„éœ€è¦åˆ¥çš„å—ï¼Ÿ"}, {"id": "u8", "speaker": "USER", "hint_en": "Thatâ€™s all, thank you.", "hint_zh": "å°±é€™æ¨£ï¼Œè¬è¬ã€‚"}, {"id": "a9", "speaker": "AI", "en": "Perfect. Iâ€™ll bring your food soon.", "zh": "å¥½çš„ï¼Œæˆ‘å¾ˆå¿«é€ä¸Šä¾†ã€‚"}, {"id": "a10", "speaker": "AI", "en": "Would you like the bill now?", "zh": "ç¾åœ¨è¦çµå¸³å—ï¼Ÿ"}, {"id": "u11", "speaker": "USER", "hint_en": "Yes, could we have the bill, please?", "hint_zh": "å¥½ï¼Œå¯ä»¥çµå¸³å—ï¼Ÿ"}], "feedback_tiers": [{"min": 0, "max": 39, "title": "å†è©¦ä¸€æ¬¡ä¹Ÿæ²’é—œä¿‚ ğŸ‘", "summary": "é»é¤æµç¨‹å°šæœªå®Œæˆï¼Œå…ˆæŠŠã€çœ‹èœå–®ã€èˆ‡ã€é»ä¸»é¤ã€ç·´ç†Ÿã€‚", "metric_notes": {"relevance": "å¥å­ä¸å¤ è²¼åˆé¤å»³æƒ…å¢ƒã€‚", "pronunciation": "menu / steak / bill éœ€æ›´æ¸…æ¥šã€‚", "vocab": "å…ˆç”¨ç°¡çŸ­å¥å®Œæˆä»»å‹™ã€‚"}, "one_fix": {"original": "I want order steak.", "better": "Iâ€™d like to order the steak."}, "ai_message": "å…ˆæŠŠã€Iâ€™d like to orderâ€¦ã€é€™å€‹å¥å‹ç·´é †ã€‚", "cta": "retry"}, {"min": 40, "max": 59, "title": "ä¸éŒ¯çš„é–‹å§‹ï¼", "summary": "å·²èƒ½è¡¨é”éœ€æ±‚ï¼Œä½†å¥å‹ç•¥ç”Ÿç¡¬ã€‚", "metric_notes": {"relevance": "å¤§å¤šç¬¦åˆé»é¤ã€‚", "pronunciation": "order / recommend å†æ¸…æ¥šä¸€é»ã€‚", "vocab": "å¥å­å¯æ›´ç¦®è²Œã€‚"}, "one_fix": {"original": "Give me menu.", "better": "Could I see the menu, please?"}, "ai_message": "åŠ ä¸Š please æœƒæ›´è‡ªç„¶æœ‰ç¦®è²Œã€‚", "cta": "practice_once_more"}, {"min": 60, "max": 74, "title": "åšå¾—ä¸éŒ¯ï¼", "summary": "ä»»å‹™å®Œæˆï¼Œè¡¨é”æ¸…æ¥šã€‚", "metric_notes": {"relevance": "æµç¨‹å®Œæ•´ã€‚", "pronunciation": "å¯ç†è§£ã€‚", "vocab": "ç”¨å­—æ°ç•¶ã€‚"}, "one_fix": {"original": "Bill!", "better": "Could we have the bill, please?"}, "ai_message": "ä½ å·²ç¶“èƒ½åœ¨é¤å»³é †åˆ©é»é¤äº†ï¼", "cta": "next_or_advanced"}, {"min": 75, "max": 89, "title": "å¾ˆå¥½ï¼ğŸ‘", "summary": "å°è©±è‡ªç„¶ï¼Œæ¥è¿‘çœŸå¯¦æƒ…å¢ƒã€‚", "metric_notes": {"relevance": "éå¸¸è²¼åˆã€‚", "pronunciation": "æ¸…æ¥šè‡ªç„¶ã€‚", "vocab": "å¥å‹æµæš¢ã€‚"}, "one_fix": {"original": "Medium.", "better": "Medium, please."}, "ai_message": "è¡¨ç¾å¾ˆå¥½ï¼èªæ°£å¾ˆåˆ°ä½ã€‚", "cta": "unlock_real"}, {"min": 90, "max": 100, "title": "å¤ªæ£’äº†ï¼ğŸŒŸ", "summary": "éå¸¸è‡ªç„¶ï¼ŒåƒçœŸçš„åœ¨é¤å»³ç”¨è‹±æ–‡é»é¤ã€‚", "metric_notes": {"relevance": "å®Œå…¨æŒæ¡ã€‚", "pronunciation": "æ¯èªæ„Ÿã€‚", "vocab": "å½ˆæ€§é«˜ã€‚"}, "one_fix": {"original": "No ice.", "better": "Could I have it with no ice, please?"}, "ai_message": "ä½ å·²ç¶“å¯ä»¥ç›´æ¥åœ¨åœ‹å¤–é¤å»³ä½¿ç”¨äº†ï¼", "cta": "next"}]}, "airport_checkin": {"id": "airport_checkin", "level": "A2", "title_zh": "æ©Ÿå ´å ±åˆ°", "title_en": "Airport Check-in", "role": {"ai_name": "Alex", "ai_title": "Airline Staff"}, "meta": {"missions": [{"id": 1, "text": "å‘Šè¨´æ«ƒå°ä½ è¦è¾¦ç†å ±åˆ°ã€‚", "complete_on_step": "u2"}, {"id": 2, "text": "å›ç­”è¡Œæèˆ‡åº§ä½å•é¡Œã€‚", "complete_on_step": "u6"}, {"id": 3, "text": "æ‹¿åˆ°ç™»æ©Ÿè­‰ä¸¦æ”¶å°¾ã€‚", "complete_on_step": "u12"}], "examples": [{"en": "Iâ€™d like to check in for my flight.", "zh": "æˆ‘æƒ³è¾¦ç†èˆªç­å ±åˆ°ã€‚"}, {"en": "I have one checked bag.", "zh": "æˆ‘æœ‰ä¸€ä»¶æ‰˜é‹è¡Œæã€‚"}, {"en": "Could I have an aisle seat, please?", "zh": "æˆ‘æƒ³è¦èµ°é“åº§ä½ã€‚"}], "key_vocab": [{"w": "check in", "zh": "å ±åˆ°", "note": ""}, {"w": "boarding pass", "zh": "ç™»æ©Ÿè­‰", "note": ""}, {"w": "checked bag", "zh": "æ‰˜é‹è¡Œæ", "note": ""}, {"w": "aisle seat", "zh": "èµ°é“ä½", "note": ""}]}, "dialogue": [{"id": "a1", "speaker": "AI", "en": "Hello. Where are you flying today?", "zh": "ä½ å¥½ã€‚ä»Šå¤©é£›å¾€å“ªè£¡ï¼Ÿ"}, {"id": "u2", "speaker": "USER", "hint_en": "Hi, Iâ€™d like to check in for my flight to Tokyo.", "hint_zh": "ä½ å¥½ï¼Œæˆ‘è¦è¾¦ç†é£›å¾€æ±äº¬çš„å ±åˆ°ã€‚"}, {"id": "a3", "speaker": "AI", "en": "May I see your passport, please?", "zh": "å¯ä»¥çœ‹ä¸€ä¸‹è­·ç…§å—ï¼Ÿ"}, {"id": "u4", "speaker": "USER", "hint_en": "Sure. Here it is.", "hint_zh": "ç•¶ç„¶ï¼Œçµ¦ä½ ã€‚"}, {"id": "a5", "speaker": "AI", "en": "Do you have any bags to check?", "zh": "æœ‰è¡Œæè¦æ‰˜é‹å—ï¼Ÿ"}, {"id": "u6", "speaker": "USER", "hint_en": "Yes, I have one checked bag.", "hint_zh": "æœ‰ï¼Œæˆ‘æœ‰ä¸€ä»¶æ‰˜é‹è¡Œæã€‚"}, {"id": "a7", "speaker": "AI", "en": "Would you like a window or an aisle seat?", "zh": "è¦é çª—é‚„æ˜¯èµ°é“ï¼Ÿ"}, {"id": "u8", "speaker": "USER", "hint_en": "An aisle seat, please.", "hint_zh": "èµ°é“ä½ï¼Œè¬è¬ã€‚"}, {"id": "a9", "speaker": "AI", "en": "Great. Here is your boarding pass.", "zh": "å¥½çš„ï¼Œé€™æ˜¯æ‚¨çš„ç™»æ©Ÿè­‰ã€‚"}, {"id": "a10", "speaker": "AI", "en": "Boarding starts at 6:30 at Gate 12.", "zh": "6:30 åœ¨ 12 è™Ÿç™»æ©Ÿé–€é–‹å§‹ç™»æ©Ÿã€‚"}, {"id": "u11", "speaker": "USER", "hint_en": "Thank you. Where is Gate 12?", "hint_zh": "è¬è¬ã€‚12 è™Ÿç™»æ©Ÿé–€åœ¨å“ªï¼Ÿ"}, {"id": "a12", "speaker": "AI", "en": "Go straight and turn left. Have a nice flight!", "zh": "ç›´èµ°å†å·¦è½‰ã€‚ç¥æ‚¨æ—…é€”æ„‰å¿«ï¼"}], "feedback_tiers": [{"min": 0, "max": 39, "title": "å†è©¦ä¸€æ¬¡ä¹Ÿæ²’é—œä¿‚ ğŸ‘", "summary": "å ±åˆ°æµç¨‹å°šæœªå®Œæˆï¼Œå…ˆæŠŠã€check in / è¡Œæ / åº§ä½ã€ç·´ç†Ÿã€‚", "metric_notes": {"relevance": "å›ç­”æœªèšç„¦å ±åˆ°æµç¨‹ã€‚", "pronunciation": "boarding pass / checked bag éœ€æ›´æ¸…æ¥šã€‚", "vocab": "å…ˆç”¨æ¨™æº–å¥å®Œæˆä»»å‹™ã€‚"}, "one_fix": {"original": "I have luggage.", "better": "I have one checked bag."}, "ai_message": "å…ˆæŠŠã€I have one checked bagã€ç·´é †å°±æœƒé€²æ­¥å¾ˆå¿«ã€‚", "cta": "retry"}, {"min": 40, "max": 59, "title": "ä¸éŒ¯çš„é–‹å§‹ï¼", "summary": "ä½ å®Œæˆéƒ¨åˆ†ä»»å‹™ï¼Œä½†å›ç­”å¯æ›´ç²¾æº–ã€‚", "metric_notes": {"relevance": "å¤§å¤šç¬¦åˆå ±åˆ°æƒ…å¢ƒã€‚", "pronunciation": "check in / aisle å†æ¸…æ¥šä¸€é»ã€‚", "vocab": "å¥å­å¯æ›´ç›´æ¥ã€‚"}, "one_fix": {"original": "I want aisle.", "better": "An aisle seat, please."}, "ai_message": "æ–¹å‘å°äº†ï¼è£œä¸Š seat æœƒæ›´å®Œæ•´ã€‚", "cta": "practice_once_more"}, {"min": 60, "max": 74, "title": "åšå¾—ä¸éŒ¯ï¼", "summary": "ä»»å‹™å®Œæˆï¼Œè¡¨é”æ¸…æ¥šã€‚", "metric_notes": {"relevance": "æµç¨‹å®Œæ•´ã€‚", "pronunciation": "å¯ç†è§£ã€‚", "vocab": "ç”¨å­—åˆé©ã€‚"}, "one_fix": {"original": "Gate 12 where?", "better": "Where is Gate 12?"}, "ai_message": "ä½ å·²ç¶“èƒ½å®Œæˆæ©Ÿå ´å ±åˆ°å°è©±äº†ï¼", "cta": "next_or_advanced"}, {"min": 75, "max": 89, "title": "å¾ˆå¥½ï¼ğŸ‘", "summary": "å°è©±è‡ªç„¶æµæš¢ï¼Œæ¥è¿‘çœŸå¯¦æ©Ÿå ´æºé€šã€‚", "metric_notes": {"relevance": "éå¸¸è²¼åˆã€‚", "pronunciation": "æ¸…æ¥šè‡ªç„¶ã€‚", "vocab": "å¥å‹æµæš¢ã€‚"}, "one_fix": {"original": "One bag.", "better": "I have one checked bag."}, "ai_message": "å¾ˆæ£’ï¼ä½ å·²ç¶“å¾ˆåƒçœŸçš„åœ¨æ«ƒå°å ±åˆ°ã€‚", "cta": "unlock_real"}, {"min": 90, "max": 100, "title": "å¤ªæ£’äº†ï¼ğŸŒŸ", "summary": "éå¸¸è‡ªç„¶ï¼ŒåƒçœŸå¯¦æ—…å®¢çš„è‹±æ–‡è¡¨é”ã€‚", "metric_notes": {"relevance": "å®Œå…¨æŒæ¡ã€‚", "pronunciation": "æ¯èªæ„Ÿã€‚", "vocab": "å½ˆæ€§é«˜ã€‚"}, "one_fix": {"original": "Change seat?", "better": "Could I change my seat, if possible?"}, "ai_message": "é€™æ¨£è¬›éå¸¸åˆ°ä½ï¼ŒçœŸå¯¦æƒ…å¢ƒå®Œå…¨æ²’å•é¡Œï¼", "cta": "next"}]}, "business_meeting": {"id": "business_meeting", "level": "A2", "title_zh": "å•†å‹™æœƒè­°é–‹å ´", "title_en": "Business Meeting Opening", "role": {"ai_name": "Daniel", "ai_title": "Colleague"}, "meta": {"missions": [{"id": 1, "text": "ç¦®è²Œæ‰“æ‹›å‘¼ä¸¦è‡ªæˆ‘ä»‹ç´¹ã€‚", "complete_on_step": "u2"}, {"id": 2, "text": "ç¢ºèªæœƒè­°ç›®çš„ / è­°ç¨‹ã€‚", "complete_on_step": "u6"}, {"id": 3, "text": "æ”¶å°¾ä¸¦åŒæ„ä¸‹ä¸€æ­¥ã€‚", "complete_on_step": "u10"}], "examples": [{"en": "Itâ€™s great to meet you today.", "zh": "å¾ˆé«˜èˆˆä»Šå¤©è¦‹åˆ°ä½ ã€‚"}, {"en": "Could we review the agenda?", "zh": "æˆ‘å€‘å¯ä»¥çœ‹ä¸€ä¸‹è­°ç¨‹å—ï¼Ÿ"}, {"en": "Letâ€™s follow up by email.", "zh": "æˆ‘å€‘ç”¨ email å¾ŒçºŒè·Ÿé€²ã€‚"}], "key_vocab": [{"w": "agenda", "zh": "è­°ç¨‹", "note": ""}, {"w": "schedule", "zh": "è¡Œç¨‹/å®‰æ’", "note": ""}, {"w": "follow up", "zh": "è·Ÿé€²", "note": ""}, {"w": "next steps", "zh": "ä¸‹ä¸€æ­¥", "note": ""}]}, "dialogue": [{"id": "a1", "speaker": "AI", "en": "Hi, thanks for joining the meeting.", "zh": "å—¨ï¼Œè¬è¬ä½ åƒåŠ æœƒè­°ã€‚"}, {"id": "u2", "speaker": "USER", "hint_en": "Hi, Iâ€™m Ray. Itâ€™s great to meet you.", "hint_zh": "å—¨ï¼Œæˆ‘æ˜¯ Rayã€‚å¾ˆé«˜èˆˆèªè­˜ä½ ã€‚"}, {"id": "a3", "speaker": "AI", "en": "Great to meet you too. Shall we start?", "zh": "æˆ‘ä¹Ÿå¾ˆé«˜èˆˆã€‚é‚£æˆ‘å€‘é–‹å§‹å—ï¼Ÿ"}, {"id": "u4", "speaker": "USER", "hint_en": "Yes. Could we review the agenda first?", "hint_zh": "å¥½ã€‚æˆ‘å€‘å¯ä»¥å…ˆçœ‹ä¸€ä¸‹è­°ç¨‹å—ï¼Ÿ"}, {"id": "a5", "speaker": "AI", "en": "Sure. Today weâ€™ll discuss timeline and budget.", "zh": "å¯ä»¥ã€‚ä»Šå¤©è¨è«–æ™‚ç¨‹èˆ‡é ç®—ã€‚"}, {"id": "u6", "speaker": "USER", "hint_en": "Sounds good. Whatâ€™s the timeline?", "hint_zh": "äº†è§£ã€‚æ™‚ç¨‹æ˜¯æ€éº¼å®‰æ’ï¼Ÿ"}, {"id": "a7", "speaker": "AI", "en": "We plan to finish in two weeks.", "zh": "æˆ‘å€‘è¨ˆç•«å…©é€±å…§å®Œæˆã€‚"}, {"id": "u8", "speaker": "USER", "hint_en": "Great. Letâ€™s confirm next steps by email.", "hint_zh": "å¾ˆå¥½ã€‚æˆ‘å€‘ç”¨ email ç¢ºèªä¸‹ä¸€æ­¥ã€‚"}, {"id": "a9", "speaker": "AI", "en": "Perfect. Iâ€™ll send a summary after the meeting.", "zh": "å¥½çš„ã€‚æˆ‘æœƒå¾Œå¯„å‡ºæ‘˜è¦ã€‚"}, {"id": "u10", "speaker": "USER", "hint_en": "Thank you. Talk to you soon.", "hint_zh": "è¬è¬ï¼Œä¹‹å¾Œå†è¯çµ¡ã€‚"}], "feedback_tiers": [{"min": 0, "max": 39, "title": "å†è©¦ä¸€æ¬¡ä¹Ÿæ²’é—œä¿‚ ğŸ‘", "summary": "æœƒè­°é–‹å ´å¥å‹é‚„ä¸ç†Ÿï¼Œå…ˆç·´å›ºå®šæ¨¡æ¿å°±å¥½ã€‚", "metric_notes": {"relevance": "å¥å­æœªèšç„¦æœƒè­°æƒ…å¢ƒã€‚", "pronunciation": "agenda / schedule å»ºè­°å†æ¸…æ¥šã€‚", "vocab": "ç”¨ç°¡çŸ­æ­£å¼å¥å³å¯ã€‚"}, "one_fix": {"original": "Nice meet.", "better": "Itâ€™s great to meet you."}, "ai_message": "å…ˆæŠŠã€Itâ€™s great to meet youã€ç·´é †ï¼Œæœƒç«‹åˆ»æå‡å°ˆæ¥­æ„Ÿã€‚", "cta": "retry"}, {"min": 40, "max": 59, "title": "ä¸éŒ¯çš„é–‹å§‹ï¼", "summary": "èƒ½ç¦®è²Œé–‹å ´ï¼Œä½†å¥å‹ç•¥ç”Ÿç¡¬ã€‚", "metric_notes": {"relevance": "åŸºæœ¬ç¬¦åˆå•†å‹™æƒ…å¢ƒã€‚", "pronunciation": "review / agenda å†æ¸…æ¥šä¸€é»ã€‚", "vocab": "å¯åŠ ä¸Šç¦®è²Œèªæ°£ã€‚"}, "one_fix": {"original": "We see agenda?", "better": "Could we review the agenda?"}, "ai_message": "åŠ ä¸Š Could weâ€¦ æœƒæ›´è‡ªç„¶ã€æ›´å•†å‹™ã€‚", "cta": "practice_once_more"}, {"min": 60, "max": 74, "title": "åšå¾—ä¸éŒ¯ï¼", "summary": "ä½ å·²èƒ½å®Œæˆæœƒè­°é–‹å ´ï¼Œè¡¨é”æ¸…æ¥šã€‚", "metric_notes": {"relevance": "æµç¨‹å®Œæ•´ã€‚", "pronunciation": "å¯ç†è§£ã€‚", "vocab": "ç”¨å­—æ°ç•¶ã€‚"}, "one_fix": {"original": "Send email.", "better": "Letâ€™s follow up by email."}, "ai_message": "å¾ˆä¸éŒ¯ï¼å†åŠ ä¸€é»èªæ°£æœƒæ›´æœ‰èªªæœåŠ›ã€‚", "cta": "next_or_advanced"}, {"min": 75, "max": 89, "title": "å¾ˆå¥½ï¼ğŸ‘", "summary": "é–‹å ´è‡ªç„¶æµæš¢ï¼Œå¾ˆåƒçœŸå¯¦å•†å‹™å°è©±ã€‚", "metric_notes": {"relevance": "éå¸¸è²¼åˆã€‚", "pronunciation": "æ¸…æ¥šè‡ªç„¶ã€‚", "vocab": "å¥å‹æµæš¢ã€‚"}, "one_fix": {"original": "Next steps email.", "better": "Letâ€™s confirm the next steps by email."}, "ai_message": "è¡¨ç¾å¾ˆå¥½ï¼ä½ å·²ç¶“å…·å‚™å•†å‹™å ´åˆçš„è‡ªç„¶è¡¨é”ã€‚", "cta": "unlock_real"}, {"min": 90, "max": 100, "title": "å¤ªæ£’äº†ï¼ğŸŒŸ", "summary": "éå¸¸è‡ªç„¶ï¼Œåƒæœ‰ç¶“é©—çš„å•†å‹™äººå£«ã€‚", "metric_notes": {"relevance": "å®Œå…¨æŒæ¡ã€‚", "pronunciation": "æ¯èªæ„Ÿã€‚", "vocab": "å½ˆæ€§é«˜ã€‚"}, "one_fix": {"original": "Any concern?", "better": "Do you have any concerns before we proceed?"}, "ai_message": "é€™æ¨£çš„è¡¨é”éå¸¸å°ˆæ¥­ï¼ŒçœŸå¯¦æœƒè­°å®Œå…¨æ²’å•é¡Œï¼", "cta": "next"}]}}};

const DEFAULT_TALK_MP4 = "https://jeajrwpmrgczimmrflxo.supabase.co/storage/v1/object/public/assets/avatars/talk.mp4";
const DEFAULT_IDLE = "https://jeajrwpmrgczimmrflxo.supabase.co/storage/v1/object/public/assets/avatars/ai-teacher-idle.png";
const DEFAULT_LISTEN = "https://jeajrwpmrgczimmrflxo.supabase.co/storage/v1/object/public/assets/avatars/ai-teacher-listen.png";

const TEACHERS = [
  {
    id: "lychee",
    name: "Lychee",
    talk_video_url: "https://jeajrwpmrgczimmrflxo.supabase.co/storage/v1/object/public/assets/avatars/Lychee.mp4"
  },
  {
    id: "mermaid",
    name: "Mermaid",
    talk_video_url: "https://jeajrwpmrgczimmrflxo.supabase.co/storage/v1/object/public/assets/avatars/mermaid.mp4"
  },
  {
    id: "pineapple",
    name: "Pineapple",
    talk_video_url: "https://jeajrwpmrgczimmrflxo.supabase.co/storage/v1/object/public/assets/avatars/Pineapple.mp4"
  }
];

const $ = (id)=>document.getElementById(id);
const sceneSel = $("sceneSel");
const teacherSel = $("teacherSel");
const badgeRole = $("badgeRole");
const sceneTitle = $("sceneTitle");
const lineEn = $("lineEn");
const lineZh = $("lineZh");
const youSaid = $("youSaid");
const toast = $("toast");
const avatarVideo = $("avatarVideo");
const avatarFallback = $("avatarFallback");

let currentSceneId = null;
let currentTeacherId = null;
let steps = [];
let stepIdx = 0;
let currentExpected = "";
let isSpeaking = false;
let recognition = null;

function qs() {
  const p = new URLSearchParams(location.search);
  return {
    scene: p.get("scene") || "",
    teacher: p.get("teacher") || "",
  };
}
function setQS(key, val) {
  const u = new URL(location.href);
  if (val) u.searchParams.set(key, val); else u.searchParams.delete(key);
  history.replaceState(null, "", u.toString());
}

function toastMsg(msg) {
  toast.textContent = msg;
  toast.style.display = "block";
  clearTimeout(toast._t);
  toast._t = setTimeout(()=>toast.style.display="none", 1600);
}

function normalize(s) {
  return (s||"")
    .toLowerCase()
    .replace(/['â€™]/g,"")
    .replace(/[^a-z0-9\s]/g," ")
    .replace(/\s+/g," ")
    .trim();
}
function scoreSimilarity(user, expected) {
  const u = normalize(user);
  const e = normalize(expected);
  if (!u || !e) return 0;
  if (u === e) return 1;
  // token overlap (lenient)
  const ut = new Set(u.split(" "));
  const et = e.split(" ");
  let hit = 0;
  for (const t of et) if (ut.has(t)) hit++;
  return hit / Math.max(et.length, 1);
}

function stopAllSpeech() {
  try { speechSynthesis.cancel(); } catch(e){}
}

function setAvatarSourceForTeacher(keyOrObj){
  // keyOrObj can be teacher id string (e.g. "pineapple") or a teacher object from TEACHERS
  let t = null;
  if (typeof keyOrObj === "string") {
    t = TEACHERS.find(x => x && (x.key === keyOrObj)) || null;
  } else if (keyOrObj && typeof keyOrObj === "object") {
    t = keyOrObj;
  }
  if (!t) t = TEACHERS[0];

  // Store current teacher
  APP.teacher = t.key;

  // Header / badge
  const badge = $("#badgeRole");
  if (badge) badge.textContent = "AI Â· " + (t.name || t.key);

  const chip = $("#teacherChip");
  if (chip) chip.textContent = "è€å¸«ï¼š " + (t.name || t.key);

  // Avatar: prefer video, fallback to image
  const v = $("#avatarVideo");
  const img = $("#avatarImg");
  if (img) img.src = t.idle_png_url || "";

  if (v) {
    try {
      v.pause();
      v.removeAttribute("src");
      v.load();
      v.src = t.talk_video_url || "";
      v.load();

      // default: stay at first frame (idle)
      const onMeta = () => {
        try { v.currentTime = 0; } catch(e) {}
        v.pause();
      };
      v.addEventListener("loadedmetadata", onMeta, { once: true });

      // if video errors, show image
      v.onerror = () => {
        v.style.display = "none";
        if (img) img.style.display = "block";
      };
      v.onloadeddata = () => {
        v.style.display = "block";
        if (img) img.style.display = img.src ? "none" : "block";
      };
    } catch (e) {
      // ignore
    }
  }
}

function avatarSpeakStop() {
  // åœæ­¢ï¼šå›åˆ°ç¬¬ä¸€å¹€ç­‰å¾…
  try {
    avatarVideo.pause();
    avatarVideo.currentTime = 0.01;
    avatarVideo.pause();
  } catch (e) {}
}

function speakTTS(text, onDone) {
  stopAllSpeech();
  if (!("speechSynthesis" in window)) {
    toastMsg("æ­¤ç€è¦½å™¨ä¸æ”¯æ´ TTS");
    onDone && onDone();
    return;
  }
  const u = new SpeechSynthesisUtterance(text);
  u.lang = "en-US";
  u.rate = 0.95;
  u.pitch = 1.0;
  u.onstart = async () => {
    isSpeaking = true;
    await avatarSpeakStart();
  };
  u.onend = () => {
    isSpeaking = false;
    avatarSpeakStop();
    onDone && onDone();
  };
  u.onerror = () => {
    isSpeaking = false;
    avatarSpeakStop();
    onDone && onDone();
  };
  speechSynthesis.speak(u);
}

function buildSelectors() {
  // scene selector from index items
  const items = DATA.index.items || [];
  sceneSel.innerHTML = "";
  for (const it of items) {
    const opt = document.createElement("option");
    opt.value = it.id;
    opt.textContent = `${it.title_zh} | ${it.title_en} (${it.level})`;
    sceneSel.appendChild(opt);
  }

  teacherSel.innerHTML = "";
  for (const t of TEACHERS) {
    const opt = document.createElement("option");
    opt.value = t.id;
    opt.textContent = `è€å¸«ï¼š${t.name}`;
    teacherSel.appendChild(opt);
  }
}

function loadScene(sceneId) {
  const s = DATA.scenes[sceneId];
  if (!s) {
    toastMsg("æ‰¾ä¸åˆ°æƒ…å¢ƒï¼š" + sceneId);
    return;
  }
  currentSceneId = sceneId;
  setQS("scene", sceneId);

  steps = s.dialogue || [];
  stepIdx = 0;

  badgeRole.textContent = `AI Â· ${ (typeof s.role==="string" ? s.role : (s.role && (s.role.label||s.role.id)) ) || "teacher"}`;
  sceneTitle.textContent = `${s.title_zh} | ${s.title_en} (${s.level})`;
  nextStep(true);
}

function selectTeacher(teacherId) {
  const t = TEACHERS.find(x=>x.id===teacherId) || TEACHERS[0];
  currentTeacherId = t.id;
  teacherSel.value = t.id;
  setQS("teacher", t.id);
  setAvatarSourceForTeacher(t);
}

function nextStep(fromAI=false) {
  youSaid.textContent = "";
  if (stepIdx >= steps.length) {
    lineEn.textContent = "âœ… Finished!";
    lineZh.textContent = "å®Œæˆï¼å¯ä»¥æ›æƒ…å¢ƒæˆ–é‡æ’­ã€‚";
    currentExpected = "";
    return;
  }
  const step = steps[stepIdx];

  if (step.speaker === "AI") {
    lineEn.textContent = step.en || "";
    lineZh.textContent = step.zh || "";
    currentExpected = "";
    // auto speak then advance
    speakTTS(step.en || "", ()=>{ stepIdx++; nextStep(true); });
  } else {
    // USER
    const expected = step.hint_en || step.en || "";
    currentExpected = expected;
    lineEn.textContent = "Try: " + expected;
    lineZh.textContent = step.hint_zh || step.zh || "";
  }
}

function passUser(text, forced=false) {
  const expected = currentExpected || "";
  youSaid.textContent = "ä½ èªªï¼š" + (text || "");
  if (forced) {
    toastMsg("å·²è·³é");
    stepIdx++;
    nextStep();
    return;
  }
  const score = scoreSimilarity(text, expected);
  if (score >= 0.62) {
    toastMsg("OK âœ”");
    stepIdx++;
    nextStep();
  } else {
    toastMsg("å†è©¦ä¸€æ¬¡ï¼ˆå¯æ…¢æ…¢èªªï¼Œæˆ–ç”¨è¼¸å…¥ï¼‰");
  }
}

function ensureRecognition() {
  const SR = window.SpeechRecognition || window.webkitSpeechRecognition;
  if (!SR) return null;
  const r = new SR();
  r.lang = "en-US";
  r.interimResults = false;
  r.maxAlternatives = 3;
  return r;
}

$("btnSpeak").onclick = () => {
  if (isSpeaking) stopAllSpeech();
  if (!currentExpected) {
    toastMsg("ç¾åœ¨ä¸æ˜¯ä½ å›ç­”çš„å›åˆ");
    return;
  }
  if (!recognition) recognition = ensureRecognition();
  if (!recognition) {
    toastMsg("æ­¤ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜ï¼Œè«‹ç”¨è¼¸å…¥");
    return;
  }
  try {
    recognition.abort();
  } catch(e){}
  recognition.onresult = (ev) => {
    const text = ev.results && ev.results[0] && ev.results[0][0] ? ev.results[0][0].transcript : "";
    passUser(text, false);
  };
  recognition.onerror = () => toastMsg("è¾¨è­˜å¤±æ•—ï¼Œè«‹å†è©¦ä¸€æ¬¡æˆ–æ”¹è¼¸å…¥");
  recognition.onend = ()=>{};
  try {
    recognition.start();
  } catch(e) {
    toastMsg("ç„¡æ³•å•Ÿå‹•éº¥å…‹é¢¨ï¼ˆè«‹ç¢ºèªæ¬Šé™ï¼‰");
  }
};

$("btnType").onclick = () => {
  if (!currentExpected) {
    toastMsg("ç¾åœ¨ä¸æ˜¯ä½ å›ç­”çš„å›åˆ");
    return;
  }
  const ans = prompt("è«‹è¼¸å…¥ä½ è¦å›ç­”çš„è‹±æ–‡ï¼š");
  if (ans == null) return;
  passUser(ans, false);
};

$("btnSkip").onclick = () => {
  if (!currentExpected) {
    // allow skipping AI line
    stopAllSpeech();
    avatarSpeakStop();
    stepIdx++;
    nextStep();
    return;
  }
  passUser("(skip)", true);
};

$("btnReplay").onclick = () => {
  const step = steps[stepIdx];
  if (step && step.speaker === "AI") {
    speakTTS(step.en || "", ()=>{});
  } else {
    // replay last AI line
    const prev = steps[stepIdx-1];
    if (prev && prev.speaker==="AI") speakTTS(prev.en||"", ()=>{});
    else toastMsg("æ²’æœ‰å¯é‡æ’­çš„å¥å­");
  }
};

$("btnBack").onclick = () => history.back();

sceneSel.onchange = () => loadScene(sceneSel.value);
teacherSel.onchange = () => selectTeacher(teacherSel.value);

// init
buildSelectors();
const q = qs();
const firstScene = (q.scene && DATA.scenes[q.scene]) ? q.scene : (DATA.index.items[0]?.id || "coffee_shop");
sceneSel.value = firstScene;
loadScene(firstScene);

const DEFAULT_TEACHER_ID = "pineapple";
const firstTeacher = TEACHERS.some(t=>t.id===q.teacher)
  ? q.teacher
  : (TEACHERS.some(t=>t.id===DEFAULT_TEACHER_ID) ? DEFAULT_TEACHER_ID : TEACHERS[0].id);
selectTeacher(firstTeacher);
</script>
</body>
</html>
