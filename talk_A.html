<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>口說練習 Talk｜BookWide</title>
  <meta name="description" content="BookWide Talk — 口說練習、AI 對話、即時糾錯。" />
  <style>
    :root{--bg:#f4f6fb;--card:#fff;--ink:#0f172a;--muted:#64748b;--line:#e5e7eb;
      --brand:#2563eb;--soft:#eef2ff;--radius:18px;--shadow:0 14px 40px rgba(15,23,42,.1);}
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);font-family:system-ui,-apple-system,"Segoe UI";}
    .topbar{display:flex;justify-content:space-between;padding:14px 18px;background:#0b1220;color:#fff}
    .pill{border:1px solid rgba(255,255,255,.3);padding:6px 12px;border-radius:999px}
    .wrap{max-width:1100px;margin:20px auto;padding:0 14px}
    .grid{display:grid;gap:14px}
    @media(min-width:900px){.grid{grid-template-columns:420px 1fr}}
    .card{background:#fff;border:1px solid var(--line);border-radius:var(--radius);box-shadow:var(--shadow)}
    .hd{padding:14px;border-bottom:1px solid var(--line);font-weight:800}
    .bd{padding:14px}
    textarea,select{width:100%;padding:10px;border-radius:12px;border:1px solid var(--line)}
    button{padding:10px 14px;border-radius:12px;border:0;background:var(--brand);color:#fff;font-weight:700;cursor:pointer}
    .chat{display:flex;flex-direction:column;gap:10px}
    .msg{border:1px solid var(--line);border-radius:14px;padding:10px}
    .ai{background:var(--soft)}
    .muted{color:var(--muted);font-size:13px}
  </style>
</head>
<body>
<header class="topbar">
  <div>BookWide · Talk</div>
  <div style="display:flex;gap:10px">
    <span id="userPill" class="pill">未登入</span>
    <a href="/index.html" class="pill" style="color:#fff;text-decoration:none">回首頁</a>
  </div>
</header>

<div class="wrap">
  <div class="grid">
    <section class="card">
      <div class="hd">設定</div>
      <div class="bd">
        <label class="muted">語言</label>
        <select id="lang"><option value="en">英文</option><option value="ja">日文</option></select>
        <br><br>
        <button id="start">開始練習</button>
      </div>
    </section>

    <section class="card">
      <div class="hd">對話</div>
      <div class="bd">
        <div id="chat" class="chat"></div><br>
        <textarea id="input" placeholder="說一句…"></textarea><br><br>
        <button id="send">送出</button>
      </div>
    </section>
  </div>
</div>

<script type="module">
  import { supabase } from './supa.js';

  const userPill = document.getElementById('userPill');
  const chat = document.getElementById('chat');
  const input = document.getElementById('input');

  function add(text, ai=false){
    const d=document.createElement('div');
    d.className='msg'+(ai?' ai':'');
    d.textContent=text;
    chat.appendChild(d);
    chat.scrollTop=chat.scrollHeight;
  }

  async function guard(){
    const { data:{ session } } = await supabase.auth.getSession();
    if(!session?.user){
      location.href='/index.html#login';
      return false;
    }
    userPill.textContent=session.user.email;
    return true;
  }

  document.getElementById('start').onclick=async()=>{
    if(await guard()) add('AI：Say one sentence.',true);
  };

  document.getElementById('send').onclick=()=>{
    const t=input.value.trim();
    if(!t) return;
    add('你：'+t);
    add('AI：Good. Try again, shorter.',true);
    input.value='';
  };

  guard();
</script>
</body>
</html>
