<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Talkï½œå½±åƒå£èªª MVPï½œBookWide</title>
<style>
:root{
  --bg:#f4f6fb; --card:#fff; --ink:#0f172a; --muted:#64748b; --line:#e5e7eb;
  --brand:#2563eb; --brand2:#1d4ed8; --soft:#eef2ff; --ok:#16a34a; --warn:#ef4444;
  --radius:18px; --shadow:0 14px 40px rgba(15,23,42,.08);
}
*{box-sizing:border-box}
html,body{margin:0;background:var(--bg);color:var(--ink);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif}
a{color:inherit;text-decoration:none}
.topbar{
  height:64px;display:flex;align-items:center;justify-content:space-between;
  padding:0 18px;background:linear-gradient(180deg,#0b1220,#0b1220 60%,rgba(11,18,32,.94));
  color:#fff; position:sticky; top:0; z-index:10;
}
.brand{display:flex;align-items:center;gap:10px;font-weight:800;font-size:26px;letter-spacing:.2px}
.badge{font-size:12px;padding:4px 10px;border-radius:999px;background:rgba(255,255,255,.10);border:1px solid rgba(255,255,255,.16)}
.rightBtns{display:flex;align-items:center;gap:10px}
.pill{padding:8px 12px;border-radius:999px;background:rgba(255,255,255,.10);border:1px solid rgba(255,255,255,.16);font-size:13px}

.wrap{max-width:1180px;margin:22px auto;padding:0 16px;display:grid;grid-template-columns: 420px 1fr;gap:18px}
.card{background:var(--card);border-radius:var(--radius);box-shadow:var(--shadow);border:1px solid rgba(148,163,184,.25)}
.cardHd{padding:16px 18px;border-bottom:1px solid var(--line);display:flex;align-items:center;justify-content:space-between;gap:12px}
.cardHd h2{margin:0;font-size:16px}
.sub{font-size:12px;color:var(--muted);margin-top:2px}
.cardBd{padding:16px 18px}
.row{display:grid;grid-template-columns:1fr 1fr;gap:10px}
.field label{display:block;font-size:12px;color:var(--muted);margin:0 0 6px}
select,textarea,input{
  width:100%;padding:10px 12px;border-radius:12px;border:1px solid rgba(148,163,184,.35);
  outline:none;background:#fff;color:var(--ink)
}
textarea{min-height:78px;resize:vertical}
.hr{height:1px;background:var(--line);margin:14px 0}
.statusPills{display:flex;gap:8px;flex-wrap:wrap}
.st{font-size:12px;border-radius:999px;padding:6px 10px;border:1px solid rgba(148,163,184,.35);background:#fff}
.st.ok{border-color:rgba(34,197,94,.35);background:rgba(34,197,94,.10);color:#14532d}
.st.bad{border-color:rgba(239,68,68,.35);background:rgba(239,68,68,.10);color:#7f1d1d}
.btns{display:flex;gap:10px;flex-wrap:wrap;margin-top:12px}
button{
  border:0;border-radius:14px;padding:10px 14px;font-weight:700;cursor:pointer;
}
.primary{background:var(--brand);color:#fff}
.ghost{background:#fff;border:1px solid rgba(148,163,184,.35);color:var(--ink)}
.danger{background:#fff;border:1px solid rgba(239,68,68,.45);color:#991b1b}
.small{padding:8px 10px;border-radius:12px;font-weight:700;font-size:12px}

.videoBox{
  background:#0b1220;border-radius:16px;overflow:hidden;border:1px solid rgba(148,163,184,.25);
  aspect-ratio: 4/3; display:grid; place-items:center;
}
video{width:100%;height:100%;object-fit:cover}
.hint{font-size:12px;color:var(--muted);margin-top:8px}

.chat{padding:0}
.chatHdLeft{display:flex;align-items:center;gap:10px}
.ai-avatar-wrap{display:flex;align-items:center;gap:10px}
.ai-avatar{width:44px;height:44px;border-radius:14px;background:#0b1220;display:grid;place-items:center;box-shadow:0 10px 26px rgba(15,23,42,.18);border:1px solid rgba(148,163,184,.25)}
.ai-face{width:30px;height:30px;position:relative}
.ai-eye{position:absolute;top:7px;width:6px;height:6px;border-radius:50%;background:#e2e8f0;opacity:.95}
.ai-eye.left{left:6px}
.ai-eye.right{right:6px}
.ai-mouth{position:absolute;left:50%;bottom:6px;transform:translateX(-50%);width:14px;height:6px;border-radius:0 0 10px 10px;border:2px solid #e2e8f0;border-top:0;opacity:.95}
.ai-avatar.talking .ai-mouth{height:10px;width:16px;border-radius:10px;background:#e2e8f0;border:0;opacity:.95;animation:mouth 140ms infinite alternate}
@keyframes mouth{from{transform:translateX(-50%) scaleY(.7)}to{transform:translateX(-50%) scaleY(1.2)}}

.feed{padding:16px 18px;max-height: calc(100vh - 140px);overflow:auto}
.msg{border:1px solid rgba(148,163,184,.25);border-radius:16px;padding:12px 12px;margin:10px 0;background:#fff}
.msg .meta{display:flex;justify-content:space-between;align-items:center;color:var(--muted);font-size:12px;margin-bottom:6px}
.msg.ai{background:rgba(37,99,235,.06);border-color:rgba(37,99,235,.18)}
.badgeOk{display:inline-flex;align-items:center;gap:8px;border-radius:14px;padding:10px 12px;border:1px solid rgba(34,197,94,.25);background:rgba(34,197,94,.08);margin:10px 0}
.badgeOk b{color:#14532d}
.actions{display:flex;gap:10px;flex-wrap:wrap;margin-top:8px}
.actions button{border-radius:12px}
.note{color:var(--muted);font-size:12px;margin-top:6px}

@media (max-width: 980px){
  .wrap{grid-template-columns:1fr}
  .feed{max-height:unset}
}
</style>
</head>
<body>

<div class="topbar">
  <div class="brand">BookWide <span class="badge">Talkï½œå½±åƒå£èªª MVP</span></div>
  <div class="rightBtns">
    <span class="pill" id="loginPill">å…ˆèƒ½ç©ï¼šä¸æ¥å¾Œç«¯</span>
    <a class="pill" href="/index.html">å›é¦–é </a>
  </div>
</div>

<div class="wrap">
  <!-- Left -->
  <div class="card">
    <div class="cardHd">
      <div>
        <h2>å£èªªç·´ç¿’è¨­å®š</h2>
        <div class="sub">MVPï¼šç›¸æ©Ÿç•«é¢ + æŒ‰ä½èªªè©±ï¼ˆèªéŸ³è¾¨è­˜ï¼‰+ AI ç«‹åˆ»ç³¾éŒ¯ï¼ˆæœ¬æ©Ÿè¦å‰‡ï¼‰</div>
      </div>
    </div>
    <div class="cardBd">
      <div class="row">
        <div class="field">
          <label>æƒ…å¢ƒ</label>
          <select id="sceneSel">
            <option value="nails" data-zh="å¡—æŒ‡ç”²" data-en="nails" data-ja="ãƒã‚¤ãƒ«">å¡—æŒ‡ç”² nails</option>
            <option value="makeup" data-zh="åŒ–å¦" data-en="makeup" data-ja="ãƒ¡ã‚¤ã‚¯">åŒ–å¦ makeup</option>
            <option value="cooking" data-zh="åšèœ" data-en="cooking" data-ja="æ–™ç†">åšèœ cooking</option>
            <option value="coffee" data-zh="å–å’–å•¡" data-en="coffee" data-ja="ã‚³ãƒ¼ãƒ’ãƒ¼">å–å’–å•¡ coffee</option>
            <option value="shopping" data-zh="è³¼ç‰©" data-en="shopping" data-ja="è²·ã„ç‰©">è³¼ç‰© shopping</option>
            <option value="gym" data-zh="å¥èº«" data-en="gym" data-ja="ã‚¸ãƒ ">å¥èº« gym</option>
            <option value="cleaning" data-zh="æ‰“æƒ" data-en="cleaning" data-ja="æƒé™¤">æ‰“æƒ cleaning</option>
          </select>
        </div>
        <div class="field">
          <label>èªè¨€</label>
          <select id="langSel">
            <option value="en">è‹±æ–‡ (EN)</option>
            <option value="zh">ä¸­æ–‡æç¤º (ZH)</option>
            <option value="ja">æ—¥æ–‡æç¤º (JA)</option>
          </select>
        </div>
      </div>

      <div class="hr"></div>

      <div class="field">
        <label>æç¤ºï¼ˆå¯é¸ï¼‰</label>
        <textarea id="coachHint" placeholder="ä¾‹å¦‚ï¼šç”¨ç°¡å–®å¥ã€æ…¢æ…¢èªªã€‚å…ˆèªª 1 å¥å°±å¥½ã€‚"></textarea>
      </div>

      <div class="hr"></div>

      <div class="statusPills">
        <span class="st" id="stCam">ç›¸æ©Ÿï¼šæœªé–‹</span>
        <span class="st" id="stMic">éº¥å…‹é¢¨ï¼šæœªç”¨</span>
        <span class="st" id="stRec">è¾¨è­˜ï¼šå¾…å‘½</span>
      </div>

      <div style="margin-top:12px" class="videoBox">
        <video id="cam" autoplay playsinline muted></video>
      </div>

      <div class="btns">
        <button class="ghost" id="btnCam">é–‹å•Ÿç›¸æ©Ÿ</button>
        <button class="ghost" id="btnSnap">æ‹ä¸€å¼µï¼ˆåªé¡¯ç¤ºï¼Œä¸é€å‡ºï¼‰</button>
        <button class="danger" id="btnClear">æ¸…ç©ºå°è©±</button>
      </div>

      <div class="hr"></div>

      <div class="btns">
        <button class="primary" id="btnHold">æŒ‰ä½èªªè©±</button>
        <button class="ghost" id="btnSendText">é€å‡ºæ–‡å­—</button>
      </div>

      <div class="hint" id="hintText">Chrome / Edge æ”¯æ´èªéŸ³è¾¨è­˜ã€‚è‹¥å¤±æ•—å¯ç”¨ã€Œé€å‡ºæ–‡å­—ã€ã€‚</div>
      <div style="margin-top:10px" class="field">
        <label>ä½ çš„å¥å­ï¼ˆèªéŸ³çµæœ / æ‰‹æ‰“ï¼‰</label>
        <input id="userText" placeholder="ä¾‹å¦‚ï¼šI'm cooking dinner."/>
      </div>
    </div>
  </div>

  <!-- Right -->
  <div class="card chat">
    <div class="cardHd">
      <div class="chatHdLeft">
        <div class="ai-avatar-wrap">
          <div class="ai-avatar" id="aiAvatar" title="AI è™›æ“¬é ­åƒï¼ˆæœ—è®€æ™‚æœƒå‹•å˜´ï¼‰">
            <div class="ai-face">
              <span class="ai-eye left"></span><span class="ai-eye right"></span><span class="ai-mouth"></span>
            </div>
          </div>
          <div>
            <h2 style="margin:0">AI å³æ™‚ç³¾éŒ¯</h2>
            <div class="sub" id="subTitle">ä½ èªªä¸€å¥ â†’ æˆ‘çµ¦æ›´è‡ªç„¶ç‰ˆæœ¬ + ä¸€å€‹é‡é» + è·Ÿè®€ã€‚</div>
          </div>
        </div>
      </div>
      <button class="ghost small" id="btnAvatar">é¡¯ç¤ºé ­åƒ</button>
    </div>
    <div class="feed" id="feed"></div>
  </div>
</div>

<script>
/* ========= 1) Scene data (æœ¬æ©Ÿè¦å‰‡ï¼šå…ˆèƒ½ç©) ========= */
const SCENES = {
  nails: {
    q: {en:"What are you doing?", zh:"ä½ åœ¨åšä»€éº¼ï¼Ÿ", ja:"ä½•ã‚’ã—ã¦ã„ã‚‹ã®ï¼Ÿ"},
    good: ["I'm doing my nails.","I'm painting my nails.","I'm getting a manicure."],
    tips: {en:"Use: I'm doing my nails.", zh:"å¸¸ç”¨ï¼šI'm doing my nails.", ja:"å®šç•ªï¼šI'm doing my nails."},
    fix(user){
      // common errors: "I am nail", "I'm do nails"
      return "I'm doing my nails.";
    }
  },
  makeup: {
    q:{en:"What are you doing?", zh:"ä½ åœ¨åšä»€éº¼ï¼Ÿ", ja:"ä½•ã‚’ã—ã¦ã„ã‚‹ã®ï¼Ÿ"},
    good:["I'm doing my makeup.","I'm putting on makeup."],
    tips:{en:"Use: I'm doing my makeup.", zh:"å¸¸ç”¨ï¼šI'm doing my makeup.", ja:"å®šç•ªï¼šI'm doing my makeup."},
    fix(){ return "I'm doing my makeup."; }
  },
  cooking: {
    q:{en:"What are you doing?", zh:"ä½ åœ¨åšä»€éº¼ï¼Ÿ", ja:"ä½•ã‚’ã—ã¦ã„ã‚‹ã®ï¼Ÿ"},
    good:["I'm cooking dinner.","I'm making a meal.","I'm preparing dinner."],
    tips:{en:"Add object: I'm cooking dinner.", zh:"åŠ å—è©ï¼šI'm cooking dinner.", ja:"ç›®çš„èªï¼šI'm cooking dinner."},
    fix(){ return "I'm cooking dinner."; }
  },
  coffee: {
    q:{en:"What are you doing?", zh:"ä½ åœ¨åšä»€éº¼ï¼Ÿ", ja:"ä½•ã‚’ã—ã¦ã„ã‚‹ã®ï¼Ÿ"},
    good:["I'm making coffee.","I'm having coffee.","I'm grabbing a coffee."],
    tips:{en:"Try: I'm having coffee.", zh:"å¯èªªï¼šI'm having coffee.", ja:"ä¾‹ï¼šI'm having coffee."},
    fix(){ return "I'm having coffee."; }
  },
  shopping: {
    q:{en:"What are you doing?", zh:"ä½ åœ¨åšä»€éº¼ï¼Ÿ", ja:"ä½•ã‚’ã—ã¦ã„ã‚‹ã®ï¼Ÿ"},
    good:["I'm shopping.","I'm looking for clothes.","I'm buying groceries."],
    tips:{en:"Simple: I'm shopping.", zh:"ç°¡å–®ï¼šI'm shopping.", ja:"ç°¡å˜ï¼šI'm shopping."},
    fix(){ return "I'm shopping."; }
  },
  gym: {
    q:{en:"What are you doing?", zh:"ä½ åœ¨åšä»€éº¼ï¼Ÿ", ja:"ä½•ã‚’ã—ã¦ã„ã‚‹ã®ï¼Ÿ"},
    good:["I'm working out.","I'm at the gym.","I'm exercising."],
    tips:{en:"Natural: I'm working out.", zh:"è‡ªç„¶ï¼šI'm working out.", ja:"è‡ªç„¶ï¼šI'm working out."},
    fix(){ return "I'm working out."; }
  },
  cleaning: {
    q:{en:"What are you doing?", zh:"ä½ åœ¨åšä»€éº¼ï¼Ÿ", ja:"ä½•ã‚’ã—ã¦ã„ã‚‹ã®ï¼Ÿ"},
    good:["I'm cleaning the house.","I'm doing some cleaning.","I'm tidying up."],
    tips:{en:"Use: I'm tidying up.", zh:"å¯èªªï¼šI'm tidying up.", ja:"ä¾‹ï¼šI'm tidying up."},
    fix(){ return "I'm tidying up."; }
  }
};

function nowHHMM(){
  const d=new Date();
  return d.toLocaleTimeString('zh-TW',{hour:'2-digit',minute:'2-digit'});
}

/* ========= 2) UI helpers ========= */
const feed = document.getElementById('feed');
const sceneSel = document.getElementById('sceneSel');
const langSel  = document.getElementById('langSel');
const userText = document.getElementById('userText');
const coachHint = document.getElementById('coachHint');

const stCam=document.getElementById('stCam');
const stMic=document.getElementById('stMic');
const stRec=document.getElementById('stRec');

const aiAvatar=document.getElementById('aiAvatar');
const btnAvatar=document.getElementById('btnAvatar');

function addMsg(role, text, extraHtml=''){
  const div=document.createElement('div');
  div.className = 'msg ' + (role==='ai'?'ai':'');
  div.innerHTML = `
    <div class="meta">
      <div><b>${role==='ai'?'AI':'ä½ èªª'}</b></div>
      <div>${nowHHMM()}</div>
    </div>
    <div class="body">${escapeHtml(text).replace(/\n/g,'<br>')}</div>
    ${extraHtml}
  `;
  feed.appendChild(div);
  feed.scrollTop = feed.scrollHeight;
}

function escapeHtml(s){
  return (s||'').replace(/[&<>"']/g, m=>({ '&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;' }[m]));
}

function setPill(el, ok, text){
  el.className = 'st' + (ok?' ok':'');
  el.textContent = text;
}

function updateSceneLabels(){
  const lang = langSel.value;
  [...sceneSel.options].forEach(opt=>{
    const zh = opt.dataset.zh || opt.textContent;
    const en = opt.dataset.en || opt.value;
    const ja = opt.dataset.ja || opt.value;
    if(lang==='en') opt.textContent = en;
    else if(lang==='ja') opt.textContent = ja;
    else opt.textContent = zh + ' ' + en;
  });
}

/* ========= 3) Camera ========= */
let camStream=null;
async function startCam(){
  try{
    camStream = await navigator.mediaDevices.getUserMedia({video:true,audio:false});
    document.getElementById('cam').srcObject = camStream;
    stCam.classList.add('ok'); stCam.textContent='ç›¸æ©Ÿï¼šå·²é–‹';
  }catch(e){
    stCam.classList.add('bad'); stCam.textContent='ç›¸æ©Ÿï¼šå¤±æ•—';
    addMsg('ai', 'ç›¸æ©Ÿå•Ÿç”¨å¤±æ•—ï¼š'+(e?.message||e));
  }
}
document.getElementById('btnCam').addEventListener('click', startCam);

document.getElementById('btnSnap').addEventListener('click', ()=>{
  // MVP: åªæ‹ç…§é¡¯ç¤ºç”¨ï¼ˆä¸é€å‡ºï¼‰
  const v=document.getElementById('cam');
  if(!v.srcObject){ addMsg('ai','è«‹å…ˆé–‹å•Ÿç›¸æ©Ÿã€‚'); return; }
  const c=document.createElement('canvas');
  c.width=v.videoWidth||640; c.height=v.videoHeight||480;
  const ctx=c.getContext('2d');
  ctx.drawImage(v,0,0,c.width,c.height);
  const url=c.toDataURL('image/jpeg',0.85);
  addMsg('ai','ğŸ“¸ Snapshotï¼ˆåªé¡¯ç¤ºï¼Œä¸é€å‡ºï¼‰', `<div class="note"><img src="${url}" style="max-width:100%;border-radius:14px;border:1px solid rgba(148,163,184,.25)"/></div>`);
});

/* ========= 4) Speech Recognition (press & hold) ========= */
const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;
let rec=null;
let holding=false;

function initRec(){
  if(!SpeechRecognition){ stRec.classList.add('bad'); stRec.textContent='è¾¨è­˜ï¼šä¸æ”¯æ´'; return; }
  rec = new SpeechRecognition();
  rec.continuous = false;
  rec.interimResults = true;
  rec.lang = 'en-US';

  rec.onstart = ()=>{ stMic.classList.add('ok'); stMic.textContent='éº¥å…‹é¢¨ï¼šå¯ç”¨'; stRec.classList.add('ok'); stRec.textContent='è¾¨è­˜ï¼šä¸­'; };
  rec.onerror = (e)=>{ stRec.classList.add('bad'); stRec.textContent='è¾¨è­˜ï¼šéŒ¯èª¤'; addMsg('ai','èªéŸ³è¾¨è­˜éŒ¯èª¤ï¼š'+(e?.error||'')); };
  rec.onend = ()=>{ stRec.textContent='è¾¨è­˜ï¼šå¾…å‘½'; };
  rec.onresult = (ev)=>{
    let finalText='';
    let interim='';
    for(let i=ev.resultIndex;i<ev.results.length;i++){
      const r=ev.results[i];
      if(r.isFinal) finalText += r[0].transcript;
      else interim += r[0].transcript;
    }
    userText.value = (finalText || interim || '').trim();
    if(finalText && holding){
      holding=false;
      analyzeAndReply(finalText.trim());
    }
  };
}

function holdStart(){
  if(!rec) initRec();
  if(!rec){ addMsg('ai','é€™ç€è¦½å™¨ä¸æ”¯æ´èªéŸ³è¾¨è­˜ï¼Œè«‹æ”¹ç”¨ã€Œé€å‡ºæ–‡å­—ã€ã€‚'); return; }
  holding=true;
  rec.lang = (langSel.value==='ja') ? 'ja-JP' : (langSel.value==='zh' ? 'zh-TW' : 'en-US');
  try{ rec.start(); }catch(e){}
}
function holdEnd(){
  holding=false;
  try{ rec && rec.stop(); }catch(e){}
}

const btnHold=document.getElementById('btnHold');
btnHold.addEventListener('mousedown', holdStart);
btnHold.addEventListener('mouseup', holdEnd);
btnHold.addEventListener('mouseleave', holdEnd);
btnHold.addEventListener('touchstart', (e)=>{ e.preventDefault(); holdStart(); }, {passive:false});
btnHold.addEventListener('touchend', (e)=>{ e.preventDefault(); holdEnd(); }, {passive:false});

document.getElementById('btnSendText').addEventListener('click', ()=>{
  const t=userText.value.trim();
  if(!t) return;
  analyzeAndReply(t);
});

/* ========= 5) Local â€œAIâ€ reply + TTS ========= */
function speak(text){
  if(!('speechSynthesis' in window)) return;
  window.speechSynthesis.cancel();
  const u=new SpeechSynthesisUtterance(text);
  // voice pick (best-effort)
  const want = langSel.value==='ja' ? 'ja' : (langSel.value==='zh' ? 'zh' : 'en');
  const voices = window.speechSynthesis.getVoices?.() || [];
  const v = voices.find(x=> (x.lang||'').toLowerCase().startsWith(want));
  if(v) u.voice = v;
  u.rate = 1.0;

  u.onstart = ()=> aiAvatar.classList.add('talking');
  u.onend = ()=> aiAvatar.classList.remove('talking');
  u.onerror = ()=> aiAvatar.classList.remove('talking');

  window.speechSynthesis.speak(u);
}

function analyzeAndReply(user){
  const scene = sceneSel.value;
  const lang = langSel.value;
  const cfg = SCENES[scene] || SCENES.cooking;

  addMsg('user', user);

  // core: question + correction
  const q = cfg.q[lang] || cfg.q.en;
  const corrected = cfg.fix(user);
  const tip = cfg.tips[lang] || cfg.tips.en;

  const extra = `
    <div class="badgeOk">
      <span>âœ…</span>
      <div>
        <b>${lang==='en'?'Very close! Say it like this:':(lang==='ja'?'ã„ã„æ„Ÿã˜ï¼ã“ã†è¨€ã†ã¨è‡ªç„¶ï¼š':'å¾ˆæ¥è¿‘ï¼ä½ å¯ä»¥é€™æ¨£æ›´è‡ªç„¶ï¼š')}</b>
        <div style="margin-top:6px"><span style="font-weight:800">${escapeHtml(corrected)}</span>
          <span class="note">(${escapeHtml(tip)})</span>
        </div>
        <div class="actions">
          <button class="primary small" data-act="speak" data-text="${escapeHtml(corrected)}">ğŸ”Š è·Ÿè®€</button>
          <button class="ghost small" data-act="copy" data-text="${escapeHtml(corrected)}">ğŸ“‹ è¤‡è£½æ­£ç¢ºå¥</button>
        </div>
      </div>
    </div>
    <div class="note">${escapeHtml(q)}</div>
  `;

  addMsg('ai', (lang==='en'?'Got it. Try this:':(lang==='ja'?'OKã€‚ã“ã‚Œã‚’è©¦ã—ã¦ï¼š':'æ”¶åˆ°ã€‚è©¦è©¦çœ‹ï¼š')), extra);
}

feed.addEventListener('click', (e)=>{
  const btn=e.target.closest('button');
  if(!btn) return;
  const act=btn.dataset.act;
  const text=btn.dataset.text || '';
  if(act==='copy'){
    navigator.clipboard?.writeText(text).then(()=>{
      btn.textContent='âœ… å·²è¤‡è£½';
      setTimeout(()=>btn.textContent='ğŸ“‹ è¤‡è£½æ­£ç¢ºå¥',900);
    }).catch(()=>{});
  }else if(act==='speak'){
    speak(text);
  }
});

document.getElementById('btnClear').addEventListener('click', ()=>{
  feed.innerHTML='';
  addMsg('ai','æ­¡è¿ä¾†åˆ° BookWide Talkï¼ˆMVPï¼‰ã€‚æŒ‰ã€Œé–‹å•Ÿç›¸æ©Ÿã€ï¼Œå†æŒ‰ä½èªªä¸€å¥è‹±æ–‡ã€‚');
});

/* ========= 6) Avatar toggle ========= */
let avatarVisible=true;
btnAvatar.addEventListener('click', ()=>{
  avatarVisible = !avatarVisible;
  aiAvatar.style.display = avatarVisible ? 'grid' : 'none';
  btnAvatar.textContent = avatarVisible ? 'éš±è—é ­åƒ' : 'é¡¯ç¤ºé ­åƒ';
});

/* ========= init ========= */
updateSceneLabels();
langSel.addEventListener('change', updateSceneLabels);
addMsg('ai','æ­¡è¿ä¾†åˆ° BookWide Talkï¼ˆMVPï¼‰ã€‚æŒ‰ã€Œé–‹å•Ÿç›¸æ©Ÿã€ï¼Œå†æŒ‰ä½èªªä¸€å¥è‹±æ–‡ã€‚');
</script>
</body>
</html>
