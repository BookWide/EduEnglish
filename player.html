<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BookWide Êí≠ÊîæÂô®Ôºà4 ÂàÜÈ†Å + Ê∏¨È©óÂõõÈ°ûÔºâ</title>

<style>
:root{
  --bg:#0b1324;
  --panel:#0f172a;
  --border:#1f2a44;
  --ink:#e6f0ff;
  --muted:#9fb0c9;
  --accent:#3c7cff;
}

*,
*::before,
*::after{
  box-sizing:border-box;
}

html,body{
  margin:0;
  padding:0;
  height:100%;
  background:var(--bg);
  color:var(--ink);
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",system-ui,sans-serif;
}

/* È†ÅÈ¶ñ */
header{
  position:sticky;
  top:0;
  z-index:40;
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:8px 12px;
  background:#020617;
  border-bottom:1px solid var(--border);
}
header h1{
  margin:0;
  font-size:17px;
}
header .muted{
  color:var(--muted);
  font-size:13px;
}

/* Âè≥‰∏ä email Ê®£Âºè */
.user-email{
  font-size:0.85rem;
  color:rgba(230,240,255,0.9);
  white-space:nowrap;
  max-width:260px;
  overflow:hidden;
  text-overflow:ellipsis;
  vertical-align:middle;
  margin-left:4px;
}

/* Â§ñÂ±§Â∏ÉÂ±Ä */
.wrap{
  display:flex;
  flex-direction:column;
  height:calc(100vh - 48px);
}

/* ‰∏äÊñπÔºöÂàÜÈ°û + È°åÁõÆÊ®ôÈ°åÂàó */
.topbar{
  padding:6px 12px 4px;
  background:#020617;
  border-bottom:1px solid var(--border);
  display:flex;
  flex-wrap:wrap;
  align-items:center;
  gap:8px;
  font-size:13px;
}
.topbar span.label{
  color:var(--muted);
}

/* ‰∏ªÈ´î layoutÔºöÂ∑¶Âè≥ÂàÜÊ¨ÑÔºàÊ°åÊ©üÔºâÔºè‰∏ä‰∏ãÔºàÊâãÊ©üÔºâ */
.layout{
  flex:1;
  display:flex;
  min-height:0;
}

/* Â∑¶ÂçÄÔºöÂΩ±Áâá + ÊéßÂà∂Âàó */
.left{
  flex:1;
  min-width:0;
  padding:10px;
  border-right:1px solid var(--border);
  display:flex;
  flex-direction:column;
  gap:8px;
}

.videoWrap{
  position:relative;
  width:100%;
  padding-top:56.25%;
  background:#020617;
  border-radius:12px;
  overflow:hidden;
  border:1px solid var(--border);
}
.videoWrap video{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  background:#000;
}

/* Êí≠ÊîæÊéßÂà∂Âàó */
.controls{
  padding:8px 10px;
  background:#020617;
  border-radius:10px;
  border:1px solid var(--border);
  display:flex;
  flex-direction:column;
  gap:6px;
  font-size:13px;
}
.controls .row{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  align-items:center;
}
.controls .row span.muted{
  color:var(--muted);
  margin-left:4px;
}

/* Âè≥ÂçÄÔºöÂõõÂàÜÈ†ÅÔºàÂ≠óÂπïÔºèÊ∏¨È©óÔºèÂñÆÂ≠óÔºèAIÔºâ */
.right{
  flex:1;
  min-width:0;
  display:flex;
  flex-direction:column;
  background:#020617;
}

/* ÂàÜÈ†ÅÂàó */
.tabs{
  display:flex;
  border-bottom:1px solid var(--border);
  background:#020617;
}
.tabs button{
  flex:1;
  background:none;
  border:0;
  padding:10px 4px;
  font-size:13px;
  color:var(--muted);
  cursor:pointer;
  border-bottom:2px solid transparent;
}
.tabs button.active{
  color:var(--ink);
  border-bottom-color:var(--accent);
}

/* Âè≥ÂÅ¥ÂÖßÂÆπÂèØÊç≤ÂãïÂçÄ */
.tab-panels{
  flex:1;
  min-height:0;
  position:relative;
  display:flex;
  flex-direction:column;
}
.tab-panel{
  position:absolute;
  inset:0;
  padding:8px 10px 12px;
  overflow-y:auto;
  display:none;
}
.tab-panel.active{
  display:block;
}

/* Â≠óÂπïË°®Ê†º */
.cue-table{
  width:100%;
  border-collapse:collapse;
  font-size:13px;
}
.cue-table th,
.cue-table td{
  padding:4px 6px;
  border-bottom:1px solid #1e293b;
  vertical-align:top;
}
.cue-table th{
  position:sticky;
  top:0;
  background:#020617;
  z-index:1;
}
.cue-table td.time{
  white-space:nowrap;
  color:var(--muted);
  cursor:pointer;
}
.cue-table td.text{
  cursor:pointer;
}
.cue-table tr:hover td{
  background:#020617;
}
.cue-table tr.active td{
  background:#1f2937;
}

/* Ê∏¨È©óÂçÄ */
.quiz-header{
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  align-items:center;
  margin-bottom:8px;
}
.quiz-header .pill-group{
  display:flex;
  flex-wrap:wrap;
  gap:4px;
}
.pill{
  border-radius:999px;
  padding:3px 10px;
  font-size:12px;
  border:1px solid #334155;
  color:var(--muted);
  background:#020617;
  cursor:pointer;
}
.pill.active{
  border-color:var(--accent);
  color:var(--ink);
}

/* Ê∏¨È©óË©¶È°åÂàóË°® */
.quiz-list{
  margin:0;
  padding:0;
  list-style:none;
  font-size:13px;
}
.quiz-list li{
  padding:6px 6px 8px;
  border-bottom:1px solid #1e293b;
}
.quiz-q{
  font-weight:600;
  margin-bottom:4px;
}
.quiz-q .q-no{
  display:inline-block;
  min-width:1.5em;
}
.quiz-opts{
  margin:4px 0 0;
  padding-left:0;
  list-style:none;
}
.quiz-opts li{
  margin:2px 0;
}
.quiz-opts label{
  display:flex;
  gap:6px;
  cursor:pointer;
}
.quiz-opts input[type="radio"]{
  margin-top:2px;
}
.quiz-ans{
  margin-top:4px;
  color:#22c55e;
  font-size:12px;
  display:none;
}
.quiz-ans.show{
  display:block;
}
.quiz-footer{
  margin-top:10px;
  display:flex;
  flex-wrap:wrap;
  gap:6px;
  align-items:center;
  font-size:12px;
  color:var(--muted);
}

/* ÂñÆÂ≠óÂçÄ */
.vocab-list{
  margin:0;
  padding:0;
  list-style:none;
  display:flex;
  flex-direction:column;
  gap:8px;
}
.vocab-item{
  padding:8px 10px;
  border-radius:10px;
  background:#020617;
  border:1px solid #1e293b;
}
.vocab-head{
  display:flex;
  justify-content:space-between;
  align-items:center;
  margin-bottom:4px;
  font-size:14px;
}
.vocab-head .pos{
  color:var(--muted);
  font-size:12px;
}
.vocab-phon{
  font-size:12px;
  color:var(--muted);
  margin-bottom:4px;
}
.vocab-zh{
  font-size:13px;
  margin-bottom:4px;
}
.vocab-ex{
  font-size:12px;
  color:var(--muted);
}

/* AI ÂçÄ */
.ai-prompt{
  margin-bottom:6px;
  font-size:13px;
}
.ai-prompt textarea{
  width:100%;
  min-height:60px;
  border-radius:8px;
  border:1px solid #1e293b;
  background:#020617;
  color:var(--ink);
  padding:6px 8px;
  resize:vertical;
  font-family:inherit;
  font-size:13px;
}
.ai-log{
  margin-top:8px;
  font-size:13px;
  max-height:260px;
  overflow-y:auto;
  border-top:1px solid #1e293b;
  padding-top:6px;
}
.ai-msg{
  margin-bottom:6px;
}
.ai-msg.me{
  color:#7dd3fc;
}
.ai-msg.ai{
  color:#bbf7d0;
}

/* ÂÖ±Áî®ÊåâÈàï */
.btn{
  background:#13233f;
  border:1px solid #24446f;
  border-radius:10px;
  padding:7px 12px;
  color:#fff;
  cursor:pointer;
  font-size:14px;
}
.btn.blue{background:#14335f;border-color:#2c5aa3;}
.btn.sm{padding:5px 10px;font-size:13px;border-radius:999px;}
.btn.sm.blue{background:#1d4ed8;border-color:#1d4ed8;}
.btn:disabled{
  opacity:.4;
  cursor:default;
}

/* Âø´Êç∑ÈñãÈóú */
.toggle{
  display:inline-flex;
  align-items:center;
  gap:4px;
  font-size:12px;
}
.toggle input{
  width:30px;
}

/* Êç≤ÂãïÊ¢ùÊ®£ÂºèÔºàÂè≥ÂÅ¥Ôºâ */
.tab-panel::-webkit-scrollbar{
  width:8px;
}
.tab-panel::-webkit-scrollbar-track{
  background:#020617;
}
.tab-panel::-webkit-scrollbar-thumb{
  background:#334155;
  border-radius:999px;
}

/* ÊâãÊ©üÁâàÔºö‰∏ä‰∏ãÂàá */
@media (max-width:900px){
  .layout{
    flex-direction:column;
  }
  .left{
    border-right:0;
    border-bottom:1px solid var(--border);
  }
}

/* ÂàóÂç∞Ê®£ÂºèÔºàÂè™Âç∞Ê∏¨È©óÔºâ */
@media print{
  body{
    background:#fff;
    color:#000;
  }
  header,
  .wrap > .topbar,
  .left,
  .tabs,
  .tab-panel:not(#panel-quiz){
    display:none!important;
  }
  .wrap{
    height:auto;
  }
  .layout{
    display:block;
  }
  .right{
    border:0;
  }
  #panel-quiz{
    position:static;
    padding:0;
    overflow:visible;
  }
  .quiz-list li{
    page-break-inside:avoid;
  }
  .quiz-ans{
    display:block;
  }
  .quiz-footer{
    display:none;
  }
  .user-email{
    display:none!important;
  }
}

/* ËÆìÂè≥ÂÅ¥ÂÖßÂÆπÁ®çÂæÆÂÜçÈï∑ 10pxÔºåÈÅøÂÖçÈÇäÁïåË¢´ÂêÉ */
.tab-panel{
  padding-bottom:14px;
}
</style>

<!-- Supabase JSÔºàÂè™Áî®Êñº player ÂÆàÈñÄÔºå‰∏çÂΩ±ÈüøÂÖ∂ÂÆÉÈ†ÅÈù¢Ôºâ -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const SUPABASE_URL = 'https://jeajrwpmrgczimmrflxo.supabase.co';
  const SUPABASE_ANON_KEY =
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImplYWpyd3BtcmdjemltbXJmbHhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3MTg5MzksImV4cCI6MjA3NjI5NDkzOX0.3iFXdHH0JEuk177_R4TGFJmOxYK9V8XctON6rDe7-Do';

  const supa = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  async function guardAndShowEmail() {
    try {
      const { data, error } = await supa.auth.getUser();
      if (error || !data || !data.user) {
        const next = encodeURIComponent(location.pathname + location.search);
        window.location.href = '/EduEnglish/index.html?denied=signin&next=' + next;
        return;
      }
      const email = data.user.email || '';
      const badge = document.getElementById('userNameBadge');
      if (badge && email) {
        badge.textContent = email;
        badge.classList.add('user-email');
      }
      console.log('[player-guard] signed in as', email);
    } catch (err) {
      console.error('[player-guard] error', err);
    }
  }

  document.addEventListener('DOMContentLoaded', guardAndShowEmail);
</script>
</head>
<body>
<header>
  <h1>Êí≠ÊîæÂô®</h1>
  <div style="display:flex;align-items:center;gap:10px">
    <a class="btn" href="https://bookwide.github.io/EduEnglish/index.html">üè† ÂõûÈ¶ñÈ†Å</a>
    <span class="muted user-email" id="userNameBadge"></span>
  </div>
</header>

<div class="wrap">
  <div class="topbar">
    <span class="label">ÂàÜÈ°ûÔºö</span>
    <span id="catLabel">story</span>
    <span class="label" style="margin-left:8px">Ê®ôÈ°åÔºö</span>
    <span id="titleLabel">‚Äî</span>
    <span class="label" style="margin-left:8px">SlugÔºö</span>
    <span id="slugLabel">‚Äî</span>
  </div>

  <div id="track" class="layout">
    <!-- Â∑¶ÔºöÂΩ±Áâá -->
    <section class="page" id="pageLeft">
      <section class="left">
        <div class="videoWrap">
          <video id="player" playsinline controls></video>
        </div>
        <div class="controls">
          <div class="row">
            <button class="btn" id="btnPrev">‚èÆ ‰∏ä‰∏ÄÂè•</button>
            <button class="btn" id="btnPlay">‚ñ∂Ô∏è / ‚è∏</button>
            <button class="btn" id="btnNext">‚è≠ ‰∏ã‰∏ÄÂè•</button>
            <button class="btn" id="btnReplay">üîÅ ÈáçÊí≠Âè•Â≠ê</button>
          </div>
          <div class="row">
            <span class="muted">ÈÄüÂ∫¶Ôºö</span>
            <input type="range" id="speedRange" min="0.5" max="1.5" step="0.05" value="1" />
            <span id="speedLabel" class="muted">1.00√ó</span>
          </div>
          <div class="row">
            <label class="toggle">
              <input type="checkbox" id="chkFollow" checked />
              <span>Ë∑üÈö®Â≠óÂπï</span>
            </label>
            <label class="toggle">
              <input type="checkbox" id="chkAutoPause" />
              <span>ÊØèÂè•Ëá™ÂãïÊö´ÂÅú</span>
            </label>
            <span class="muted" id="currentTimeLabel">00:00 / 00:00</span>
          </div>
        </div>
      </section>
    </section>

    <!-- Âè≥ÔºöÂõõÂàÜÈ†Å -->
    <section class="page" id="pageRight">
      <section class="right">
        <div class="tabs">
          <button class="active" data-tab="panel-cue">Â≠óÂπï</button>
          <button data-tab="panel-quiz">Ê∏¨È©ó</button>
          <button data-tab="panel-vocab">ÂñÆÂ≠ó</button>
          <button data-tab="panel-ai">AI ‰∫íÂãï</button>
        </div>

        <div class="tab-panels">
          <!-- Â≠óÂπï TAB -->
          <div class="tab-panel active" id="panel-cue">
            <table class="cue-table">
              <thead>
                <tr>
                  <th style="width:70px">ÊôÇÈñì</th>
                  <th>Ëã±Êñá</th>
                  <th>‰∏≠Êñá</th>
                  <th>Êó•Êñá</th>
                </tr>
              </thead>
              <tbody id="cueTbody"></tbody>
            </table>
          </div>

          <!-- Ê∏¨È©ó TAB -->
          <div class="tab-panel" id="panel-quiz">
            <div class="quiz-header">
              <div class="pill-group">
                <button class="pill active" data-qcat="vocab">Vocabulary</button>
                <button class="pill" data-qcat="grammar">Grammar</button>
                <button class="pill" data-qcat="reading">Reading</button>
                <button class="pill" data-qcat="mixed">Mixed</button>
              </div>
              <button class="btn sm blue" id="btnShowAns">È°ØÁ§∫ / Èö±ËóèÁ≠îÊ°à</button>
              <button class="btn sm" id="btnPrintQuiz">ÂàóÂç∞ÂõõÈ°ûË©¶È°å</button>
            </div>
            <ul class="quiz-list" id="quizList"></ul>
            <div class="quiz-footer">
              <span>ÁõÆÂâçÈ°ûÂà•Ôºö<span id="quizCatLabel">Vocabulary</span></span>
            </div>
          </div>

          <!-- ÂñÆÂ≠ó TAB -->
          <div class="tab-panel" id="panel-vocab">
            <ul class="vocab-list" id="vocabList"></ul>
          </div>

          <!-- AI TAB -->
          <div class="tab-panel" id="panel-ai">
            <div class="ai-prompt">
              <div class="muted" style="margin-bottom:4px">
                Ë´ãÁî®Ëã±ÊñáÂïèÂïèÈ°åÔºåAI ÊúÉ‰æùÂΩ±ÁâáÂÖßÂÆπÂõûË¶ÜÔºàdemo ÁâàÔºåÂÉÖÊú¨Ê©üÊ®°Êì¨Ôºå‰∏çÈÄ£Á∂≤Ôºâ„ÄÇ
              </div>
              <textarea id="aiInput" placeholder="‰æãÂ¶ÇÔºöExplain the story in simple English."></textarea>
              <div style="margin-top:6px;display:flex;gap:6px;align-items:center">
                <button class="btn sm blue" id="btnAskAI">ÈÄÅÂá∫</button>
                <span class="muted" id="aiStatus"></span>
              </div>
            </div>
            <div class="ai-log" id="aiLog"></div>
          </div>
        </div>
      </section>
    </section>
  </div>
</div>

<script>
// Á∞°Êòì $ helper
const $ = (s, e=document)=>e.querySelector(s);
const $$ = (s, e=document)=>[...e.querySelectorAll(s)];

/* ==== URL ÂèÉÊï∏Ëß£Êûê ==== */
function getQuery(){
  const p = new URLSearchParams(location.search);
  return {
    cat: p.get('cat') || 'story',
    slug: p.get('slug') || 'houyi'
  };
}

/* ==== ÂàùÂßãÂåñ + ÂéüÊú¨ÂÆàÈñÄÁ®ãÂºèÔºà‰øùÁïôÔºå‰ΩÜÁèæÂú®‰∏ªË¶ÅÂÆàÈñÄÊîπÁî± Supabase JS ÂÆåÊàêÔºâ ==== */
(async function init(){
  try{
    // ËàäÁâàÂÆàÈñÄÔºöËã•È†ÅÈù¢‰∏äÊúâ ensureAuth ÊâçÊúÉËß∏ÁôºÔºåÂê¶ÂâáÁï•ÈÅé
    if(typeof ensureAuth==='function'){
      await ensureAuth({
        redirect:'/EduEnglish/index.html',
        next:location.pathname+location.search
      });
    }
    let email='';
    if(typeof getSessionUser==='function'){
      const u=await getSessionUser();
      email=(u&&(u.email||(u.user&&u.user.email)))||'';
    }else if(typeof supaGetUser==='function'){
      const u=await supaGetUser();
      email=(u&&(u.email||(u.user&&u.user.email)))||'';
    }
    if(email){
      const badge = $('#userNameBadge');
      if(badge){
        badge.textContent = email;
        badge.classList.add('user-email');
      }
    }
  }catch(e){
    console.warn('[auth] error:',e);
  }

  // === ‰ª•‰∏ãÁÇ∫Êí≠ÊîæÂô®ÁöÑ‰∏ªÁ®ãÂºè ===

  const video       = $('#player');
  const cueTbody    = $('#cueTbody');
  const quizList    = $('#quizList');
  const vocabList   = $('#vocabList');
  const aiInput     = $('#aiInput');
  const aiLog       = $('#aiLog');
  const aiStatus    = $('#aiStatus');
  const btnAskAI    = $('#btnAskAI');
  const catLabel    = $('#catLabel');
  const titleLabel  = $('#titleLabel');
  const slugLabel   = $('#slugLabel');
  const btnPrev     = $('#btnPrev');
  const btnPlay     = $('#btnPlay');
  const btnNext     = $('#btnNext');
  const btnReplay   = $('#btnReplay');
  const speedRange  = $('#speedRange');
  const speedLabel  = $('#speedLabel');
  const chkFollow   = $('#chkFollow');
  const chkAutoPause= $('#chkAutoPause');
  const currentTimeLabel = $('#currentTimeLabel');
  const quizCatLabel= $('#quizCatLabel');
  const btnShowAns  = $('#btnShowAns');
  const btnPrintQuiz= $('#btnPrintQuiz');

  const { cat, slug } = getQuery();
  catLabel.textContent = cat;
  slugLabel.textContent = slug;

  // === ËºâÂÖ•ÂΩ±ÁâáËàá JSON ===
  const base = `./data/${cat}/${slug}`;
  const videoSrc = `./videos/${cat}/${slug}.mp4`;

  // Ë®≠ÂÆöÂΩ±Áâá‰æÜÊ∫ê
  video.src = videoSrc;

  // ËÆÄÂèñ JSONÔºöÂ≠óÂπïÔºèÊ∏¨È©óÔºèÂñÆÂ≠ó
  async function loadJSON(path){
    const res = await fetch(path);
    if(!res.ok) throw new Error('ËºâÂÖ•Â§±ÊïóÔºö'+path);
    return await res.json();
  }

  let cues  = [];
  let quiz  = [];
  let vocab = [];

  try{
    const [cueData, quizData, vocabData] = await Promise.all([
      loadJSON(`${base}/cues-${slug}.json`),
      loadJSON(`${base}/quiz-${slug}.json`),
      loadJSON(`${base}/vocab-${slug}.json`)
    ]);

    cues  = cueData.cues || cueData || [];
    quiz  = quizData.quiz || quizData || [];
    vocab = vocabData.vocab || vocabData || [];
    const metaTitle = cueData.title || quizData.title || vocabData.title || slug;
    titleLabel.textContent = metaTitle;
  }catch(err){
    console.error(err);
    titleLabel.textContent = 'ËºâÂÖ•Ë≥áÊñôÂ§±Êïó';
  }

  /* ==== Â≠óÂπïÊ∏≤Êüì ==== */
  let currentCueIndex = -1;

  function formatTime(sec){
    if(!Number.isFinite(sec)) return '--:--';
    const m = Math.floor(sec/60);
    const s = Math.floor(sec%60);
    return String(m).padStart(2,'0')+':'+String(s).padStart(2,'0');
  }

  function renderCues(){
    cueTbody.innerHTML = '';
    cues.forEach((c,idx)=>{
      const tr = document.createElement('tr');
      tr.dataset.index = idx;
      const tdTime = document.createElement('td');
      tdTime.className = 'time';
      tdTime.textContent = `${formatTime(c.start)} ‚Üí ${formatTime(c.end)}`;
      const tdEn = document.createElement('td');
      tdEn.className = 'text';
      tdEn.textContent = c.en || '';
      const tdZh = document.createElement('td');
      tdZh.className = 'text';
      tdZh.textContent = c.zh || '';
      const tdJa = document.createElement('td');
      tdJa.className = 'text';
      tdJa.textContent = c.ja || '';
      tr.append(tdTime,tdEn,tdZh,tdJa);
      cueTbody.appendChild(tr);
    });
  }

  renderCues();

  function setActiveCue(idx){
    if(idx===currentCueIndex) return;
    currentCueIndex = idx;
    $$('#cueTbody tr').forEach(tr=>{
      tr.classList.toggle('active', Number(tr.dataset.index)===idx);
    });
    if(chkFollow.checked){
      const active = $('#cueTbody tr.active');
      if(active){
        const rect = active.getBoundingClientRect();
        const parentRect = active.parentElement.getBoundingClientRect();
        if(rect.top<parentRect.top || rect.bottom>parentRect.bottom){
          active.scrollIntoView({block:'center'});
        }
      }
    }
  }

  cueTbody.addEventListener('click', e=>{
    const tr = e.target.closest('tr');
    if(!tr) return;
    const idx = Number(tr.dataset.index||'-1');
    if(idx<0 || !cues[idx]) return;
    video.currentTime = cues[idx].start||0;
    video.play();
    setActiveCue(idx);
  });

  video.addEventListener('timeupdate', ()=>{
    const t = video.currentTime;
    const d = video.duration || 0;
    currentTimeLabel.textContent = `${formatTime(t)} / ${formatTime(d)}`;
    const idx = cues.findIndex(c=>t>=c.start && t<c.end);
    if(idx>=0) setActiveCue(idx);
  });

  video.addEventListener('ended', ()=>{
    if(chkAutoPause.checked){
      video.pause();
    }
  });

  btnPrev.addEventListener('click',()=>{
    if(!cues.length) return;
    const idx = currentCueIndex>0 ? currentCueIndex-1 : 0;
    const c = cues[idx];
    video.currentTime = c.start||0;
    video.play();
    setActiveCue(idx);
  });
  btnNext.addEventListener('click',()=>{
    if(!cues.length) return;
    const idx = currentCueIndex>=0 && currentCueIndex<cues.length-1 ? currentCueIndex+1 : cues.length-1;
    const c = cues[idx];
    video.currentTime = c.start||0;
    video.play();
    setActiveCue(idx);
  });
  btnReplay.addEventListener('click',()=>{
    if(currentCueIndex<0 || !cues[currentCueIndex]) return;
    const c = cues[currentCueIndex];
    video.currentTime = c.start||0;
    video.play();
  });

  btnPlay.addEventListener('click',()=>{
    if(video.paused) video.play(); else video.pause();
  });

  speedRange.addEventListener('input',()=>{
    const v = Number(speedRange.value||'1');
    video.playbackRate = v;
    speedLabel.textContent = v.toFixed(2)+'√ó';
  });

  /* ==== Ê∏¨È©óÊ∏≤Êüì ==== */
  let currentQuizCat = 'vocab'; // vocab / grammar / reading / mixed

  function renderQuiz(){
    quizList.innerHTML = '';
    const filtered = quiz.filter(q=> (q.category||'vocab')===currentQuizCat );
    filtered.forEach((q,idx)=>{
      const li = document.createElement('li');
      const qDiv = document.createElement('div');
      qDiv.className = 'quiz-q';
      const noSpan = document.createElement('span');
      noSpan.className = 'q-no';
      noSpan.textContent = (idx+1)+'.';
      qDiv.appendChild(noSpan);
      const textSpan = document.createElement('span');
      textSpan.textContent = q.question||'';
      qDiv.appendChild(textSpan);

      const optUl = document.createElement('ul');
      optUl.className = 'quiz-opts';
      (q.options||[]).forEach((opt,optIdx)=>{
        const liOpt = document.createElement('li');
        const label = document.createElement('label');
        const radio = document.createElement('input');
        radio.type = 'radio';
        radio.name = `q_${currentQuizCat}_${idx}`;
        radio.value = String(optIdx);
        const spanOpt = document.createElement('span');
        spanOpt.textContent = opt;
        label.append(radio,spanOpt);
        liOpt.appendChild(label);
        optUl.appendChild(liOpt);
      });

      const ansDiv = document.createElement('div');
      ansDiv.className = 'quiz-ans';
      ansDiv.textContent = 'Á≠îÊ°àÔºö'+(q.answerText||q.answer||'');

      li.append(qDiv,optUl,ansDiv);
      quizList.appendChild(li);
    });
  }

  renderQuiz();

  $$('.pill').forEach(btn=>{
    btn.addEventListener('click',()=>{
      $$('.pill').forEach(b=>b.classList.remove('active'));
      btn.classList.add('active');
      currentQuizCat = btn.dataset.qcat||'vocab';
      quizCatLabel.textContent = btn.textContent.trim();
      renderQuiz();
    });
  });

  btnShowAns.addEventListener('click',()=>{
    $$('.quiz-ans').forEach(el=>{
      el.classList.toggle('show');
    });
  });

  btnPrintQuiz.addEventListener('click',()=>{
    // Áõ¥Êé•Ëµ∞ÁÄèË¶ΩÂô®ÂàóÂç∞
    window.print();
  });

  /* ==== ÂñÆÂ≠ó ==== */
  function renderVocab(){
    vocabList.innerHTML = '';
    vocab.forEach(v=>{
      const li = document.createElement('li');
      li.className = 'vocab-item';
      const head = document.createElement('div');
      head.className = 'vocab-head';
      const wordSpan = document.createElement('span');
      wordSpan.textContent = v.word||'';
      const posSpan = document.createElement('span');
      posSpan.className = 'pos';
      posSpan.textContent = v.pos||'';
      head.append(wordSpan,posSpan);

      const phon = document.createElement('div');
      phon.className = 'vocab-phon';
      phon.textContent = v.phonetic||'';

      const zh = document.createElement('div');
      zh.className = 'vocab-zh';
      zh.textContent = v.zh||'';

      const ex = document.createElement('div');
      ex.className = 'vocab-ex';
      ex.textContent = v.example||'';

      li.append(head,phon,zh,ex);
      vocabList.appendChild(li);
    });
  }

  renderVocab();

  /* ==== AI demo ==== */
  function appendAiMsg(text, who='me'){
    const div = document.createElement('div');
    div.className = 'ai-msg '+who;
    div.textContent = text;
    aiLog.appendChild(div);
    aiLog.scrollTop = aiLog.scrollHeight;
  }

  btnAskAI.addEventListener('click',()=>{
    const text = (aiInput.value||'').trim();
    if(!text) return;
    appendAiMsg(text,'me');
    aiInput.value='';
    aiStatus.textContent = 'Thinking...';
    setTimeout(()=>{
      appendAiMsg('ÔºàdemoÔºâÊ†πÊìöÂΩ±ÁâáÂÖßÂÆπÁöÑËã±ÊñáËß£Ë™™ / Á∑¥ÁøíÂõûË¶ÜÊúÉÂá∫ÁèæÂú®ÈÄôË£°„ÄÇ','ai');
      aiStatus.textContent = '';
    },800);
  });

})(); // end init
</script>
</body>
</html>




























































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BookWide Êí≠ÊîæÂô®Ôºà4 ÂàÜÈ†Å + Ê∏¨È©óÂõõÈ°ûÔºâ</title>

<style>
:root{
  --bg:#0b1324;
  --panel:#0f172a;
  --border:#1f2a44;
  --ink:#e6f0ff;
  --muted:#9fb0c9;
  --accent:#3c7cff;
}
*{box-sizing:border-box;}
html,body{
  margin:0;
  height:100%;
  background:var(--bg);
  color:var(--ink);
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Noto Sans TC",sans-serif;
  overflow:hidden; /* Ê°åÊ©üÔºöÊï¥È†Å‰∏çË¶ÅÊç≤ÔºåÁî±Âè≥ÂÅ¥Èù¢ÊùøËá™Â∑±Êç≤Âãï */
}
a{color:var(--accent);text-decoration:none;}

header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px 18px;
  background:#0f172a;
  border-bottom:1px solid #0e203f;
}
header h1{margin:0;font-size:20px;}

.wrap{
  padding:14px;
  height:calc(100vh - 50px);
}
.layout{
  height:100%;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:14px;
  overflow:hidden;
}
.layout > *{min-height:0;} /* ËÆìÂ∑¶Âè≥ÂÖ©Ê¨ÑÂèØ‰ª•ÂÖßÈÉ®Êç≤Âãï */

.left,.right{
  min-width:0;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:12px;
}

/* Â∑¶ÂÅ¥ÂΩ±ÁâáÂçÄ */
.left{
  display:flex;
  flex-direction:column;
  padding:12px;
  position:sticky;
  top:0;
  align-self:flex-start;
}

.videoWrap{
  position:relative;
  width:100%;
  aspect-ratio:16/9;
  background:#000;
  border-radius:10px;
  overflow:hidden;
}
.videoWrap video{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  background:#000;
}

.controls{
  margin-top:10px;
  background:#0e2038;
  border:1px solid #183459;
  border-radius:12px;
  padding:10px;
}
.controls .row{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  align-items:center;
  margin:4px 0;
}

.btn{
  background:#13233f;
  border:1px solid #24446f;
  border-radius:10px;
  padding:7px 12px;
  color:#fff;
  cursor:pointer;
  font-size:14px;
}
.btn.blue{background:#14335f;border-color:#2c5aa3;}
.btn.sm{padding:5px 10px;font-size:13px;border-radius:999px;}
.btn.sm.blue{background:#14335f;border-color:#2c5aa3;}
.muted{color:var(--muted);font-size:13px;}
.chip{
  display:inline-flex;
  align-items:center;
  gap:4px;
  padding:4px 8px;
  border-radius:999px;
  background:#111f38;
  border:1px solid #1c314f;
  font-size:13px;
}

/* Âè≥ÂÅ¥ÂõõÂàÜÈ†ÅÊï¥È´îÔºöÂèØÂÖßÈÉ®Êç≤Âãï */
.right{
  display:flex;
  flex-direction:column;
  overflow:hidden;
  min-height:0;
}
.rightScroll{
  flex:1 1 auto;
  min-height:0;
  overflow-y:auto;
  position:relative;
  scrollbar-width:thin;
}
.rightScroll::-webkit-scrollbar{width:10px;}
.rightScroll::-webkit-scrollbar-thumb{
  background:#556a9a;
  border-radius:6px;
}

/* È†ÇÁ´ØÈÅ∏È†ÖÂç° */
.tabs{
  display:flex;
  gap:8px;
  padding:6px 10px;
  margin:0;
  border-bottom:1px solid var(--border);
  position:sticky;
  top:0;
  z-index:20;
  background:var(--panel);
}
.tab{
  cursor:pointer;
  background:#122340;
  border:1px solid #1f375f;
  border-radius:12px;
  padding:8px 14px;
  font-weight:600;
  font-size:14px;
}
.tab.active{background:#154274;}

.pane{
  padding:0 0 12px;
  min-height:0;
}

/* Â≠óÂπï */
table{width:100%;border-collapse:collapse;}
th,td{
  padding:8px 10px;
  border-bottom:1px solid #162a48;
  vertical-align:top;
}
tbody tr{background:#0f1f34;}
tbody tr:nth-child(2n){background:#0d1a2b;}
tbody tr:hover{background:#0f2a4e;}
tr.active{background:#173a6e;}

.cues-table{table-layout:fixed;}
.cue-time{
  width:64px;
  min-width:64px;
  color:rgba(255,255,255,.75);
  font-family:ui-monospace,Consolas,monospace;
  white-space:nowrap;
}
.cue-en{line-height:1.6;word-break:break-word;position:relative;}
.zh-line,.ja-line{margin-top:4px;opacity:.96;}

/* ÂéªÊéâÂñáÂè≠ÔºåÂè™ÁïôÂ∑¶ÂÅ¥È´ò‰∫Æ */
tr.speaking::before{content:none!important;}
tr.speaking{
  box-shadow:inset 3px 0 0 0 rgba(60,124,255,.55)!important;
  background:rgba(60,124,255,.10)!important;
}

/* Â≠óÂπïË°®È†≠ sticky */
#pane-sub thead th{
  position:sticky;
  top:44px;
  background:var(--panel);
  z-index:10;
}

/* Ê∏¨È©óÔºöÂõõÈ°ûÊåâÈàïÂàó */
.quiz-cats{
  padding:8px 12px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  border-bottom:1px solid #162a48;
}

/* AI ÂçÄÂ°ä */
#pane-ai textarea{
  width:100%;
  resize:vertical;
  font-family:inherit;
  border-radius:8px;
  border:1px solid #223048;
  background:#050b18;
  color:var(--ink);
  padding:8px;
}
#aiReply{
  border:1px solid #223048;
  border-radius:10px;
  padding:10px;
  min-height:54px;
}

/* ÊâãÊ©üÔºöÂ∑¶Âè≥ÂÖ©È†Å */
@media (max-width:860px) and (orientation:portrait){
  html,body{
    overflow:auto;              /* ÊâãÊ©üÔºöÊÅ¢Âæ©Êï¥È†ÅÊç≤Âãï */
    height:100%;
  }
  .wrap{
    height:auto;
  }
  .layout{
    height:auto;
  }
  .rightScroll{
    max-height:none;
    overflow-y:visible;         /* ÊâãÊ©üÁâàÂè≥ÂÅ¥‰∏çÂÜçÁç®Á´ãÂç∑Ëª∏ÔºåÊîπÊàêÊï¥È†ÅÊç≤Âãï */
  }

  #track{
    display:flex;
    overflow-x:auto;
    overflow-y:hidden;
    scroll-snap-type:x mandatory;
  }
  .page{
    flex:0 0 100vw;
    max-width:100vw;
    height:calc(100vh - 50px);
    scroll-snap-align:start;
    overflow-y:auto;
  }
  .left,.right{
    width:100%;
    max-width:100%;
    border-radius:0;
    border-left:0;
    border-right:0;
  }
  #btnExitFocus{
    position:fixed;
    right:16px;
    bottom:16px;
    z-index:10020;
    padding:10px 14px;
    border:1px solid rgba(100,116,139,.5);
    background:#0f172a;
    color:#e6efff;
    border-radius:12px;
    display:none;
  }
  body.at-right #btnExitFocus{display:inline-flex;}
}

/* ÂàóÂç∞ */
@media print{
  header,.controls,.tabs,#btnExitFocus{display:none!important;}
  body{background:#fff;color:#000;}
  .left{display:none!important;}
  .right{border:none;}
}


/* Ê°åÊ©üÔºöÂè≥ÂÅ¥ÂÖßÂÆπÂèØÁç®Á´ãÊç≤ÂãïÔºåÂ∫ïÈÉ®Â§ßÁ¥ÑËàáÂ∑¶ÂÅ¥ÈΩä */
@media (min-width: 861px){
  .rightScroll{
    max-height: calc(100vh - 90px); /*  */
    overflow-y: auto;
  }
}

/* === V12 print override based on V7 (2025-11-14) === */
@media print{
  /* 1) Âè™‰øùÁïôÂè≥ÂÅ¥ÂÖßÂÆπÔºåÈö±ËóèÊ®ôÈ†≠ËàáÂ∑¶ÂÅ¥ÂΩ±ÁâáÂçÄ */
  header,.controls,.tabs,#btnExitFocus{display:none!important;}
  html,body{
    height:auto!important;
    overflow:visible!important;
    background:#fff!important;
    color:#000!important;
  }
  .wrap,
  .layout{
    height:auto!important;
    min-height:0!important;
    display:block!important;
    overflow:visible!important;
  }
  #track{
    display:block!important;
    height:auto!important;
    overflow:visible!important;
  }
  #pageLeft,
  .left{
    display:none!important;
  }
  #pageRight{
    display:block!important;
    width:100%!important;
    height:auto!important;
    overflow:visible!important;
  }
  #pageRight .right{
    display:block!important;
    height:auto!important;
    max-width:100%!important;
    max-height:none!important;
    border:none!important;
    overflow:visible!important;
  }
  #pageRight .rightScroll{
    display:block!important;
    height:auto!important;
    max-height:none!important;
    overflow:visible!important;
    padding-bottom:0!important;
  }
}


</style>

<!-- Áõ¥Êé•Âæû GitHub ËºâÂÖ• supa.jsÔºàÂÆàÈñÄ + Supabase ÂÖ±Áî®Ôºâ -->
<script src="https://bookwide.github.io/EduEnglish/supa.js?v=20251018"></script>
</head>
<body>
<header>
  <h1>Êí≠ÊîæÂô®</h1>
  <div style="display:flex;align-items:center;gap:10px">
    <a class="btn" href="https://bookwide.github.io/EduEnglish/index.html">üè† ÂõûÈ¶ñÈ†Å</a>
    <span class="muted" id="userNameBadge"></span>
  </div>
</header>

<div class="wrap">
  <div id="track" class="layout">
    <!-- Â∑¶ÔºöÂΩ±Áâá -->
    <section class="page" id="pageLeft">
      <section class="left">
        <div class="videoWrap">
          <video id="player" playsinline controls></video>
        </div>
        <div class="controls">
          <div class="row">
            <button class="btn" id="btnPrev">‚èÆ ‰∏ä‰∏ÄÂè•</button>
            <button class="btn" id="btnPlay">‚ñ∂Ô∏è Êí≠Êîæ / Êö´ÂÅú</button>
            <button class="btn" id="btnNext">‚è≠ ‰∏ã‰∏ÄÂè•</button>
            <button class="btn" id="btnReplay">üîÅ ÈáçË§áÊú¨Âè•</button>
          </div>
          <div class="row">
            <label class="chip"><input id="chkFollow" type="checkbox" /> Ë∑üÈö®</label>
            <span class="chip">ÂÅèÁßª <span id="offsetVal">0.0s</span></span>
            <button class="btn" id="btnOffsetMinus">-0.5s</button>
            <button class="btn" id="btnOffsetPlus">+0.5s</button>
            <button class="btn" id="btnAutoSync">üß≠ Á∞°ÊòìÊ†°Ê∫ñ</button>
          </div>
          <div class="row" style="gap:10px">
            <span class="muted">ÈÄüÂ∫¶</span>
            <input id="speedRange" type="range" min="0.5" max="2" step="0.05" value="1" />
            <span id="speedVal">1.00x</span>
          </div>
        </div>
      </section>
    </section>

    <!-- Âè≥ÔºöÂõõÂàÜÈ†ÅÔºàÂ§ñÂ±§ right + ÂÖßÂ±§ rightScroll ÊúâÊç≤Ëª∏Ôºâ -->
    <section class="page" id="pageRight">
      <section class="right">
        <div class="rightScroll" id="rightScroll">
          <div class="tabs">
            <div class="tab active" data-tab="sub">Â≠óÂπï</div>
            <div class="tab" data-tab="quiz">Ê∏¨È©ó</div>
            <div class="tab" data-tab="vocab">ÂñÆÂ≠ó</div>
            <div class="tab" data-tab="ai">AI‰∫íÂãï</div>
          </div>

          <!-- Â≠óÂπï -->
          <div class="pane" id="pane-sub">
            <div class="muted" id="cuesStatus" style="padding:8px 12px">ÔºàÂ≠óÂπïËºâÂÖ•‰∏≠‚Ä¶Ôºâ</div>
            <table class="cues-table">
              <thead>
              <tr><th style="width:80px">ÊôÇÈñì</th><th>Ëã±Êñá / ‰∏≠Êñá / Êó•Êñá</th></tr>
              </thead>
              <tbody id="cuesBody"></tbody>
            </table>
          </div>

          <!-- Ê∏¨È©óÔºöÂõõÈ°û + ÂàóÂç∞ -->
          <div class="pane" id="pane-quiz" style="display:none">
            <div id="quizCats" class="quiz-cats">
              <button class="btn sm blue" data-cat="all">ÂÖ®ÈÉ®</button>
              <button class="btn sm" data-cat="vocab">ÂñÆÂ≠ó</button>
              <button class="btn sm" data-cat="grammar">ÊñáÊ≥ï</button>
              <button class="btn sm" data-cat="reading">Èñ±ËÆÄ</button>
              <button class="btn sm" data-cat="mix">Á∂úÂêà</button>
            </div>
            <div class="muted" id="quizMeta" style="padding:6px 12px">ÔºàÊ∏¨È©óËºâÂÖ•‰∏≠‚Ä¶Ôºâ</div>
            <ol id="quizList" style="line-height:1.6;padding:0 28px"></ol>
            <div class="q-actions" style="margin:12px 12px 4px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;">
              <button class="btn" id="btnSubmitQuiz">‰∫§Âç∑</button>
              <button class="btn" id="btnShowAnswer">È°ØÁ§∫Á≠îÊ°à</button>
              <button class="btn" id="btnPrint">ÂàóÂç∞ÁõÆÂâçÈ†Å</button>
              <button class="btn" id="btnPrintAll">ÂÆåÊï¥ÂàóÂç∞ 4 È°û</button>
              <span id="quizScore" style="margin-left:8px"></span>
            </div>
          </div>

          <!-- ÂñÆÂ≠ó -->
          <div class="pane" id="pane-vocab" style="display:none">
            <div class="muted" id="vocabStatus" style="padding:8px 12px">( ÂñÆÂ≠óËºâÂÖ•‰∏≠‚Ä¶ )</div>
            <div id="vocabBox" style="padding:0 12px 12px;"></div>
          </div>

          <!-- AI ‰∫íÂãïÔºàÂä†ÂÖ•Ëã± / ‰∏≠ / Êó•Á§∫ÁØÑ + Â∞çÊáâÊúóËÆÄÔºâ -->
          <div class="pane" id="pane-ai" style="display:none">
            <div style="padding:8px 12px">
              <div class="muted" style="margin-bottom:6px">
                Á∂≤ÂùÄÊ†ºÂºèÔºö<code>?cat=story|music|movie|news|pro&slug=houyi</code>
              </div>
              <div style="display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-bottom:6px">
                <select id="aiTopic" class="btn" style="min-width:180px"></select>
                <button id="btnPrevTopic" class="btn sm">‚óÄ ‰∏ä‰∏ÄÈ°å</button>
                <button id="btnNextTopic" class="btn sm">‰∏ã‰∏ÄÈ°å ‚ñ∂</button>
                <button id="btnTts" class="btn sm">È°åÁõÆÊúóËÆÄ</button>
                <button id="btnRec" class="btn sm">üéôÔ∏è ÈñãÂßãË™™</button>
                <button id="btnStop" class="btn sm" disabled>‚õî ÂÅúÊ≠¢</button>
                <label class="muted"><input id="aiAutoNext" type="checkbox" /> ‰ΩúÁ≠îÂæåËá™Âãï‰∏ã‰∏ÄÈ°å</label>
                <span id="aiProgress" class="muted">Á¨¨ 0/0 È°å</span>
              </div>
              <textarea id="aiPrompt" rows="3" readonly placeholder="È°åÁõÆÊúÉÈ°ØÁ§∫Âú®ÈÄôË£°‚Ä¶"></textarea>
              <div style="margin:8px 0 4px">
                <span class="muted">ÊèêÁ§∫Ôºö</span><span id="aiHint" class="muted">‚Äî</span>
              </div>
              <div style="display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin:6px 0">
                <span class="muted">AI Á§∫ÁØÑÔºö</span>
                <button id="aiDemoEn" class="btn sm">Ëã±</button>
                <button id="aiDemoZh" class="btn sm">‰∏≠</button>
                <button id="aiDemoJa" class="btn sm">Êó•</button>
                <button id="aiDemoTts" class="btn sm">ÊúóËÆÄÁõÆÂâç</button>
              </div>
              <div id="aiReply">(Á≠âÂæÖ‰Ω†ÁöÑ‰ΩúÁ≠î‚Ä¶)</div>
            </div>
          </div>
        </div>
      </section>
    </section>
  </div>
</div>

<button id="btnExitFocus" class="btn">ËøîÂõûÂΩ±Áâá</button>

<script>
const $=(s,e=document)=>e.querySelector(s);
const $$=(s,e=document)=>[...e.querySelectorAll(s)];
const toSec=t=>{
  if(typeof t==='number')return t;
  const p=String(t).split(':').map(Number);
  if(p.length===3)return p[0]*3600+p[1]*60+p[2];
  if(p.length===2)return p[0]*60+p[1];
  return Number(t)||0;
};
const fmt=sec=>{
  sec=Math.max(0,sec|0);
  const m=(sec/60)|0,s=sec%60;
  return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
};
const esc=s=>String(s??'')
  .replaceAll('&','&amp;').replaceAll('<','&lt;')
  .replaceAll('>','&gt;').replaceAll('"','&quot;');

const params=new URLSearchParams(location.search);
const paramBase=params.get('base');
const BASE = paramBase || (location.host.includes('github.io')? '/EduEnglish' : 'https://bookwide.github.io/EduEnglish');
const cat =(params.get('cat')||'story').toLowerCase();
let slug=params.get('slug')||'houyi';
if(slug==='huyi') slug='houyi';
const vnow=Date.now();

/* ÂΩ±Áâá & ÊéßÂà∂ */
const video=$('#player');
const cuesBody=$('#cuesBody');
const cuesStatus=$('#cuesStatus');
const btnPrev=$('#btnPrev'),btnPlay=$('#btnPlay'),
      btnNext=$('#btnNext'),btnReplay=$('#btnReplay');
const btnOffsetMinus=$('#btnOffsetMinus'),btnOffsetPlus=$('#btnOffsetPlus'),
      offsetVal=$('#offsetVal');
const chkFollow=$('#chkFollow');
const speedRange=$('#speedRange'),speedVal=$('#speedVal');

const paneSub=$('#pane-sub'),paneQuiz=$('#pane-quiz'),
      paneVocab=$('#pane-vocab'),paneAI=$('#pane-ai');

let cues=[],offset=0,loopSentence=false;
let quizData=[],currentQuizCat='all';

function setOffset(v){
  offset=Number(v)||0;
  offsetVal.textContent=`${offset.toFixed(1)}s`;
  localStorage.setItem(`offset:${slug}`,String(offset));
}
window.player={setOffset,clearRepeat:()=>{loopSentence=false;btnReplay?.classList.remove('blue');}};

/* ==== ÊéõÂΩ±ÁâáÔºàSupabase ÂÑ™ÂÖàÔºâ ==== */
async function loadVideo(){
  const SUPA_PUBLIC_BASE='https://jeajrwpmrgczimmrflxo.supabase.co/storage/v1/object/public';
  const SUPA_VIDEOS_BASE=SUPA_PUBLIC_BASE+'/videos';
  const sources=[
    `${SUPA_VIDEOS_BASE}/${cat}/${slug}.mp4`,
    `${BASE}/videos/${cat}/${slug}.mp4`,
    `${BASE}/videos/${slug}.mp4`,
    `${BASE}/videos/story/houyi.mp4`
  ];
  let i=0;
  function setSrc(k){ video.src=sources[k]; }
  setSrc(0);
  video.addEventListener('error',()=>{
    if(i<sources.length-1){i++;setSrc(i);}
  },{passive:true});
}

/* ==== Â≠óÂπï ==== */
async function loadCues(){
  cuesStatus.textContent='ÔºàÂ≠óÂπïËºâÂÖ•‰∏≠‚Ä¶Ôºâ';
  const url=`${BASE}/data/${cat}/${slug}/cues-${slug}.json?v=${vnow}`;
  try{
    const r=await fetch(url,{cache:'no-store'});
    if(!r.ok) throw 0;
    const data=await r.json();
    cues=(Array.isArray(data)?data:(data.cues||[]))
      .map(x=>({t:toSec(x.time),en:x.en||'',zh:x.zh||'',ja:x.ja||''}));
    cuesBody.innerHTML=cues.map((c,i)=>`
      <tr data-i="${i}" style="position:relative">
        <td class="cue-time">${c.t?fmt(c.t):''}</td>
        <td class="cue-en">
          <span class="en-line">${esc(c.en)}</span>
          ${c.zh?`<div class="zh-line">${esc(c.zh)}</div>`:''}
          ${c.ja?`<div class="ja-line">${esc(c.ja)}</div>`:''}
        </td>
      </tr>`).join('');
    cuesStatus.textContent=`Â∑≤ËºâÂÖ•Ôºö${url}`;
  }catch(e){
    console.warn(e);
    cuesStatus.textContent='‚ö†Ô∏è Â≠óÂπïËÆÄÂèñÂ§±ÊïóÔºö'+url;
  }

  cuesBody.addEventListener('click',e=>{
    const tr=e.target.closest('tr'); if(!tr)return;
    const i=+tr.dataset.i;

    // ÈªûÊôÇÈñìÂçÄÂ°äÔºöË∑üÈö® + ÂΩ±ÁâáË∑≥ËΩâ
    if(e.target.closest('.cue-time')){
      seekTo(i,true);
      return;
    }

    // ÈªûÊñáÂ≠óÔºöÂè™Áî®ÁÄèË¶ΩÂô® TTS
    let lang='en-US',text='';
    if(e.target.closest('.ja-line')){lang='ja-JP';text=e.target.closest('.ja-line').textContent.trim();}
    else if(e.target.closest('.zh-line')){lang='zh-TW';text=e.target.closest('.zh-line').textContent.trim();}
    else{lang='en-US';text=(tr.querySelector('.en-line')?.textContent||'').trim();}
    if(!text) return;
    speakText(text,lang);
    highlightRow(i,true);
  },true);
}

/* ==== Ê∏¨È©óÔºàÂõõÈ°û + ÂàóÂç∞Ôºâ ==== */
async function loadQuiz(){
  const meta=$('#quizMeta');
  const url=`${BASE}/data/${cat}/${slug}/quiz-${slug}.json?v=${vnow}`;
  try{
    const r=await fetch(url,{cache:'no-store'});
    if(!r.ok) throw 0;
    const raw=await r.json();
    const arr=Array.isArray(raw)?raw:(raw.questions||raw.data||[]);
    const cats=['vocab','grammar','reading','mix'];

    quizData=arr.map((q,idx)=>{
      const fromData=q.category||q.cat;
      let catKey=fromData||cats[Math.min(3,Math.floor(idx/(arr.length/4||1)))];
      return {...q,_cat:catKey};
    });

    meta.textContent=`Â∑≤ËºâÂÖ•Ôºö${url}`;
    renderQuiz('all');
    setupQuizButtons();
  }catch(e){
    console.warn(e);
    meta.textContent='‚ùå È°åÂ∫´ËÆÄÂèñÂ§±ÊïóÔºö'+url;
  }
}

function renderQuiz(cat){
  if(!quizData.length)return;
  currentQuizCat=cat;
  const labelMap={all:'ÂÖ®ÈÉ®',vocab:'ÂñÆÂ≠ó',grammar:'ÊñáÊ≥ï',reading:'Èñ±ËÆÄ',mix:'Á∂úÂêà'};
  const list=(cat==='all')?quizData:quizData.filter(q=>q._cat===cat);
  const ol=$('#quizList');

  ol.innerHTML=list.map((q,idx)=>{
    const question=q.question||q.q||'';
    const options=q.options||q.choices||[];
    const ans=String(q.answer??'');
    return `<li style="padding:8px 0" data-cat="${q._cat||''}">
      <div style="font-weight:700">[${labelMap[q._cat]||''}] ${esc(question)}</div>
      ${options.map(op=>`<div><label>
        <input type="radio" name="q_${idx}" value="${esc(op)}"> ${esc(op)}
      </label></div>`).join('')}
      <div class="ans muted" data-ans="${esc(ans)}"
           style="display:none;margin-top:6px">Á≠îÊ°àÔºö${esc(ans)}</div>
    </li>`;
  }).join('');

  $('#quizMeta').textContent=`ÁõÆÂâçÈ°ØÁ§∫Ôºö${labelMap[cat]||'ÂÖ®ÈÉ®'}ÔºåÂÖ± ${list.length} È°å„ÄÇ`;
}

function setupQuizButtons(){
  if(setupQuizButtons._done) return;
  setupQuizButtons._done=true;

  const catsRow=$('#quizCats');

  catsRow?.addEventListener('click',e=>{
    const btn=e.target.closest('[data-cat]'); if(!btn)return;
    const cat=btn.dataset.cat;
    $$('#quizCats .btn').forEach(b=>b.classList.toggle('blue',b===btn));
    renderQuiz(cat);
  });

  $('#btnShowAnswer').onclick=()=>{
    $$('#quizList .ans').forEach(a=>a.style.display='block');
  };

  $('#btnSubmitQuiz').onclick=()=>{
    const lis=$$('#quizList > li');
    let s=0,t=0;
    lis.forEach(li=>{
      const ans=li.querySelector('.ans')?.dataset.ans||'';
      const chosen=[...li.querySelectorAll('input[type=radio]')]
        .find(r=>r.checked)?.value||'';
      if(!ans)return;
      t++;
      if(ans.toLowerCase()===chosen.toLowerCase()) s++;
    });
    $('#quizScore').textContent=`ÂæóÂàÜÔºö${s} / ${t}`;
  };

  $('#btnPrint').onclick=()=>{
    // Á¢∫‰øùÂàóÂç∞ÊôÇÈ°ØÁ§∫„ÄåÊ∏¨È©ó„ÄçÂàÜÈ†Å
    if(typeof showTab==='function') showTab('quiz');
    setTimeout(()=>window.print(),50);
  };

  $('#btnPrintAll').onclick=()=>{
    const prev=currentQuizCat;
    renderQuiz('all');
    window.print();
    const targetBtn=$(`#quizCats [data-cat="${prev}"]`);
    $$('#quizCats .btn').forEach(b=>b.classList.toggle('blue',b===targetBtn));
    renderQuiz(prev);
  };
}

/* ==== ÂñÆÂ≠ó ==== */
async function loadVocab(){
  const vStatus=$('#vocabStatus'),vBox=$('#vocabBox');
  const url=`${BASE}/data/${cat}/${slug}/vocab-${slug}.json?v=${vnow}`;
  try{
    const r=await fetch(url,{cache:'no-store'});
    if(!r.ok) throw 0;
    const list=await r.json();
    if(!list?.length){vStatus.textContent='‚ö†Ô∏è Êü•ÁÑ°ÂñÆÂ≠óË≥áÊñô';vBox.innerHTML='';return;}
    vStatus.textContent=`Â∑≤ËºâÂÖ•Ôºö${url}`;
    vBox.innerHTML=list.map(v=>`
      <div style="border:1px solid #223048;border-radius:10px;padding:10px;margin:10px 0">
        <div style="font-weight:800;font-size:18px">${esc(v.word||'')}</div>
        ${v.zh?`<div>„Äê‰∏≠„Äë${esc(v.zh)}</div>`:''}
        ${v.en?`<div>„ÄêËã±„Äë${esc(v.en)}</div>`:''}
        ${v.ja?`<div>„ÄêÊó•„Äë${esc(v.ja)}</div>`:''}
        <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
          ${v.time?`<button class="btn sm" data-act="jump" data-time="${esc(v.time)}">Ë∑≥Âà∞ÁâáÊÆµ</button>`:''}
          ${v.en?`<button class="btn sm" data-act="speak" data-lang="en-US" data-text="${esc(v.en)}">üîä Ëã±</button>`:''}
          ${v.zh?`<button class="btn sm" data-act="speak" data-lang="zh-TW" data-text="${esc(v.zh)}">üîä ‰∏≠</button>`:''}
          ${v.ja?`<button class="btn sm" data-act="speak" data-lang="ja-JP" data-text="${esc(v.ja)}">üîä Êó•</button>`:''}
        </div>
      </div>`).join('');
    vBox.addEventListener('click',e=>{
      const act=e.target?.dataset?.act; if(!act)return;
      if(act==='jump'){
        const p=toSec(e.target.dataset.time||0);
        video.currentTime=Math.max(0,p);video.play();
      }
      if(act==='speak'){
        speakText(e.target.dataset.text||'',e.target.dataset.lang||'en-US');
      }
    });
  }catch(e){
    console.warn(e);
    vStatus.textContent='‚ö†Ô∏è ËÆÄÂèñÂ§±ÊïóÔºö'+url;
  }
}

/* ==== AIÔºà‰∏âË™ûÁ§∫ÁØÑ + Â∞çÊáâÊúóËÆÄÔºâ ==== */
async function loadAI(){
  const url=`${BASE}/data/${cat}/${slug}/ai-${slug}.json?v=${vnow}`;
  try{
    const r=await fetch(url,{cache:'no-store'});
    if(!r.ok) throw 0;
    const data=await r.json();
    const topics=Array.isArray(data)?data:(data.topics||[]);
    const sel=$('#aiTopic');
    sel.innerHTML=topics.map((t,i)=>`
      <option value="${i}">${esc(t.title||t.q||('È°åÁõÆ'+(i+1)))}</option>`).join('');
    const prompt=$('#aiPrompt'),hint=$('#aiHint'),reply=$('#aiReply');
    const total=topics.length;let idx=0;
    let currentLang='en';

    function getSamples(t){
      const jaObj=(t.ja && typeof t.ja==='object')?t.ja:null;
      const zhObj=(t.zh && typeof t.zh==='object')?t.zh:null;
      const enObj=(t.en && typeof t.en==='object')?t.en:null;

      const sampleEn=t.sample_en || t.sampleEn ||
        (enObj && (enObj.sample || enObj.reply)) ||
        (typeof t.en==='string'?t.en:'') ||
        t.sample || t.demo || '';

      const sampleZh=t.sample_zh || t.sampleZh ||
        (zhObj && (zhObj.sample || zhObj.reply)) ||
        (typeof t.zh==='string'?t.zh:'') ||
        t.cn || '';

      const sampleJa=t.sample_ja || t.sampleJa ||
        (jaObj && (jaObj.sample || jaObj.reply)) ||
        (typeof t.ja==='string'?t.ja:'') || '';

      return {sampleEn,sampleZh,sampleJa};
    }

    function setReplyByLang(t,lang){
      const {sampleEn,sampleZh,sampleJa}=getSamples(t);
      let text='';
      if(lang==='zh') text=sampleZh||sampleEn||sampleJa;
      else if(lang==='ja') text=sampleJa||sampleEn||sampleZh;
      else text=sampleEn||sampleZh||sampleJa;
      reply.textContent=text||'(Â∞öÁÑ°Á§∫ÁØÑÂè•)';
    }

    function render(){
      const t=topics[idx]||{};
      prompt.value=t.prompt||t.q||'';
      hint.textContent=t.hint||'';
      setReplyByLang(t,currentLang);
      $('#aiProgress').textContent=`Á¨¨ ${idx+1}/${total} È°å`;
      sel.value=String(idx);
    }
    if(total) render();

    sel.onchange=()=>{idx=+sel.value|0;render();};
    $('#btnPrevTopic').onclick=()=>{idx=(idx-1+total)%total;render();};
    $('#btnNextTopic').onclick=()=>{idx=(idx+1)%total;render();};
    $('#btnTts').onclick=()=>speakText(prompt.value,'en-US');

    $('#aiDemoEn').onclick=()=>{currentLang='en';render();};
    $('#aiDemoZh').onclick=()=>{currentLang='zh';render();};
    $('#aiDemoJa').onclick=()=>{currentLang='ja';render();};

    $('#aiDemoTts').onclick=()=>{
      const t=topics[idx]||{};
      const {sampleEn,sampleZh,sampleJa}=getSamples(t);
      let text='',langCode='en-US';
      if(currentLang==='zh'){text=sampleZh||sampleEn||sampleJa;langCode='zh-TW';}
      else if(currentLang==='ja'){text=sampleJa||sampleEn||sampleZh;langCode='ja-JP';}
      else {text=sampleEn||sampleZh||sampleJa;langCode='en-US';}
      if(text) speakText(text,langCode);
    };

  }catch(e){console.warn(e);}
}

/* ==== ÂõõÂÄã tab ÂàáÊèõ + ÊâãÊ©üÂè≥È†Å focus ==== */
function showTab(name){
  paneSub.style.display=(name==='sub')?'':'none';
  paneQuiz.style.display=(name==='quiz')?'':'none';
  paneVocab.style.display=(name==='vocab')?'':'none';
  paneAI.style.display =(name==='ai')?'':'none';
  $$('.tabs .tab').forEach(t=>t.classList.toggle('active',t.dataset.tab===name));

  if(name!=='sub' && window.matchMedia('(max-width:860px) and (orientation:portrait)').matches){
    const track=$('#track');
    track.scrollTo({left:track.clientWidth,behavior:'smooth'});
    document.body.classList.add('at-right');
  }
}
$$('.tabs .tab').forEach(t=>t.addEventListener('click',()=>showTab(t.dataset.tab)));

(function(){
  const track=$('#track'),btnExit=$('#btnExitFocus');
  function toLeft(){
    if(!track)return;
    track.scrollTo({left:0,behavior:'smooth'});
    document.body.classList.remove('at-right');
  }
  btnExit?.addEventListener('click',toLeft);
  track?.addEventListener('scroll',()=>{
    if(!track)return;
    const atRight=track.scrollLeft>(track.clientWidth/2);
    document.body.classList.toggle('at-right',atRight);
  },{passive:true});
})();

/* ==== Êí≠ÊîæÊéßÂà∂ + Ë∑üÈö®Âè•Â≠ê ==== */
speedRange.addEventListener('input',()=>{
  const r=Number(speedRange.value)||1;
  video.playbackRate=r;
  speedVal.textContent=`${r.toFixed(2)}x`;
});
btnPlay.addEventListener('click',()=>{
  if(video.paused) video.play();
  else video.pause();
});

function currentIndex(){
  const t=video.currentTime+offset;
  let i=0;while(i+1<cues.length && cues[i+1].t<=t+0.0001)i++;
  return i;
}
function highlightRow(idx){
  const trs=$$('#cuesBody tr');
  trs.forEach(tr=>tr.classList.remove('active','speaking'));
  const tr=trs[idx];if(!tr) return;
  tr.classList.add('active','speaking');
  const container=$('#rightScroll');
  if(container){
    const rect=tr.getBoundingClientRect();
    const crect=container.getBoundingClientRect();
    if(rect.top<crect.top || rect.bottom>crect.bottom){
      const targetTop=tr.offsetTop-container.clientHeight/2+tr.offsetHeight/2;
      container.scrollTo({top:Math.max(0,targetTop),behavior:'smooth'});
    }
  }
}
function sentenceRange(i){
  if(!cues[i])return[0,0];
  const s=cues[i].t,e=(i+1<cues.length?cues[i+1].t:s+3);
  return[s,e];
}
function seekTo(idx,play=true){
  if(!cues[idx])return;
  video.currentTime=Math.max(0,cues[idx].t-offset+0.0001);
  highlightRow(idx);
  if(play) video.play();
}

btnPrev.addEventListener('click',()=>seekTo(Math.max(0,currentIndex()-1),true));
btnNext.addEventListener('click',()=>seekTo(Math.min(cues.length-1,currentIndex()+1),true));

(function(){
  const btn=btnReplay;
  const on =()=>{btn.dataset.active='1';btn.classList.add('blue');};
  const off=()=>{btn.dataset.active='0';btn.classList.remove('blue');loopSentence=false;};
  off();
  btn.addEventListener('click',function(e){
    const isOn=btn.dataset.active==='1';
    if(isOn){e.stopImmediatePropagation();window.player.clearRepeat();off();return;}
    loopSentence=true;on();seekTo(currentIndex(),true);
  },true);
})();

btnOffsetMinus.addEventListener('click',()=>setOffset(offset-0.5));
btnOffsetPlus .addEventListener('click',()=>setOffset(offset+0.5));
$('#btnAutoSync').addEventListener('click',()=>{
  alert('ÂÖàËÆìÂΩ±ÁâáËàáÂ≠óÂπïÂ∞çÂà∞‰∏ÄÂÄãÂè•Â≠êÔºåÂÜçÁî®ÂÅèÁßª +/-0.5 ÂæÆË™øÂç≥ÂèØ„ÄÇ\nÔºàÁõÆÂâçÂè™ÊúâÁ∞°ÊòìÊâãÂãïÊ†°Ê∫ñÔºâ');
});

video.addEventListener('timeupdate',()=>{
  if(!cues.length)return;
  const i=currentIndex();highlightRow(i);
  if(loopSentence){
    const [s,e]=sentenceRange(i);
    const t=video.currentTime+offset;
    if(t>=e-0.02){
      video.currentTime=Math.max(0,s-offset+0.0001);
      video.play();
    }
  }
});

/* ==== Browser TTS ==== */
function speakText(text,lang){
  if(!text || !('speechSynthesis' in window))return;
  try{speechSynthesis.cancel();}catch{}
  const u=new SpeechSynthesisUtterance(String(text));
  u.lang=lang||'en-US';u.rate=1.0;u.pitch=1.0;u.volume=1.0;
  speechSynthesis.speak(u);
}

/* ==== ÂàùÂßãÂåñ + ÂÆàÈñÄÁ®ãÂ∫èÔºà‰øùÁïôÔºâ ==== */
(async function init(){
  try{
    // ÂÆàÈñÄÁ®ãÂºèÔºöÈúÄÁôªÂÖ• Supabase ÊâçËÉΩÈÄ≤Êí≠ÊîæÂô®
    if(typeof ensureAuth==='function'){
      await ensureAuth({
        redirect:'/EduEnglish/index.html',
        next:location.pathname+location.search
      });
    }
    let email='';
    if(typeof getSessionUser==='function'){
      const u=await getSessionUser();
      email=(u&&(u.email||(u.user&&u.user.email)))||'';
    }else if(typeof supaGetUser==='function'){
      const u=await supaGetUser();
      email=(u&&(u.email||(u.user&&u.user.email)))||'';
    }
    if(email) $('#userNameBadge').textContent=email;
  }catch(e){console.warn('[auth] error:',e);}

  const saved=localStorage.getItem(`offset:${slug}`);
  if(saved!=null)setOffset(parseFloat(saved));else setOffset(0);
  const r=Number(speedRange.value)||1;video.playbackRate=r;
  speedVal.textContent=`${r.toFixed(2)}x`;

  await loadVideo();
  await loadCues();
  await loadQuiz();
  await loadVocab();
  await loadAI();

  showTab('sub');
})();
</script>
</body>
</html>

















































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































