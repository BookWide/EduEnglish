<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>BookWide æ’­æ”¾å™¨ï¼ˆ4 åˆ†é  + æ¸¬é©—å››é¡ï¼‰</title>

<style>
:root{
  --bg:#0b1324;
  --panel:#0f172a;
  --border:#1f2a44;
  --ink:#e6f0ff;
  --muted:#9fb0c9;
  --accent:#3c7cff;
}
*{box-sizing:border-box;}
html,body{
  margin:0;
  height:100%;
  background:var(--bg);
  color:var(--ink);
  font-family:system-ui,-apple-system,BlinkMacSystemFont,"Noto Sans TC",sans-serif;
  overflow:hidden; /* æ¡Œæ©Ÿï¼šæ•´é ä¸è¦æ²ï¼Œç”±å³å´é¢æ¿è‡ªå·±æ²å‹• */
}
a{color:var(--accent);text-decoration:none;}

header{
  display:flex;
  align-items:center;
  justify-content:space-between;
  padding:12px 18px;
  background:#0f172a;
  border-bottom:1px solid #0e203f;
}
header h1{margin:0;font-size:20px;}

.wrap{
  padding:14px;
  height:calc(100vh - 50px);
}
.layout{
  height:100%;
  display:grid;
  grid-template-columns:1fr 1fr;
  gap:14px;
  overflow:hidden;
}
.layout > *{min-height:0;} /* è®“å·¦å³å…©æ¬„å¯ä»¥å…§éƒ¨æ²å‹• */

.left,.right{
  min-width:0;
  background:var(--panel);
  border:1px solid var(--border);
  border-radius:12px;
}

/* å·¦å´å½±ç‰‡å€ */
.left{
  display:flex;
  flex-direction:column;
  padding:12px;
  position:sticky;
  top:0;
  align-self:flex-start;
}

.videoWrap{
  position:relative;
  width:100%;
  aspect-ratio:16/9;
  background:#000;
  border-radius:10px;
  overflow:hidden;
}
.videoWrap video{
  position:absolute;
  inset:0;
  width:100%;
  height:100%;
  object-fit:cover;
  background:#000;
}

.controls{
  margin-top:10px;
  background:#0e2038;
  border:1px solid #183459;
  border-radius:12px;
  padding:10px;
}
.controls .row{
  display:flex;
  flex-wrap:wrap;
  gap:8px;
  align-items:center;
  margin:4px 0;
}

.btn{
  background:#13233f;
  border:1px solid #24446f;
  border-radius:10px;
  padding:7px 12px;
  color:#fff;
  cursor:pointer;
  font-size:14px;
}
.btn.blue{background:#14335f;border-color:#2c5aa3;}
.btn.sm{padding:5px 10px;font-size:13px;border-radius:999px;}
.btn.sm.blue{background:#14335f;border-color:#2c5aa3;}
.muted{color:var(--muted);font-size:13px;}
.chip{
  display:inline-flex;
  align-items:center;
  gap:4px;
  padding:4px 8px;
  border-radius:999px;
  background:#111f38;
  border:1px solid #1c314f;
  font-size:13px;
}

/* å³å´å››åˆ†é æ•´é«”ï¼šå¯å…§éƒ¨æ²å‹• */
.right{
  display:flex;
  flex-direction:column;
  overflow:hidden;
  min-height:0;
}
.rightScroll{
  flex:1 1 auto;
  min-height:0;
  overflow-y:auto;
  position:relative;
  scrollbar-width:thin;
}
.rightScroll::-webkit-scrollbar{width:10px;}
.rightScroll::-webkit-scrollbar-thumb{
  background:#556a9a;
  border-radius:6px;
}

/* é ‚ç«¯é¸é …å¡ */
.tabs{
  display:flex;
  gap:8px;
  padding:6px 10px;
  margin:0;
  border-bottom:1px solid var(--border);
  position:sticky;
  top:0;
  z-index:20;
  background:var(--panel);
}
.tab{
  cursor:pointer;
  background:#122340;
  border:1px solid #1f375f;
  border-radius:12px;
  padding:8px 14px;
  font-weight:600;
  font-size:14px;
}
.tab.active{background:#154274;}

.pane{
  padding:0 0 12px;
  min-height:0;
}

/* å­—å¹• */
table{width:100%;border-collapse:collapse;}
th,td{
  padding:8px 10px;
  border-bottom:1px solid #162a48;
  vertical-align:top;
}
tbody tr{background:#0f1f34;}
tbody tr:nth-child(2n){background:#0d1a2b;}
tbody tr:hover{background:#0f2a4e;}
tr.active{background:#173a6e;}

.cues-table{table-layout:fixed;}
.cue-time{
  width:64px;
  min-width:64px;
  color:rgba(255,255,255,.75);
  font-family:ui-monospace,Consolas,monospace;
  white-space:nowrap;
}
.cue-en{line-height:1.6;word-break:break-word;position:relative;}
.zh-line,.ja-line{margin-top:4px;opacity:.96;}

/* å»æ‰å–‡å­ï¼Œåªç•™å·¦å´é«˜äº® */
tr.speaking::before{content:none!important;}
tr.speaking{
  box-shadow:inset 3px 0 0 0 rgba(60,124,255,.55)!important;
  background:rgba(60,124,255,.10)!important;
}

/* å­—å¹•è¡¨é ­ sticky */
#pane-sub thead th{
  position:sticky;
  top:44px;
  background:var(--panel);
  z-index:10;
}

/* æ¸¬é©—ï¼šå››é¡æŒ‰éˆ•åˆ— */
.quiz-cats{
  padding:8px 12px;
  display:flex;
  gap:8px;
  flex-wrap:wrap;
  border-bottom:1px solid #162a48;
}

/* AI å€å¡Š */
#pane-ai textarea{
  width:100%;
  resize:vertical;
  font-family:inherit;
  border-radius:8px;
  border:1px solid #223048;
  background:#050b18;
  color:var(--ink);
  padding:8px;
}
#aiReply{
  border:1px solid #223048;
  border-radius:10px;
  padding:10px;
  min-height:54px;
}

/* æ‰‹æ©Ÿï¼šå·¦å³å…©é  */
@media (max-width:860px) and (orientation:portrait){
  html,body{
    overflow:auto;              /* æ‰‹æ©Ÿï¼šæ¢å¾©æ•´é æ²å‹• */
    height:100%;
  }
  .wrap{
    height:auto;
  }
  .layout{
    height:auto;
  }
  .rightScroll{
    max-height:none;
    overflow-y:visible;         /* æ‰‹æ©Ÿç‰ˆå³å´ä¸å†ç¨ç«‹å·è»¸ï¼Œæ”¹æˆæ•´é æ²å‹• */
  }

  #track{
    display:flex;
    overflow-x:auto;
    overflow-y:hidden;
    scroll-snap-type:x mandatory;
  }
  .page{
    flex:0 0 100vw;
    max-width:100vw;
    height:calc(100vh - 50px);
    scroll-snap-align:start;
    overflow-y:auto;
  }
  .left,.right{
    width:100%;
    max-width:100%;
    border-radius:0;
    border-left:0;
    border-right:0;
  }
  #btnExitFocus{
    position:fixed;
    right:16px;
    bottom:16px;
    z-index:10020;
    padding:10px 14px;
    border:1px solid rgba(100,116,139,.5);
    background:#0f172a;
    color:#e6efff;
    border-radius:12px;
    display:none;
  }
  body.at-right #btnExitFocus{display:inline-flex;}
}

/* åˆ—å° */
@media print{
  header,.controls,.tabs,#btnExitFocus{display:none!important;}
  body{background:#fff;color:#000;}
  .left{display:none!important;}
  .right{border:none;}
}


/* æ¡Œæ©Ÿï¼šå³å´å…§å®¹å¯ç¨ç«‹æ²å‹•ï¼Œåº•éƒ¨å¤§ç´„èˆ‡å·¦å´é½Š */
@media (min-width: 861px){
  .rightScroll{
    max-height: calc(100vh - 90px); /*  */
    overflow-y: auto;
  }
}

/* === V12 print override based on V7 (2025-11-14) === */
@media print{
  /* 1) åªä¿ç•™å³å´å…§å®¹ï¼Œéš±è—æ¨™é ­èˆ‡å·¦å´å½±ç‰‡å€ */
  header,.controls,.tabs,#btnExitFocus{display:none!important;}
  html,body{
    height:auto!important;
    overflow:visible!important;
    background:#fff!important;
    color:#000!important;
  }
  .wrap,
  .layout{
    height:auto!important;
    min-height:0!important;
    display:block!important;
    overflow:visible!important;
  }
  #track{
    display:block!important;
    height:auto!important;
    overflow:visible!important;
  }
  #pageLeft,
  .left{
    display:none!important;
  }
  #pageRight{
    display:block!important;
    width:100%!important;
    height:auto!important;
    overflow:visible!important;
  }
  #pageRight .right{
    display:block!important;
    height:auto!important;
    max-width:100%!important;
    max-height:none!important;
    border:none!important;
    overflow:visible!important;
  }
  #pageRight .rightScroll{
    display:block!important;
    height:auto!important;
    max-height:none!important;
    overflow:visible!important;
    padding-bottom:0!important;
  }
}
</style>

<!-- Supabase JSï¼ˆåªç”¨æ–¼ player å®ˆé–€ï¼Œä¸å½±éŸ¿å…¶å®ƒé é¢ï¼‰ -->
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
  const SUPABASE_URL = 'https://jeajrwpmrgczimmrflxo.supabase.co';
  const SUPABASE_ANON_KEY =
    'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImplYWpyd3BtcmdjemltbXJmbHhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3MTg5MzksImV4cCI6MjA3NjI5NDkzOX0.3iFXdHH0JEuk177_R4TGFJmOxYK9V8XctON6rDe7-Do';

  // åƒ…ä¾› player.html ä½¿ç”¨çš„ Supabase Client
  const playerSupa = supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

  async function bwPlayerGetUser() {
    try {
      const { data, error } = await playerSupa.auth.getUser();
      if (error || !data || !data.user) return null;
      return data.user;
    } catch (err) {
      console.error('[player-auth] getUser error', err);
      return null;
    }
  }

  // æä¾›çµ¦èˆŠç¨‹å¼ä½¿ç”¨çš„å®ˆé–€ / å– user å‡½å¼
  async function ensureAuth(options = {}) {
    const redirect = options.redirect || '/EduEnglish/index.html';
    const next =
      options.next || (location.pathname + location.search);

    const user = await bwPlayerGetUser();
    if (user) return user;

    const url =
      redirect +
      '?denied=signin&next=' +
      encodeURIComponent(next);
    window.location.href = url;
    return null;
  }

  async function getSessionUser() {
    return await bwPlayerGetUser();
  }

  async function supaGetUser() {
    return await bwPlayerGetUser();
  }
</script>
</head>
<body>
<header>
  <h1>æ’­æ”¾å™¨</h1>
  <div style="display:flex;align-items:center;gap:10px">
    <!-- âœ… é€™è£¡æ”¹æˆ /EduEnglish/index.html -->
    <a class="btn" href="/EduEnglish/index.html">ğŸ  å›é¦–é </a>
    <span class="muted" id="userNameBadge"></span>
  </div>
</header>

<div class="wrap">
  <div id="track" class="layout">
    <!-- å·¦ï¼šå½±ç‰‡ -->
    <section class="page" id="pageLeft">
      <section class="left">
        <div class="videoWrap">
          <video id="player" playsinline controls></video>
        </div>
        <div class="controls">
          <div class="row">
            <button class="btn" id="btnPrev">â® ä¸Šä¸€å¥</button>
            <button class="btn" id="btnPlay">â–¶ï¸ æ’­æ”¾ / æš«åœ</button>
            <button class="btn" id="btnNext">â­ ä¸‹ä¸€å¥</button>
            <button class="btn" id="btnReplay">ğŸ” é‡è¤‡æœ¬å¥</button>
          </div>
          <div class="row">
            <label class="chip"><input id="chkFollow" type="checkbox" /> è·Ÿéš¨</label>
            <span class="chip">åç§» <span id="offsetVal">0.0s</span></span>
            <button class="btn" id="btnOffsetMinus">-0.5s</button>
            <button class="btn" id="btnOffsetPlus">+0.5s</button>
            <button class="btn" id="btnAutoSync">ğŸ§­ ç°¡æ˜“æ ¡æº–</button>
          </div>
          <div class="row" style="gap:10px">
            <span class="muted">é€Ÿåº¦</span>
            <input id="speedRange" type="range" min="0.5" max="2" step="0.05" value="1" />
            <span id="speedVal">1.00x</span>
          </div>
        </div>
      </section>
    </section>

    <!-- å³ï¼šå››åˆ†é ï¼ˆå¤–å±¤ right + å…§å±¤ rightScroll æœ‰æ²è»¸ï¼‰ -->
    <section class="page" id="pageRight">
      <section class="right">
        <div class="rightScroll" id="rightScroll">
          <div class="tabs">
            <div class="tab active" data-tab="sub">å­—å¹•</div>
            <div class="tab" data-tab="quiz">æ¸¬é©—</div>
            <div class="tab" data-tab="vocab">å–®å­—</div>
            <div class="tab" data-tab="ai">AIäº’å‹•</div>
          </div>

          <!-- å­—å¹• -->
          <div class="pane" id="pane-sub">
            <div class="muted" id="cuesStatus" style="padding:8px 12px">ï¼ˆå­—å¹•è¼‰å…¥ä¸­â€¦ï¼‰</div>
            <table class="cues-table">
              <thead>
              <tr><th style="width:80px">æ™‚é–“</th><th>è‹±æ–‡ / ä¸­æ–‡ / æ—¥æ–‡</th></tr>
              </thead>
              <tbody id="cuesBody"></tbody>
            </table>
          </div>

          <!-- æ¸¬é©—ï¼šå››é¡ + åˆ—å° -->
          <div class="pane" id="pane-quiz" style="display:none">
            <div id="quizCats" class="quiz-cats">
              <button class="btn sm blue" data-cat="all">å…¨éƒ¨</button>
              <button class="btn sm" data-cat="vocab">å–®å­—</button>
              <button class="btn sm" data-cat="grammar">æ–‡æ³•</button>
              <button class="btn sm" data-cat="reading">é–±è®€</button>
              <button class="btn sm" data-cat="mix">ç¶œåˆ</button>
            </div>
            <div class="muted" id="quizMeta" style="padding:6px 12px">ï¼ˆæ¸¬é©—è¼‰å…¥ä¸­â€¦ï¼‰</div>
            <ol id="quizList" style="line-height:1.6;padding:0 28px"></ol>
            <div class="q-actions" style="margin:12px 12px 4px;display:flex;flex-wrap:wrap;gap:8px;align-items:center;">
              <button class="btn" id="btnSubmitQuiz">äº¤å·</button>
              <button class="btn" id="btnShowAnswer">é¡¯ç¤ºç­”æ¡ˆ</button>
              <button class="btn" id="btnPrint">åˆ—å°ç›®å‰é </button>
              <button class="btn" id="btnPrintAll">å®Œæ•´åˆ—å° 4 é¡</button>
              <span id="quizScore" style="margin-left:8px"></span>
            </div>
          </div>

          <!-- å–®å­— -->
          <div class="pane" id="pane-vocab" style="display:none">
            <div class="muted" id="vocabStatus" style="padding:8px 12px">( å–®å­—è¼‰å…¥ä¸­â€¦ )</div>
            <div id="vocabBox" style="padding:0 12px 12px;"></div>
          </div>

          <!-- AI äº’å‹• -->
          <div class="pane" id="pane-ai" style="display:none">
            <div style="padding:8px 12px">
              <div class="muted" style="margin-bottom:6px">
                ç¶²å€æ ¼å¼ï¼š<code>?cat=story|music|movie|news|pro&slug=houyi</code>
              </div>
              <div style="display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin-bottom:6px">
                <select id="aiTopic" class="btn" style="min-width:180px"></select>
                <button id="btnPrevTopic" class="btn sm">â—€ ä¸Šä¸€é¡Œ</button>
                <button id="btnNextTopic" class="btn sm">ä¸‹ä¸€é¡Œ â–¶</button>
                <button id="btnTts" class="btn sm">é¡Œç›®æœ—è®€</button>
                <button id="btnRec" class="btn sm">ğŸ™ï¸ é–‹å§‹èªª</button>
                <button id="btnStop" class="btn sm" disabled>â›” åœæ­¢</button>
                <label class="muted"><input id="aiAutoNext" type="checkbox" /> ä½œç­”å¾Œè‡ªå‹•ä¸‹ä¸€é¡Œ</label>
                <span id="aiProgress" class="muted">ç¬¬ 0/0 é¡Œ</span>
              </div>
              <textarea id="aiPrompt" rows="3" readonly placeholder="é¡Œç›®æœƒé¡¯ç¤ºåœ¨é€™è£¡â€¦"></textarea>
              <div style="margin:8px 0 4px">
                <span class="muted">æç¤ºï¼š</span><span id="aiHint" class="muted">â€”</span>
              </div>
              <div style="display:flex;flex-wrap:wrap;gap:8px;align-items:center;margin:6px 0">
                <span class="muted">AI ç¤ºç¯„ï¼š</span>
                <button id="aiDemoEn" class="btn sm">è‹±</button>
                <button id="aiDemoZh" class="btn sm">ä¸­</button>
                <button id="aiDemoJa" class="btn sm">æ—¥</button>
                <button id="aiDemoTts" class="btn sm">æœ—è®€ç›®å‰</button>
              </div>
              <div id="aiReply">(ç­‰å¾…ä½ çš„ä½œç­”â€¦)</div>
            </div>
          </div>
        </div>
      </section>
    </section>
  </div>
</div>

<button id="btnExitFocus" class="btn">è¿”å›å½±ç‰‡</button>

<script>
const $=(s,e=document)=>e.querySelector(s);
const $$=(s,e=document)=>[...e.querySelectorAll(s)];
const toSec=t=>{
  if(typeof t==='number')return t;
  const p=String(t).split(':').map(Number);
  if(p.length===3)return p[0]*3600+p[1]*60+p[2];
  if(p.length===2)return p[0]*60+p[1];
  return Number(t)||0;
};
const fmt=sec=>{
  sec=Math.max(0,sec|0);
  const m=(sec/60)|0,s=sec%60;
  return `${String(m).padStart(2,'0')}:${String(s).padStart(2,'0')}`;
};
const esc=s=>String(s??'')
  .replaceAll('&','&amp;').replaceAll('<','&lt;')
  .replaceAll('>','&gt;').replaceAll('"','&quot;');

const params=new URLSearchParams(location.search);
const paramBase=params.get('base');

/* âœ… é€™è£¡æ”¹æˆå›ºå®š /EduEnglishï¼ˆä¸å†æŒ‡åˆ° bookwide.github.ioï¼‰ */
const BASE = paramBase || '/EduEnglish';

const cat =(params.get('cat')||'story').toLowerCase();
let slug=params.get('slug')||'houyi';
if(slug==='huyi') slug='houyi';
const vnow=Date.now();

/* å½±ç‰‡ & æ§åˆ¶ */
const video=$('#player');
const cuesBody=$('#cuesBody');
const cuesStatus=$('#cuesStatus');
const btnPrev=$('#btnPrev'),btnPlay=$('#btnPlay'),
      btnNext=$('#btnNext'),btnReplay=$('#btnReplay');
const btnOffsetMinus=$('#btnOffsetMinus'),btnOffsetPlus=$('#btnOffsetPlus'),
      offsetVal=$('#offsetVal');
const chkFollow=$('#chkFollow');
const speedRange=$('#speedRange'),speedVal=$('#speedVal');

const paneSub=$('#pane-sub'),paneQuiz=$('#pane-quiz'),
      paneVocab=$('#pane-vocab'),paneAI=$('#pane-ai');

let cues=[],offset=0,loopSentence=false;
let quizData=[],currentQuizCat='all';

function setOffset(v){
  offset=Number(v)||0;
  offsetVal.textContent=`${offset.toFixed(1)}s`;
  localStorage.setItem(`offset:${slug}`,String(offset));
}
window.player={setOffset,clearRepeat:()=>{loopSentence=false;btnReplay?.classList.remove('blue');}};

/* ==== æ›å½±ç‰‡ï¼ˆSupabase å„ªå…ˆï¼‰ ==== */
async function loadVideo(){
  const SUPA_PUBLIC_BASE='https://jeajrwpmrgczimmrflxo.supabase.co/storage/v1/object/public';
  const SUPA_VIDEOS_BASE=SUPA_PUBLIC_BASE+'/videos';
  const sources=[
    `${SUPA_VIDEOS_BASE}/${cat}/${slug}.mp4`,
    `${BASE}/videos/${cat}/${slug}.mp4`,
    `${BASE}/videos/${slug}.mp4`,
    `${BASE}/videos/story/houyi.mp4`
  ];
  let i=0;
  function setSrc(k){ video.src=sources[k]; }
  setSrc(0);
  video.addEventListener('error',()=>{
    if(i<sources.length-1){i++;setSrc(i);}
  },{passive:true});
}

/* ==== å­—å¹• ==== */
async function loadCues(){
  cuesStatus.textContent='ï¼ˆå­—å¹•è¼‰å…¥ä¸­â€¦ï¼‰';
  const url=`${BASE}/data/${cat}/${slug}/cues-${slug}.json?v=${vnow}`;
  try{
    const r=await fetch(url,{cache:'no-store'});
    if(!r.ok) throw 0;
    const data=await r.json();
    cues=(Array.isArray(data)?data:(data.cues||[]))
      .map(x=>({t:toSec(x.time),en:x.en||'',zh:x.zh||'',ja:x.ja||''}));
    cuesBody.innerHTML=cues.map((c,i)=>`
      <tr data-i="${i}" style="position:relative">
        <td class="cue-time">${c.t?fmt(c.t):''}</td>
        <td class="cue-en">
          <span class="en-line">${esc(c.en)}</span>
          ${c.zh?`<div class="zh-line">${esc(c.zh)}</div>`:''}
          ${c.ja?`<div class="ja-line">${esc(c.ja)}</div>`:''}
        </td>
      </tr>`).join('');
    cuesStatus.textContent=`å·²è¼‰å…¥ï¼š${url}`;
  }catch(e){
    console.warn(e);
    cuesStatus.textContent='âš ï¸ å­—å¹•è®€å–å¤±æ•—ï¼š'+url;
  }

  cuesBody.addEventListener('click',e=>{
    const tr=e.target.closest('tr'); if(!tr)return;
    const i=+tr.dataset.i;

    // é»æ™‚é–“å€å¡Šï¼šè·Ÿéš¨ + å½±ç‰‡è·³è½‰
    if(e.target.closest('.cue-time')){
      seekTo(i,true);
      return;
    }

    // é»æ–‡å­—ï¼šåªç”¨ç€è¦½å™¨ TTS
    let lang='en-US',text='';
    if(e.target.closest('.ja-line')){lang='ja-JP';text=e.target.closest('.ja-line').textContent.trim();}
    else if(e.target.closest('.zh-line')){lang='zh-TW';text=e.target.closest('.zh-line').textContent.trim();}
    else{lang='en-US';text=(tr.querySelector('.en-line')?.textContent||'').trim();}
    if(!text) return;
    speakText(text,lang);
    highlightRow(i,true);
  },true);
}

/* ==== æ¸¬é©—ï¼ˆå››é¡ + åˆ—å°ï¼‰ ==== */
async function loadQuiz(){
  const meta=$('#quizMeta');
  const url=`${BASE}/data/${cat}/${slug}/quiz-${slug}.json?v=${vnow}`;
  try{
    const r=await fetch(url,{cache:'no-store'});
    if(!r.ok) throw 0;
    const raw=await r.json();
    const arr=Array.isArray(raw)?raw:(raw.questions||raw.data||[]);
    const cats=['vocab','grammar','reading','mix'];

    quizData=arr.map((q,idx)=>{
      const fromData=q.category||q.cat;
      let catKey=fromData||cats[Math.min(3,Math.floor(idx/(arr.length/4||1)))];
      return {...q,_cat:catKey};
    });

    meta.textContent=`å·²è¼‰å…¥ï¼š${url}`;
    renderQuiz('all');
    setupQuizButtons();
  }catch(e){
    console.warn(e);
    meta.textContent='âŒ é¡Œåº«è®€å–å¤±æ•—ï¼š'+url;
  }
}

function renderQuiz(cat){
  if(!quizData.length)return;
  currentQuizCat=cat;
  const labelMap={all:'å…¨éƒ¨',vocab:'å–®å­—',grammar:'æ–‡æ³•',reading:'é–±è®€',mix:'ç¶œåˆ'};
  const list=(cat==='all')?quizData:quizData.filter(q=>q._cat===cat);
  const ol=$('#quizList');

  ol.innerHTML=list.map((q,idx)=>{
    const question=q.question||q.q||'';
    const options=q.options||q.choices||[];
    const ans=String(q.answer??'');
    return `<li style="padding:8px 0" data-cat="${q._cat||''}">
      <div style="font-weight:700">[${labelMap[q._cat]||''}] ${esc(question)}</div>
      ${options.map(op=>`<div><label>
        <input type="radio" name="q_${idx}" value="${esc(op)}"> ${esc(op)}
      </label></div>`).join('')}
      <div class="ans muted" data-ans="${esc(ans)}"
           style="display:none;margin-top:6px">ç­”æ¡ˆï¼š${esc(ans)}</div>
    </li>`;
  }).join('');

  $('#quizMeta').textContent=`ç›®å‰é¡¯ç¤ºï¼š${labelMap[cat]||'å…¨éƒ¨'}ï¼Œå…± ${list.length} é¡Œã€‚`;
}

function setupQuizButtons(){
  if(setupQuizButtons._done) return;
  setupQuizButtons._done=true;

  const catsRow=$('#quizCats');

  catsRow?.addEventListener('click',e=>{
    const btn=e.target.closest('[data-cat]'); if(!btn)return;
    const cat=btn.dataset.cat;
    $$('#quizCats .btn').forEach(b=>b.classList.toggle('blue',b===btn));
    renderQuiz(cat);
  });

  $('#btnShowAnswer').onclick=()=>{
    $$('#quizList .ans').forEach(a=>a.style.display='block');
  };

  $('#btnSubmitQuiz').onclick=()=>{
    const lis=$$('#quizList > li');
    let s=0,t=0;
    lis.forEach(li=>{
      const ans=li.querySelector('.ans')?.dataset.ans||'';
      const chosen=[...li.querySelectorAll('input[type=radio]')]
        .find(r=>r.checked)?.value||'';
      if(!ans)return;
      t++;
      if(ans.toLowerCase()===chosen.toLowerCase()) s++;
    });
    $('#quizScore').textContent=`å¾—åˆ†ï¼š${s} / ${t}`;
  };

  $('#btnPrint').onclick=()=>{
    // ç¢ºä¿åˆ—å°æ™‚é¡¯ç¤ºã€Œæ¸¬é©—ã€åˆ†é 
    if(typeof showTab==='function') showTab('quiz');
    setTimeout(()=>window.print(),50);
  };

  $('#btnPrintAll').onclick=()=>{
    const prev=currentQuizCat;
    renderQuiz('all');
    window.print();
    const targetBtn=$(`#quizCats [data-cat="${prev}"]`);
    $$('#quizCats .btn').forEach(b=>b.classList.toggle('blue',b===targetBtn));
    renderQuiz(prev);
  };
}

/* ==== å–®å­— ==== */
async function loadVocab(){
  const vStatus=$('#vocabStatus'),vBox=$('#vocabBox');
  const url=`${BASE}/data/${cat}/${slug}/vocab-${slug}.json?v=${vnow}`;
  try{
    const r=await fetch(url,{cache:'no-store'});
    if(!r.ok) throw 0;
    const list=await r.json();
    if(!list?.length){vStatus.textContent='âš ï¸ æŸ¥ç„¡å–®å­—è³‡æ–™';vBox.innerHTML='';return;}
    vStatus.textContent=`å·²è¼‰å…¥ï¼š${url}`;
    vBox.innerHTML=list.map(v=>`
      <div style="border:1px solid #223048;border-radius:10px;padding:10px;margin:10px 0">
        <div style="font-weight:800;font-size:18px">${esc(v.word||'')}</div>
        ${v.zh?`<div>ã€ä¸­ã€‘${esc(v.zh)}</div>`:''}
        ${v.en?`<div>ã€è‹±ã€‘${esc(v.en)}</div>`:''}
        ${v.ja?`<div>ã€æ—¥ã€‘${esc(v.ja)}</div>`:''}
        <div style="margin-top:8px;display:flex;gap:8px;flex-wrap:wrap">
          ${v.time?`<button class="btn sm" data-act="jump" data-time="${esc(v.time)}">è·³åˆ°ç‰‡æ®µ</button>`:''}
          ${v.en?`<button class="btn sm" data-act="speak" data-lang="en-US" data-text="${esc(v.en)}">ğŸ”Š è‹±</button>`:''}
          ${v.zh?`<button class="btn sm" data-act="speak" data-lang="zh-TW" data-text="${esc(v.zh)}">ğŸ”Š ä¸­</button>`:''}
          ${v.ja?`<button class="btn sm" data-act="speak" data-lang="ja-JP" data-text="${esc(v.ja)}">ğŸ”Š æ—¥</button>`:''}
        </div>
      </div>`).join('');
    vBox.addEventListener('click',e=>{
      const act=e.target?.dataset?.act; if(!act)return;
      if(act==='jump'){
        const p=toSec(e.target.dataset.time||0);
        video.currentTime=Math.max(0,p);video.play();
      }
      if(act==='speak'){
        speakText(e.target.dataset.text||'',e.target.dataset.lang||'en-US');
      }
    });
  }catch(e){
    console.warn(e);
    vStatus.textContent='âš ï¸ è®€å–å¤±æ•—ï¼š'+url;
  }
}

/* ==== AIï¼ˆä¸‰èªç¤ºç¯„ + å°æ‡‰æœ—è®€ï¼‰ ==== */
async function loadAI(){
  const url=`${BASE}/data/${cat}/${slug}/ai-${slug}.json?v=${vnow}`;
  try{
    const r=await fetch(url,{cache:'no-store'});
    if(!r.ok) throw 0;
    const data=await r.json();
    const topics=Array.isArray(data)?data:(data.topics||[]);
    const sel=$('#aiTopic');
    sel.innerHTML=topics.map((t,i)=>`
      <option value="${i}">${esc(t.title||t.q||('é¡Œç›®'+(i+1)))}</option>`).join('');
    const prompt=$('#aiPrompt'),hint=$('#aiHint'),reply=$('#aiReply']);
    const total=topics.length;let idx=0;
    let currentLang='en';

    function getSamples(t){
      const jaObj=(t.ja && typeof t.ja==='object')?t.ja:null;
      const zhObj=(t.zh && typeof t.zh==='object')?t.zh:null;
      const enObj=(t.en && typeof t.en==='object')?t.en:null;

      const sampleEn=t.sample_en || t.sampleEn ||
        (enObj && (enObj.sample || enObj.reply)) ||
        (typeof t.en==='string'?t.en:'') ||
        t.sample || t.demo || '';

      const sampleZh=t.sample_zh || t.sampleZh ||
        (zhObj && (zhObj.sample || zhObj.reply)) ||
        (typeof t.zh==='string'?t.zh:'') ||
        t.cn || '';

      const sampleJa=t.sample_ja || t.sampleJa ||
        (jaObj && (jaObj.sample || jaObj.reply)) ||
        (typeof t.ja==='string'?t.ja:'') || '';

      return {sampleEn,sampleZh,sampleJa};
    }

    function setReplyByLang(t,lang){
      const {sampleEn,sampleZh,sampleJa}=getSamples(t);
      let text='';
      if(lang==='zh') text=sampleZh||sampleEn||sampleJa;
      else if(lang==='ja') text=sampleJa||sampleEn||sampleZh;
      else text=sampleEn||sampleZh||sampleJa;
      reply.textContent=text||'(å°šç„¡ç¤ºç¯„å¥)';
    }

    function render(){
      const t=topics[idx]||{};
      prompt.value=t.prompt||t.q||'';
      hint.textContent=t.hint||'';
      setReplyByLang(t,currentLang);
      $('#aiProgress').textContent=`ç¬¬ ${idx+1}/${total} é¡Œ`;
      sel.value=String(idx);
    }
    if(total) render();

    sel.onchange=()=>{idx=+sel.value|0;render();};
    $('#btnPrevTopic').onclick=()=>{idx=(idx-1+total)%total;render();};
    $('#btnNextTopic').onclick=()=>{idx=(idx+1)%total;render();};
    $('#btnTts').onclick=()=>speakText(prompt.value,'en-US');

    $('#aiDemoEn').onclick=()=>{currentLang='en';render();};
    $('#aiDemoZh').onclick=()=>{currentLang='zh';render();};
    $('#aiDemoJa').onclick=()=>{currentLang='ja';render();};

    $('#aiDemoTts').onclick=()=>{
      const t=topics[idx]||{};
      const {sampleEn,sampleZh,sampleJa}=getSamples(t);
      let text='',langCode='en-US';
      if(currentLang==='zh'){text=sampleZh||sampleEn||sampleJa;langCode='zh-TW';}
      else if(currentLang==='ja'){text=sampleJa||sampleEn||sampleZh;langCode='ja-JP';}
      else {text=sampleEn||sampleZh||sampleJa;langCode='en-US';}
      if(text) speakText(text,langCode);
    };

  }catch(e){console.warn(e);}
}

/* ==== å››å€‹ tab åˆ‡æ› + æ‰‹æ©Ÿå³é  focus ==== */
function showTab(name){
  paneSub.style.display=(name==='sub')?'':'none';
  paneQuiz.style.display=(name==='quiz')?'':'none';
  paneVocab.style.display=(name==='vocab')?'':'none';
  paneAI.style.display =(name==='ai')?'':'none';
  $$('.tabs .tab').forEach(t=>t.classList.toggle('active',t.dataset.tab===name));

  if(name!=='sub' && window.matchMedia('(max-width:860px) and (orientation:portrait)').matches){
    const track=$('#track');
    track.scrollTo({left:track.clientWidth,behavior:'smooth'});
    document.body.classList.add('at-right');
  }
}
$$('.tabs .tab').forEach(t=>t.addEventListener('click',()=>showTab(t.dataset.tab)));

(function(){
  const track=$('#track'),btnExit=$('#btnExitFocus');
  function toLeft(){
    if(!track)return;
    track.scrollTo({left:0,behavior:'smooth'});
    document.body.classList.remove('at-right');
  }
  btnExit?.addEventListener('click',toLeft);
  track?.addEventListener('scroll',()=>{
    if(!track)return;
    const atRight=track.scrollLeft>(track.clientWidth/2);
    document.body.classList.toggle('at-right',atRight);
  },{passive:true});
})();

/* ==== æ’­æ”¾æ§åˆ¶ + è·Ÿéš¨å¥å­ ==== */
speedRange.addEventListener('input',()=>{
  const r=Number(speedRange.value)||1;
  video.playbackRate=r;
  speedVal.textContent=`${r.toFixed(2)}x`;
});
btnPlay.addEventListener('click',()=>{
  if(video.paused) video.play();
  else video.pause();
});

function currentIndex(){
  const t=video.currentTime+offset;
  let i=0;while(i+1<cues.length && cues[i+1].t<=t+0.0001)i++;
  return i;
}
function highlightRow(idx){
  const trs=$$('#cuesBody tr');
  trs.forEach(tr=>tr.classList.remove('active','speaking'));
  const tr=trs[idx];if(!tr) return;
  tr.classList.add('active','speaking');
  const container=$('#rightScroll');
  if(container){
    const rect=tr.getBoundingClientRect();
    const crect=container.getBoundingClientRect();
    if(rect.top<crect.top || rect.bottom>crect.bottom){
      const targetTop=tr.offsetTop-container.clientHeight/2+tr.offsetHeight/2;
      container.scrollTo({top:Math.max(0,targetTop),behavior:'smooth'});
    }
  }
}
function sentenceRange(i){
  if(!cues[i])return[0,0];
  const s=cues[i].t,e=(i+1<cues.length?cues[i+1].t:s+3);
  return[s,e];
}
function seekTo(idx,play=true){
  if(!cues[idx])return;
  video.currentTime=Math.max(0,cues[idx].t-offset+0.0001);
  highlightRow(idx);
  if(play) video.play();
}

btnPrev.addEventListener('click',()=>seekTo(Math.max(0,currentIndex()-1),true));
btnNext.addEventListener('click',()=>seekTo(Math.min(cues.length-1,currentIndex()+1),true));

(function(){
  const btn=btnReplay;
  const on =()=>{btn.dataset.active='1';btn.classList.add('blue');};
  const off=()=>{btn.dataset.active='0';btn.classList.remove('blue');loopSentence=false;};
  off();
  btn.addEventListener('click',function(e){
    const isOn=btn.dataset.active==='1';
    if(isOn){e.stopImmediatePropagation();window.player.clearRepeat();off();return;}
    loopSentence=true;on();seekTo(currentIndex(),true);
  },true);
})();

btnOffsetMinus.addEventListener('click',()=>setOffset(offset-0.5));
btnOffsetPlus .addEventListener('click',()=>setOffset(offset+0.5));
$('#btnAutoSync').addEventListener('click',()=>{
  alert('å…ˆè®“å½±ç‰‡èˆ‡å­—å¹•å°åˆ°ä¸€å€‹å¥å­ï¼Œå†ç”¨åç§» +/-0.5 å¾®èª¿å³å¯ã€‚\nï¼ˆç›®å‰åªæœ‰ç°¡æ˜“æ‰‹å‹•æ ¡æº–ï¼‰');
});

video.addEventListener('timeupdate',()=>{
  if(!cues.length)return;
  const i=currentIndex();highlightRow(i);
  if(loopSentence){
    const [s,e]=sentenceRange(i);
    const t=video.currentTime+offset;
    if(t>=e-0.02){
      video.currentTime=Math.max(0,s-offset+0.0001);
      video.play();
    }
  }
});

/* ==== Browser TTS ==== */
function speakText(text,lang){
  if(!text || !('speechSynthesis' in window))return;
  try{speechSynthesis.cancel();}catch{}
  const u=new SpeechSynthesisUtterance(String(text));
  u.lang=lang||'en-US';u.rate=1.0;u.pitch=1.0;u.volume=1.0;
  speechSynthesis.speak(u);
}


/* ==== åˆå§‹åŒ– + å®ˆé–€ç¨‹åºï¼ˆç™»å…¥ + è¨‚é–± + previewï¼‰ ==== */
(async function init(){
  const params = new URLSearchParams(location.search);
  const isPreview = params.get('preview') === '1';

  let user = null;

  // 1ï¸âƒ£ å…ˆç”¨ player.html å°ˆç”¨çš„ bwPlayerGetUser() å–å¾—ç™»å…¥ä½¿ç”¨è€…
  try {
    if (typeof bwPlayerGetUser === 'function') {
      user = await bwPlayerGetUser();
    }
  } catch (e) {
    console.error('[BW-player] bwPlayerGetUser error', e);
  }

  // 2ï¸âƒ£ è‹¥æœªç™»å…¥ï¼šé preview ä¸€å¾‹å°å›é¦–é 
  if (!user) {
    if (!isPreview) {
      const next = location.pathname + location.search;
      const url = new URL('/EduEnglish/index.html', location.origin);
      url.searchParams.set('denied', 'signin');
      url.searchParams.set('next', next);
      location.href = url.toString();
      return;
    }
  } else {
    // é¡¯ç¤ºç™»å…¥è€… Email
    const email = user.email || (user.user && user.user.email) || '';
    if (email) {
      const badge = $('#userNameBadge');
      if (badge) badge.textContent = email;
    }
  }

  // 3ï¸âƒ£ å·²ç™»å…¥ä¸”é previewï¼šæª¢æŸ¥ profiles.expires_atï¼ˆä½¿ç”¨ playerSupaï¼‰
  let validUntil = null;
  if (!isPreview && user) {
    try {
      if (typeof playerSupa !== 'undefined') {
        const { data, error } = await playerSupa
          .from('profiles')
          .select('expires_at')
          .eq('id', user.id)
          .maybeSingle();
        if (!error && data && data.expires_at) {
          validUntil = new Date(data.expires_at);
        }
        console.log('[BW-player] expires_at raw =', data && data.expires_at, 'parsed =', validUntil);
      } else {
        console.warn('[BW-player] playerSupa not defined for subscription check');
      }
    } catch (e) {
      console.error('[BW-player] check subscription error', e);
    }

    const today = new Date();
    today.setHours(0, 0, 0, 0);

    // åªæœ‰åœ¨ã€Œæœ‰å–å¾—æœ‰æ•ˆæ—¥æœŸã€çš„æƒ…æ³ä¸‹æ‰åšéæœŸåˆ¤æ–·
    if (validUntil instanceof Date && !isNaN(validUntil.getTime())) {
      if (validUntil.getTime() < today.getTime()) {
        const next = location.pathname + location.search;
        const url = new URL('/EduEnglish/pricing.html', location.origin);
        url.searchParams.set('denied', 'expired');
        url.searchParams.set('next', next);
        location.href = url.toString();
        return;
      }
    }
  }

  // 4ï¸âƒ£ å®ˆé–€é€šéå¾Œï¼Œåˆå§‹åŒ–æ’­æ”¾å™¨ + è¼‰å…¥è³‡æ–™
  try {
    const saved = localStorage.getItem(`offset:${slug}`);
    if (saved != null) setOffset(parseFloat(saved)); else setOffset(0);

    const r = Number(speedRange.value) || 1;
    video.playbackRate = r;
    speedVal.textContent = `${r.toFixed(2)}x`;

    await loadVideo();
    await loadCues();
    await loadQuiz();
    await loadVocab();
    await loadAI();

    showTab('sub');
  } catch (e) {
    console.warn('[BW-player] init error:', e);
  }
})();
</script>
</body>
</html>






































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































































