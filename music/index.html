<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Music English</title>
<style>
  :root{--ink:#e6f0ff;--bg:#0b1520;--card:#0f2030;--line:#264a6a}
  *{box-sizing:border-box} body{margin:0;background:var(--bg);color:var(--ink);font-family:ui-sans-serif,system-ui}
  .wrap{max-width:1100px;margin:24px auto;padding:0 16px}
  a{color:inherit;text-decoration:none}
  .head{display:flex;justify-content:space-between;align-items:center;gap:12px;flex-wrap:wrap}
  .search{flex:1;min-width:260px;display:flex;gap:8px}
  .search input{flex:1;padding:10px 12px;border-radius:10px;border:1px solid var(--line);background:#0c1a28;color:var(--ink)}
  .grid{margin-top:16px;display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:16px}
  .card{background:var(--card);border:1px solid var(--line);border-radius:16px;overflow:hidden}
  .card img{width:100%;aspect-ratio:16/9;object-fit:cover;display:block}
  .meta{padding:12px 14px}
  .tag{font-size:12px;opacity:.8}
  .empty{opacity:.8;padding:32px;text-align:center;border:1px dashed var(--line);border-radius:12px}
</style>
</head>
<body>
  <div class="wrap">
    <div class="head">
      <h1 style="margin:0">🎵 聽音樂學英文</h1>
      <div class="search">
        <input id="m-search" placeholder="搜尋歌曲、歌手、主題…" />
        <a href="../index.html" class="btn" style="padding:10px 12px;border:1px solid var(--line);border-radius:10px">← 回首頁</a>
      </div>
    </div>
    <div id="list" class="grid"></div>
  </div>

<script type="module">
  const listEl = document.getElementById('list');
  const input  = document.getElementById('m-search');
  const items  = await (await fetch('./data/index.json')).json();

  const qs = new URLSearchParams(location.search);
  input.value = qs.get('q') || '';
  render(filter(items, input.value));

  input.addEventListener('input', () => {
    render(filter(items, input.value));
    const url = new URL(location);
    const q = input.value.trim();
    if (q) url.searchParams.set('q', q); else url.searchParams.delete('q');
    history.replaceState(null,'',url);
  });

  function filter(list, q){
    q=(q||'').toLowerCase();
    if(!q) return list;
    return list.filter(x =>
      [x.title,x.artist,x.topic,x.level].filter(Boolean).some(s=>s.toLowerCase().includes(q))
    );
  }

  function render(list){
    if(!list.length){
      listEl.innerHTML = `<div class="empty">沒有符合的結果。換個關鍵字試試看！</div>`;
      return;
    }
    listEl.innerHTML = list.map(x=>{
      const cover = `https://img.youtube.com/vi/${x.youtubeId}/hqdefault.jpg`;
      return `
        <a class="card" href="./player-music.html?slug=${encodeURIComponent(x.slug)}">
          <img src="${cover}" alt="${x.title}">
          <div class="meta">
            <div class="tag">${x.level} · ${x.topic||''}</div>
            <h3 style="margin:.4rem 0 0">${x.title}</h3>
            <div style="opacity:.85">${x.artist}</div>
          </div>
        </a>`;
    }).join('');
  }
</script>
</body>
</html>
