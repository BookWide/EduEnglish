<!DOCTYPE html><html lang="zh-Hant"><head><meta charset="utf-8"><meta name="viewport" content="width=device-width,initial-scale=1">
<title>BookWide Admin 主控台（白底）</title>
<style>:root{--bg:#fff;--fg:#111;--line:#e5e7eb;--soft:#f6f7f9;--accent:#0ea5e9;--radius:12px;--muted:#666}*{box-sizing:border-box}body{margin:0;background:var(--bg);color:var(--fg);font:16px/1.6 system-ui,Segoe UI,Roboto,Helvetica,Arial}header{position:sticky;top:0;background:#fff;border-bottom:1px solid var(--line);z-index:5}.wrap{max-width:1100px;margin:auto;padding:18px}h1{margin:6px 0 4px;font-size:24px}.tabs{display:flex;gap:10px;margin:10px 0 0}.tabbtn{padding:10px 14px;border:1px solid var(--line);background:var(--soft);border-radius:var(--radius);cursor:pointer}.tabbtn.active{background:var(--accent);color:#fff;border-color:var(--accent)}.panel{padding:16px}.hidden{display:none}.toolbar{display:flex;gap:10px;flex-wrap:wrap;align-items:center;margin:8px 0 12px}input[type=text],select{padding:10px 12px;border:1px solid var(--line);border-radius:10px;background:#fff}.btn{padding:10px 14px;border:1px solid var(--line);border-radius:10px;background:#fff;cursor:pointer}.btn.primary{background:var(--accent);color:#fff;border-color:var(--accent)}.card{border:1px solid var(--line);border-radius:var(--radius);padding:14px;background:#fff}table{width:100%;border-collapse:separate;border-spacing:0}th,td{padding:10px;border-bottom:1px solid var(--line);text-align:left}tr:hover td{background:#fafafa}.chip{display:inline-block;padding:2px 8px;border-radius:999px;border:1px solid var(--line);background:var(--soft);font-size:12px}.muted{color:var(--muted)}.mono{font-family:ui-monospace,Consolas,Menlo,monospace}footer{border-top:1px solid var(--line);text-align:center;color:#888;padding:12px 0;margin-top:20px;font-size:12px}</style>
<script type="module">import { supabase } from './supa.js';window.supa=supabase;</script></head>
<body><header><div class="wrap"><h1>BookWide Admin 主控台（白底）</h1><div class="tabs"><button class="tabbtn active" data-tab="users">使用者清單</button><button class="tabbtn" data-tab="roles">授權／暫停管理員</button><button class="tabbtn" data-tab="mp4">MP4 上傳自動化</button><span id="who" style="margin-left:auto" class="muted"></span></div></div></header>
<main class="wrap">
<section id="panel-users" class="panel"><div class="toolbar"><input id="q1" type="text" placeholder="搜尋 Email / 顯示名稱…"><button id="btnR1" class="btn">重新整理</button></div><div class="card"><table><thead><tr><th>Email</th><th>顯示名稱</th><th>狀態</th><th>最後登入（台灣）</th><th>最近在線（台灣）</th><th>到期日</th></tr></thead><tbody id="rows1"><tr><td colspan="6" class="muted">載入中…</td></tr></tbody></table></div></section>
<section id="panel-roles" class="panel hidden"><div class="toolbar"><input id="q2" type="text" placeholder="搜尋 Email / 顯示名稱…"><button id="btnR2" class="btn">重新整理</button></div><div class="card"><table><thead><tr><th>Email</th><th>顯示名稱</th><th>管理員</th><th>停權</th><th>暫停</th></tr></thead><tbody id="rows2"><tr><td colspan="5" class="muted">載入中…</td></tr></tbody></table></div></section>
<section id="panel-mp4" class="panel hidden"><div class="card"><p class="muted">白底樣式已套用，此分頁保留原功能位置。可銜接你現有的 MP4 自動化程式。</p><div class="toolbar"><select id="mp4Cat"><option value="story">story</option><option value="music">music</option><option value="movie">movie</option><option value="news">news</option><option value="pro">pro</option></select><input id="mp4Slug" type="text" placeholder="Slug（不含空白與中文）"><button class="btn primary" disabled>上傳（預留）</button></div></div></section>
</main>
<footer>BookWide Admin · v20251104 · white theme</footer>
<script type="module">
  const $=s=>document.querySelector(s), $$=s=>[...document.querySelectorAll(s)];
  const fmtTW = v => v ? new Date(v).toLocaleString('zh-TW',{timeZone:'Asia/Taipei',hour12:false}) : '<span class="muted">—</span>';
  const COLS='id,email,display_name,is_admin,is_suspended,is_paused,last_sign_in_at,last_seen_at,expires_at';
  const state={u:[],r:[]};
  $$('.tabbtn').forEach(b=>b.onclick=()=>{$$('.tabbtn').forEach(x=>x.classList.remove('active'));b.classList.add('active');['users','roles','mp4'].forEach(k=>$('#panel-'+k).classList.add('hidden'));$('#panel-'+b.dataset.tab).classList.remove('hidden');});
  (async()=>{const {data:{user}}=await supa.auth.getUser();$('#who').textContent=user?`已登入：${user.email}`:'未登入';})();
  async function loadUsers(){ $('#rows1').innerHTML='<tr><td colspan="6" class="muted">載入中…</td></tr>'; const r=await supa.from('profiles').select(COLS).order('email',{ascending:true}); if(r.error){$('#rows1').innerHTML=`<tr><td colspan="6" class="muted">讀取失敗：${r.error.message}</td></tr>`;return;} state.u=r.data||[]; renderUsers(); }
  function renderUsers(){ const q=$('#q1').value?.toLowerCase()||''; const rows=state.u.filter(x=> (x.email||'').toLowerCase().includes(q) || (x.display_name||'').toLowerCase().includes(q)); if(rows.length===0){$('#rows1').innerHTML='<tr><td colspan="6" class="muted">無資料</td></tr>';return;} $('#rows1').innerHTML=rows.map(x=>`<tr><td class="mono">${x.email||''}</td><td>${x.display_name||''}</td><td>${x.is_suspended?'<span class=chip>停權</span>':'<span class=chip>正常</span>'}${x.is_paused?'<span class=chip>暫停</span>':''}${x.is_admin?'<span class=chip>管理員</span>':''}</td><td>${fmtTW(x.last_sign_in_at)}</td><td>${fmtTW(x.last_seen_at)}</td><td>${x.expires_at||'<span class=muted>—</span>'}</td></tr>`).join(''); }
  async function loadRoles(){ $('#rows2').innerHTML='<tr><td colspan="5" class="muted">載入中…</td></tr>'; const r=await supa.from('profiles').select(COLS).order('email',{ascending:true}); if(r.error){$('#rows2').innerHTML=`<tr><td colspan="5" class="muted">讀取失敗：${r.error.message}</td></tr>`;return;} state.r=r.data||[]; renderRoles(); }
  function renderRoles(){ const q=$('#q2').value?.toLowerCase()||''; const rows=state.r.filter(x=> (x.email||'').toLowerCase().includes(q) || (x.display_name||'').toLowerCase().includes(q)); if(rows.length===0){$('#rows2').innerHTML='<tr><td colspan="5" class="muted">無資料</td></tr>';return;} $('#rows2').innerHTML=rows.map(x=>`<tr><td class="mono">${x.email||''}</td><td>${x.display_name||''}</td><td><input type="checkbox" data-k="is_admin" data-id="${x.id}" ${x.is_admin?'checked':''}></td><td><input type="checkbox" data-k="is_suspended" data-id="${x.id}" ${x.is_suspended?'checked':''}></td><td><input type="checkbox" data-k="is_paused" data-id="${x.id}" ${x.is_paused?'checked':''}></td></tr>`).join(''); $$('#rows2 input[type=checkbox]').forEach(el=>{ el.onchange=async()=>{ const {id,k}=el.dataset; const val=el.checked; el.disabled=true; const {error}=await supa.from('profiles').update({[k]:val}).eq('id',id); if(error){ alert('更新失敗：'+error.message); el.checked=!val; } el.disabled=false; }; }); }
  $('#q1').oninput=renderUsers; $('#btnR1').onclick=loadUsers; $('#q2').oninput=renderRoles; $('#btnR2').onclick=loadRoles;
  await Promise.all([loadUsers(), loadRoles()]);
</script></body></html>











