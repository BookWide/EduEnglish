<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BookWide Admin 主控台</title>
  <style>
    body{margin:0;font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',Roboto,'Noto Sans TC',sans-serif;background:#fff;color:#111;}
    header,main,footer{display:none;}
    .center{padding:40px;text-align:center;}
    .btn{display:inline-block;padding:8px 16px;background:#0b57d0;color:#fff;border-radius:6px;text-decoration:none;margin-top:16px;}
    .warn{color:#d97706;}
  </style>
  <script type="module">
    import { createClient } from 'https://esm.sh/@supabase/supabase-js';

    const SUPABASE_URL = 'https://jeajrwpmrgczimmrflxo.supabase.co';
    const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImplYWpyd3BtcmdjemltbXJmbHhvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NjA3MTg5MzksImV4cCI6MjA3NjI5NDkzOX0.3iFXdHH0JEuk177_R4TGFJmOxYK9V8XctON6rDe7-Do';
    const supa = createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

    (async()=>{
      const gate=document.getElementById('gate');
      try{
        const {data:{user},error:authErr}=await supa.auth.getUser();
        if(authErr||!user){
          gate.innerHTML=`<h2>尚未登入</h2><p>請先回首頁登入後再開啟 <b>admin.html</b>。</p><a href="index.html" class="btn">回首頁登入</a>`;return;
        }
        const {data,error}=await supa.from('profiles').select('is_admin').eq('id',user.id).maybeSingle();
        if(error||!data){
          gate.innerHTML=`<h2>無法確認管理員資格</h2><p class="warn">${error?.message||'查無資料'}</p>`;return;
        }
        if(!data.is_admin){
          gate.innerHTML=`<h2>拒絕訪問</h2><p>此帳號非管理員，無法使用主控台。</p><a href="index.html" class="btn">返回首頁</a>`;return;
        }
        // 通過
        gate.remove();
        document.querySelector('header').style.display='';
        document.querySelector('main').style.display='';
        document.querySelector('footer').style.display='';
      }catch(e){
        gate.innerHTML=`<h2>驗證錯誤</h2><p class="warn">${e.message}</p>`;
      }
    })();
  </script>
</head>
<body>
<div id="gate" class="center"><h2>正在驗證管理員身分...</h2><p class="warn">BookWide Admin 需要登入管理員帳號才能開啟。</p></div>

<header><h1>BookWide Admin 主控台</h1></header>
<main><p>✅ 守門測試頁 — 通過後才顯示主控台內容。</p></main>
<footer>BookWide Admin · Access Guard 版 v20251104</footer>
</body></html>













