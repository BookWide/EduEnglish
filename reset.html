<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>重設密碼｜BookWide</title>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
  <style>
    body { background:#0b1324; color:white; font-family:system-ui; padding:40px; }
    .box{ max-width:420px; margin:auto; padding:30px; background:#111a2b; border-radius:18px; }
    input{ width:100%; padding:14px; margin:10px 0; border-radius:10px; border:1px solid #334; background:#0f172a; color:white; }
    button{ width:100%; padding:14px; border-radius:10px; border:0; margin-top:10px;
      background:linear-gradient(90deg,#3b82f6,#22c55e); color:white; font-size:18px; }
    .err{ margin-top:10px; color:#f87171; font-size:14px; }
  </style>
</head>

<body>

<div class="box">
  <h2>重設密碼</h2>

  <div id="expired" style="display:none; color:#f87171;">
    驗證連結無效或已過期，請回登入畫面重新申請重設密碼。
  </div>

  <div id="formArea">
    <input id="pw1" type="password" placeholder="請輸入新密碼">
    <input id="pw2" type="password" placeholder="再次確認新密碼">
    <button id="btnReset">重設密碼</button>
    <div id="msg" class="err"></div>
  </div>
</div>

<script>
const supabase = supabase.createClient(
  "https://jeajrwpmrgczimmrflxo.supabase.co",
  "YOUR_PUBLIC_ANON_KEY"
);

(async () => {
  const hash = window.location.hash;  
  if (!hash || !hash.includes("access_token")) {
    document.getElementById("formArea").style.display = "none";
    document.getElementById("expired").style.display = "block";
    return;
  }

  // 將 token 寫入 local session
  const { data, error } = await supabase.auth.getSessionFromUrl({ storeSession: true });
  if (error) {
    document.getElementById("formArea").style.display = "none";
    document.getElementById("expired").style.display = "block";
  }
})();

document.getElementById("btnReset").onclick = async () => {
  const pw1 = pw1.value.trim();
  const pw2 = pw2.value.trim();
  const msg = document.getElementById("msg");

  if (pw1.length < 6) return msg.textContent = "密碼至少 6 字元";
  if (pw1 !== pw2) return msg.textContent = "兩次密碼不一致";

  msg.textContent = "";

  const { error } = await supabase.auth.updateUser({ password: pw1 });
  if (error) {
    msg.textContent = error.message;
  } else {
    msg.style.color = "#4ade80";
    msg.textContent = "密碼更新成功，請返回登入畫面重新登入。";
  }
};
</script>

</body>
</html>



















