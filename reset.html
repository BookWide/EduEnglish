<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>重設密碼｜BookWide</title>
</head>

<body>

<h2>重設密碼</h2>

<div id="step1">
  <p>請輸入新密碼：</p>
  <input id="newPassword" type="password" placeholder="新密碼" />
  <button onclick="updatePassword()">更新密碼</button>
</div>

<div id="result"></div>

<script type="module">
import { createClient } from "https://esm.sh/@supabase/supabase-js@2";

const supabase = createClient(
  "https://jeajrwpmrgczimmrflxo.supabase.co",
  "你的 anon key（不用 service key）"
);

// 從 URL 抓 access_token
const params = new URLSearchParams(window.location.hash.substring(1));
const access_token = params.get("access_token");

if (!access_token) {
  document.querySelector("#step1").style.display = "none";
  document.querySelector("#result").innerText =
    "驗證連結無效或已過期，請重新從信箱點擊連結再試一次。";
}

// 設定 token（很重要）
await supabase.auth.setSession({
  access_token,
  refresh_token: params.get("refresh_token"),
});

async function updatePassword() {
  const newPassword = document.getElementById("newPassword").value;

  const { data, error } = await supabase.auth.updateUser({
    password: newPassword,
  });

  if (error) {
    document.querySelector("#result").innerText = "更新失敗：" + error.message;
  } else {
    document.querySelector("#result").innerText = "密碼重設成功！";
    document.querySelector("#step1").style.display = "none";
  }
}
</script>

</body>
</html>



