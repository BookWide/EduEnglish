<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>é‡è¨­å¯†ç¢¼ï½œBookWide</title>

  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

  <style>
    body { background:#0b1324; color:white; font-family:sans-serif; }
    .card { width:420px; margin:80px auto; padding:30px; background:#111a2b; border-radius:12px; }
    input { width:100%; padding:12px; border-radius:8px; margin:10px 0; background:#0f172a; border:1px solid #1e293b; color:white; }
    button { width:100%; padding:14px; margin-top:15px; background:linear-gradient(to right,#3b82f6,#22c55e); border:none; border-radius:8px; color:white; font-size:18px; }
    .error { color:#ff6565; margin-top:10px; }
  </style>
</head>

<body>
<div class="card">
  <h2>é‡è¨­å¯†ç¢¼</h2>

  <input id="pw1" type="password" placeholder="è«‹è¼¸å…¥æ–°å¯†ç¢¼">
  <input id="pw2" type="password" placeholder="å†ç¢ºèªæ–°å¯†ç¢¼">
  <button id="btnReset">é‡è¨­å¯†ç¢¼</button>

  <div id="msg" class="error"></div>
</div>

<script>
const supabase = supabase.createClient(
  "https://jeajrwpmrgczimmrflxo.supabase.co",
  "YOUR_ANON_KEY"
);

// ğŸ”¥ 1. è§£æ hash æŠ“ token
const hash = window.location.hash.substring(1);
const params = new URLSearchParams(hash);
const access_token = params.get("access_token");
const type = params.get("type");

// ğŸ”¥ 2. æª¢æŸ¥æ˜¯å¦å¾ email é‡è¨­é€£çµé€²ä¾†
if (!access_token || type !== "recovery") {
  document.getElementById("msg").textContent =
    "å°šæœªå®Œæˆèº«åˆ†é©—è­‰ï¼Œè«‹å¾ä¿¡ç®±ã€Reset Passwordã€é€£çµé€²å…¥æœ¬é ã€‚";
}

// ğŸ”¥ 3. ä½¿ç”¨ token ç›´æ¥ç™»å…¥ï¼ˆSupabase è¦é€™æ¨£ï¼‰
if (access_token) {
  supabase.auth.setSession({
    access_token,
    refresh_token: access_token
  });
}

document.getElementById("btnReset").onclick = async () => {
  const pw1 = document.getElementById("pw1").value;
  const pw2 = document.getElementById("pw2").value;

  if (pw1 !== pw2) {
    document.getElementById("msg").textContent = "å¯†ç¢¼ä¸ä¸€è‡´";
    return;
  }

  const { data, error } = await supabase.auth.updateUser({ password: pw1 });

  if (error) {
    document.getElementById("msg").textContent = error.message;
  } else {
    alert("å¯†ç¢¼æ›´æ–°æˆåŠŸï¼Œè«‹è¿”å›ç™»å…¥ç•«é¢é‡æ–°ç™»å…¥ï¼");
    window.location.href = "login.html";
  }
};
</script>

</body>
</html>

















