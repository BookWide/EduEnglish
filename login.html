<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>登入｜BookWide</title>
  <meta name="description" content="BookWide 登入（Email/Password + Google OAuth）。" />
  <style>
    :root{
      --bg:#0b1324;
      --panel:#0f172a;
      --card:#0e1a33;
      --border:#1f2a44;
      --ink:#e6f0ff;
      --muted:#9fb0c9;
      --accent:#3c7cff;
      --danger:#ff6b6b;
      --radius:18px;
      --shadow:0 12px 40px rgba(0,0,0,.35);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:system-ui,-apple-system,BlinkMacSystemFont,"Noto Sans TC","Segoe UI",Roboto,Arial,sans-serif;
      background:radial-gradient(1200px 800px at 20% 10%, #152a5a 0%, rgba(21,42,90,0) 60%) , var(--bg);
      color:var(--ink);
      display:flex;
      align-items:center;
      justify-content:center;
      padding:24px;
    }
    a{color:var(--accent);text-decoration:none}
    .wrap{width:min(980px, 100%); display:grid; grid-template-columns: 1.2fr 1fr; gap:18px;}
    @media (max-width: 860px){ .wrap{grid-template-columns:1fr;} }
    .hero{
      background:linear-gradient(180deg, rgba(60,124,255,.16), rgba(0,0,0,0));
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:22px;
      box-shadow:var(--shadow);
      min-height: 420px;
    }
    .logo{display:flex; align-items:center; gap:10px; font-weight:800; letter-spacing:.5px; font-size:24px;}
    .badge{
      font-size:12px; color:var(--muted);
      border:1px solid var(--border);
      padding:4px 10px; border-radius:999px;
      background:rgba(255,255,255,.03);
    }
    .hero h1{margin:18px 0 8px; font-size:28px}
    .hero p{margin:0; color:var(--muted); line-height:1.7}
    .bullets{margin-top:18px; display:grid; gap:10px}
    .bullets div{
      background:rgba(255,255,255,.03);
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px 12px;
      color:var(--muted);
    }
    .card{
      background:linear-gradient(180deg, rgba(255,255,255,.04), rgba(255,255,255,.02));
      border:1px solid var(--border);
      border-radius:var(--radius);
      padding:20px;
      box-shadow:var(--shadow);
    }
    .row{display:flex; gap:10px; flex-wrap:wrap}
    .btn{
      appearance:none; border:1px solid var(--border);
      background:rgba(255,255,255,.04);
      color:var(--ink);
      padding:12px 14px;
      border-radius:14px;
      font-weight:700;
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      transition:.15s transform, .15s border-color, .15s background;
      user-select:none;
    }
    .btn:hover{transform:translateY(-1px); border-color:rgba(60,124,255,.6); background:rgba(60,124,255,.12)}
    .btn.primary{
      background:linear-gradient(180deg, rgba(60,124,255,.35), rgba(60,124,255,.18));
      border-color:rgba(60,124,255,.7);
    }
    .btn.block{width:100%}
    .btn:disabled{opacity:.55; cursor:not-allowed; transform:none}
    .sep{
      display:flex; align-items:center; gap:10px; margin:16px 0;
      color:var(--muted); font-size:12px;
    }
    .sep:before,.sep:after{content:""; height:1px; background:var(--border); flex:1}
    label{display:block; font-size:12px; color:var(--muted); margin:10px 0 6px}
    .ipt{
      width:100%;
      padding:12px 12px;
      border-radius:14px;
      border:1px solid var(--border);
      background:rgba(0,0,0,.22);
      color:var(--ink);
      outline:none;
    }
    .ipt:focus{border-color:rgba(60,124,255,.8)}
    .hint{margin-top:10px; font-size:12px; color:var(--muted); line-height:1.6}
    .msg{margin-top:12px; padding:10px 12px; border-radius:14px; border:1px solid var(--border); background:rgba(255,255,255,.03); color:var(--muted)}
    .msg.ok{border-color:rgba(34,197,94,.5); color:#bff3cd; background:rgba(34,197,94,.08)}
    .msg.err{border-color:rgba(255,107,107,.5); color:#ffd0d0; background:rgba(255,107,107,.08)}
    .foot{margin-top:14px; display:flex; justify-content:space-between; gap:10px; flex-wrap:wrap; font-size:12px; color:var(--muted)}
    code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,monospace; font-size:12px; color:#cfe2ff}
  
/* --- Password eye + autofill fix (QQ/Chrome) --- */
.pwRow{position:relative;display:flex;align-items:center}
.pwRow .ipt{padding-right:44px}
.pwEye{
  position:absolute; right:10px; top:50%; transform:translateY(-50%);
  border:0; background:transparent; color:var(--muted,#9fb0c9);
  cursor:pointer; padding:6px; border-radius:10px;
}
.pwEye:hover{background:rgba(255,255,255,.08); color:var(--ink,#e6f0ff)}
input:-webkit-autofill,
input:-webkit-autofill:hover,
input:-webkit-autofill:focus{
  -webkit-text-fill-color: var(--ink,#e6f0ff);
  transition: background-color 9999s ease-out 0s;
  box-shadow: 0 0 0px 1000px rgba(0,0,0,.25) inset;
}


/* === Login Patch (eye + QQ friendly) === */
.pwWrap{position:relative}
.pwWrap input{padding-right:44px}
.pwEye{position:absolute;right:10px;top:50%;transform:translateY(-50%);width:36px;height:36px;border-radius:12px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.06);color:var(--ink);display:inline-flex;align-items:center;justify-content:center;cursor:pointer}
.pwEye:hover{background:rgba(255,255,255,.10)}
.bw-toast{position:fixed;left:50%;bottom:18px;transform:translate(-50%,20px);opacity:0;transition:.25s;z-index:10000;
  padding:10px 14px;border-radius:14px;background:rgba(15,23,42,.92);color:#fff;border:1px solid rgba(255,255,255,.12);
  max-width:min(92vw,520px);font-size:14px}
.bw-toast.show{transform:translate(-50%,0);opacity:1}

</style>
  <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
</head>
<body>
  <div class="wrap">
    <section class="hero">
      <div class="logo">
        <span>BookWide</span>
        <span class="badge">Login</span>
      </div>
      <h1>登入你的學習帳號</h1>
      <p>支援 Email/密碼、以及 Google 一鍵登入。登入後會自動回到你原本想去的頁面（<code>?next=</code>）。</p>
      <div class="bullets">
        <div>✅ Google OAuth（走 Supabase Providers）</div>
        <div>✅ Email/Password 註冊 + 登入</div>
        <div>✅ 不依賴 player.html（不會動它）</div>
      </div>
      <div class="hint" style="margin-top:18px">
        用法：把這檔存成 <b>login.html</b> 放網站根目錄，然後你原本「未登入」導向的地方改成
        <code>/login.html?next=...</code>。
      </div>
    </section>

    <section class="card">
      <button id="btnGoogle" class="btn primary block" type="button">
        <span style="font-size:16px">G</span> 用 Google 登入
      </button>

      <div class="sep">或使用 Email</div>

      <label for="email">電子信箱</label>
      <input id="email" class="ipt" type="email" autocomplete="email" placeholder="you@example.com" />

      <label for="password">密碼</label>
      <div class="pwRow">
      <input id="password" class="ipt" type="password" autocomplete="current-password" placeholder="••••••••" />
      <button type="button" class="pwEye" id="pwEye" class="pwEye" aria-label="顯示或隱藏密碼" title="顯示/隱藏">
        <svg viewBox="0 0 24 24" width="18" height="18" aria-hidden="true"><path fill="currentColor" d="M12 5c5.5 0 9.8 4 11 7-1.2 3-5.5 7-11 7S2.2 15 1 12c1.2-3 5.5-7 11-7zm0 2C7.6 7 4.1 10 3.1 12 4.1 14 7.6 17 12 17s7.9-3 8.9-5C19.9 10 16.4 7 12 7zm0 2.5A2.5 2.5 0 1 1 9.5 12 2.5 2.5 0 0 1 12 9.5z"/></svg>
      </button>
    </div>
<div class="row" style="margin-top:12px">
        <button id="btnLogin" class="btn" type="button" style="flex:1">登入</button>
        <button id="btnSignup" class="btn" type="button" style="flex:1">新用戶註冊</button>
      </div>

      <div id="msg" class="msg" style="display:none"></div>

      <div class="foot">
        <a href="/index.html">← 回首頁</a>
        <a href="/reset.html">忘記密碼？</a>
      </div>

      <div class="hint">
        你只要改兩個常數：<br/>
        1) <code>SUPABASE_URL</code><br/>
        2) <code>SUPABASE_ANON_KEY</code>
      </div>
    </section>
  </div>

<script>
(function(){
  // BookWide login.html (QQ friendly: no async/await)
  var SUPABASE_URL = window.SUPABASE_URL || "https://YOUR_PROJECT.supabase.co";
  var SUPABASE_ANON_KEY = window.SUPABASE_ANON_KEY || "YOUR_SUPABASE_ANON_KEY";

  function toast(msg){
    var el = document.getElementById("toast");
    if (!el){
      el = document.createElement("div");
      el.id = "toast";
      el.className = "bw-toast";
      document.body.appendChild(el);
    }
    el.textContent = msg;
    el.classList.add("show");
    clearTimeout(window.__bw_toast_t);
    window.__bw_toast_t = setTimeout(function(){ el.classList.remove("show"); }, 2800);
  }

  if (!window.supabase || !window.supabase.createClient){
    toast("Supabase SDK 未載入");
    return;
  }
  if (SUPABASE_URL.indexOf("YOUR_PROJECT") >= 0 || SUPABASE_ANON_KEY.indexOf("YOUR_") >= 0){
    toast("請先在 login.html 設定 SUPABASE_URL / SUPABASE_ANON_KEY");
  }

  var sb = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY, {
    auth: { persistSession:true, autoRefreshToken:true, detectSessionInUrl:true }
  });

  function $(id){ return document.getElementById(id); }
  var emailEl = $("email");
  var passEl = $("password");
  var eyeBtn = $("pwEye");
  var loginBtn = $("btnLogin");
  var signupBtn = $("btnSignup");
  var googleBtn = $("btnGoogle");

  function setPwVisible(vis){
    if (!passEl) return;
    passEl.type = vis ? "text" : "password";
    if (eyeBtn) eyeBtn.setAttribute("aria-pressed", vis ? "true" : "false");
  }
  if (eyeBtn){
    eyeBtn.addEventListener("click", function(e){
      e.preventDefault();
      setPwVisible(passEl && passEl.type === "password");
    });
  }

  function doEmailLogin(isSignup){
    var email = emailEl ? (emailEl.value || "").trim() : "";
    var pass = passEl ? (passEl.value || "") : "";
    if (!email || !pass){ toast("請輸入 Email 與密碼"); return; }

    var p = isSignup
      ? sb.auth.signUp({ email: email, password: pass })
      : sb.auth.signInWithPassword({ email: email, password: pass });

    p.then(function(res){
      if (res && res.error){ toast(res.error.message || "登入失敗"); return; }
      // success -> go back
      var u = res && res.data ? (res.data.user || null) : null;
      var next = new URL(location.href).searchParams.get("next");
      location.href = next ? decodeURIComponent(next) : "/index.html";
    }).catch(function(err){
      console.warn(err);
      toast("登入程序錯誤（請看 Console）");
    });
  }

  if (loginBtn){
    loginBtn.addEventListener("click", function(e){ e.preventDefault(); doEmailLogin(false); });
  }
  if (signupBtn){
    signupBtn.addEventListener("click", function(e){ e.preventDefault(); doEmailLogin(true); });
  }
  if (passEl){
    passEl.addEventListener("keydown", function(e){
      if (e.key === "Enter"){ e.preventDefault(); doEmailLogin(false); }
    });
  }

  if (googleBtn){
    googleBtn.addEventListener("click", function(e){
      e.preventDefault();
      var next = new URL(location.href).searchParams.get("next");
      var redirectTo = location.origin + "/index.html";
      sb.auth.signInWithOAuth({
        provider:"google",
        options:{
          redirectTo: redirectTo,
          queryParams:{ prompt:"select_account" }
        }
      }).catch(function(err){
        console.warn(err);
        toast("Google 登入失敗");
      });
    });
  }
})();
</script>

</body>
</html>
