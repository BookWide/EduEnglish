<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8"/><title>é‡ç”¢å°ˆå®¶ V38 - è¦–è¦ºå¼•å°ç‰ˆ</title>
<style>
  :root{ --bg:#050a14; --panel:#111827; --text:#f3f4f6; --ok:#10b981; --btn:#3b82f6; --line:#374151; }
  body{ background:var(--bg); color:var(--text); font-family: system-ui; padding:20px; }
  .card{ background:var(--panel); border:1px solid var(--line); border-radius:16px; padding:20px; margin-bottom:20px; }
  .grid { display:grid; grid-template-columns: 1.5fr 1fr 1fr; gap:15px; }
  textarea, select, input { width:100%; background:#000; border:1px solid var(--line); color:#22c55e; border-radius:10px; padding:12px; outline:none; }
  .btn{ background:var(--btn); color:white; border:none; padding:15px; border-radius:10px; cursor:pointer; font-weight:bold; width:100%; }
  .img-ref-box { border: 2px dashed var(--line); padding: 15px; text-align: center; border-radius: 10px; color: #9ca3af; }
</style>
</head>
<body>

<div class="card">
  <h1>ğŸ¬ å½±éŸ³é‡ç”¢å·¥å»  V38 (è¦–è¦ºå¼•å°æ¨¡å¼)</h1>
  <p style="color:#9ca3af; font-size:13px;">æ€è·¯ï¼šå…ˆå®šè£ä¸€å¼µã€Œæ¯åœ–ã€ï¼Œå¾ŒçºŒä»»å‹™å°‡è‡ªå‹•ç¹¼æ‰¿æ¯åœ–çš„è¦–è¦ºé¢¨æ ¼ã€‚</p>
  
  <div class="grid">
    <div>
      <label>1. ä¸»è§’è¦–è¦º ID (æ¯åœ–ç‰¹å¾µ)</label>
      <textarea id="charSpec" rows="4" placeholder="ä¾‹ï¼šè«¸è‘›äº®ï¼Œç™½è¢ç¾½æ‰‡ï¼Œå´é¢ç‰¹å¯«..."></textarea>
    </div>
    <div class="img-ref-box">
      <label>2. è¦–è¦ºåƒè€ƒ (Img2Img æ¦‚å¿µ)</label>
      <div style="margin-top:10px; font-size:12px;">å°‡ä½ ã€Œåˆ‡ä¸‹ä¾†çš„åœ–ã€<br>åƒè€ƒçš„è¦–è¦ºæè¿°å¡«å…¥ä¸‹æ–¹</div>
      <input type="text" id="visualStyle" placeholder="ä¾‹ï¼šDark moody camp, cinematic light">
    </div>
    <div>
      <label>3. é¢¨æ ¼èˆ‡è¼‰å…¥</label>
      <select id="vCategory" style="margin-bottom:10px;">
        <option value="Epic cinematic style">å²è©©é›»å½±</option>
        <option value="Ink wash painting">æ°´å¢¨ç¹ªæœ¬</option>
      </select>
      <input type="file" id="srtFile" onchange="process()" />
    </div>
  </div>
  <button class="btn" style="background:var(--ok); margin-top:15px;" onclick="process()">âš¡ å»ºç«‹è¦–è¦ºé€£è²«ä»»å‹™æ¸…å–®</button>
</div>

<table id="mainTable" style="width:100%; border-collapse:collapse;">
  <thead>
    <tr style="text-align:left; color:#9ca3af;"><th>ä»»å‹™</th><th>åŠ‡æƒ… (MP3)</th><th>è¦–è¦ºæŒ‡ä»¤ (å°‡ç¹¼æ‰¿æ¯åœ–ç‰¹å¾µ)</th><th>åŸ·è¡Œ</th></tr>
  </thead>
  <tbody></tbody>
</table>

<script>
async function process() {
  const file = document.getElementById('srtFile').files[0];
  if(!file) return;
  const rawText = await file.text();
  const char = document.getElementById('charSpec').value;
  const vStyle = document.getElementById('visualStyle').value;
  
  const regex = /(\d+)\s+(\d{2}:\d{2}:\d{2},\d{3} --> \d{2}:\d{2}:\d{2},\d{3})\s+([\s\S]*?)(?=\n\d+\s+\d{2}:\d{2}:\d{2},\d{3} -->|$)/g;
  let match, srtData = [];
  while ((match = regex.exec(rawText)) !== null) {
    srtData.push(match[3].trim().replace(/\r?\n/g, " "));
  }

  const tbody = document.querySelector('#mainTable tbody');
  tbody.innerHTML = "";
  
  srtData.forEach((text, i) => {
    const id = `V_${String(i+1).padStart(3, '0')}`;
    // å¼·åˆ¶ç¹¼æ‰¿é‚è¼¯ï¼šè¦–è¦ºåƒè€ƒ + ä¸»è§’é–å®š + ç•¶å‰åŠ‡æƒ…
    const prompt = `Visual Reference: ${vStyle}. Character Lock: ${char}. Scene Action: ${text}. (Keep consistency with reference image)`;

    tbody.innerHTML += `
      <tr style="border-bottom:1px solid #374151;">
        <td style="padding:15px;">${id}</td>
        <td><textarea rows="2">${text}</textarea></td>
        <td><textarea rows="2">${prompt}</textarea></td>
        <td><button class="btn" style="padding:8px;" onclick="alert('é–‹å§‹ç”¢å‡ºå½±éŸ³...')">ç”¢å‡º</button></td>
      </tr>`;
  });
}
</script>
</body>
</html>
