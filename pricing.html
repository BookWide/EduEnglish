<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>BookWide | 方案與定價</title>
  <link rel="preconnect" href="https://cdn.jsdelivr.net">
  <style>
    :root{
      --bg:#fff; --text:#111; --muted:#666; --brand:#111; --pill:#f5f5f7; --border:#e5e7eb;
      --accent:#111; --accentText:#fff;
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--text);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial}
    .wrap{max-width:1080px;margin:auto;padding:24px}
    .bar{display:flex;justify-content:space-between;align-items:center;margin-bottom:8px}
    .brand{font-size:28px;font-weight:700;letter-spacing:1px}
    .announce{display:flex;gap:8px;align-items:center;background:#fafafa;border:1px solid var(--border);padding:12px 14px;border-radius:12px;color:#333}
    .announce .dot{width:8px;height:8px;border-radius:50%;background:#16a34a}
    .grid{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-top:18px}
    .card{border:1px solid var(--border);border-radius:16px;padding:16px;background:var(--pill)}
    .card h3{margin:2px 0 10px 0;font-size:20px}
    .price{color:#444;margin-bottom:10px}
    .card ul{margin:0 0 6px 18px;padding:0}
    .pick{display:flex;gap:12px;justify-content:center;margin:22px 0}
    .pill{border:1px solid var(--border);padding:10px 14px;border-radius:999px;background:#fff}
    .act{background:var(--accent);color:var(--accentText);border-color:#111}
    .btn{display:inline-flex;gap:8px;align-items:center;justify-content:center;background:#111;color:#fff;border:none;border-radius:12px;padding:12px 20px;font-weight:700;cursor:pointer}
    .topics{display:flex;gap:10px;flex-wrap:wrap;justify-content:center;margin:16px 0}
    .topic-btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border:1px solid var(--border);border-radius:999px;background:#fff;cursor:pointer}
    .topic-btn.sel{background:#111;color:#fff;border-color:#111}
    .muted{color:var(--muted)}
    footer{margin-top:36px;color:#888;text-align:center;font-size:14px}
    @media (max-width:960px){.grid{grid-template-columns:repeat(2,1fr)}}
    @media (max-width:640px){.grid{grid-template-columns:1fr} .brand{font-size:22px}}
  </style>
  <script type="module">
    import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/+esm";
    const el = (sel,root=document)=>root.querySelector(sel);
    const els = (sel,root=document)=>[...root.querySelectorAll(sel)];
    const params = new URLSearchParams(location.search);
    const SUPA_URL = params.get('supa_url') || window.SUPABASE_URL;
    const SUPA_KEY = params.get('supa_key') || window.SUPABASE_ANON_KEY;
    let sb = (SUPA_URL && SUPA_KEY) ? createClient(SUPA_URL, SUPA_KEY) : null;

    const DEFAULT_TOPICS = [
      {key:'story', title:'故事 Story', month:200, description:'分級故事影片與字幕\n單字／文法／閱讀測驗\n可列印成績單'},
      {key:'music', title:'音樂 Music', month:200, description:'歌曲影片，歌詞雙語字幕\n關鍵單詞小測驗\n收藏精選歌曲'},
      {key:'movie', title:'電影 Movie', month:200, description:'電影片段學英文\n情境會話／片語重點\n主題測驗可列印'},
      {key:'news',  title:'新聞 News', month:200, description:'國際新聞精讀\n重點單字／時事測驗\n每週更新'},
      {key:'pro',   title:'專業行業 Professional', month:200, description:'商務／科技／設計等領域\n商務情境對話\n術語與案例剖析'},
    ];

    const state = {
      plan: 'monthly',
      selected: new Set(),
      topics: DEFAULT_TOPICS,
      notice: '系統公告：若價格調整，將提前一個月於此公告。'
    };

    function renderTopics(){
      const box = el('#topics');
      box.innerHTML = state.topics.map(t=>{
        const lines = (t.description||'').split(/\n+/).filter(Boolean);
        return `
          <div class="card">
            <h3>${t.title}</h3>
            <div class="price">NT$${t.month||200} / 月</div>
            <ul>${lines.map(x=>`<li>${x}</li>`).join('')}</ul>
            <label class="topic-btn ${state.selected.has(t.key)?'sel':''}" data-key="${t.key}">
              <input type="checkbox" hidden ${state.selected.has(t.key)?'checked':''}/>
              勾選這個主題
            </label>
          </div>`;
      }).join('');

      els('.topic-btn',box).forEach(b=>{
        b.addEventListener('click',()=>{
          const k = b.dataset.key;
          if(state.selected.has(k)) state.selected.delete(k); else state.selected.add(k);
          b.classList.toggle('sel');
        });
      });
    }

    function renderPlan(){
      els('.pill').forEach(p=>p.classList.remove('act'));
      el(`[data-plan="${state.plan}"]`).classList.add('act');
    }

    async function boot(){
      if(sb){
        try{
          const { data: s } = await sb.from('pricing_settings').select('*').single();
          if(s && s.notice_text) state.notice = s.notice_text;
        }catch(e){}
        try{
          const { data: t } = await sb.from('pricing_topics').select('*').order('sort',{ascending:true});
          if(Array.isArray(t) && t.length){
            state.topics = t.map(r=>({
              key: r.key || r.slug || r.id || 'x',
              title: r.title || r.name,
              month: r.month_price ?? 200,
              description: r.description || ''
            }));
          }
        }catch(e){}
      }
      el('#notice').textContent = state.notice;
      renderTopics();
      renderPlan();
      el('#goCheckout').addEventListener('click',()=>{
        const topics = [...state.selected].join(',');
        const plan = state.plan;
        const url = new URL('./checkout.html', location.origin + location.pathname.replace(/[^\/]+$/,''));
        if(topics) url.searchParams.set('topics', topics);
        url.searchParams.set('plan', plan);
        location.href = url.toString();
      });
      els('[data-plan]').forEach(btn=>btn.addEventListener('click',()=>{
        state.plan = btn.dataset.plan;
        renderPlan();
      }));
    }
    window.addEventListener('DOMContentLoaded', boot);
  </script>
</head>
<body>
  <div class="wrap">
    <div class="bar">
      <div class="brand">BookWide｜方案與定價</div>
    </div>

    <div class="announce"><span class="dot"></span><span id="notice">系統公告：若價格調整，將提前一個月於此公告。</span></div>

    <h2 class="muted" style="margin:18px 0 6px">選擇主題</h2>
    <div id="topics" class="grid"></div>

    <h2 class="muted" style="margin:22px 0 8px">選擇方案</h2>
    <div class="pick">
      <button class="pill act" data-plan="monthly">月繳 NT$200 / 主題</button>
      <button class="pill" data-plan="halfyear">半年 NT$960 / 主題</button>
      <button class="pill" data-plan="yearly">年繳 NT$1680 / 主題</button>
    </div>

    <div style="text-align:center;margin:20px 0">
      <button id="goCheckout" class="btn">前往結帳</button>
    </div>

    <footer>BookWide © 2025</footer>
  </div>
</body>
</html>




