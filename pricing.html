<!doctype html>
<html lang="zh-Hant">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BookWide｜結帳（訂閱方案）</title>
  <style>
    :root{
      --fg:#111;
      --bg:#f7f8fa;
      --card:#fff;
      --muted:#6b7280;
      --line:#e5e7eb;
      --brand:#111;
      --ok:#0a7f2e;
      --bad:#b91c1c;
    }
    *{box-sizing:border-box;}
    body{
      margin:0;
      background:var(--bg);
      color:var(--fg);
      font:15px/1.7 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans TC","PingFang TC","Microsoft JhengHei",sans-serif;
    }
    header{
      border-bottom:1px solid var(--line);
      background:#fff;
    }
    .wrap{
      max-width:980px;
      margin:0 auto;
      padding:18px 16px 32px;
    }
    .nav{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:16px;
    }
    .nav-title{
      font-size:22px;
      font-weight:800;
      letter-spacing:.04em;
    }
    .nav-back{
      font-size:14px;
      color:#2563eb;
      text-decoration:none;
    }
    .nav-back:hover{text-decoration:underline;}

    main{margin-top:18px;}
    .section{
      background:var(--card);
      border-radius:16px;
      border:1px solid var(--line);
      padding:18px 18px 20px;
      margin-bottom:18px;
    }
    .section h2{
      margin:0 0 10px;
      font-size:18px;
    }
    .section-sub{
      margin-top:-2px;
      margin-bottom:10px;
      color:var(--muted);
      font-size:13px;
    }

    .chips{
      display:flex;
      flex-wrap:wrap;
      gap:6px;
      margin:2px 0 10px;
    }
    .chip{
      padding:4px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#f9fafb;
      font-size:13px;
    }

    .plan-row{
      margin-top:4px;
      font-size:14px;
    }
    .plan-price{
      margin-top:6px;
      font-size:26px;
      font-weight:800;
    }
    .plan-price small{
      font-size:13px;
      font-weight:400;
      color:var(--muted);
      margin-left:4px;
    }
    .plan-note{
      margin-top:8px;
      font-size:13px;
      color:var(--muted);
    }

    textarea{
      width:100%;
      min-height:110px;
      padding:10px;
      border-radius:10px;
      border:1px solid var(--line);
      resize:vertical;
      font:14px/1.6 inherit;
    }
    textarea:focus{
      outline:2px solid #d1e0ff;
      outline-offset:1px;
      border-color:#2563eb;
    }

    .field-label{
      font-size:14px;
      margin-bottom:4px;
    }
    .hint{
      font-size:12px;
      color:var(--muted);
      margin-top:4px;
    }

    .pay-options{
      display:flex;
      flex-wrap:wrap;
      gap:12px;
      margin-top:4px;
    }
    .pay-pill{
      display:inline-flex;
      align-items:center;
      gap:6px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid var(--line);
      background:#f9fafb;
      font-size:14px;
      cursor:pointer;
    }
    .pay-pill input{
      accent-color:#111;
    }

    .actions{
      display:flex;
      flex-wrap:wrap;
      gap:10px;
      margin-top:14px;
    }
    button{
      font:14px/1.4 inherit;
      cursor:pointer;
      border-radius:10px;
      border:1px solid transparent;
      padding:9px 16px;
    }
    .btn-primary{
      background:#111;
      color:#fff;
      border-color:#111;
    }
    .btn-primary:disabled{
      opacity:.5;
      cursor:not-allowed;
    }
    .btn-ghost{
      background:#fff;
      color:#111;
      border-color:var(--line);
    }

    .msg{
      margin-top:10px;
      font-size:13px;
    }
    .msg-ok{color:var(--ok);}
    .msg-bad{color:var(--bad);}

    footer{
      text-align:center;
      padding:20px 0 30px;
      color:var(--muted);
      font-size:13px;
    }

    @media (max-width:640px){
      .wrap{padding:14px 12px 28px;}
      .section{padding:14px 12px 16px;}
      .plan-price{font-size:22px;}
    }
  </style>
</head>
<body>
<header>
  <div class="wrap nav">
    <div>
      <div class="nav-title">BookWide｜結帳</div>
      <div style="font-size:12px;color:var(--muted);margin-top:2px;">
        請確認訂閱方案與金額，若有誤可先回 pricing.html 重新選擇。
      </div>
    </div>
    <a href="pricing.html" class="nav-back">← 回方案與定價</a>
  </div>
</header>

<main class="wrap">

  <!-- 訂閱方案 -->
  <section class="section">
    <h2>訂閱方案</h2>
    <div class="section-sub">以下內容由 pricing.html 帶入：</div>

    <div id="topicChips" class="chips"></div>

    <div class="plan-row">
      方案期間：<span id="planPeriod" style="font-weight:600;">（尚未帶入）</span>
    </div>

    <div id="planPrice" class="plan-price">
      0 元 <small>（由 pricing.html 傳入）</small>
    </div>

    <div class="plan-note">
      若金額或項目不正確，請先回 pricing.html 重新選擇方案再進入本頁。
    </div>
  </section>

  <!-- 備註 / 發票 -->
  <section class="section">
    <h2>備註／發票資訊（選填）</h2>
    <p class="section-sub">
      如需填寫統編、抬頭，或其他備註，請在此留下（選填）。
    </p>

    <div class="field">
      <div class="field-label">備註內容</div>
      <textarea id="note" placeholder="此欄位內容會一起寫入訂單，並附在通知 email 中。"></textarea>
      <div class="hint">例：XX 公司，統編 12345678，抬頭：OOO。</div>
    </div>
  </section>

  <!-- 付款方式 -->
  <section class="section">
    <h2>付款方式</h2>
    <p class="section-sub">目前為測試環境，可先使用「模擬付款成功」流程。</p>

    <div class="field-label">選擇付款方式</div>
    <div class="pay-options">
      <label class="pay-pill">
        <input type="radio" name="pay" value="sim" checked>
        模擬付款（測試用）
      </label>
      <label class="pay-pill">
        <input type="radio" name="pay" value="bank">
        匯款 / 轉帳
      </label>
      <label class="pay-pill">
        <input type="radio" name="pay" value="other">
        其他方式（之後再聯繫）
      </label>
    </div>

    <div class="actions">
      <button id="btnSubmit" class="btn-primary">模擬付款成功，建立訂單</button>
      <button id="btnPrint" class="btn-ghost" type="button">列印這一頁</button>
    </div>

    <div id="msgArea" class="msg"></div>
  </section>

</main>

<footer>BookWide © 2025</footer>

<script>
/* -------- 1. 從 URL 讀取 topics / plan -------- */
const url = new URL(location.href);
const topicsParam = (url.searchParams.get('topics') || '').trim();
const planKey = (url.searchParams.get('plan') || 'monthly').trim();

/* -------- 2. 主題對照表（chips 上的文字） -------- */
const TOPIC_LABELS = {
  story:'故事 Story',
  music:'音樂 Music',
  movie:'電影 Movie',
  news :'新聞 News',
  pro  :'職場 Pro'
};

/* -------- 3. 方案金額對照表 -------- */
/* 這裡就是你要的 1000 / 5400 / 9600 */
const PLAN_SETTINGS = {
  monthly:{ label:'月方案',   amount:1000 },
  semi  :{ label:'半年方案', amount:5400 },
  yearly :{ label:'一年方案', amount:9600 }
};

/* -------- 4. 畫面渲染：主題 chips -------- */
function renderTopics(){
  const box = document.getElementById('topicChips');
  box.innerHTML = '';

  const keys = topicsParam
    ? topicsParam.split(',').map(s=>s.trim()).filter(Boolean)
    : Object.keys(TOPIC_LABELS); // 若沒帶參數就全顯示

  if(!keys.length){
    const span = document.createElement('span');
    span.textContent = '（尚未由 pricing.html 選擇主題）';
    span.style.color = '#9ca3af';
    span.style.fontSize = '13px';
    box.appendChild(span);
    return;
  }

  keys.forEach(k=>{
    const chip = document.createElement('div');
    chip.className = 'chip';
    chip.textContent = TOPIC_LABELS[k] || k;
    box.appendChild(chip);
  });

  return keys;
}

/* -------- 5. 畫面渲染：方案期間 + 金額 -------- */
function renderPlan(){
  const setting = PLAN_SETTINGS[planKey];
  const periodEl = document.getElementById('planPeriod');
  const priceEl  = document.getElementById('planPrice');

  if(!setting){
    periodEl.textContent = planKey || '（未知方案）';
    periodEl.style.color = '#b91c1c';
    priceEl.innerHTML = '0 元 <small>（方案代碼不正確，請回 pricing.html 重選）</small>';
    return { label:planKey, amount:0 };
  }

  periodEl.textContent = setting.label;
  const formatted = setting.amount.toLocaleString('zh-TW');
  priceEl.innerHTML = `${formatted} 元 <small>（由 pricing.html 傳入）</small>`;
  return setting;
}

/* -------- 6. 送出訂單（目前只模擬，保留未來接 Supabase 的空位） -------- */
function getSelectedPayMethod(){
  const r = document.querySelector('input[name="pay"]:checked');
  return r ? r.value : 'sim';
}

function showMessage(text, ok=true){
  const box = document.getElementById('msgArea');
  box.textContent = text;
  box.className = 'msg ' + (ok ? 'msg-ok' : 'msg-bad');
}

document.getElementById('btnSubmit').addEventListener('click', async ()=>{
  const topics = renderTopics();     // 目前畫面上的主題
  const plan   = renderPlan();       // {label, amount}
  const note   = document.getElementById('note').value.trim();
  const pay    = getSelectedPayMethod();

  if(!plan.amount){
    showMessage('方案金額為 0，可能是 URL 參數錯誤，請先回 pricing.html 重新選擇。', false);
    return;
  }

  const payload = {
    topics,
    plan_key: planKey,
    plan_label: plan.label,
    amount: plan.amount,
    pay_method: pay,
    note
  };

  // 目前先做「前端模擬成功」，之後你要接 Supabase Edge Function 再加在這裡即可：
  // 例如：
  // await fetch('https://xxxx.supabase.co/functions/v1/create-order', { method:'POST', body:JSON.stringify(payload) })

  console.log('模擬送出訂單 payload =', payload);
  showMessage('模擬付款成功！訂單已在前端建立（詳見 console）。實際上線時可在此接 Supabase Edge Function。', true);
});

/* -------- 7. 列印 -------- */
document.getElementById('btnPrint').addEventListener('click', ()=>{
  window.print();
});

/* -------- 8. 初始化畫面 -------- */
renderTopics();
renderPlan();
</script>
</body>
</html>















